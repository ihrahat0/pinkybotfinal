var pn=Object.defineProperty,dn=Object.defineProperties;var gn=Object.getOwnPropertyDescriptors;var Ee=Object.getOwnPropertySymbols;var kt=Object.prototype.hasOwnProperty,Bt=Object.prototype.propertyIsEnumerable;var St=(e,t,n)=>t in e?pn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,V=(e,t)=>{for(var n in t||(t={}))kt.call(t,n)&&St(e,n,t[n]);if(Ee)for(var n of Ee(t))Bt.call(t,n)&&St(e,n,t[n]);return e},z=(e,t)=>dn(e,gn(t));var Me=(e,t)=>{var n={};for(var r in e)kt.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&Ee)for(var r of Ee(e))t.indexOf(r)<0&&Bt.call(e,r)&&(n[r]=e[r]);return n};import{PublicKey as Ne}from"@solana/web3.js";import mn from"bn.js";import{PublicKey as B}from"@solana/web3.js";var $r=new B("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),ei=new B("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),ti=new B("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),ni=new B("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),ri=new B("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),ii=new B("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),oi=new B("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),si=new B("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),ai=new B("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),ui=new B("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),ci=new B("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),li=new B("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),fi=new B("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),mi=new B("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),hn=new B("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),bn=new B("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),yn=new B("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),wn=new B("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),pi=new B("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),di=new B("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),gi=new B("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Tn=new B("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),xn=new B("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Pn=new B("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),he={IDO_PROGRAM_ID_V1:hn,IDO_PROGRAM_ID_V2:bn,IDO_PROGRAM_ID_V3:yn,IDO_PROGRAM_ID_V4:wn};var hi={SERUM_MARKET:B.default,OPENBOOK_MARKET:new B("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:B.default,FarmV3:new B("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new B("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new B("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new B("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new B("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new B("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new B("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new B("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new B("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Tn,CREATE_CPMM_POOL_AUTH:xn,CREATE_CPMM_POOL_FEE_ACC:Pn,FEE_DESTINATION_ID:new B("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import{PublicKey as R,SystemProgram as Ct,SYSVAR_RENT_PUBKEY as An}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Sn}from"@solana/spl-token";function Qe({pubkey:e,isSigner:t=!1,isWritable:n=!0}){return{pubkey:e,isWritable:n,isSigner:t}}var xi=[Qe({pubkey:Sn,isWritable:!1}),Qe({pubkey:Ct.programId,isWritable:!1}),Qe({pubkey:An,isWritable:!1})];function It({publicKey:e,transformSol:t}){let n=$e(e.toString());if(n instanceof R)return t&&n.equals(be)?fe:n;if(t&&n.toString()===be.toBase58())return fe;if(typeof n=="string"){if(n===R.default.toBase58())return R.default;try{return new R(n)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function $e(e){try{return new R(e)}catch{return e}}var Pi=new R("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ai=new R("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),kn=new R("SysvarRent111111111111111111111111111111111"),Lt=new R("SysvarC1ock11111111111111111111111111111111"),Si=new R("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ki=new R("Sysvar1nstructions1111111111111111111111111"),Bn=Ct.programId,Bi=new R("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ci=new R("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Ii=new R("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Li=new R("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Ni=new R("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ei=new R("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Mi=new R("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Di=new R("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ri=new R("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),_i=new R("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Oi=new R("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),fe=new R("So11111111111111111111111111111111111111112"),be=R.default;import{PublicKey as qr}from"@solana/web3.js";import Gr from"bn.js";import Kr from"big.js";import Ye from"bn.js";import te from"bn.js";var me=9e15,oe=1e9,et="0123456789abcdef",Re="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",_e="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",tt={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-me,maxE:me,crypto:!1},Dt,Q,S=!0,ve="[DecimalError] ",ie=ve+"Invalid argument: ",Rt=ve+"Precision limit exceeded",_t=ve+"crypto unavailable",Ot="[object Decimal]",q=Math.floor,O=Math.pow,Cn=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,In=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Ln=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,vt=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Y=1e7,A=7,Nn=9007199254740991,En=Re.length-1,nt=_e.length-1,d={toStringTag:Ot};d.absoluteValue=d.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),P(e)};d.ceil=function(){return P(new this.constructor(this),this.e+1,2)};d.clampedTo=d.clamp=function(e,t){var n,r=this,i=r.constructor;if(e=new i(e),t=new i(t),!e.s||!t.s)return new i(NaN);if(e.gt(t))throw Error(ie+t);return n=r.cmp(e),n<0?e:r.cmp(t)>0?t:new i(r)};d.comparedTo=d.cmp=function(e){var t,n,r,i,o=this,s=o.d,a=(e=new o.constructor(e)).d,u=o.s,c=e.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==e.e)return o.e>e.e^u<0?1:-1;for(r=s.length,i=a.length,t=0,n=r<i?r:i;t<n;++t)if(s[t]!==a[t])return s[t]>a[t]^u<0?1:-1;return r===i?0:r>i^u<0?1:-1};d.cosine=d.cos=function(){var e,t,n=this,r=n.constructor;return n.d?n.d[0]?(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+A,r.rounding=1,n=Mn(r,Ut(r,n)),r.precision=e,r.rounding=t,P(Q==2||Q==3?n.neg():n,e,t,!0)):new r(1):new r(NaN)};d.cubeRoot=d.cbrt=function(){var e,t,n,r,i,o,s,a,u,c,l=this,f=l.constructor;if(!l.isFinite()||l.isZero())return new f(l);for(S=!1,o=l.s*O(l.s*l,1/3),!o||Math.abs(o)==1/0?(n=K(l.d),e=l.e,(o=(e-n.length+1)%3)&&(n+=o==1||o==-2?"0":"00"),o=O(n,1/3),e=q((e+1)/3)-(e%3==(e<0?-1:2)),o==1/0?n="5e"+e:(n=o.toExponential(),n=n.slice(0,n.indexOf("e")+1)+e),r=new f(n),r.s=l.s):r=new f(o.toString()),s=(e=f.precision)+3;;)if(a=r,u=a.times(a).times(a),c=u.plus(l),r=E(c.plus(l).times(a),c.plus(u),s+2,1),K(a.d).slice(0,s)===(n=K(r.d)).slice(0,s))if(n=n.slice(s-3,s+1),n=="9999"||!i&&n=="4999"){if(!i&&(P(a,e+1,0),a.times(a).times(a).eq(l))){r=a;break}s+=4,i=1}else{(!+n||!+n.slice(1)&&n.charAt(0)=="5")&&(P(r,e+1,1),t=!r.times(r).times(r).eq(l));break}return S=!0,P(r,e,f.rounding,t)};d.decimalPlaces=d.dp=function(){var e,t=this.d,n=NaN;if(t){if(e=t.length-1,n=(e-q(this.e/A))*A,e=t[e],e)for(;e%10==0;e/=10)n--;n<0&&(n=0)}return n};d.dividedBy=d.div=function(e){return E(this,new this.constructor(e))};d.dividedToIntegerBy=d.divToInt=function(e){var t=this,n=t.constructor;return P(E(t,new n(e),0,1,1),n.precision,n.rounding)};d.equals=d.eq=function(e){return this.cmp(e)===0};d.floor=function(){return P(new this.constructor(this),this.e+1,3)};d.greaterThan=d.gt=function(e){return this.cmp(e)>0};d.greaterThanOrEqualTo=d.gte=function(e){var t=this.cmp(e);return t==1||t===0};d.hyperbolicCosine=d.cosh=function(){var e,t,n,r,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;n=s.precision,r=s.rounding,s.precision=n+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(e=Math.ceil(i/3),t=(1/Ve(4,e)).toString()):(e=16,t="2.3283064365386962890625e-10"),o=pe(s,1,o.times(t),new s(1),!0);for(var u,c=e,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return P(o,s.precision=n,s.rounding=r,!0)};d.hyperbolicSine=d.sinh=function(){var e,t,n,r,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(t=o.precision,n=o.rounding,o.precision=t+Math.max(i.e,i.sd())+4,o.rounding=1,r=i.d.length,r<3)i=pe(o,2,i,i,!0);else{e=1.4*Math.sqrt(r),e=e>16?16:e|0,i=i.times(1/Ve(5,e)),i=pe(o,2,i,i,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);e--;)s=i.times(i),i=i.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=t,o.rounding=n,P(i,t,n,!0)};d.hyperbolicTangent=d.tanh=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+7,r.rounding=1,E(n.sinh(),n.cosh(),r.precision=e,r.rounding=t)):new r(n.s)};d.inverseCosine=d.acos=function(){var e,t=this,n=t.constructor,r=t.abs().cmp(1),i=n.precision,o=n.rounding;return r!==-1?r===0?t.isNeg()?Z(n,i,o):new n(0):new n(NaN):t.isZero()?Z(n,i+4,o).times(.5):(n.precision=i+6,n.rounding=1,t=t.asin(),e=Z(n,i+4,o).times(.5),n.precision=i,n.rounding=o,e.minus(t))};d.inverseHyperbolicCosine=d.acosh=function(){var e,t,n=this,r=n.constructor;return n.lte(1)?new r(n.eq(1)?0:NaN):n.isFinite()?(e=r.precision,t=r.rounding,r.precision=e+Math.max(Math.abs(n.e),n.sd())+4,r.rounding=1,S=!1,n=n.times(n).minus(1).sqrt().plus(n),S=!0,r.precision=e,r.rounding=t,n.ln()):new r(n)};d.inverseHyperbolicSine=d.asinh=function(){var e,t,n=this,r=n.constructor;return!n.isFinite()||n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+2*Math.max(Math.abs(n.e),n.sd())+6,r.rounding=1,S=!1,n=n.times(n).plus(1).sqrt().plus(n),S=!0,r.precision=e,r.rounding=t,n.ln())};d.inverseHyperbolicTangent=d.atanh=function(){var e,t,n,r,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(e=o.precision,t=o.rounding,r=i.sd(),Math.max(r,e)<2*-i.e-1?P(new o(i),e,t,!0):(o.precision=n=r-i.e,i=E(i.plus(1),new o(1).minus(i),n+e,1),o.precision=e+4,o.rounding=1,i=i.ln(),o.precision=e,o.rounding=t,i.times(.5))):new o(NaN)};d.inverseSine=d.asin=function(){var e,t,n,r,i=this,o=i.constructor;return i.isZero()?new o(i):(t=i.abs().cmp(1),n=o.precision,r=o.rounding,t!==-1?t===0?(e=Z(o,n+4,r).times(.5),e.s=i.s,e):new o(NaN):(o.precision=n+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=n,o.rounding=r,i.times(2)))};d.inverseTangent=d.atan=function(){var e,t,n,r,i,o,s,a,u,c=this,l=c.constructor,f=l.precision,m=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&f+4<=nt)return s=Z(l,f+4,m).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(f+4<=nt)return s=Z(l,f+4,m).times(.5),s.s=c.s,s}for(l.precision=a=f+10,l.rounding=1,n=Math.min(28,a/A+2|0),e=n;e;--e)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(S=!1,t=Math.ceil(a/A),r=1,u=c.times(c),s=new l(c),i=c;e!==-1;)if(i=i.times(u),o=s.minus(i.div(r+=2)),i=i.times(u),s=o.plus(i.div(r+=2)),s.d[t]!==void 0)for(e=t;s.d[e]===o.d[e]&&e--;);return n&&(s=s.times(2<<n-1)),S=!0,P(s,l.precision=f,l.rounding=m,!0)};d.isFinite=function(){return!!this.d};d.isInteger=d.isInt=function(){return!!this.d&&q(this.e/A)>this.d.length-2};d.isNaN=function(){return!this.s};d.isNegative=d.isNeg=function(){return this.s<0};d.isPositive=d.isPos=function(){return this.s>0};d.isZero=function(){return!!this.d&&this.d[0]===0};d.lessThan=d.lt=function(e){return this.cmp(e)<0};d.lessThanOrEqualTo=d.lte=function(e){return this.cmp(e)<1};d.logarithm=d.log=function(e){var t,n,r,i,o,s,a,u,c=this,l=c.constructor,f=l.precision,m=l.rounding,p=5;if(e==null)e=new l(10),t=!0;else{if(e=new l(e),n=e.d,e.s<0||!n||!n[0]||e.eq(1))return new l(NaN);t=e.eq(10)}if(n=c.d,c.s<0||!n||!n[0]||c.eq(1))return new l(n&&!n[0]?-1/0:c.s!=1?NaN:n?0:1/0);if(t)if(n.length>1)o=!0;else{for(i=n[0];i%10===0;)i/=10;o=i!==1}if(S=!1,a=f+p,s=re(c,a),r=t?Oe(l,a+10):re(e,a),u=E(s,r,a,1),ye(u.d,i=f,m))do if(a+=10,s=re(c,a),r=t?Oe(l,a+10):re(e,a),u=E(s,r,a,1),!o){+K(u.d).slice(i+1,i+15)+1==1e14&&(u=P(u,f+1,0));break}while(ye(u.d,i+=10,m));return S=!0,P(u,f,m)};d.minus=d.sub=function(e){var t,n,r,i,o,s,a,u,c,l,f,m,p=this,w=p.constructor;if(e=new w(e),!p.d||!e.d)return!p.s||!e.s?e=new w(NaN):p.d?e.s=-e.s:e=new w(e.d||p.s!==e.s?p:NaN),e;if(p.s!=e.s)return e.s=-e.s,p.plus(e);if(c=p.d,m=e.d,a=w.precision,u=w.rounding,!c[0]||!m[0]){if(m[0])e.s=-e.s;else if(c[0])e=new w(p);else return new w(u===3?-0:0);return S?P(e,a,u):e}if(n=q(e.e/A),l=q(p.e/A),c=c.slice(),o=l-n,o){for(f=o<0,f?(t=c,o=-o,s=m.length):(t=m,n=l,s=c.length),r=Math.max(Math.ceil(a/A),s)+2,o>r&&(o=r,t.length=1),t.reverse(),r=o;r--;)t.push(0);t.reverse()}else{for(r=c.length,s=m.length,f=r<s,f&&(s=r),r=0;r<s;r++)if(c[r]!=m[r]){f=c[r]<m[r];break}o=0}for(f&&(t=c,c=m,m=t,e.s=-e.s),s=c.length,r=m.length-s;r>0;--r)c[s++]=0;for(r=m.length;r>o;){if(c[--r]<m[r]){for(i=r;i&&c[--i]===0;)c[i]=Y-1;--c[i],c[r]+=Y}c[r]-=m[r]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--n;return c[0]?(e.d=c,e.e=Fe(c,n),S?P(e,a,u):e):new w(u===3?-0:0)};d.modulo=d.mod=function(e){var t,n=this,r=n.constructor;return e=new r(e),!n.d||!e.s||e.d&&!e.d[0]?new r(NaN):!e.d||n.d&&!n.d[0]?P(new r(n),r.precision,r.rounding):(S=!1,r.modulo==9?(t=E(n,e.abs(),0,3,1),t.s*=e.s):t=E(n,e,0,r.modulo,1),t=t.times(e),S=!0,n.minus(t))};d.naturalExponential=d.exp=function(){return rt(this)};d.naturalLogarithm=d.ln=function(){return re(this)};d.negated=d.neg=function(){var e=new this.constructor(this);return e.s=-e.s,P(e)};d.plus=d.add=function(e){var t,n,r,i,o,s,a,u,c,l,f=this,m=f.constructor;if(e=new m(e),!f.d||!e.d)return!f.s||!e.s?e=new m(NaN):f.d||(e=new m(e.d||f.s===e.s?f:NaN)),e;if(f.s!=e.s)return e.s=-e.s,f.minus(e);if(c=f.d,l=e.d,a=m.precision,u=m.rounding,!c[0]||!l[0])return l[0]||(e=new m(f)),S?P(e,a,u):e;if(o=q(f.e/A),r=q(e.e/A),c=c.slice(),i=o-r,i){for(i<0?(n=c,i=-i,s=l.length):(n=l,r=o,s=c.length),o=Math.ceil(a/A),s=o>s?o+1:s+1,i>s&&(i=s,n.length=1),n.reverse();i--;)n.push(0);n.reverse()}for(s=c.length,i=l.length,s-i<0&&(i=s,n=l,l=c,c=n),t=0;i;)t=(c[--i]=c[i]+l[i]+t)/Y|0,c[i]%=Y;for(t&&(c.unshift(t),++r),s=c.length;c[--s]==0;)c.pop();return e.d=c,e.e=Fe(c,r),S?P(e,a,u):e};d.precision=d.sd=function(e){var t,n=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(ie+e);return n.d?(t=Ft(n.d),e&&n.e+1>t&&(t=n.e+1)):t=NaN,t};d.round=function(){var e=this,t=e.constructor;return P(new t(e),e.e+1,t.rounding)};d.sine=d.sin=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+A,r.rounding=1,n=Rn(r,Ut(r,n)),r.precision=e,r.rounding=t,P(Q>2?n.neg():n,e,t,!0)):new r(NaN)};d.squareRoot=d.sqrt=function(){var e,t,n,r,i,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(S=!1,c=Math.sqrt(+s),c==0||c==1/0?(t=K(a),(t.length+u)%2==0&&(t+="0"),c=Math.sqrt(t),u=q((u+1)/2)-(u<0||u%2),c==1/0?t="5e"+u:(t=c.toExponential(),t=t.slice(0,t.indexOf("e")+1)+u),r=new l(t)):r=new l(c.toString()),n=(u=l.precision)+3;;)if(o=r,r=o.plus(E(s,o,n+2,1)).times(.5),K(o.d).slice(0,n)===(t=K(r.d)).slice(0,n))if(t=t.slice(n-3,n+1),t=="9999"||!i&&t=="4999"){if(!i&&(P(o,u+1,0),o.times(o).eq(s))){r=o;break}n+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(P(r,u+1,1),e=!r.times(r).eq(s));break}return S=!0,P(r,u,l.rounding,e)};d.tangent=d.tan=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+10,r.rounding=1,n=n.sin(),n.s=1,n=E(n,new r(1).minus(n.times(n)).sqrt(),e+10,0),r.precision=e,r.rounding=t,P(Q==2||Q==4?n.neg():n,e,t,!0)):new r(NaN)};d.times=d.mul=function(e){var t,n,r,i,o,s,a,u,c,l=this,f=l.constructor,m=l.d,p=(e=new f(e)).d;if(e.s*=l.s,!m||!m[0]||!p||!p[0])return new f(!e.s||m&&!m[0]&&!p||p&&!p[0]&&!m?NaN:!m||!p?e.s/0:e.s*0);for(n=q(l.e/A)+q(e.e/A),u=m.length,c=p.length,u<c&&(o=m,m=p,p=o,s=u,u=c,c=s),o=[],s=u+c,r=s;r--;)o.push(0);for(r=c;--r>=0;){for(t=0,i=u+r;i>r;)a=o[i]+p[r]*m[i-r-1]+t,o[i--]=a%Y|0,t=a/Y|0;o[i]=(o[i]+t)%Y|0}for(;!o[--s];)o.pop();return t?++n:o.shift(),e.d=o,e.e=Fe(o,n),S?P(e,f.precision,f.rounding):e};d.toBinary=function(e,t){return ot(this,2,e,t)};d.toDecimalPlaces=d.toDP=function(e,t){var n=this,r=n.constructor;return n=new r(n),e===void 0?n:(H(e,0,oe),t===void 0?t=r.rounding:H(t,0,8),P(n,e+n.e+1,t))};d.toExponential=function(e,t){var n,r=this,i=r.constructor;return e===void 0?n=X(r,!0):(H(e,0,oe),t===void 0?t=i.rounding:H(t,0,8),r=P(new i(r),e+1,t),n=X(r,!0,e+1)),r.isNeg()&&!r.isZero()?"-"+n:n};d.toFixed=function(e,t){var n,r,i=this,o=i.constructor;return e===void 0?n=X(i):(H(e,0,oe),t===void 0?t=o.rounding:H(t,0,8),r=P(new o(i),e+i.e+1,t),n=X(r,!1,e+r.e+1)),i.isNeg()&&!i.isZero()?"-"+n:n};d.toFraction=function(e){var t,n,r,i,o,s,a,u,c,l,f,m,p=this,w=p.d,g=p.constructor;if(!w)return new g(p);if(c=n=new g(1),r=u=new g(0),t=new g(r),o=t.e=Ft(w)-p.e-1,s=o%A,t.d[0]=O(10,s<0?A+s:s),e==null)e=o>0?t:c;else{if(a=new g(e),!a.isInt()||a.lt(c))throw Error(ie+a);e=a.gt(t)?o>0?t:c:a}for(S=!1,a=new g(K(w)),l=g.precision,g.precision=o=w.length*A*2;f=E(a,t,0,1,1),i=n.plus(f.times(r)),i.cmp(e)!=1;)n=r,r=i,i=c,c=u.plus(f.times(i)),u=i,i=t,t=a.minus(f.times(i)),a=i;return i=E(e.minus(n),r,0,1,1),u=u.plus(i.times(c)),n=n.plus(i.times(r)),u.s=c.s=p.s,m=E(c,r,o,1).minus(p).abs().cmp(E(u,n,o,1).minus(p).abs())<1?[c,r]:[u,n],g.precision=l,S=!0,m};d.toHexadecimal=d.toHex=function(e,t){return ot(this,16,e,t)};d.toNearest=function(e,t){var n=this,r=n.constructor;if(n=new r(n),e==null){if(!n.d)return n;e=new r(1),t=r.rounding}else{if(e=new r(e),t===void 0?t=r.rounding:H(t,0,8),!n.d)return e.s?n:e;if(!e.d)return e.s&&(e.s=n.s),e}return e.d[0]?(S=!1,n=E(n,e,0,t,1).times(e),S=!0,P(n)):(e.s=n.s,n=e),n};d.toNumber=function(){return+this};d.toOctal=function(e,t){return ot(this,8,e,t)};d.toPower=d.pow=function(e){var t,n,r,i,o,s,a=this,u=a.constructor,c=+(e=new u(e));if(!a.d||!e.d||!a.d[0]||!e.d[0])return new u(O(+a,c));if(a=new u(a),a.eq(1))return a;if(r=u.precision,o=u.rounding,e.eq(1))return P(a,r,o);if(t=q(e.e/A),t>=e.d.length-1&&(n=c<0?-c:c)<=Nn)return i=Vt(u,a,n,r),e.s<0?new u(1).div(i):P(i,r,o);if(s=a.s,s<0){if(t<e.d.length-1)return new u(NaN);if((e.d[t]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return n=O(+a,c),t=n==0||!isFinite(n)?q(c*(Math.log("0."+K(a.d))/Math.LN10+a.e+1)):new u(n+"").e,t>u.maxE+1||t<u.minE-1?new u(t>0?s/0:0):(S=!1,u.rounding=a.s=1,n=Math.min(12,(t+"").length),i=rt(e.times(re(a,r+n)),r),i.d&&(i=P(i,r+5,1),ye(i.d,r,o)&&(t=r+10,i=P(rt(e.times(re(a,t+n)),t),t+5,1),+K(i.d).slice(r+1,r+15)+1==1e14&&(i=P(i,r+1,0)))),i.s=s,S=!0,u.rounding=o,P(i,r,o))};d.toPrecision=function(e,t){var n,r=this,i=r.constructor;return e===void 0?n=X(r,r.e<=i.toExpNeg||r.e>=i.toExpPos):(H(e,1,oe),t===void 0?t=i.rounding:H(t,0,8),r=P(new i(r),e,t),n=X(r,e<=r.e||r.e<=i.toExpNeg,e)),r.isNeg()&&!r.isZero()?"-"+n:n};d.toSignificantDigits=d.toSD=function(e,t){var n=this,r=n.constructor;return e===void 0?(e=r.precision,t=r.rounding):(H(e,1,oe),t===void 0?t=r.rounding:H(t,0,8)),P(new r(n),e,t)};d.toString=function(){var e=this,t=e.constructor,n=X(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+n:n};d.truncated=d.trunc=function(){return P(new this.constructor(this),this.e+1,1)};d.valueOf=d.toJSON=function(){var e=this,t=e.constructor,n=X(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+n:n};function K(e){var t,n,r,i=e.length-1,o="",s=e[0];if(i>0){for(o+=s,t=1;t<i;t++)r=e[t]+"",n=A-r.length,n&&(o+=ne(n)),o+=r;s=e[t],r=s+"",n=A-r.length,n&&(o+=ne(n))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function H(e,t,n){if(e!==~~e||e<t||e>n)throw Error(ie+e)}function ye(e,t,n,r){var i,o,s,a;for(o=e[0];o>=10;o/=10)--t;return--t<0?(t+=A,i=0):(i=Math.ceil((t+1)/A),t%=A),o=O(10,A-t),a=e[i]%o|0,r==null?t<3?(t==0?a=a/100|0:t==1&&(a=a/10|0),s=n<4&&a==99999||n>3&&a==49999||a==5e4||a==0):s=(n<4&&a+1==o||n>3&&a+1==o/2)&&(e[i+1]/o/100|0)==O(10,t-2)-1||(a==o/2||a==0)&&(e[i+1]/o/100|0)==0:t<4?(t==0?a=a/1e3|0:t==1?a=a/100|0:t==2&&(a=a/10|0),s=(r||n<4)&&a==9999||!r&&n>3&&a==4999):s=((r||n<4)&&a+1==o||!r&&n>3&&a+1==o/2)&&(e[i+1]/o/1e3|0)==O(10,t-3)-1,s}function De(e,t,n){for(var r,i=[0],o,s=0,a=e.length;s<a;){for(o=i.length;o--;)i[o]*=t;for(i[0]+=et.indexOf(e.charAt(s++)),r=0;r<i.length;r++)i[r]>n-1&&(i[r+1]===void 0&&(i[r+1]=0),i[r+1]+=i[r]/n|0,i[r]%=n)}return i.reverse()}function Mn(e,t){var n,r,i;if(t.isZero())return t;r=t.d.length,r<32?(n=Math.ceil(r/3),i=(1/Ve(4,n)).toString()):(n=16,i="2.3283064365386962890625e-10"),e.precision+=n,t=pe(e,1,t.times(i),new e(1));for(var o=n;o--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return e.precision-=n,t}var E=function(){function e(r,i,o){var s,a=0,u=r.length;for(r=r.slice();u--;)s=r[u]*i+a,r[u]=s%o|0,a=s/o|0;return a&&r.unshift(a),r}function t(r,i,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(r[a]!=i[a]){u=r[a]>i[a]?1:-1;break}return u}function n(r,i,o,s){for(var a=0;o--;)r[o]-=a,a=r[o]<i[o]?1:0,r[o]=a*s+r[o]-i[o];for(;!r[0]&&r.length>1;)r.shift()}return function(r,i,o,s,a,u){var c,l,f,m,p,w,g,x,T,y,h,b,N,k,v,M,_,W,U,J,se=r.constructor,le=r.s==i.s?1:-1,F=r.d,D=i.d;if(!F||!F[0]||!D||!D[0])return new se(!r.s||!i.s||(F?D&&F[0]==D[0]:!D)?NaN:F&&F[0]==0||!D?le*0:le/0);for(u?(p=1,l=r.e-i.e):(u=Y,p=A,l=q(r.e/p)-q(i.e/p)),U=D.length,_=F.length,T=new se(le),y=T.d=[],f=0;D[f]==(F[f]||0);f++);if(D[f]>(F[f]||0)&&l--,o==null?(k=o=se.precision,s=se.rounding):a?k=o+(r.e-i.e)+1:k=o,k<0)y.push(1),w=!0;else{if(k=k/p+2|0,f=0,U==1){for(m=0,D=D[0],k++;(f<_||m)&&k--;f++)v=m*u+(F[f]||0),y[f]=v/D|0,m=v%D|0;w=m||f<_}else{for(m=u/(D[0]+1)|0,m>1&&(D=e(D,m,u),F=e(F,m,u),U=D.length,_=F.length),M=U,h=F.slice(0,U),b=h.length;b<U;)h[b++]=0;J=D.slice(),J.unshift(0),W=D[0],D[1]>=u/2&&++W;do m=0,c=t(D,h,U,b),c<0?(N=h[0],U!=b&&(N=N*u+(h[1]||0)),m=N/W|0,m>1?(m>=u&&(m=u-1),g=e(D,m,u),x=g.length,b=h.length,c=t(g,h,x,b),c==1&&(m--,n(g,U<x?J:D,x,u))):(m==0&&(c=m=1),g=D.slice()),x=g.length,x<b&&g.unshift(0),n(h,g,b,u),c==-1&&(b=h.length,c=t(D,h,U,b),c<1&&(m++,n(h,U<b?J:D,b,u))),b=h.length):c===0&&(m++,h=[0]),y[f++]=m,c&&h[0]?h[b++]=F[M]||0:(h=[F[M]],b=1);while((M++<_||h[0]!==void 0)&&k--);w=h[0]!==void 0}y[0]||y.shift()}if(p==1)T.e=l,Dt=w;else{for(f=1,m=y[0];m>=10;m/=10)f++;T.e=f+l*p-1,P(T,a?o+T.e+1:o,s,w)}return T}}();function P(e,t,n,r){var i,o,s,a,u,c,l,f,m,p=e.constructor;e:if(t!=null){if(f=e.d,!f)return e;for(i=1,a=f[0];a>=10;a/=10)i++;if(o=t-i,o<0)o+=A,s=t,l=f[m=0],u=l/O(10,i-s-1)%10|0;else if(m=Math.ceil((o+1)/A),a=f.length,m>=a)if(r){for(;a++<=m;)f.push(0);l=u=0,i=1,o%=A,s=o-A+1}else break e;else{for(l=a=f[m],i=1;a>=10;a/=10)i++;o%=A,s=o-A+i,u=s<0?0:l/O(10,i-s-1)%10|0}if(r=r||t<0||f[m+1]!==void 0||(s<0?l:l%O(10,i-s-1)),c=n<4?(u||r)&&(n==0||n==(e.s<0?3:2)):u>5||u==5&&(n==4||r||n==6&&(o>0?s>0?l/O(10,i-s):0:f[m-1])%10&1||n==(e.s<0?8:7)),t<1||!f[0])return f.length=0,c?(t-=e.e+1,f[0]=O(10,(A-t%A)%A),e.e=-t||0):f[0]=e.e=0,e;if(o==0?(f.length=m,a=1,m--):(f.length=m+1,a=O(10,A-o),f[m]=s>0?(l/O(10,i-s)%O(10,s)|0)*a:0),c)for(;;)if(m==0){for(o=1,s=f[0];s>=10;s/=10)o++;for(s=f[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(e.e++,f[0]==Y&&(f[0]=1));break}else{if(f[m]+=a,f[m]!=Y)break;f[m--]=0,a=1}for(o=f.length;f[--o]===0;)f.pop()}return S&&(e.e>p.maxE?(e.d=null,e.e=NaN):e.e<p.minE&&(e.e=0,e.d=[0])),e}function X(e,t,n){if(!e.isFinite())return Wt(e);var r,i=e.e,o=K(e.d),s=o.length;return t?(n&&(r=n-s)>0?o=o.charAt(0)+"."+o.slice(1)+ne(r):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(e.e<0?"e":"e+")+e.e):i<0?(o="0."+ne(-i-1)+o,n&&(r=n-s)>0&&(o+=ne(r))):i>=s?(o+=ne(i+1-s),n&&(r=n-i-1)>0&&(o=o+"."+ne(r))):((r=i+1)<s&&(o=o.slice(0,r)+"."+o.slice(r)),n&&(r=n-s)>0&&(i+1===s&&(o+="."),o+=ne(r))),o}function Fe(e,t){var n=e[0];for(t*=A;n>=10;n/=10)t++;return t}function Oe(e,t,n){if(t>En)throw S=!0,n&&(e.precision=n),Error(Rt);return P(new e(Re),t,1,!0)}function Z(e,t,n){if(t>nt)throw Error(Rt);return P(new e(_e),t,n,!0)}function Ft(e){var t=e.length-1,n=t*A+1;if(t=e[t],t){for(;t%10==0;t/=10)n--;for(t=e[0];t>=10;t/=10)n++}return n}function ne(e){for(var t="";e--;)t+="0";return t}function Vt(e,t,n,r){var i,o=new e(1),s=Math.ceil(r/A+4);for(S=!1;;){if(n%2&&(o=o.times(t),Et(o.d,s)&&(i=!0)),n=q(n/2),n===0){n=o.d.length-1,i&&o.d[n]===0&&++o.d[n];break}t=t.times(t),Et(t.d,s)}return S=!0,o}function Nt(e){return e.d[e.d.length-1]&1}function Kt(e,t,n){for(var r,i=new e(t[0]),o=0;++o<t.length;)if(r=new e(t[o]),r.s)i[n](r)&&(i=r);else{i=r;break}return i}function rt(e,t){var n,r,i,o,s,a,u,c=0,l=0,f=0,m=e.constructor,p=m.rounding,w=m.precision;if(!e.d||!e.d[0]||e.e>17)return new m(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:0/0);for(t==null?(S=!1,u=w):u=t,a=new m(.03125);e.e>-2;)e=e.times(a),f+=5;for(r=Math.log(O(2,f))/Math.LN10*2+5|0,u+=r,n=o=s=new m(1),m.precision=u;;){if(o=P(o.times(e),u,1),n=n.times(++l),a=s.plus(E(o,n,u,1)),K(a.d).slice(0,u)===K(s.d).slice(0,u)){for(i=f;i--;)s=P(s.times(s),u,1);if(t==null)if(c<3&&ye(s.d,u-r,p,c))m.precision=u+=10,n=o=a=new m(1),l=0,c++;else return P(s,m.precision=w,p,S=!0);else return m.precision=w,s}s=a}}function re(e,t){var n,r,i,o,s,a,u,c,l,f,m,p=1,w=10,g=e,x=g.d,T=g.constructor,y=T.rounding,h=T.precision;if(g.s<0||!x||!x[0]||!g.e&&x[0]==1&&x.length==1)return new T(x&&!x[0]?-1/0:g.s!=1?NaN:x?0:g);if(t==null?(S=!1,l=h):l=t,T.precision=l+=w,n=K(x),r=n.charAt(0),Math.abs(o=g.e)<15e14){for(;r<7&&r!=1||r==1&&n.charAt(1)>3;)g=g.times(e),n=K(g.d),r=n.charAt(0),p++;o=g.e,r>1?(g=new T("0."+n),o++):g=new T(r+"."+n.slice(1))}else return c=Oe(T,l+2,h).times(o+""),g=re(new T(r+"."+n.slice(1)),l-w).plus(c),T.precision=h,t==null?P(g,h,y,S=!0):g;for(f=g,u=s=g=E(g.minus(1),g.plus(1),l,1),m=P(g.times(g),l,1),i=3;;){if(s=P(s.times(m),l,1),c=u.plus(E(s,new T(i),l,1)),K(c.d).slice(0,l)===K(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(Oe(T,l+2,h).times(o+""))),u=E(u,new T(p),l,1),t==null)if(ye(u.d,l-w,y,a))T.precision=l+=w,c=s=g=E(f.minus(1),f.plus(1),l,1),m=P(g.times(g),l,1),i=a=1;else return P(u,T.precision=h,y,S=!0);else return T.precision=h,u;u=c,i+=2}}function Wt(e){return String(e.s*e.s/0)}function it(e,t){var n,r,i;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(n<0&&(n=r),n+=+t.slice(r+1),t=t.substring(0,r)):n<0&&(n=t.length),r=0;t.charCodeAt(r)===48;r++);for(i=t.length;t.charCodeAt(i-1)===48;--i);if(t=t.slice(r,i),t){if(i-=r,e.e=n=n-r-1,e.d=[],r=(n+1)%A,n<0&&(r+=A),r<i){for(r&&e.d.push(+t.slice(0,r)),i-=A;r<i;)e.d.push(+t.slice(r,r+=A));t=t.slice(r),r=A-t.length}else r-=i;for(;r--;)t+="0";e.d.push(+t),S&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function Dn(e,t){var n,r,i,o,s,a,u,c,l;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),vt.test(t))return it(e,t)}else if(t==="Infinity"||t==="NaN")return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(In.test(t))n=16,t=t.toLowerCase();else if(Cn.test(t))n=2;else if(Ln.test(t))n=8;else throw Error(ie+t);for(o=t.search(/p/i),o>0?(u=+t.slice(o+1),t=t.substring(2,o)):t=t.slice(2),o=t.indexOf("."),s=o>=0,r=e.constructor,s&&(t=t.replace(".",""),a=t.length,o=a-o,i=Vt(r,new r(n),o,o*2)),c=De(t,n,Y),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new r(e.s*0):(e.e=Fe(c,l),e.d=c,S=!1,s&&(e=E(e,i,a*4)),u&&(e=e.times(Math.abs(u)<54?O(2,u):Ke.pow(2,u))),S=!0,e)}function Rn(e,t){var n,r=t.d.length;if(r<3)return t.isZero()?t:pe(e,2,t,t);n=1.4*Math.sqrt(r),n=n>16?16:n|0,t=t.times(1/Ve(5,n)),t=pe(e,2,t,t);for(var i,o=new e(5),s=new e(16),a=new e(20);n--;)i=t.times(t),t=t.times(o.plus(i.times(s.times(i).minus(a))));return t}function pe(e,t,n,r,i){var o,s,a,u,c=1,l=e.precision,f=Math.ceil(l/A);for(S=!1,u=n.times(n),a=new e(r);;){if(s=E(a.times(u),new e(t++*t++),l,1),a=i?r.plus(s):r.minus(s),r=E(s.times(u),new e(t++*t++),l,1),s=a.plus(r),s.d[f]!==void 0){for(o=f;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=r,r=s,s=o,c++}return S=!0,s.d.length=f+1,s}function Ve(e,t){for(var n=e;--t;)n*=e;return n}function Ut(e,t){var n,r=t.s<0,i=Z(e,e.precision,1),o=i.times(.5);if(t=t.abs(),t.lte(o))return Q=r?4:1,t;if(n=t.divToInt(i),n.isZero())Q=r?3:2;else{if(t=t.minus(n.times(i)),t.lte(o))return Q=Nt(n)?r?2:3:r?4:1,t;Q=Nt(n)?r?1:4:r?3:2}return t.minus(i).abs()}function ot(e,t,n,r){var i,o,s,a,u,c,l,f,m,p=e.constructor,w=n!==void 0;if(w?(H(n,1,oe),r===void 0?r=p.rounding:H(r,0,8)):(n=p.precision,r=p.rounding),!e.isFinite())l=Wt(e);else{for(l=X(e),s=l.indexOf("."),w?(i=2,t==16?n=n*4-3:t==8&&(n=n*3-2)):i=t,s>=0&&(l=l.replace(".",""),m=new p(1),m.e=l.length-s,m.d=De(X(m),10,i),m.e=m.d.length),f=De(l,10,i),o=u=f.length;f[--u]==0;)f.pop();if(!f[0])l=w?"0p+0":"0";else{if(s<0?o--:(e=new p(e),e.d=f,e.e=o,e=E(e,m,n,r,0,i),f=e.d,o=e.e,c=Dt),s=f[n],a=i/2,c=c||f[n+1]!==void 0,c=r<4?(s!==void 0||c)&&(r===0||r===(e.s<0?3:2)):s>a||s===a&&(r===4||c||r===6&&f[n-1]&1||r===(e.s<0?8:7)),f.length=n,c)for(;++f[--n]>i-1;)f[n]=0,n||(++o,f.unshift(1));for(u=f.length;!f[u-1];--u);for(s=0,l="";s<u;s++)l+=et.charAt(f[s]);if(w){if(u>1)if(t==16||t==8){for(s=t==16?4:3,--u;u%s;u++)l+="0";for(f=De(l,i,t),u=f.length;!f[u-1];--u);for(s=1,l="1.";s<u;s++)l+=et.charAt(f[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(t==16?"0x":t==2?"0b":t==8?"0o":"")+l}return e.s<0?"-"+l:l}function Et(e,t){if(e.length>t)return e.length=t,!0}function _n(e){return new this(e).abs()}function On(e){return new this(e).acos()}function vn(e){return new this(e).acosh()}function Fn(e,t){return new this(e).plus(t)}function Vn(e){return new this(e).asin()}function Kn(e){return new this(e).asinh()}function Wn(e){return new this(e).atan()}function Un(e){return new this(e).atanh()}function qn(e,t){e=new this(e),t=new this(t);var n,r=this.precision,i=this.rounding,o=r+4;return!e.s||!t.s?n=new this(NaN):!e.d&&!t.d?(n=Z(this,o,1).times(t.s>0?.25:.75),n.s=e.s):!t.d||e.isZero()?(n=t.s<0?Z(this,r,i):new this(0),n.s=e.s):!e.d||t.isZero()?(n=Z(this,o,1).times(.5),n.s=e.s):t.s<0?(this.precision=o,this.rounding=1,n=this.atan(E(e,t,o,1)),t=Z(this,o,1),this.precision=r,this.rounding=i,n=e.s<0?n.minus(t):n.plus(t)):n=this.atan(E(e,t,o,1)),n}function Gn(e){return new this(e).cbrt()}function Hn(e){return P(e=new this(e),e.e+1,2)}function jn(e,t,n){return new this(e).clamp(t,n)}function zn(e){if(!e||typeof e!="object")throw Error(ve+"Object expected");var t,n,r,i=e.defaults===!0,o=["precision",1,oe,"rounding",0,8,"toExpNeg",-me,0,"toExpPos",0,me,"maxE",0,me,"minE",-me,0,"modulo",0,9];for(t=0;t<o.length;t+=3)if(n=o[t],i&&(this[n]=tt[n]),(r=e[n])!==void 0)if(q(r)===r&&r>=o[t+1]&&r<=o[t+2])this[n]=r;else throw Error(ie+n+": "+r);if(n="crypto",i&&(this[n]=tt[n]),(r=e[n])!==void 0)if(r===!0||r===!1||r===0||r===1)if(r)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[n]=!0;else throw Error(_t);else this[n]=!1;else throw Error(ie+n+": "+r);return this}function Zn(e){return new this(e).cos()}function Yn(e){return new this(e).cosh()}function qt(e){var t,n,r;function i(o){var s,a,u,c=this;if(!(c instanceof i))return new i(o);if(c.constructor=i,Mt(o)){c.s=o.s,S?!o.d||o.e>i.maxE?(c.e=NaN,c.d=null):o.e<i.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;S?s>i.maxE?(c.e=NaN,c.d=null):s<i.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return it(c,o.toString())}else if(u!=="string")throw Error(ie+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),vt.test(o)?it(c,o):Dn(c,o)}if(i.prototype=d,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=zn,i.clone=qt,i.isDecimal=Mt,i.abs=_n,i.acos=On,i.acosh=vn,i.add=Fn,i.asin=Vn,i.asinh=Kn,i.atan=Wn,i.atanh=Un,i.atan2=qn,i.cbrt=Gn,i.ceil=Hn,i.clamp=jn,i.cos=Zn,i.cosh=Yn,i.div=Xn,i.exp=Jn,i.floor=Qn,i.hypot=$n,i.ln=er,i.log=tr,i.log10=rr,i.log2=nr,i.max=ir,i.min=or,i.mod=sr,i.mul=ar,i.pow=ur,i.random=cr,i.round=lr,i.sign=fr,i.sin=mr,i.sinh=pr,i.sqrt=dr,i.sub=gr,i.sum=hr,i.tan=br,i.tanh=yr,i.trunc=wr,e===void 0&&(e={}),e&&e.defaults!==!0)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<r.length;)e.hasOwnProperty(n=r[t++])||(e[n]=this[n]);return i.config(e),i}function Xn(e,t){return new this(e).div(t)}function Jn(e){return new this(e).exp()}function Qn(e){return P(e=new this(e),e.e+1,3)}function $n(){var e,t,n=new this(0);for(S=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)n.d&&(n=n.plus(t.times(t)));else{if(t.s)return S=!0,new this(1/0);n=t}return S=!0,n.sqrt()}function Mt(e){return e instanceof Ke||e&&e.toStringTag===Ot||!1}function er(e){return new this(e).ln()}function tr(e,t){return new this(e).log(t)}function nr(e){return new this(e).log(2)}function rr(e){return new this(e).log(10)}function ir(){return Kt(this,arguments,"lt")}function or(){return Kt(this,arguments,"gt")}function sr(e,t){return new this(e).mod(t)}function ar(e,t){return new this(e).mul(t)}function ur(e,t){return new this(e).pow(t)}function cr(e){var t,n,r,i,o=0,s=new this(1),a=[];if(e===void 0?e=this.precision:H(e,1,oe),r=Math.ceil(e/A),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(r));o<r;)i=t[o],i>=429e7?t[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(r*=4);o<r;)i=t[o]+(t[o+1]<<8)+(t[o+2]<<16)+((t[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(t,o):(a.push(i%1e7),o+=4);o=r/4}else throw Error(_t);else for(;o<r;)a[o++]=Math.random()*1e7|0;for(r=a[--o],e%=A,r&&e&&(i=O(10,A-e),a[o]=(r/i|0)*i);a[o]===0;o--)a.pop();if(o<0)n=0,a=[0];else{for(n=-1;a[0]===0;n-=A)a.shift();for(r=1,i=a[0];i>=10;i/=10)r++;r<A&&(n-=A-r)}return s.e=n,s.d=a,s}function lr(e){return P(e=new this(e),e.e+1,this.rounding)}function fr(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function mr(e){return new this(e).sin()}function pr(e){return new this(e).sinh()}function dr(e){return new this(e).sqrt()}function gr(e,t){return new this(e).sub(t)}function hr(){var e=0,t=arguments,n=new this(t[e]);for(S=!1;n.s&&++e<t.length;)n=n.plus(t[e]);return S=!0,P(n,this.precision,this.rounding)}function br(e){return new this(e).tan()}function yr(e){return new this(e).tanh()}function wr(e){return P(e=new this(e),e.e+1,1)}d[Symbol.for("nodejs.util.inspect.custom")]=d.toString;d[Symbol.toStringTag]="Decimal";var Ke=d.constructor=qt(tt);Re=new Ke(Re);_e=new Ke(_e);import{PublicKey as Tr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Gt}from"@solana/spl-token";var Ht={chainId:101,address:Tr.default.toBase58(),programId:Gt.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ae={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Gt.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as st}from"@solana/web3.js";var at=class{constructor({mint:t,decimals:n,symbol:r,name:i,skipMint:o=!1,isToken2022:s=!1}){if(t===be.toBase58()||t instanceof st&&be.equals(t)){this.decimals=ae.decimals,this.symbol=ae.symbol,this.name=ae.name,this.mint=new st(ae.address),this.isToken2022=!1;return}this.decimals=n,this.symbol=r||t.toString().substring(0,6),this.name=i||t.toString().substring(0,6),this.mint=o?st.default:It({publicKey:t}),this.isToken2022=s}equals(t){return this===t?!0:this.mint.equals(t.mint)}},ue=at;ue.WSOL=new at(z(V({},ae),{mint:ae.address}));var ut=class{constructor({decimals:t,symbol:n="UNKNOWN",name:r="UNKNOWN"}){this.decimals=t,this.symbol=n,this.name=r}equals(t){return this===t}},We=ut;We.SOL=new ut(Ht);import qe from"big.js";import Br from"bn.js";import Cr from"decimal.js-light";import{get as jt,set as xr}from"lodash";var ct=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let n=t.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(n)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},zt={},Pr={};function G(e){let t=jt(zt,e);if(!t){let n=jt(Pr,e);t=new ct({name:e,logLevel:n}),xr(zt,e,t)}return t}import we from"bn.js";var Zt=9007199254740991;function j(e){let t=G("Raydium_parseBigNumberish");if(e instanceof we)return e;if(typeof e=="string"){if(e.match(/^-?[0-9]+$/))return new we(e);t.logWithError(`invalid BigNumberish string: ${e}`)}return typeof e=="number"?(e%1&&t.logWithError(`BigNumberish number underflow: ${e}`),(e>=Zt||e<=-Zt)&&t.logWithError(`BigNumberish number overflow: ${e}`),new we(String(e))):typeof e=="bigint"?new we(e.toString()):(t.error(`invalid BigNumberish value: ${e}`),new we(0))}import Ar from"toformat";var Sr=Ar,Te=Sr;var Ue=G("module/fraction"),lt=Te(qe),xe=Te(Cr),Ir={[0]:xe.ROUND_DOWN,[1]:xe.ROUND_HALF_UP,[2]:xe.ROUND_UP},Lr={[0]:qe.roundDown,[1]:qe.roundHalfUp,[2]:qe.roundUp},L=class{constructor(t,n=new Br(1)){this.numerator=j(t),this.denominator=j(n)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new L(this.denominator,this.numerator)}add(t){let n=t instanceof L?t:new L(j(t));return this.denominator.eq(n.denominator)?new L(this.numerator.add(n.numerator),this.denominator):new L(this.numerator.mul(n.denominator).add(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}sub(t){let n=t instanceof L?t:new L(j(t));return this.denominator.eq(n.denominator)?new L(this.numerator.sub(n.numerator),this.denominator):new L(this.numerator.mul(n.denominator).sub(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}mul(t){let n=t instanceof L?t:new L(j(t));return new L(this.numerator.mul(n.numerator),this.denominator.mul(n.denominator))}div(t){let n=t instanceof L?t:new L(j(t));return new L(this.numerator.mul(n.denominator),this.denominator.mul(n.numerator))}toSignificant(t,n={groupSeparator:""},r=1){Number.isInteger(t)||Ue.logWithError(`${t} is not an integer.`),t<=0&&Ue.logWithError(`${t} is not positive.`),xe.set({precision:t+1,rounding:Ir[r]});let i=new xe(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return i.toFormat(i.decimalPlaces(),n)}toFixed(t,n={groupSeparator:""},r=1){return Number.isInteger(t)||Ue.logWithError(`${t} is not an integer.`),t<0&&Ue.logWithError(`${t} is negative.`),lt.DP=t,lt.RM=Lr[r]||1,new lt(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,n)}isZero(){return this.numerator.isZero()}};import Nr from"bn.js";var Yt=new L(new Nr(100)),de=class extends L{toSignificant(t=5,n,r){return this.mul(Yt).toSignificant(t,n,r)}toFixed(t=2,n,r){return this.mul(Yt).toFixed(t,n,r)}};var Er=G("Raydium_price"),$=class extends L{constructor(n){let{baseToken:r,quoteToken:i,numerator:o,denominator:s}=n;super(o,s);this.baseToken=r,this.quoteToken=i,this.scalar=new L(ft(r.decimals),ft(i.decimals))}get raw(){return new L(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new $({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(n){this.quoteToken!==n.baseToken&&Er.logWithError("mul token not equals");let r=super.mul(n);return new $({baseToken:this.baseToken,quoteToken:n.quoteToken,denominator:r.denominator,numerator:r.numerator})}toSignificant(n=this.quoteToken.decimals,r,i){return this.adjusted.toSignificant(n,r,i)}toFixed(n=this.quoteToken.decimals,r,i){return this.adjusted.toFixed(n,r,i)}};var Mr=new te(0),Fo=new te(1),Vo=new te(2),Ko=new te(3),Wo=new te(5),mt=new te(10),Uo=new te(100),qo=new te(1e3),Go=new te(1e4);function ft(e){return mt.pow(j(e))}import{PublicKey as Dr}from"@solana/web3.js";import{MINT_SIZE as ts,TOKEN_PROGRAM_ID as ns,getTransferFeeConfig as rs,unpackMint as is}from"@solana/spl-token";var pt=G("Raydium_accountInfo_util");async function Jt(e,t,n){let{batchRequest:r,commitment:i="confirmed",chunkCount:o=100}=V({batchRequest:!1},n),s=dt(t,o),a=new Array(s.length).fill([]);if(r){let u=s.map(f=>{let m=e._buildArgs([f.map(p=>p.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:m}}),c=dt(u,10);a=(await(await Promise.all(c.map(async f=>await e._rpcBatchRequest(f)))).flat()).map(f=>(f.error&&pt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${f.error.message}`),f.result.value.map(m=>{if(m){let{data:p,executable:w,lamports:g,owner:x,rentEpoch:T}=m;return p.length!==2&&p[1]!=="base64"&&pt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:w,lamports:g,owner:new Dr(x),rentEpoch:T}}return null})))}else try{a=await Promise.all(s.map(u=>e.getMultipleAccountsInfo(u,i)))}catch(u){u instanceof Error&&pt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}function dt(e,t=1,n=[]){let r=[...e];if(t<=0)return n;for(;r.length;)n.push(r.splice(0,t));return n}import{PublicKey as As}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ks}from"@solana/spl-token";import{ComputeBudgetProgram as Qt,Keypair as en,PublicKey as ds,Transaction as tn,TransactionMessage as Rr,VersionedTransaction as nn}from"@solana/web3.js";var gt={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{TOKEN_PROGRAM_ID as _r}from"@solana/spl-token";var $t=G("Raydium_txUtil"),rn=1644;function Ge(e){let t=[],n=[];return e.microLamports&&(t.push(Qt.setComputeUnitPrice({microLamports:e.microLamports})),n.push(gt.SetComputeUnitPrice)),e.units&&(t.push(Qt.setComputeUnitLimit({units:e.units})),n.push(gt.SetComputeUnitLimit)),{instructions:t,instructionTypes:n}}async function ge(e,t){var r,i;let n=t!=null?t:"confirmed";return(i=await((r=e.getLatestBlockhash)==null?void 0:r.call(e,{commitment:n})))==null?void 0:i.blockhash}async function He(e,t){return e.getSignatureStatuses([t]),new Promise((n,r)=>{let i=setTimeout(r,6e4);e.onSignature(t,o=>{if(clearTimeout(i),!o.err){n("");return}r(o.err.toString())},"confirmed")})}function Or(e,t){e.length<1&&$t.logWithError(`no instructions provided: ${e.toString()}`),t.length<1&&$t.logWithError(`no signers provided:, ${t.toString()}`);let n=new tn;n.recentBlockhash="11111111111111111111111111111111",n.feePayer=t[0],n.add(...e);try{return Buffer.from(n.serialize({verifySignatures:!1})).toString("base64").length<rn}catch{return!1}}function Pe({instructions:e,payer:t,signers:n}){return Or(e,[t,...n])}function Ae({instructions:e,payer:t,lookupTableAddressAccount:n,recentBlockhash:r=en.generate().publicKey.toString()}){let o=new Rr({payerKey:t,recentBlockhash:r,instructions:e}).compileToV0Message(Object.values(n!=null?n:{}));try{return Buffer.from(new nn(o).serialize()).toString("base64").length<rn}catch{return!1}}var vr=e=>Buffer.isBuffer(e)?e:e instanceof Uint8Array?Buffer.from(e.buffer,e.byteOffset,e.byteLength):Buffer.from(e),Fr=e=>{let t=e.serialize({requireAllSignatures:!1,verifySignatures:!1});e instanceof nn&&(t=vr(t));try{return t instanceof Buffer?t.toString("base64"):Buffer.from(t).toString("base64")}catch{return t.toString("base64")}};function ce(e){let t=[];return e.forEach(n=>{n instanceof tn&&(n.recentBlockhash||(n.recentBlockhash=_r.toBase58()),n.feePayer||(n.feePayer=en.generate().publicKey)),t.push(Fr(n))}),console.log("simulate tx string:",t),t}import Ls from"bn.js";import{PublicKey as on,AddressLookupTableAccount as je}from"@solana/web3.js";async function ht({connection:e,address:t}){let n=await Jt(e,[...new Set(t.map(i=>i.toString()))].map(i=>new on(i))),r={};for(let i=0;i<t.length;i++){let o=n[i],s=t[i];if(!o)continue;let a=new je({key:s,state:je.deserialize(o.data)});r[s.toString()]=a,ze[s.toString()]=a}return r}var ze={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new je({key:new on("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:je.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as Se,sendAndConfirmTransaction as bt,Transaction as ke,TransactionMessage as Be,VersionedTransaction as Ce}from"@solana/web3.js";import Vr from"axios";var Ze=class{constructor(t){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner,this.cluster=t.cluster,this.blockhashCommitment=t.blockhashCommitment,this.api=t.api}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let t=(await Vr.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:n}=(r=t==null?void 0:t[15])!=null?r:{};if(!!n)return{units:6e5,microLamports:Math.min(Math.ceil(n*1e6/6e5),25e3)}}addCustomComputeBudget(t){if(t){let{instructions:n,instructionTypes:r}=Ge(t);return this.instructions.unshift(...n),this.instructionTypes.unshift(...r),!0}return!1}async calComputeBudget({config:t,defaultIns:n}){try{let r=t||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;n&&this.instructions.unshift(...n)}catch{n&&this.instructions.unshift(...n)}}addInstruction({instructions:t=[],endInstructions:n=[],signers:r=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...t),this.endInstructions.push(...n),this.signers.push(...r),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Se.default.toString())),this}async versionBuild({txVersion:t,extInfo:n}){return t===0?await this.buildV0(V({},n||{})):this.build(n)}build(t){var r;let n=new ke;return this.allInstructions.length&&n.add(...this.allInstructions),n.feePayer=this.feePayer,((r=this.owner)==null?void 0:r.signer)&&!this.signers.some(i=>i.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:n,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async i=>{var c;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a}=i||{},u=o!=null?o:await ge(this.connection,this.blockhashCommitment);if(n.recentBlockhash=u,this.signers.length&&n.sign(...this.signers),ce([n]),(c=this.owner)!=null&&c.isKeyPair)return{txId:a?await bt(this.connection,n,this.signers.find(f=>f.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(n.serialize(),{skipPreflight:s}),signedTx:n};if(this.signAllTransactions){let l=await this.signAllTransactions([n]);return{txId:await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:t||{}}}buildMultiTx(t){var c;let{extraPreBuildData:n=[],extInfo:r}=t,{transaction:i}=this.build(r),o=n.filter(l=>l.transaction.instructions.length>0),s=[i,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],u=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(c=this.owner)!=null&&c.signer&&a.forEach(l=>{l.some(f=>f.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:u,execute:async l=>{var x;let{sequentially:f,onTxUpdate:m,recentBlockHash:p,skipPreflight:w=!0}=l||{},g=p!=null?p:await ge(this.connection,this.blockhashCommitment);if((x=this.owner)!=null&&x.isKeyPair){if(f){let T=[];for(let y of s){let h=await bt(this.connection,y,this.signers.find(b=>b.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:w});T.push(h)}return{txIds:T,signedTxs:s}}return{txIds:await await Promise.all(s.map(async T=>(T.recentBlockhash=g,await this.connection.sendRawTransaction(T.serialize(),{skipPreflight:w})))),signedTxs:s}}if(this.signAllTransactions){let T=s.map((h,b)=>(h.recentBlockhash=g,a[b].length&&h.sign(...a[b]),h));ce(T);let y=await this.signAllTransactions(T);if(f){let h=0,b=[],N=async()=>{if(!y[h])return;let k=await this.connection.sendRawTransaction(y[h].serialize(),{skipPreflight:w});b.push({txId:k,status:"sent",signedTx:y[h]}),m==null||m([...b]),h++,this.connection.onSignature(k,v=>{let M=b.findIndex(_=>_.txId===k);M>-1&&(b[M].status=v.err?"error":"success"),m==null||m([...b]),v.err||N()},"processed"),this.connection.getSignatureStatus(k)};return await N(),{txIds:b.map(k=>k.txId),signedTxs:y}}else{let h=[];for(let b=0;b<y.length;b+=1){let N=await this.connection.sendRawTransaction(y[b].serialize(),{skipPreflight:w});h.push(N)}return{txIds:h,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:t,txVersion:n,extInfo:r}){return n===0?await this.buildV0MultiTx({extraPreBuildData:t,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:t,extInfo:r})}async buildV0(t){var g;let w=t||{},{lookupTableCache:n={},lookupTableAddress:r=[],forerunCreate:i,recentBlockhash:o}=w,s=Me(w,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=V(V({},this.cluster==="devnet"?{}:ze),n),u=Array.from(new Set([...r,...this.lookupTableAddress])),c=[];for(let x of u)a[x]===void 0&&c.push(new Se(x));let l=await ht({connection:this.connection,address:c});for(let[x,T]of Object.entries(l))a[x]=T;let f=i?Se.default.toBase58():o!=null?o:await ge(this.connection,this.blockhashCommitment),m=new Be({payerKey:this.feePayer,recentBlockhash:f,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((g=this.owner)==null?void 0:g.signer)&&!this.signers.some(x=>x.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let p=new Ce(m);return p.sign(this.signers),{builder:this,transaction:p,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async x=>{var h;let{skipPreflight:T=!0,sendAndConfirm:y}=x||{};if(ce([p]),(h=this.owner)!=null&&h.isKeyPair){let b=await this.connection.sendTransaction(p,{skipPreflight:T});return y&&await He(this.connection,b),{txId:b,signedTx:p}}if(this.signAllTransactions){let b=await this.signAllTransactions([p]);return{txId:await this.connection.sendTransaction(b[0],{skipPreflight:T}),signedTx:b[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(t){var c;let{extraPreBuildData:n=[],buildProps:r}=t,{transaction:i}=await this.buildV0(r),o=n.filter(l=>l.builder.instructions.length>0),s=[i,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],u=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(c=this.owner)!=null&&c.signer&&a.forEach(l=>{l.some(f=>f.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,f)=>{l.sign(a[f])}),{builder:this,transactions:s,signers:a,instructionTypes:u,buildProps:r,execute:async l=>{var g;let{sequentially:f,onTxUpdate:m,recentBlockHash:p,skipPreflight:w=!0}=l||{};if(p&&s.forEach(x=>x.message.recentBlockhash=p),ce(s),(g=this.owner)!=null&&g.isKeyPair){if(f){let x=[];for(let T of s){let y=await this.connection.sendTransaction(T,{skipPreflight:w});await He(this.connection,y),x.push(y)}return{txIds:x,signedTxs:s}}return{txIds:await Promise.all(s.map(async x=>await this.connection.sendTransaction(x,{skipPreflight:w}))),signedTxs:s}}if(this.signAllTransactions){let x=await this.signAllTransactions(s);if(f){let T=0,y=[],h=async()=>{if(!x[T])return;let b=await this.connection.sendTransaction(x[T],{skipPreflight:w});y.push({txId:b,status:"sent",signedTx:x[T]}),m==null||m([...y]),T++,this.connection.onSignature(b,N=>{let k=y.findIndex(v=>v.txId===b);k>-1&&(y[k].status=N.err?"error":"success"),m==null||m([...y]),N.err||h()},"processed"),this.connection.getSignatureStatus(b)};return h(),{txIds:[],signedTxs:x}}else{let T=[];for(let y=0;y<x.length;y+=1){let h=await this.connection.sendTransaction(x[y],{skipPreflight:w});T.push(h)}return{txIds:T,signedTxs:x}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(t){var l;let c=t||{},{computeBudgetConfig:n}=c,r=Me(c,["computeBudgetConfig"]),i=n?Ge(n):{instructions:[],instructionTypes:[]},o=this.signers.reduce((f,m)=>z(V({},f),{[m.publicKey.toBase58()]:m}),{}),s=[],a=[],u=[];if(this.allInstructions.forEach(f=>{let m=[...u,f],p=n?[...i.instructions,...m]:m,g=[...new Set(m.map(x=>x.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat()).values()].map(x=>new Se(x));if(u.length<12&&Pe({instructions:p,payer:this.feePayer,signers:g})||Pe({instructions:m,payer:this.feePayer,signers:g}))u.push(f);else{if(u.length===0)throw Error("item ins too big");Pe({instructions:n?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:g})?s.push(new ke().add(...i.instructions,...u)):s.push(new ke().add(...u)),a.push(Array.from(new Set(u.map(x=>x.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat())).map(x=>o[x]).filter(x=>x!==void 0)),u=[f]}}),u.length>0){let m=[...new Set(u.map(p=>p.keys.filter(w=>w.isSigner).map(w=>w.pubkey.toString())).flat()).values()].map(p=>o[p]).filter(p=>p!==void 0);Pe({instructions:n?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:m.map(p=>p.publicKey)})?s.push(new ke().add(...i.instructions,...u)):s.push(new ke().add(...u)),a.push(m)}return s.forEach(f=>f.feePayer=this.feePayer),(l=this.owner)!=null&&l.signer&&a.forEach(f=>{f.some(m=>m.publicKey.equals(this.owner.publicKey))||f.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async f=>{var T;let{sequentially:m,onTxUpdate:p,recentBlockHash:w,skipPreflight:g=!0}=f||{},x=w!=null?w:await ge(this.connection,this.blockhashCommitment);if(s.forEach(async(y,h)=>{y.recentBlockhash=x,a[h].length&&y.sign(...a[h])}),ce(s),(T=this.owner)!=null&&T.isKeyPair){if(m){let y=[];for(let h of s){let b=await bt(this.connection,h,this.signers.find(N=>N.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g});y.push(b)}return{txIds:y,signedTxs:s}}return{txIds:await Promise.all(s.map(async y=>await this.connection.sendRawTransaction(y.serialize(),{skipPreflight:g}))),signedTxs:s}}if(this.signAllTransactions){let y=await this.signAllTransactions(s);if(m){let h=0,b=[],N=async()=>{if(!y[h])return;let k=await this.connection.sendRawTransaction(y[h].serialize(),{skipPreflight:g});b.push({txId:k,status:"sent",signedTx:y[h]}),p==null||p([...b]),h++,this.connection.onSignature(k,v=>{let M=b.findIndex(_=>_.txId===k);M>-1&&(b[M].status=v.err?"error":"success"),p==null||p([...b]),v.err||N()},"processed"),this.connection.getSignatureStatus(k)};return await N(),{txIds:b.map(k=>k.txId),signedTxs:y}}else{let h=[];for(let b=0;b<y.length;b+=1){let N=await this.connection.sendRawTransaction(y[b].serialize(),{skipPreflight:g});h.push(N)}return{txIds:h,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuildV0(t){var T;let x=t||{},{computeBudgetConfig:n,lookupTableCache:r={},lookupTableAddress:i=[]}=x,o=Me(x,["computeBudgetConfig","lookupTableCache","lookupTableAddress"]),s=V(V({},this.cluster==="devnet"?{}:ze),r),a=Array.from(new Set([...this.lookupTableAddress,...i])),u=[];for(let y of a)s[y]===void 0&&u.push(new Se(y));let c=await ht({connection:this.connection,address:u});for(let[y,h]of Object.entries(c))s[y]=h;let l=n?Ge(n):{instructions:[],instructionTypes:[]},f=await ge(this.connection,this.blockhashCommitment),m=this.signers.reduce((y,h)=>z(V({},y),{[h.publicKey.toBase58()]:h}),{}),p=[],w=[],g=[];if(this.allInstructions.forEach(y=>{let h=[...g,y],b=n?[...l.instructions,...h]:h;if(g.length<12&&Ae({instructions:b,payer:this.feePayer,lookupTableAddressAccount:s})||Ae({instructions:h,payer:this.feePayer,lookupTableAddressAccount:s}))g.push(y);else{if(g.length===0)throw Error("item ins too big");let N={};for(let k of[...new Set(a)])s[k]!==void 0&&(N[k]=s[k]);if(n&&Ae({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:f})){let k=new Be({payerKey:this.feePayer,recentBlockhash:f,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(s));p.push(new Ce(k))}else{let k=new Be({payerKey:this.feePayer,recentBlockhash:f,instructions:[...g]}).compileToV0Message(Object.values(s));p.push(new Ce(k))}w.push(Array.from(new Set(g.map(k=>k.keys.filter(v=>v.isSigner).map(v=>v.pubkey.toString())).flat())).map(k=>m[k]).filter(k=>k!==void 0)),g=[y]}}),g.length>0){let h=[...new Set(g.map(b=>b.keys.filter(N=>N.isSigner).map(N=>N.pubkey.toString())).flat()).values()].map(b=>m[b]).filter(b=>b!==void 0);if(n&&Ae({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:f})){let b=new Be({payerKey:this.feePayer,recentBlockhash:f,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(s));p.push(new Ce(b))}else{let b=new Be({payerKey:this.feePayer,recentBlockhash:f,instructions:[...g]}).compileToV0Message(Object.values(s));p.push(new Ce(b))}w.push(h)}return(T=this.owner)!=null&&T.signer&&w.forEach(y=>{y.some(h=>h.publicKey.equals(this.owner.publicKey))||y.push(this.owner.signer)}),{builder:this,transactions:p,buildProps:t,signers:w,instructionTypes:this.instructionTypes,execute:async y=>{var v;let{sequentially:h,onTxUpdate:b,recentBlockHash:N,skipPreflight:k=!0}=y||{};if(p.map(async(M,_)=>{w[_].length&&M.sign(w[_]),N&&(M.message.recentBlockhash=N)}),ce(p),(v=this.owner)!=null&&v.isKeyPair){if(h){let M=[];for(let _ of p){let W=await this.connection.sendTransaction(_,{skipPreflight:k});await He(this.connection,W),M.push(W)}return{txIds:M,signedTxs:p}}return{txIds:await Promise.all(p.map(async M=>await this.connection.sendTransaction(M,{skipPreflight:k}))),signedTxs:p}}if(this.signAllTransactions){let M=await this.signAllTransactions(p);if(h){let _=0,W=[],U=async()=>{if(!M[_])return;let J=await this.connection.sendTransaction(M[_],{skipPreflight:k});W.push({txId:J,status:"sent",signedTx:M[_]}),b==null||b([...W]),_++,this.connection.onSignature(J,se=>{let le=W.findIndex(F=>F.txId===J);le>-1&&(W[le].status=se.err?"error":"success"),b==null||b([...W]),se.err||U()},"processed"),this.connection.getSignatureStatus(J)};return U(),{txIds:[],signedTxs:M}}else{let _=[];for(let W=0;W<M.length;W+=1){let U=await this.connection.sendTransaction(M[W],{skipPreflight:k});_.push(U)}return{txIds:_,signedTxs:M}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}};var Wr=G("Raydium_amount"),sn=Te(Kr);function Ur(e,t){let n="0",r="0";if(e.includes(".")){let i=e.split(".");i.length===2?([n,r]=i,r=r.padEnd(t,"0")):Wr.logWithError(`invalid number string, num: ${e}`)}else n=e;return[n,r.slice(0,t)||r]}var ee=class extends L{constructor(n,r,i=!0,o){let s=new Ye(0),a=mt.pow(new Ye(n.decimals));if(i)s=j(r);else{let u=new Ye(0),c=new Ye(0);if(typeof r=="string"||typeof r=="number"||typeof r=="bigint"){let[l,f]=Ur(r.toString(),n.decimals);u=j(l),c=j(f)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=G(o||"TokenAmount"),this.token=n}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(n){return this.token.equals(n.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(n.raw)}lt(n){return this.token.equals(n.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(n.raw)}add(n){return this.token.equals(n.token)||this.logger.logWithError("add token not equals"),new ee(this.token,this.raw.add(n.raw))}subtract(n){return this.token.equals(n.token)||this.logger.logWithError("sub token not equals"),new ee(this.token,this.raw.sub(n.raw))}toSignificant(n=this.token.decimals,r,i=0){return super.toSignificant(n,r,i)}toFixed(n=this.token.decimals,r,i=0){return n>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(n,r,i)}toExact(n={groupSeparator:""}){return sn.DP=this.token.decimals,new sn(this.numerator.toString()).div(this.denominator.toString()).toFormat(n)}};function Xt(e){return typeof e=="object"&&e!==null&&![ue,ee,qr,L,Gr,$,de].some(t=>typeof t=="object"&&e instanceof t)}function Xe(e){return typeof e=="string"?$e(e):Array.isArray(e)?e.map(t=>Xe(t)):Xt(e)?Object.fromEntries(Object.entries(e).map(([t,n])=>[t,Xe(n)])):e}var yt=(...e)=>e.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),Ie=class{constructor({scope:t,moduleName:n}){this.disabled=!1;this.scope=t,this.logger=G(n)}createTxBuilder(t){return this.scope.checkOwner(),new Ze({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(yt(t))}logInfo(...t){this.logger.info(yt(t))}logAndCreateError(...t){let n=yt(t);throw new Error(n)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{SYSVAR_CLOCK_PUBKEY as Yr,TransactionInstruction as ln}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as fn}from"@solana/spl-token";import{PublicKey as Wu}from"@solana/web3.js";import qu,{isBN as Gu}from"bn.js";import{bits as Ka,BitStructure as Wa,blob as Ua,Blob as qa,cstr as Ga,f32 as Ha,f32be as ja,f64 as za,f64be as Za,greedy as Ya,Layout as Xa,ns64 as Ja,ns64be as Qa,nu64 as Hr,nu64be as $a,offset as eu,s16 as tu,s16be as nu,s24 as ru,s24be as iu,s32 as ou,s32be as su,s40 as au,s40be as uu,s48 as cu,s48be as lu,s8 as fu,seq as mu,struct as pu,Structure as jr,u16 as du,u16be as gu,u24 as hu,u24be as bu,u32 as yu,u32be as wu,u40 as Tu,u40be as xu,u48 as Pu,u48be as Au,u8 as Su,UInt as zr,union as ku,Union as Bu,unionLayoutDiscriminator as Cu,utf8 as Iu}from"@solana/buffer-layout";var an=jr;var un=zr;var cn=Hr;function Tt(e){return new un(1,e)}var wt=class extends an{decode(t,n){return super.decode(t,n)}};function xt(e,t,n){return new wt(e,t,n)}var Zr=xt([Tt("instruction"),cn("amount")]),Le=xt([Tt("instruction")]);function Je({programId:e},t){let n=[{pubkey:fn,isSigner:!1,isWritable:!1},{pubkey:Lt,isSigner:!1,isWritable:!1},...Object.entries(t).map(([i,o])=>({pubkey:o,isSigner:i==="userOwner",isWritable:!["authority","userOwner"].includes(i)}))],r=Buffer.alloc(Le.span);return Le.encode({instruction:2},r),new ln({keys:n,programId:e,data:r})}function Pt(e){let{poolConfig:t,userKeys:n,side:r}=e,i=r==="base"?n.baseTokenAccount:n.quoteTokenAccount,o=r==="base"?t.baseVault:t.quoteVault,s=Buffer.alloc(Le.span);Le.encode({instruction:2},s);let a=[{pubkey:fn,isWritable:!1,isSigner:!1},{pubkey:Yr,isWritable:!1,isSigner:!1},{pubkey:t.id,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!1},{pubkey:o,isWritable:!0,isSigner:!1},{pubkey:i,isWritable:!0,isSigner:!1},{pubkey:n.ledgerAccount,isWritable:!0,isSigner:!1},{pubkey:n.owner,isWritable:!1,isSigner:!0}];return new ln({programId:t.programId,keys:a,data:s})}var Xr={[he.IDO_PROGRAM_ID_V1.toString()]:1,[he.IDO_PROGRAM_ID_V2.toString()]:2,[he.IDO_PROGRAM_ID_V3.toString()]:3,[he.IDO_PROGRAM_ID_V4.toString()]:4},At=class extends Ie{async claim({ownerInfo:t,idoKeys:n,associatedOnly:r=!0,checkCreateATAOwner:i=!1,txVersion:o}){let s=this.createTxBuilder(),a=Xr[n.programId];a||this.logAndCreateError("invalid version",a);let u=Xe(n),[c,l]=[!new mn(t.coin).isZero(),!new mn(t.pc).isZero()],f=u.projectInfo.mint.address.equals(fe),{account:m,instructionParams:p}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:u.projectInfo.mint.programId,mint:u.projectInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!f,notUseTokenAccount:f,associatedOnly:f?!1:r,checkCreateATAOwner:i});!m&&c&&this.logAndCreateError("target token accounts not found","mint",n.projectInfo.mint.address),c&&p&&s.addInstruction(p);let w=u.buyInfo.mint.address.equals(fe),{account:g,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:u.buyInfo.mint.programId,mint:u.buyInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:r,checkCreateATAOwner:i});if(!m&&l&&this.logAndCreateError("target token accounts not found","mint",n.projectInfo.mint.address),l&&x&&s.addInstruction(x),(!m||!g)&&this.logAndCreateError("target token accounts not found","mint",n.projectInfo.mint.address,n.buyInfo.mint.address),a===3)return s.addInstruction({instructions:[...c?[Je({programId:u.programId},{idoId:u.id,authority:u.authority,poolTokenAccount:u.projectInfo.vault,userTokenAccount:m,userIdoInfo:new Ne(t.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[],...l?[Je({programId:new Ne(n.programId)},{idoId:u.id,authority:u.authority,poolTokenAccount:u.buyInfo.vault,userTokenAccount:g,userIdoInfo:new Ne(t.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[]]}).versionBuild({txVersion:o});if(a<3)return!c&&!l&&this.logAndCreateError("no claimable rewards"),s.addInstruction({instructions:[Je({programId:u.programId},{idoId:u.id,authority:u.authority,poolQuoteTokenAccount:u.buyInfo.vault,poolBaseTokenAccount:u.projectInfo.vault,userQuoteTokenAccount:g,userBaseTokenAccount:m,userIdoInfo:new Ne(t.userIdoInfo),userOwner:this.scope.ownerPubKey})]}).versionBuild({txVersion:o});let T={poolConfig:{id:u.id,programId:u.programId,authority:u.authority,baseVault:u.projectInfo.vault,quoteVault:u.buyInfo.vault,baseToken:n.projectInfo.mint,quoteToken:n.buyInfo.mint},userKeys:{baseTokenAccount:m,quoteTokenAccount:g,ledgerAccount:new Ne(t.userIdoInfo),owner:this.scope.ownerPubKey}};return s.addInstruction({instructions:[...c?[Pt(z(V({},T),{side:"base"}))]:[],...l?[Pt(z(V({},T),{side:"quote"}))]:[]]}).versionBuild({txVersion:o})}};export{At as default};
//# sourceMappingURL=ido.mjs.map