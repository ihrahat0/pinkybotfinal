var ji=Object.defineProperty,Ji=Object.defineProperties;var $i=Object.getOwnPropertyDescriptors;var Gn=Object.getOwnPropertySymbols;var er=Object.prototype.hasOwnProperty,tr=Object.prototype.propertyIsEnumerable;var Un=(i,e,t)=>e in i?ji(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,j=(i,e)=>{for(var t in e||(e={}))er.call(e,t)&&Un(i,t,e[t]);if(Gn)for(var t of Gn(e))tr.call(e,t)&&Un(i,t,e[t]);return i},te=(i,e)=>Ji(i,$i(e));import{PublicKey as Xg}from"@solana/web3.js";import{createTransferInstruction as Qg,TOKEN_PROGRAM_ID as Yg,TOKEN_2022_PROGRAM_ID as Hg}from"@solana/spl-token";import Ns from"bn.js";var bt=9e15,st=1e9,sn="0123456789abcdef",_t="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Dt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",an={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-bt,maxE:bt,crypto:!1},Yn,He,V=!0,Wt="[DecimalError] ",ot=Wt+"Invalid argument: ",Hn=Wt+"Precision limit exceeded",Zn=Wt+"crypto unavailable",jn="[object Decimal]",Te=Math.floor,pe=Math.pow,nr=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,ir=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,rr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Jn=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Ve=1e7,D=7,or=9007199254740991,sr=_t.length-1,un=Dt.length-1,P={toStringTag:jn};P.absoluteValue=P.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),M(i)};P.ceil=function(){return M(new this.constructor(this),this.e+1,2)};P.clampedTo=P.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(ot+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};P.comparedTo=P.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,u=o.s,c=i.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==i.e)return o.e>i.e^u<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===r?0:n>r^u<0?1:-1};P.cosine=P.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+D,n.rounding=1,t=ar(n,ii(n,t)),n.precision=i,n.rounding=e,M(He==2||He==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};P.cubeRoot=P.cbrt=function(){var i,e,t,n,r,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(V=!1,o=l.s*pe(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=ke(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=pe(t,1/3),i=Te((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(i=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=ne(c.plus(l).times(a),c.plus(u),s+2,1),ke(a.d).slice(0,s)===(t=ke(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(M(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(M(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return V=!0,M(n,i,m.rounding,e)};P.decimalPlaces=P.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-Te(this.e/D))*D,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};P.dividedBy=P.div=function(i){return ne(this,new this.constructor(i))};P.dividedToIntegerBy=P.divToInt=function(i){var e=this,t=e.constructor;return M(ne(e,new t(i),0,1,1),t.precision,t.rounding)};P.equals=P.eq=function(i){return this.cmp(i)===0};P.floor=function(){return M(new this.constructor(this),this.e+1,3)};P.greaterThan=P.gt=function(i){return this.cmp(i)>0};P.greaterThanOrEqualTo=P.gte=function(i){var e=this.cmp(i);return e==1||e===0};P.hyperbolicCosine=P.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/Gt(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=yt(s,1,o.times(e),new s(1),!0);for(var u,c=i,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return M(o,s.precision=t,s.rounding=n,!0)};P.hyperbolicSine=P.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=yt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/Gt(5,i)),r=yt(o,2,r,r,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,M(r,e,t,!0)};P.hyperbolicTangent=P.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,ne(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};P.inverseCosine=P.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?De(t,r,o):new t(0):new t(NaN):e.isZero()?De(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=De(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};P.inverseHyperbolicCosine=P.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,V=!1,t=t.times(t).minus(1).sqrt().plus(t),V=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};P.inverseHyperbolicSine=P.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,V=!1,t=t.times(t).plus(1).sqrt().plus(t),V=!0,n.precision=i,n.rounding=e,t.ln())};P.inverseHyperbolicTangent=P.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?M(new o(r),i,e,!0):(o.precision=t=n-r.e,r=ne(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};P.inverseSine=P.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=De(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};P.inverseTangent=P.atan=function(){var i,e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=un)return s=De(l,m+4,d).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=un)return s=De(l,m+4,d).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/D+2|0),i=t;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(V=!1,e=Math.ceil(a/D),n=1,u=c.times(c),s=new l(c),r=c;i!==-1;)if(r=r.times(u),o=s.minus(r.div(n+=2)),r=r.times(u),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),V=!0,M(s,l.precision=m,l.rounding=d,!0)};P.isFinite=function(){return!!this.d};P.isInteger=P.isInt=function(){return!!this.d&&Te(this.e/D)>this.d.length-2};P.isNaN=function(){return!this.s};P.isNegative=P.isNeg=function(){return this.s<0};P.isPositive=P.isPos=function(){return this.s>0};P.isZero=function(){return!!this.d&&this.d[0]===0};P.lessThan=P.lt=function(i){return this.cmp(i)<0};P.lessThanOrEqualTo=P.lte=function(i){return this.cmp(i)<1};P.logarithm=P.log=function(i){var e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding,p=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(V=!1,a=m+p,s=rt(c,a),n=e?Vt(l,a+10):rt(i,a),u=ne(s,n,a,1),wt(u.d,r=m,d))do if(a+=10,s=rt(c,a),n=e?Vt(l,a+10):rt(i,a),u=ne(s,n,a,1),!o){+ke(u.d).slice(r+1,r+15)+1==1e14&&(u=M(u,m+1,0));break}while(wt(u.d,r+=10,d));return V=!0,M(u,m,d)};P.minus=P.sub=function(i){var e,t,n,r,o,s,a,u,c,l,m,d,p=this,g=p.constructor;if(i=new g(i),!p.d||!i.d)return!p.s||!i.s?i=new g(NaN):p.d?i.s=-i.s:i=new g(i.d||p.s!==i.s?p:NaN),i;if(p.s!=i.s)return i.s=-i.s,p.plus(i);if(c=p.d,d=i.d,a=g.precision,u=g.rounding,!c[0]||!d[0]){if(d[0])i.s=-i.s;else if(c[0])i=new g(p);else return new g(u===3?-0:0);return V?M(i,a,u):i}if(t=Te(i.e/D),l=Te(p.e/D),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=d.length):(e=d,t=l,s=c.length),n=Math.max(Math.ceil(a/D),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=d[n]){m=c[n]<d[n];break}o=0}for(m&&(e=c,c=d,d=e,i.s=-i.s),s=c.length,n=d.length-s;n>0;--n)c[s++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(r=n;r&&c[--r]===0;)c[r]=Ve-1;--c[r],c[n]+=Ve}c[n]-=d[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(i.d=c,i.e=qt(c,t),V?M(i,a,u):i):new g(u===3?-0:0)};P.modulo=P.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?M(new n(t),n.precision,n.rounding):(V=!1,n.modulo==9?(e=ne(t,i.abs(),0,3,1),e.s*=i.s):e=ne(t,i,0,n.modulo,1),e=e.times(i),V=!0,t.minus(e))};P.naturalExponential=P.exp=function(){return cn(this)};P.naturalLogarithm=P.ln=function(){return rt(this)};P.negated=P.neg=function(){var i=new this.constructor(this);return i.s=-i.s,M(i)};P.plus=P.add=function(i){var e,t,n,r,o,s,a,u,c,l,m=this,d=m.constructor;if(i=new d(i),!m.d||!i.d)return!m.s||!i.s?i=new d(NaN):m.d||(i=new d(i.d||m.s===i.s?m:NaN)),i;if(m.s!=i.s)return i.s=-i.s,m.minus(i);if(c=m.d,l=i.d,a=d.precision,u=d.rounding,!c[0]||!l[0])return l[0]||(i=new d(m)),V?M(i,a,u):i;if(o=Te(m.e/D),n=Te(i.e/D),c=c.slice(),r=o-n,r){for(r<0?(t=c,r=-r,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/D),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=c.length,r=l.length,s-r<0&&(r=s,t=l,l=c,c=t),e=0;r;)e=(c[--r]=c[r]+l[r]+e)/Ve|0,c[r]%=Ve;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return i.d=c,i.e=qt(c,n),V?M(i,a,u):i};P.precision=P.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(ot+i);return t.d?(e=$n(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};P.round=function(){var i=this,e=i.constructor;return M(new e(i),i.e+1,e.rounding)};P.sine=P.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+D,n.rounding=1,t=cr(n,ii(n,t)),n.precision=i,n.rounding=e,M(He>2?t.neg():t,i,e,!0)):new n(NaN)};P.squareRoot=P.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(V=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=ke(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=Te((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(ne(s,o,t+2,1)).times(.5),ke(o.d).slice(0,t)===(e=ke(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(M(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(M(n,u+1,1),i=!n.times(n).eq(s));break}return V=!0,M(n,u,l.rounding,i)};P.tangent=P.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=ne(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,M(He==2||He==4?t.neg():t,i,e,!0)):new n(NaN)};P.times=P.mul=function(i){var e,t,n,r,o,s,a,u,c,l=this,m=l.constructor,d=l.d,p=(i=new m(i)).d;if(i.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!i.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?i.s/0:i.s*0);for(t=Te(l.e/D)+Te(i.e/D),u=d.length,c=p.length,u<c&&(o=d,d=p,p=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,r=u+n;r>n;)a=o[r]+p[n]*d[r-n-1]+e,o[r--]=a%Ve|0,e=a/Ve|0;o[r]=(o[r]+e)%Ve|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=qt(o,t),V?M(i,m.precision,m.rounding):i};P.toBinary=function(i,e){return mn(this,2,i,e)};P.toDecimalPlaces=P.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Se(i,0,st),e===void 0?e=n.rounding:Se(e,0,8),M(t,i+t.e+1,e))};P.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Xe(n,!0):(Se(i,0,st),e===void 0?e=r.rounding:Se(e,0,8),n=M(new r(n),i+1,e),t=Xe(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};P.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=Xe(r):(Se(i,0,st),e===void 0?e=o.rounding:Se(e,0,8),n=M(new o(r),i+r.e+1,e),t=Xe(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};P.toFraction=function(i){var e,t,n,r,o,s,a,u,c,l,m,d,p=this,g=p.d,f=p.constructor;if(!g)return new f(p);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=$n(g)-p.e-1,s=o%D,e.d[0]=pe(10,s<0?D+s:s),i==null)i=o>0?e:c;else{if(a=new f(i),!a.isInt()||a.lt(c))throw Error(ot+a);i=a.gt(e)?o>0?e:c:a}for(V=!1,a=new f(ke(g)),l=f.precision,f.precision=o=g.length*D*2;m=ne(a,e,0,1,1),r=t.plus(m.times(n)),r.cmp(i)!=1;)t=n,n=r,r=c,c=u.plus(m.times(r)),u=r,r=e,e=a.minus(m.times(r)),a=r;return r=ne(i.minus(t),n,0,1,1),u=u.plus(r.times(c)),t=t.plus(r.times(n)),u.s=c.s=p.s,d=ne(c,n,o,1).minus(p).abs().cmp(ne(u,t,o,1).minus(p).abs())<1?[c,n]:[u,t],f.precision=l,V=!0,d};P.toHexadecimal=P.toHex=function(i,e){return mn(this,16,i,e)};P.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Se(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(V=!1,t=ne(t,i,0,e,1).times(i),V=!0,M(t)):(i.s=t.s,t=i),t};P.toNumber=function(){return+this};P.toOctal=function(i,e){return mn(this,8,i,e)};P.toPower=P.pow=function(i){var e,t,n,r,o,s,a=this,u=a.constructor,c=+(i=new u(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new u(pe(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,i.eq(1))return M(a,n,o);if(e=Te(i.e/D),e>=i.d.length-1&&(t=c<0?-c:c)<=or)return r=ei(u,a,t,n),i.s<0?new u(1).div(r):M(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new u(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=pe(+a,c),e=t==0||!isFinite(t)?Te(c*(Math.log("0."+ke(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(V=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),r=cn(i.times(rt(a,n+t)),n),r.d&&(r=M(r,n+5,1),wt(r.d,n,o)&&(e=n+10,r=M(cn(i.times(rt(a,e+t)),e),e+5,1),+ke(r.d).slice(n+1,n+15)+1==1e14&&(r=M(r,n+1,0)))),r.s=s,V=!0,u.rounding=o,M(r,n,o))};P.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Xe(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Se(i,1,st),e===void 0?e=r.rounding:Se(e,0,8),n=M(new r(n),i,e),t=Xe(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};P.toSignificantDigits=P.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Se(i,1,st),e===void 0?e=n.rounding:Se(e,0,8)),M(new n(t),i,e)};P.toString=function(){var i=this,e=i.constructor,t=Xe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};P.truncated=P.trunc=function(){return M(new this.constructor(this),this.e+1,1)};P.valueOf=P.toJSON=function(){var i=this,e=i.constructor,t=Xe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function ke(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=D-n.length,t&&(o+=it(t)),o+=n;s=i[e],n=s+"",t=D-n.length,t&&(o+=it(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Se(i,e,t){if(i!==~~i||i<e||i>t)throw Error(ot+i)}function wt(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=D,r=0):(r=Math.ceil((e+1)/D),e%=D),o=pe(10,D-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==pe(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==pe(10,e-3)-1,s}function vt(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=sn.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function ar(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/Gt(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=yt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var ne=function(){function i(n,r,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*r+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=r[a]){u=n[a]>r[a]?1:-1;break}return u}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,u){var c,l,m,d,p,g,f,y,A,h,w,C,F,B,v,O,Q,T,_,Ae,de=n.constructor,xe=n.s==r.s?1:-1,ue=n.d,ee=r.d;if(!ue||!ue[0]||!ee||!ee[0])return new de(!n.s||!r.s||(ue?ee&&ue[0]==ee[0]:!ee)?NaN:ue&&ue[0]==0||!ee?xe*0:xe/0);for(u?(p=1,l=n.e-r.e):(u=Ve,p=D,l=Te(n.e/p)-Te(r.e/p)),_=ee.length,Q=ue.length,A=new de(xe),h=A.d=[],m=0;ee[m]==(ue[m]||0);m++);if(ee[m]>(ue[m]||0)&&l--,o==null?(B=o=de.precision,s=de.rounding):a?B=o+(n.e-r.e)+1:B=o,B<0)h.push(1),g=!0;else{if(B=B/p+2|0,m=0,_==1){for(d=0,ee=ee[0],B++;(m<Q||d)&&B--;m++)v=d*u+(ue[m]||0),h[m]=v/ee|0,d=v%ee|0;g=d||m<Q}else{for(d=u/(ee[0]+1)|0,d>1&&(ee=i(ee,d,u),ue=i(ue,d,u),_=ee.length,Q=ue.length),O=_,w=ue.slice(0,_),C=w.length;C<_;)w[C++]=0;Ae=ee.slice(),Ae.unshift(0),T=ee[0],ee[1]>=u/2&&++T;do d=0,c=e(ee,w,_,C),c<0?(F=w[0],_!=C&&(F=F*u+(w[1]||0)),d=F/T|0,d>1?(d>=u&&(d=u-1),f=i(ee,d,u),y=f.length,C=w.length,c=e(f,w,y,C),c==1&&(d--,t(f,_<y?Ae:ee,y,u))):(d==0&&(c=d=1),f=ee.slice()),y=f.length,y<C&&f.unshift(0),t(w,f,C,u),c==-1&&(C=w.length,c=e(ee,w,_,C),c<1&&(d++,t(w,_<C?Ae:ee,C,u))),C=w.length):c===0&&(d++,w=[0]),h[m++]=d,c&&w[0]?w[C++]=ue[O]||0:(w=[ue[O]],C=1);while((O++<Q||w[0]!==void 0)&&B--);g=w[0]!==void 0}h[0]||h.shift()}if(p==1)A.e=l,Yn=g;else{for(m=1,d=h[0];d>=10;d/=10)m++;A.e=m+l*p-1,M(A,a?o+A.e+1:o,s,g)}return A}}();function M(i,e,t,n){var r,o,s,a,u,c,l,m,d,p=i.constructor;e:if(e!=null){if(m=i.d,!m)return i;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=D,s=e,l=m[d=0],u=l/pe(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/D),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=u=0,r=1,o%=D,s=o-D+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=D,s=o-D+r,u=s<0?0:l/pe(10,r-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%pe(10,r-s-1)),c=t<4?(u||n)&&(t==0||t==(i.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/pe(10,r-s):0:m[d-1])%10&1||t==(i.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=i.e+1,m[0]=pe(10,(D-e%D)%D),i.e=-e||0):m[0]=i.e=0,i;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=pe(10,D-o),m[d]=s>0?(l/pe(10,r-s)%pe(10,s)|0)*a:0),c)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,m[0]==Ve&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=Ve)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return V&&(i.e>p.maxE?(i.d=null,i.e=NaN):i.e<p.minE&&(i.e=0,i.d=[0])),i}function Xe(i,e,t){if(!i.isFinite())return ni(i);var n,r=i.e,o=ke(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+it(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+it(-r-1)+o,t&&(n=t-s)>0&&(o+=it(n))):r>=s?(o+=it(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+it(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=it(n))),o}function qt(i,e){var t=i[0];for(e*=D;t>=10;t/=10)e++;return e}function Vt(i,e,t){if(e>sr)throw V=!0,t&&(i.precision=t),Error(Hn);return M(new i(_t),e,1,!0)}function De(i,e,t){if(e>un)throw Error(Hn);return M(new i(Dt),e,t,!0)}function $n(i){var e=i.length-1,t=e*D+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function it(i){for(var e="";i--;)e+="0";return e}function ei(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/D+4);for(V=!1;;){if(t%2&&(o=o.times(e),zn(o.d,s)&&(r=!0)),t=Te(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),zn(e.d,s)}return V=!0,o}function Xn(i){return i.d[i.d.length-1]&1}function ti(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function cn(i,e){var t,n,r,o,s,a,u,c=0,l=0,m=0,d=i.constructor,p=d.rounding,g=d.precision;if(!i.d||!i.d[0]||i.e>17)return new d(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(V=!1,u=g):u=e,a=new d(.03125);i.e>-2;)i=i.times(a),m+=5;for(n=Math.log(pe(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new d(1),d.precision=u;;){if(o=M(o.times(i),u,1),t=t.times(++l),a=s.plus(ne(o,t,u,1)),ke(a.d).slice(0,u)===ke(s.d).slice(0,u)){for(r=m;r--;)s=M(s.times(s),u,1);if(e==null)if(c<3&&wt(s.d,u-n,p,c))d.precision=u+=10,t=o=a=new d(1),l=0,c++;else return M(s,d.precision=g,p,V=!0);else return d.precision=g,s}s=a}}function rt(i,e){var t,n,r,o,s,a,u,c,l,m,d,p=1,g=10,f=i,y=f.d,A=f.constructor,h=A.rounding,w=A.precision;if(f.s<0||!y||!y[0]||!f.e&&y[0]==1&&y.length==1)return new A(y&&!y[0]?-1/0:f.s!=1?NaN:y?0:f);if(e==null?(V=!1,l=w):l=e,A.precision=l+=g,t=ke(y),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(i),t=ke(f.d),n=t.charAt(0),p++;o=f.e,n>1?(f=new A("0."+t),o++):f=new A(n+"."+t.slice(1))}else return c=Vt(A,l+2,w).times(o+""),f=rt(new A(n+"."+t.slice(1)),l-g).plus(c),A.precision=w,e==null?M(f,w,h,V=!0):f;for(m=f,u=s=f=ne(f.minus(1),f.plus(1),l,1),d=M(f.times(f),l,1),r=3;;){if(s=M(s.times(d),l,1),c=u.plus(ne(s,new A(r),l,1)),ke(c.d).slice(0,l)===ke(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(Vt(A,l+2,w).times(o+""))),u=ne(u,new A(p),l,1),e==null)if(wt(u.d,l-g,h,a))A.precision=l+=g,c=s=f=ne(m.minus(1),m.plus(1),l,1),d=M(f.times(f),l,1),r=a=1;else return M(u,A.precision=w,h,V=!0);else return A.precision=w,u;u=c,r+=2}}function ni(i){return String(i.s*i.s/0)}function ln(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%D,t<0&&(n+=D),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=D;n<r;)i.d.push(+e.slice(n,n+=D));e=e.slice(n),n=D-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),V&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function ur(i,e){var t,n,r,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Jn.test(e))return ln(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(ir.test(e))t=16,e=e.toLowerCase();else if(nr.test(e))t=2;else if(rr.test(e))t=8;else throw Error(ot+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=ei(n,new n(t),o,o*2)),c=vt(e,t,Ve),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(i.s*0):(i.e=qt(c,l),i.d=c,V=!1,s&&(i=ne(i,r,a*4)),u&&(i=i.times(Math.abs(u)<54?pe(2,u):Tt.pow(2,u))),V=!0,i)}function cr(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:yt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/Gt(5,t)),e=yt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function yt(i,e,t,n,r){var o,s,a,u,c=1,l=i.precision,m=Math.ceil(l/D);for(V=!1,u=t.times(t),a=new i(n);;){if(s=ne(a.times(u),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=ne(s.times(u),new i(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return V=!0,s.d.length=m+1,s}function Gt(i,e){for(var t=i;--e;)t*=i;return t}function ii(i,e){var t,n=e.s<0,r=De(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return He=n?4:1,e;if(t=e.divToInt(r),t.isZero())He=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return He=Xn(t)?n?2:3:n?4:1,e;He=Xn(t)?n?1:4:n?3:2}return e.minus(r).abs()}function mn(i,e,t,n){var r,o,s,a,u,c,l,m,d,p=i.constructor,g=t!==void 0;if(g?(Se(t,1,st),n===void 0?n=p.rounding:Se(n,0,8)):(t=p.precision,n=p.rounding),!i.isFinite())l=ni(i);else{for(l=Xe(i),s=l.indexOf("."),g?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=vt(Xe(d),10,r),d.e=d.d.length),m=vt(l,10,r),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=g?"0p+0":"0";else{if(s<0?o--:(i=new p(i),i.d=m,i.e=o,i=ne(i,d,t,n,0,r),m=i.d,o=i.e,c=Yn),s=m[t],a=r/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(i.s<0?8:7)),m.length=t,c)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=sn.charAt(m[s]);if(g){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=vt(l,r,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=sn.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function zn(i,e){if(i.length>e)return i.length=e,!0}function lr(i){return new this(i).abs()}function mr(i){return new this(i).acos()}function dr(i){return new this(i).acosh()}function pr(i,e){return new this(i).plus(e)}function fr(i){return new this(i).asin()}function br(i){return new this(i).asinh()}function yr(i){return new this(i).atan()}function gr(i){return new this(i).atanh()}function Ar(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=De(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?De(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=De(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(ne(i,e,o,1)),e=De(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(ne(i,e,o,1)),t}function Pr(i){return new this(i).cbrt()}function kr(i){return M(i=new this(i),i.e+1,2)}function wr(i,e,t){return new this(i).clamp(e,t)}function Tr(i){if(!i||typeof i!="object")throw Error(Wt+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,st,"rounding",0,8,"toExpNeg",-bt,0,"toExpPos",0,bt,"maxE",0,bt,"minE",-bt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=an[t]),(n=i[t])!==void 0)if(Te(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(ot+t+": "+n);if(t="crypto",r&&(this[t]=an[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Zn);else this[t]=!1;else throw Error(ot+t+": "+n);return this}function hr(i){return new this(i).cos()}function Br(i){return new this(i).cosh()}function ri(i){var e,t,n;function r(o){var s,a,u,c=this;if(!(c instanceof r))return new r(o);if(c.constructor=r,Qn(o)){c.s=o.s,V?!o.d||o.e>r.maxE?(c.e=NaN,c.d=null):o.e<r.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;V?s>r.maxE?(c.e=NaN,c.d=null):s<r.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return ln(c,o.toString())}else if(u!=="string")throw Error(ot+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),Jn.test(o)?ln(c,o):ur(c,o)}if(r.prototype=P,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Tr,r.clone=ri,r.isDecimal=Qn,r.abs=lr,r.acos=mr,r.acosh=dr,r.add=pr,r.asin=fr,r.asinh=br,r.atan=yr,r.atanh=gr,r.atan2=Ar,r.cbrt=Pr,r.ceil=kr,r.clamp=wr,r.cos=hr,r.cosh=Br,r.div=Ir,r.exp=xr,r.floor=Sr,r.hypot=Kr,r.ln=Cr,r.log=Nr,r.log10=Lr,r.log2=Rr,r.max=Or,r.min=Mr,r.mod=Er,r.mul=Fr,r.pow=vr,r.random=_r,r.round=Dr,r.sign=Vr,r.sin=Wr,r.sinh=qr,r.sqrt=Gr,r.sub=Ur,r.sum=Xr,r.tan=zr,r.tanh=Qr,r.trunc=Yr,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function Ir(i,e){return new this(i).div(e)}function xr(i){return new this(i).exp()}function Sr(i){return M(i=new this(i),i.e+1,3)}function Kr(){var i,e,t=new this(0);for(V=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return V=!0,new this(1/0);t=e}return V=!0,t.sqrt()}function Qn(i){return i instanceof Tt||i&&i.toStringTag===jn||!1}function Cr(i){return new this(i).ln()}function Nr(i,e){return new this(i).log(e)}function Rr(i){return new this(i).log(2)}function Lr(i){return new this(i).log(10)}function Or(){return ti(this,arguments,"lt")}function Mr(){return ti(this,arguments,"gt")}function Er(i,e){return new this(i).mod(e)}function Fr(i,e){return new this(i).mul(e)}function vr(i,e){return new this(i).pow(e)}function _r(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Se(i,1,st),n=Math.ceil(i/D),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(Zn);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=D,n&&i&&(r=pe(10,D-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=D)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<D&&(t-=D-n)}return s.e=t,s.d=a,s}function Dr(i){return M(i=new this(i),i.e+1,this.rounding)}function Vr(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function Wr(i){return new this(i).sin()}function qr(i){return new this(i).sinh()}function Gr(i){return new this(i).sqrt()}function Ur(i,e){return new this(i).sub(e)}function Xr(){var i=0,e=arguments,t=new this(e[i]);for(V=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return V=!0,M(t,this.precision,this.rounding)}function zr(i){return new this(i).tan()}function Qr(i){return new this(i).tanh()}function Yr(i){return M(i=new this(i),i.e+1,1)}P[Symbol.for("nodejs.util.inspect.custom")]=P.toString;P[Symbol.toStringTag]="Decimal";var Tt=P.constructor=ri(an);_t=new Tt(_t);Dt=new Tt(Dt);var N=Tt;import{PublicKey as jr}from"@solana/web3.js";import{get as oi,set as Hr}from"lodash";var dn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},si={},Zr={};function ie(i){let e=oi(si,i);if(!e){let t=oi(Zr,i);e=new dn({name:i,logLevel:t}),Hr(si,i,e)}return e}import{MINT_SIZE as qs,TOKEN_PROGRAM_ID as Gs,getTransferFeeConfig as Us,unpackMint as Xs}from"@solana/spl-token";var pn=ie("Raydium_accountInfo_util");async function at(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}=j({batchRequest:!1},t),s=fn(e,o),a=new Array(s.length).fill([]);if(n){let u=s.map(m=>{let d=i._buildArgs([m.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),c=fn(u,10);a=(await(await Promise.all(c.map(async m=>await i._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&pn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:p,executable:g,lamports:f,owner:y,rentEpoch:A}=d;return p.length!==2&&p[1]!=="base64"&&pn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:g,lamports:f,owner:new jr(y),rentEpoch:A}}return null})))}else try{a=await Promise.all(s.map(u=>i.getMultipleAccountsInfo(u,r)))}catch(u){u instanceof Error&&pn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}async function ht(i,e,t){let n=await at(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>te(j({},r),{accountInfo:n[o]}))}import Je from"bn.js";import oo from"big.js";import zt from"bn.js";import Jr from"toformat";var $r=Jr,It=$r;import Xt from"big.js";import to from"bn.js";import no from"decimal.js-light";import xt from"bn.js";var ai=9007199254740991;function oe(i){let e=ie("Raydium_parseBigNumberish");if(i instanceof xt)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new xt(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=ai||i<=-ai)&&e.logWithError(`BigNumberish number overflow: ${i}`),new xt(String(i))):typeof i=="bigint"?new xt(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new xt(0))}var Ut=ie("module/fraction"),bn=It(Xt),St=It(no),io={[0]:St.ROUND_DOWN,[1]:St.ROUND_HALF_UP,[2]:St.ROUND_UP},ro={[0]:Xt.roundDown,[1]:Xt.roundHalfUp,[2]:Xt.roundUp},J=class{constructor(e,t=new to(1)){this.numerator=oe(e),this.denominator=oe(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new J(this.denominator,this.numerator)}add(e){let t=e instanceof J?e:new J(oe(e));return this.denominator.eq(t.denominator)?new J(this.numerator.add(t.numerator),this.denominator):new J(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof J?e:new J(oe(e));return this.denominator.eq(t.denominator)?new J(this.numerator.sub(t.numerator),this.denominator):new J(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof J?e:new J(oe(e));return new J(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof J?e:new J(oe(e));return new J(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Ut.logWithError(`${e} is not an integer.`),e<=0&&Ut.logWithError(`${e} is not positive.`),St.set({precision:e+1,rounding:io[n]});let r=new St(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Ut.logWithError(`${e} is not an integer.`),e<0&&Ut.logWithError(`${e} is negative.`),bn.DP=e,bn.RM=ro[n]||1,new bn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var so=ie("Raydium_amount"),ui=It(oo);function ao(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):so.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var fe=class extends J{constructor(t,n,r=!0,o){let s=new zt(0),a=yn.pow(new zt(t.decimals));if(r)s=oe(n);else{let u=new zt(0),c=new zt(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=ao(n.toString(),t.decimals);u=oe(l),c=oe(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=ie(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new fe(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new fe(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return ui.DP=this.token.decimals,new ui(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as uo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ci}from"@solana/spl-token";var gn={chainId:101,address:uo.default.toBase58(),programId:ci.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Ze={chainId:101,address:"So11111111111111111111111111111111111111112",programId:ci.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as kn}from"@solana/web3.js";import{PublicKey as ae,SystemProgram as li,SYSVAR_RENT_PUBKEY as co}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as lo}from"@solana/spl-token";function k({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var ha=[k({pubkey:lo,isWritable:!1}),k({pubkey:li.programId,isWritable:!1}),k({pubkey:co,isWritable:!1})];function An({publicKey:i,transformSol:e}){let t=Pn(i.toString());if(t instanceof ae)return e&&t.equals(Kt)?Bt:t;if(e&&t.toString()===Kt.toBase58())return Bt;if(typeof t=="string"){if(t===ae.default.toBase58())return ae.default;try{return new ae(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Pn(i){try{return new ae(i)}catch{return i}}var Qt=new ae("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ct=new ae("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ct=new ae("SysvarRent111111111111111111111111111111111"),Ba=new ae("SysvarC1ock11111111111111111111111111111111"),At=new ae("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Ia=new ae("Sysvar1nstructions1111111111111111111111111"),mo=li.programId,xa=new ae("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Sa=new ae("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Ka=new ae("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Ca=new ae("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Na=new ae("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ra=new ae("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),La=new ae("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Oa=new ae("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ma=new ae("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ea=new ae("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Fa=new ae("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Bt=new ae("So11111111111111111111111111111111111111112"),Kt=ae.default;function gt(i){return An({publicKey:i,transformSol:!0})}var wn=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===Kt.toBase58()||e instanceof kn&&Kt.equals(e)){this.decimals=Ze.decimals,this.symbol=Ze.symbol,this.name=Ze.name,this.mint=new kn(Ze.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?kn.default:An({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},We=wn;We.WSOL=new wn(te(j({},Ze),{mint:Ze.address}));var Tn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Yt=Tn;Yt.SOL=new Tn(gn);import po from"bn.js";var mi=new J(new po(100)),je=class extends J{toSignificant(e=5,t,n){return this.mul(mi).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(mi).toFixed(e,t,n)}};var fo=ie("Raydium_price"),Ce=class extends J{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new J(hn(n.decimals),hn(r.decimals))}get raw(){return new J(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Ce({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&fo.logWithError("mul token not equals");let n=super.mul(t);return new Ce({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};import{PublicKey as bo}from"@solana/web3.js";import yo from"bn.js";function pi(i){return typeof i=="object"&&i!==null&&![We,fe,bo,J,yo,Ce,je].some(e=>typeof e=="object"&&i instanceof e)}function Ne(i){return typeof i=="string"?Pn(i):Array.isArray(i)?i.map(e=>Ne(e)):pi(i)?Object.fromEntries(Object.entries(i).map(([e,t])=>[e,Ne(t)])):i}var di=new Je(0),go=new Je(1),Ru=new Je(2),Lu=new Je(3),Ou=new Je(5),yn=new Je(10),Mu=new Je(100),Eu=new Je(1e3),Fu=new Je(1e4);function hn(i){return yn.pow(oe(i))}function fn(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Po}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ko}from"@solana/spl-token";import{ComputeBudgetProgram as Uu,Keypair as Qu,PublicKey as Ao,Transaction as Hu,TransactionMessage as ju,VersionedTransaction as Ju}from"@solana/web3.js";var re={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{TOKEN_PROGRAM_ID as nc}from"@solana/spl-token";var ic=ie("Raydium_txUtil");function he(i,e){let[t,n]=Ao.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function Fe(i,e,t){return he([i.toBuffer(),(t!=null?t:ko).toBuffer(),e.toBuffer()],new Po("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as z}from"@solana/web3.js";var lc=new z("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),mc=new z("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),dc=new z("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),pc=new z("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),fc=new z("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),fi=new z("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),wo=new z("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),bc=new z("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),bi=new z("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),yi=new z("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),To=new z("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ho=new z("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),yc=new z("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),gc=new z("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Ac=new z("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Pc=new z("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),kc=new z("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),wc=new z("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Bo=new z("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Tc=new z("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),hc=new z("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Io=new z("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),xo=new z("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),So=new z("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");var Bc={SERUM_MARKET:z.default,OPENBOOK_MARKET:new z("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:z.default,FarmV3:new z("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new z("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new z("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new z("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new z("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new z("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new z("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new z("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new z("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Io,CREATE_CPMM_POOL_AUTH:xo,CREATE_CPMM_POOL_FEE_ACC:So,FEE_DESTINATION_ID:new z("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import qe from"bn.js";var Nt=1e4;function ce(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=te(j({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new qe(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Nt){let u=new qe(o.maximumFee.toString());return{amount:i.add(u),fee:u,expirationTime:a}}else{let u=Ht(i.mul(new qe(Nt)),new qe(Nt-o.transferFeeBasisPoints)),c=new qe(o.maximumFee.toString()),l=u.sub(i).gt(c)?i.add(c):u,m=Ht(l.mul(new qe(o.transferFeeBasisPoints)),new qe(Nt)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let u=Ht(i.mul(new qe(o.transferFeeBasisPoints)),new qe(Nt)),c=u.gt(s)?s:u;return{amount:i,fee:c,expirationTime:a}}}function $e(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function Ht(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new qe(0))?t.add(new qe(1)):t}import{PublicKey as Ko,AddressLookupTableAccount as gi}from"@solana/web3.js";var Co={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new gi({key:new Ko("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:gi.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as qc,sendAndConfirmTransaction as Gc,Transaction as Xc,TransactionMessage as Qc,VersionedTransaction as Yc}from"@solana/web3.js";import Zc from"axios";import{PublicKey as Do}from"@solana/web3.js";import Ti,{isBN as hi}from"bn.js";import{bits as wl,BitStructure as Tl,blob as Ro,Blob as hl,cstr as Bl,f32 as Il,f32be as xl,f64 as Sl,f64be as Kl,greedy as Cl,Layout as Lo,ns64 as Nl,ns64be as Rl,nu64 as Ll,nu64be as Ol,offset as Ml,s16 as El,s16be as Fl,s24 as vl,s24be as _l,s32 as Oo,s32be as Dl,s40 as Vl,s40be as Wl,s48 as ql,s48be as Gl,s8 as Ul,seq as Mo,struct as Xl,Structure as Eo,u16 as Fo,u16be as zl,u24 as Ql,u24be as Yl,u32 as Hl,u32be as Zl,u40 as jl,u40be as Jl,u48 as $l,u48be as em,u8 as vo,UInt as _o,union as tm,Union as nm,unionLayoutDiscriminator as im,utf8 as rm}from"@solana/buffer-layout";var Bn=Lo,Pi=Eo;var In=_o;var ki=vo,lt=Fo;var we=Oo;var wi=Mo;var be=Ro;var Pt=class extends Bn{constructor(t,n,r){super(t,r);this.blob=be(t),this.signed=n}decode(t,n=0){let r=new Ti(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new Ti(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function W(i){return new In(1,i)}function Re(i){return new In(4,i)}function b(i){return new Pt(8,!1,i)}function G(i){return new Pt(16,!1,i)}function Bi(i){return new Pt(8,!0,i)}function Ii(i){return new Pt(16,!0,i)}var Zt=class extends Bn{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function I(i){return new Zt(be(32),e=>new Do(e),e=>e.toBuffer(),i)}function ve(i){return new Zt(ki(),Vo,Wo,i)}function Vo(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function Wo(i){return i?1:0}var xn=class extends Pi{decode(e,t){return super.decode(e,t)}};function E(i,e,t){return new xn(i,e,t)}function H(i,e,t){let n,r=typeof e=="number"?e:hi(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=hi(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return wi(i,r,t)}import{PublicKey as bp}from"@solana/web3.js";import gp from"bn.js";import{AccountLayout as wp,TOKEN_PROGRAM_ID as Tp}from"@solana/spl-token";import{PublicKey as Pm}from"@solana/web3.js";import{MintLayout as wm,TOKEN_PROGRAM_ID as hm}from"@solana/spl-token";import{Keypair as En,PublicKey as x,SystemProgram as kt,TransactionInstruction as Ee}from"@solana/web3.js";import Vi from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Wi,TOKEN_2022_PROGRAM_ID as nt,TOKEN_PROGRAM_ID as me}from"@solana/spl-token";import Jo from"bn.js";import _e from"bn.js";var le=new _e(0),Le=new _e(1),et=new _e(-1),Oe=new _e(1).shln(64),jt=new _e(1).shln(128),Sn=Oe.sub(Le),Rt=64,xi=jt.subn(1),Be=-443636,Ie=-Be,ze=new _e("4295048016"),Qe=new _e("79226673521066979257578248091"),Jt=new _e("4295048017"),$t=new _e("79226673521066979257578248090"),Si=16,Ki="59543866431248",Ci="184467440737095516",Ni="15793534762490258745",en=new _e(10).pow(new _e(6));var Em=new _e("18446744073700000000");import X from"bn.js";function tn(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function Kn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Cn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function Lt(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function Ri(i,e){return Lt(i,e)?null:Kn(i,e)}function Li(i,e){return Lt(i,e)?null:Cn(i,e)}var Wm=Buffer.from("amm_config","utf8"),qo=Buffer.from("pool","utf8"),Go=Buffer.from("pool_vault","utf8"),Uo=Buffer.from("pool_reward_vault","utf8"),Oi=Buffer.from("position","utf8"),Xo=Buffer.from("tick_array","utf8"),zo=Buffer.from("operation","utf8"),Qo=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Yo=Buffer.from("observation","utf8");function Mi(i,e,t,n){return he([qo,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function Nn(i,e,t){return he([Go,e.toBuffer(),t.toBuffer()],i)}function Ei(i,e,t){return he([Uo,e.toBuffer(),t.toBuffer()],i)}function $(i,e,t){return he([Xo,e.toBuffer(),tn(t)],i)}function ut(i,e,t,n){return he([Oi,e.toBuffer(),tn(t),tn(n)],i)}function Me(i,e){return he([Oi,e.toBuffer()],i)}function nn(i){return he([Buffer.from("metadata","utf8"),At.toBuffer(),i.toBuffer()],At)}function rn(i){return he([zo],i)}function Ke(i,e){return he([Qo,e.toBuffer()],i)}function Fi(i,e){return he([Yo,e.toBuffer()],i)}var Ho=Buffer.from("locked_position","utf8");function Rn(i,e){return he([Ho,e.toBuffer()],i)}import{PublicKey as Ge}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as vi}from"@solana/spl-token";import se from"bn.js";import Ye from"bn.js";var Ot=class{static getfeeGrowthInside(e,t,n){let r=new Ye(0),o=new Ye(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new Ye(0),a=new Ye(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=U.wrappingSubU128(U.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),c=U.wrappingSubU128(U.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=U.mulDivFloor(U.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Oe),u=t.tokenFeesOwedA.add(a),c=U.mulDivFloor(U.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Oe),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=U.mulDivFloor(U.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Oe),u=t.tokenFeesOwedA.add(a),c=U.mulDivFloor(U.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Oe),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=U.wrappingSubU128(u,c.growthInsideLastX64),m=U.mulDivFloor(l,t.liquidity,Oe),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=U.wrappingSubU128(u,c.growthInsideLastX64),m=U.mulDivFloor(l,t.liquidity,Oe),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new Ye(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new Ye(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(U.wrappingSubU128(U.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new Ye(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new Ye(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(U.wrappingSubU128(U.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var y,A,h,w;let a=q.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),u=q.getSqrtPriceX64FromTick(t.tickLower),c=q.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,m=Z.getAmountsFromLiquidity(a,u,c,n,o),[d,p]=[ce(m.amountA,(y=e.mintA.extensions)==null?void 0:y.feeConfig,s,!0),ce(m.amountB,(A=e.mintB.extensions)==null?void 0:A.feeConfig,s,!0)],[g,f]=[ce(new Ye(new N(m.amountA.toString()).mul(l).toFixed(0)),(h=e.mintA.extensions)==null?void 0:h.feeConfig,s,!0),ce(new Ye(new N(m.amountB.toString()).mul(l).toFixed(0)),(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:p,amountSlippageA:g,amountSlippageB:f,expirationTime:$e(d.expirationTime,p.expirationTime)}}};var Zo=15,Y=class{static async getTickArrays(e,t,n,r,o,s,a){let u=[],c=R.getTickArrayStartIndexByTick(r,o),l=R.getInitializedTickArrayInRange(s,a,o,c,Math.floor(Zo/2));for(let p=0;p<l.length;p++){let{publicKey:g}=$(t,n,l[p]);u.push(g)}let m=(await at(e,u)).map(p=>p!==null?Mt.decode(p.data):null),d={};for(let p=0;p<u.length;p++){let g=m[p];g!==null&&(d[g.startTickIndex]=te(j({},g),{address:u[p]}))}return d}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=R.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:p}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,d,p]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/Y.tickCount(t)),a=n?R.searchLowBitFromStart(r,o,s-1,1,t):R.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=ye-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<ye;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=$(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=R.getTickArrayStartIndexByTick(r,o),u=Math.floor((r-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u-1}else for(u=u+1;u<ye;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u+1}let{publicKey:m}=$(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(R.checkIsOutOfBoundary(e)){if(e>Ie)return!1;let n=R.getTickArrayStartIndexByTick(Be,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return ye*e}};var Ln=14,tt=class{static maxTickInTickarrayBitmap(e){return e*ye*mt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!Y.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-Y.tickCount(n):t+Y.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*ye,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(r){let l=e.shln(1024-c-1),m=Ri(1024,l);if(m!==null){let d=(c-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=Li(1024,l);if(m!==null){let d=(c+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-Y.tickCount(n)}}}},Et=class{static getBitmapOffset(e,t){if(!Y.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=tt.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=tt.maxTickInTickarrayBitmap(e),n=-t;if(Ie<=t)throw Error(`extensionTickBoundary check error: ${Ie}, ${t}`);if(n<=Be)throw Error(`extensionTickBoundary check error: ${n}, ${Be}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:R.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=Y.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=tt.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let u=R.mergeTickArrayBitmap(e).shln(mt-1-a),c=Lt(512,u)?null:Kn(512,u);if(c!==null){let l=t-c*Y.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=R.mergeTickArrayBitmap(e).shrn(a),c=Lt(512,u)?null:Cn(512,u);if(c!==null){let l=t+c*Y.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-Y.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%tt.maxTickInTickarrayBitmap(t),r=Math.floor(n/Y.tickCount(t));return e<0&&n!=0&&(r=mt-r),r}};var ge=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,s=!1){let a=n.toBase58()===e.mintA.address,u=[],{isExist:c,startIndex:l,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,a);if(!c||l===void 0||!m)throw new Error("Invalid tick array");u.push(m);let{allTrade:d,amountCalculated:p,accounts:g,sqrtPriceX64:f,feeAmount:y}=dt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,o,s);return u.push(...g),{allTrade:d,expectedAmountOut:p.mul(et),remainingAccounts:u,executionPrice:f,feeAmount:y}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:y}=$(e.programId,e.id,f.nextStartIndex);a.push(y)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:g}=dt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(et),c,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:p,feeAmount:g}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=ge.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Et.checkTickArrayIsInit(Y.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):R.checkTickArrayIsInitialized(R.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=$(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,Y.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=$(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/Y.tickCount(e.tickSpacing)),r=t?R.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):R.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=Y.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=tt.nextInitializedTickArrayStartIndex(R.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Et.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Be||t>Ie)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,u,c;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(c=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(d===void 0)throw Error("get new reward mint info error");let p=te(j({},m),{perSecond:U.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Ge(d)});if(p.tokenMint.equals(Ge.default))continue;if(n<=p.openTime.toNumber()||r.eq(le)){s.push(p);continue}let g=new se(Math.min(p.endTime.toNumber(),n)),f=g.sub(p.lastUpdateTime),y=U.mulDivFloor(f,p.emissionsPerSecondX64,r),A=p.rewardGrowthGlobalX64.add(y),h=U.mulDivFloor(f,p.emissionsPerSecondX64,Oe),w=p.rewardTotalEmissioned.add(h);s.push(te(j({},p),{rewardGrowthGlobalX64:A,rewardTotalEmissioned:w,lastUpdateTime:g}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=R.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=tt.maxTickInTickarrayBitmap(e),n=-t;return t>Ie&&(t=Y.getArrayStartIndex(Ie,e)+Y.tickCount(e)),n<Be&&(n=Y.getArrayStartIndex(Be,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!Y.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/Y.tickCount(t)*mt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await ht(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=_i.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let u of t){let c=R.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=R.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:d}=$(u.programId,u.id,m);o.push({pubkey:d}),r[d.toString()]=u.id}}let s=await ht(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=r[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=Mt.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]=te(j({},l),{address:u.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(l=>l.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(d=>d.accountInfo.mint),c=[];for(let d of u)for(let p of s)c.push(Me(p,d).publicKey);let l=await at(t,c,{batchRequest:r}),m={};for(let d of l){if(d===null)continue;let p=On.decode(d.data),g=p.poolId.toString(),f=e.find(O=>O.state.id.toBase58()===g);if(f===void 0)continue;let y=f.state,A=R._getTickPriceLegacy({poolInfo:y,tick:p.tickLower,baseIn:!0}),h=R._getTickPriceLegacy({poolInfo:y,tick:p.tickUpper,baseIn:!0}),{amountA:w,amountB:C}=Z.getAmountsFromLiquidity(y.sqrtPriceX64,A.tickSqrtPriceX64,h.tickSqrtPriceX64,p.liquidity,!1),F=1/(1-Math.sqrt(Math.sqrt(A.price.div(h.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:p.poolId,nftMint:p.nftMint,priceLower:A.price,priceUpper:h.price,amountA:w,amountB:C,tickLower:p.tickLower,tickUpper:p.tickUpper,liquidity:p.liquidity,feeGrowthInsideLastX64A:p.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:p.feeGrowthInsideLastX64B,tokenFeesOwedA:p.tokenFeesOwedA,tokenFeesOwedB:p.tokenFeesOwedB,rewardInfos:p.rewardInfos.map(O=>te(j({},O),{pendingReward:new se(0)})),leverage:F,tokenFeeAmountA:new se(0),tokenFeeAmountB:new se(0)}];let B=await R.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickLower,f.state.tickSpacing),v=await R.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickUpper,f.state.tickSpacing);m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickLower}`]=B,m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickUpper}`]=v}if(o){let d=Object.values(m),p=await at(t,d,{batchRequest:r}),g={};for(let f=0;f<d.length;f++){let y=p[f];if(y===null)continue;let A=d[f].toString();g[A]=Mt.decode(y.data)}for(let{state:f,positionAccount:y}of e)if(!!y)for(let A of y){let h=`${f.programId.toString()}-${f.id.toString()}-${A.tickLower}`,w=`${f.programId.toString()}-${f.id.toString()}-${A.tickUpper}`,C=g[m[h].toString()],F=g[m[w].toString()],B=C.ticks[R.getTickOffsetInArray(A.tickLower,f.tickSpacing)],v=F.ticks[R.getTickOffsetInArray(A.tickUpper,f.tickSpacing)],{tokenFeeAmountA:O,tokenFeeAmountB:Q}=await Ot.GetPositionFees(f,A,B,v),T=await Ot.GetPositionRewards(f,A,B,v);A.tokenFeeAmountA=O.gte(new se(0))?O:new se(0),A.tokenFeeAmountB=Q.gte(new se(0))?Q:new se(0);for(let _=0;_<T.length;_++)A.rewardInfos[_].pendingReward=T[_].gte(new se(0))?T[_]:new se(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new N(0),catchLiquidityInsufficient:u=!1}){var Ae;let c,l=n.toBase58()===e.mintA.address,[m,d]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new N(0))?c=l?ze.add(new se(1)):Qe.sub(new se(1)):c=q.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let p=ce(o,m,r,!1),{allTrade:g,expectedAmountOut:f,remainingAccounts:y,executionPrice:A,feeAmount:h}=ge.getOutputAmountAndRemainAccounts(e,t,n,p.amount.sub((Ae=p.fee)!=null?Ae:le),c,u),w=ce(f,d,r,!1),C=q.sqrtPriceX64ToPrice(A,e.mintA.decimals,e.mintB.decimals),F=l?C:new N(1).div(C),B=f.mul(new se(Math.floor((1-s)*1e10))).div(new se(1e10)),v=ce(B,d,r,!1),O=l?e.currentPrice:new N(1).div(e.currentPrice),Q=new N(F).sub(O).abs(),T=O,_=new je(new N(Q).mul(10**15).toFixed(0),new N(T).mul(10**15).toFixed(0));return{allTrade:g,realAmountIn:p,amountOut:w,minAmountOut:v,expirationTime:$e(p.expirationTime,w.expirationTime),currentPrice:e.currentPrice,executionPrice:F,priceImpact:_,fee:h,remainingAccounts:y,executionPriceX64:A}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let u=r.address===e.mintB.address,[c,l]=u?[e.mintA,e.mintB]:[e.mintB,e.mintA],[m,d]=[new We(te(j({},c),{mint:c.address,isToken2022:c.programId===vi.toBase58()})),new We(te(j({},l),{mint:l.address,isToken2022:l.programId===vi.toBase58()}))],{allTrade:p,realAmountIn:g,amountOut:f,minAmountOut:y,expirationTime:A,currentPrice:h,executionPrice:w,priceImpact:C,fee:F,remainingAccounts:B,executionPriceX64:v}=ge.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Ge(c.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),O=te(j({},g),{amount:new fe(m,g.amount),fee:g.fee===void 0?void 0:new fe(m,g.fee)}),Q=te(j({},f),{amount:new fe(d,f.amount),fee:f.fee===void 0?void 0:new fe(d,f.fee)}),T=te(j({},y),{amount:new fe(d,y.amount),fee:y.fee===void 0?void 0:new fe(d,y.fee)}),_=new Ce({baseToken:m,denominator:new se(10).pow(new se(20+m.decimals)),quoteToken:d,numerator:h.mul(new N(10**(20+d.decimals))).toFixed(0)}),Ae=new Ce({baseToken:m,denominator:new se(10).pow(new se(20+m.decimals)),quoteToken:d,numerator:w.mul(new N(10**(20+d.decimals))).toFixed(0)}),de=new fe(m,F);return{allTrade:p,realAmountIn:O,amountOut:Q,minAmountOut:T,expirationTime:A,currentPrice:_,executionPrice:Ae,priceImpact:C,fee:de,remainingAccounts:B,executionPriceX64:v}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:o,slippage:s,priceLimit:a=new N(0)}){var T;let u=n.toBase58()===e.mintA.address,c={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;a.equals(new N(0))?l=u?Qe.sub(new se(1)):ze.add(new se(1)):l=q.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let m=ce(o,c[n.toString()],r,!0),{expectedAmountIn:d,remainingAccounts:p,executionPrice:g,feeAmount:f}=ge.getInputAmountAndRemainAccounts(e,t,n,m.amount.sub((T=m.fee)!=null?T:le),l),y=u?e.mintB.address:e.mintA.address,A=ce(d,c[y],r,!1),h=q.sqrtPriceX64ToPrice(g,e.mintA.decimals,e.mintB.decimals),w=u?h:new N(1).div(h),C=d.mul(new se(Math.floor((1+s)*1e10))).div(new se(1e10)),F=ce(C,c[y],r,!0),B=u?e.currentPrice:new N(1).div(e.currentPrice),v=new N(w).sub(B).abs(),O=B,Q=new je(new N(v).mul(10**15).toFixed(0),new N(O).mul(10**15).toFixed(0));return{amountIn:A,maxAmountIn:F,realAmountOut:m,expirationTime:$e(A.expirationTime,m.expirationTime),currentPrice:e.currentPrice,executionPrice:w,priceImpact:Q,fee:f,remainingAccounts:p}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var g,f,y;let o=e[t],s=R.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=R.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,d=o.priceMax-o.priceMin,p;return l<=0?p=0:m===l?p=d/l:d===l?p=l/m:p=l/d*(l/m),{feeApr:o.feeApr*p,rewardsApr:[((g=o.rewardApr[0])!=null?g:0)*p,((f=o.rewardApr[1])!=null?f:0)*p,((y=o.rewardApr[2])!=null?y:0)*p],apr:o.apr*p}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=r[gt(e.mintA.address).toString()],d=r[gt(e.mintB.address).toString()],p=e.mintA.decimals,g=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=q.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),y=q.getSqrtPriceX64FromTick(s),A=q.getSqrtPriceX64FromTick(a),{amountSlippageA:h,amountSlippageB:w}=Z.getAmountsFromLiquidityWithSlippage(f,y,A,t,!1,!1,0),{amountSlippageA:C,amountSlippageB:F}=Z.getAmountsFromLiquidityWithSlippage(f,y,A,o,!1,!1,0),B=new N(h.toString()).div(new N(10).pow(p)).mul(m.value).add(new N(w.toString()).div(new N(10).pow(g)).mul(d.value)),v=new N(C.toString()).div(new N(10).pow(p)).mul(m.value).add(new N(F.toString()).div(new N(10).pow(g)).mul(d.value)),O=new N(1).div(B.add(v)),T=new N(l.volumeFee).mul(365).div(c).mul(O).mul(100).toNumber(),_=3600*24*365,Ae=e.rewardDefaultInfos.map(de=>{var ee,qn;let xe=de.mint.decimals,ue=r[de.mint.address];return u<((ee=de.startTime)!=null?ee:0)||u>((qn=de.endTime)!=null?qn:0)||!de.perSecond||!ue||xe===void 0?0:new N(ue.value).mul(new N(de.perSecond).mul(_)).div(new N(10).pow(xe)).mul(O).mul(100).toNumber()});return{feeApr:T,rewardsApr:Ae,apr:T+Ae.reduce((de,xe)=>de+xe,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var A,h;let l=q.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),m=q.getSqrtPriceX64FromTick(n),d=q.getSqrtPriceX64FromTick(r),p=a?1-s:1+s,g=ce(o,(A=e[t?"mintA":"mintB"].extensions)==null?void 0:A.feeConfig,u,!c),f=new se(new N(g.amount.sub((h=g.fee)!=null?h:le).toString()).mul(p).toFixed(0)),y;if(l.lte(m))y=t?Z.getLiquidityFromTokenAmountA(m,d,f,!a):new se(0);else if(l.lte(d)){let w=Z.getLiquidityFromTokenAmountA(l,d,f,!a),C=Z.getLiquidityFromTokenAmountB(m,l,f);y=t?w:C}else y=t?new se(0):Z.getLiquidityFromTokenAmountB(m,d,f);return ge.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:r,liquidity:y,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var y,A,h,w;let u=q.getSqrtPriceX64FromTick(n),c=q.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,m=Z.getAmountsFromLiquidity(q.priceToSqrtPriceX64(new N(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[d,p]=[ce(m.amountA,(y=t.mintA.extensions)==null?void 0:y.feeConfig,e,!0),ce(m.amountB,(A=t.mintB.extensions)==null?void 0:A.feeConfig,e,!0)],[g,f]=[ce(m.amountA.muln(l),(h=t.mintA.extensions)==null?void 0:h.feeConfig,e,!0),ce(m.amountB.muln(l),(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:p,amountSlippageA:g,amountSlippageB:f,expirationTime:$e(d.expirationTime,p.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(u=>!n[u.id]).map(u=>new Ge(u.id));(await at(e,r)).forEach((u,c)=>{!u||(n[r[c].toBase58()]=on.decode(u.data))});let s=t.map(u=>Ke(new Ge(u.programId),new Ge(u.id)).publicKey),a=await ge.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((u,c)=>te(j({},u),{[c.id]:te(j({},n[c.id]),{id:new Ge(c.id),version:6,programId:new Ge(c.programId),mintA:c.mintA,mintB:c.mintB,ammConfig:te(j({},c.config),{id:new Ge(c.config.id),fundOwner:""}),currentPrice:new N(c.price),exBitmapInfo:a[Ke(new Ge(c.programId),new Ge(c.id)).publicKey.toBase58()],startTime:n[c.id].startTime.toNumber()})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var U=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(le)||(o=o.add(Le)),o}static mulDivFloor(e,t,n){if(n.eq(le))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(le))throw new Error("division by 0");return e.mul(t).add(n.sub(Le)).div(n)}static x64ToDecimal(e,t){return new N(e.toString()).div(N.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new X(e.mul(N.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(jt).sub(t).mod(jt)}};function Pe(i,e){return Mn(i.mul(e),64,256)}function jo(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Mn(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var q=class{static sqrtPriceX64ToPrice(e,t,n){return U.x64ToDecimal(e).pow(2).mul(N.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return U.decimalToX64(e.mul(N.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(le))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(le))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(le))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(le))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(le))return e;let o=t.shln(Rt);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?U.mulDivCeil(s,e,a):U.mulDivRoundingUp(s,Le,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return U.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(Rt);if(r)return e.add(o.div(t));{let s=U.mulDivRoundingUp(o,Le,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Be||e>Ie)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new X("18445821805675395072"):new X("18446744073709551616");return(t&2)!=0&&(n=Pe(n,new X("18444899583751176192"))),(t&4)!=0&&(n=Pe(n,new X("18443055278223355904"))),(t&8)!=0&&(n=Pe(n,new X("18439367220385607680"))),(t&16)!=0&&(n=Pe(n,new X("18431993317065453568"))),(t&32)!=0&&(n=Pe(n,new X("18417254355718170624"))),(t&64)!=0&&(n=Pe(n,new X("18387811781193609216"))),(t&128)!=0&&(n=Pe(n,new X("18329067761203558400"))),(t&256)!=0&&(n=Pe(n,new X("18212142134806163456"))),(t&512)!=0&&(n=Pe(n,new X("17980523815641700352"))),(t&1024)!=0&&(n=Pe(n,new X("17526086738831433728"))),(t&2048)!=0&&(n=Pe(n,new X("16651378430235570176"))),(t&4096)!=0&&(n=Pe(n,new X("15030750278694412288"))),(t&8192)!=0&&(n=Pe(n,new X("12247334978884435968"))),(t&16384)!=0&&(n=Pe(n,new X("8131365268886854656"))),(t&32768)!=0&&(n=Pe(n,new X("3584323654725218816"))),(t&65536)!=0&&(n=Pe(n,new X("696457651848324352"))),(t&131072)!=0&&(n=Pe(n,new X("26294789957507116"))),(t&262144)!=0&&(n=Pe(n,new X("37481735321082"))),e>0&&(n=xi.div(n)),n}static getTickFromPrice(e,t,n){return q.getTickFromSqrtPriceX64(q.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Qe)||e.lt(ze))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new X(t-64),r=jo(n,32,128),o=new X("8000000000000000","hex"),s=0,a=new X(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new X(0))&&s<Si;){u=u.mul(u);let g=u.shrn(127);u=u.shrn(63+g.toNumber()),a=a.add(o.mul(g)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=r.add(c).mul(new X(Ki)),d=Mn(m.sub(new X(Ci)),64,128).toNumber(),p=Mn(m.add(new X(Ni)),64,128).toNumber();return d==p?d:q.getSqrtPriceX64FromTick(p).lte(e)?p:d}},pt=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=q.getTickFromSqrtPriceX64(q.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=pt.getTickWithPriceAndTickspacing(e,t,n,r),s=q.getSqrtPriceX64FromTick(o);return q.sqrtPriceX64ToPrice(s,n,r)}},Z=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(le))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(Rt),s=t.sub(e);return r?U.mulDivRoundingUp(U.mulDivCeil(o,s,t),Le,e):U.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(le))throw new Error("sqrtPriceX64A must greater than 0");return r?U.mulDivCeil(n,t.sub(e),Oe):U.mulDivFloor(n,t.sub(e),Oe)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?U.mulDivRoundingUp(a,Le,Sn):a.shrn(Rt)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),U.mulDivFloor(n,Sn,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return Z.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=Z.getLiquidityFromTokenAmountA(e,n,r,!1),a=Z.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return Z.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:Z.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new X(0)};if(e.lt(n)){let s=Z.getTokenAmountAFromLiquidity(e,n,r,o),a=Z.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new X(0),amountB:Z.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:u,amountB:c}=Z.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,m=new X(new N(u.toString()).mul(l).toFixed(0)),d=new X(new N(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var h,w,C,F;let c=q.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),l=q.getSqrtPriceX64FromTick(t),m=q.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,p=Z.getAmountsFromLiquidity(c,l,m,r,s),[g,f]=[ce(p.amountA,(h=e.mintA.extensions)==null?void 0:h.feeConfig,a,u),ce(p.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,a,u)],[y,A]=[ce(new X(new N(p.amountA.toString()).mul(d).toFixed(0)),(C=e.mintA.extensions)==null?void 0:C.feeConfig,a,u),ce(new X(new N(p.amountB.toString()).mul(d).toFixed(0)),(F=e.mintB.extensions)==null?void 0:F.feeConfig,a,u)];return{liquidity:r,amountA:g,amountB:f,amountSlippageA:y,amountSlippageB:A,expirationTime:$e(g.expirationTime,f.expirationTime)}}},dt=class{static swapCompute(e,t,n,r,o,s,a,u,c,l,m,d,p,g,f=!1){if(d.eq(le))throw new Error("amountSpecified must not be 0");if(g||(g=s?ze.add(Le):Qe.sub(Le)),s){if(g.lt(ze))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(g.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(g.gt(Qe))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(g.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let y=d.gt(le),A={amountSpecifiedRemaining:d,amountCalculated:le,sqrtPriceX64:m,tick:c>p?Math.min(p+Y.tickCount(l)-1,c):p,accounts:[],liquidity:u,feeAmount:new X(0)},h=p,w=n[p],C=0,F=!s&&w.startTickIndex===A.tick;for(;!A.amountSpecifiedRemaining.eq(le)&&!A.sqrtPriceX64.eq(g);){C>10;let B={};B.sqrtPriceStartX64=A.sqrtPriceX64;let v=R.nextInitTick(w,A.tick,l,s,F),O=v||null,Q=null;if(!(O!=null&&O.liquidityGross.gtn(0))){let _=ge.nextInitializedTickArrayStartIndex({tickCurrent:A.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},h,s);if(!_.isExist){if(f)return{allTrade:!1,amountSpecifiedRemaining:A.amountSpecifiedRemaining,amountCalculated:A.amountCalculated,feeAmount:A.feeAmount,sqrtPriceX64:A.sqrtPriceX64,liquidity:A.liquidity,tickCurrent:A.tick,accounts:A.accounts};throw Error("swapCompute LiquidityInsufficient")}h=_.nextStartIndex;let{publicKey:Ae}=$(e,t,h);Q=Ae,w=n[h];try{O=R.firstInitializedTick(w,s)}catch{throw Error("not found next tick info")}}B.tickNext=O.tick,B.initialized=O.liquidityGross.gtn(0),p!==h&&Q&&(A.accounts.push(Q),p=h),B.tickNext<Be?B.tickNext=Be:B.tickNext>Ie&&(B.tickNext=Ie),B.sqrtPriceNextX64=q.getSqrtPriceX64FromTick(B.tickNext);let T;if(s&&B.sqrtPriceNextX64.lt(g)||!s&&B.sqrtPriceNextX64.gt(g)?T=g:T=B.sqrtPriceNextX64,[A.sqrtPriceX64,B.amountIn,B.amountOut,B.feeAmount]=dt.swapStepCompute(A.sqrtPriceX64,T,A.liquidity,A.amountSpecifiedRemaining,a),A.feeAmount=A.feeAmount.add(B.feeAmount),y?(A.amountSpecifiedRemaining=A.amountSpecifiedRemaining.sub(B.amountIn.add(B.feeAmount)),A.amountCalculated=A.amountCalculated.sub(B.amountOut)):(A.amountSpecifiedRemaining=A.amountSpecifiedRemaining.add(B.amountOut),A.amountCalculated=A.amountCalculated.add(B.amountIn.add(B.feeAmount))),A.sqrtPriceX64.eq(B.sqrtPriceNextX64)){if(B.initialized){let _=O.liquidityNet;s&&(_=_.mul(et)),A.liquidity=Z.addDelta(A.liquidity,_)}F=B.tickNext!=A.tick&&!s&&w.startTickIndex===B.tickNext,A.tick=s?B.tickNext-1:B.tickNext}else if(A.sqrtPriceX64!=B.sqrtPriceStartX64){let _=q.getTickFromSqrtPriceX64(A.sqrtPriceX64);F=_!=A.tick&&!s&&w.startTickIndex===_,A.tick=_}++C}try{let{nextStartIndex:B,isExist:v}=Y.nextInitializedTickArray(A.tick,l,s,r,o);v&&p!==B&&(A.accounts.push($(e,t,B).publicKey),p=B)}catch{}return{allTrade:!0,amountSpecifiedRemaining:le,amountCalculated:A.amountCalculated,feeAmount:A.feeAmount,sqrtPriceX64:A.sqrtPriceX64,liquidity:A.liquidity,tickCurrent:A.tick,accounts:A.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new X(0),amountIn:new X(0),amountOut:new X(0),feeAmount:new X(0)},a=e.gte(t),u=r.gte(le);if(u){let l=U.mulDivFloor(r,en.sub(new X(o.toString())),en);s.amountIn=a?Z.getTokenAmountAFromLiquidity(t,e,n,!0):Z.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=q.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?Z.getTokenAmountBFromLiquidity(t,e,n,!1):Z.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(et).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=q.getNextSqrtPriceX64FromOutput(e,n,r.mul(et),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=Z.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=Z.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:Z.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:Z.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(r.mul(et))&&(s.amountOut=r.mul(et)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=U.mulDivCeil(s.amountIn,new X(o),en.sub(new X(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var ye=60,mt=512,R=class{static getTickArrayAddressByTick(e,t,n,r){let o=R.getTickArrayStartIndexByTick(n,r),{publicKey:s}=$(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=R.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=ye)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=Y.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*Y.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*ye,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*ye,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*ye:e+t*ye}static mergeTickArrayBitmap(e){let t=new Jo(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*ye));return[...R.searchLowBitFromStart(e,t,s-1,o,n),...R.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return R.searchHightBitFromStart(e,t,0,mt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=R.getAllInitializedTickArrayStartIndex(n,r,o);for(let u of a){let{publicKey:c}=$(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>R.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===r)break}let u=Y.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>R.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===r)break}let u=Y.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<Be||e>Ie}static nextInitTick(e,t,n,r,o){if(Y.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<ye;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=ye-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<ye;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=q.getSqrtPriceX64FromTick(t),o=q.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new N(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new N(1).div(t),o=pt.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=q.getSqrtPriceX64FromTick(o),a=q.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new N(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=q.getSqrtPriceX64FromTick(t),o=q.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new N(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new N(1).div(t),o=pt.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=q.getSqrtPriceX64FromTick(o),a=q.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new N(1).div(a)}}};var $o=E([be(8),W("bump"),lt("index"),I(""),Re("protocolFeeRate"),Re("tradeFeeRate"),lt("tickSpacing"),H(b(),8,"")]),es=E([Re("blockTimestamp"),Bi("tickCumulative"),H(b(),4)]),Di=E([be(8),ve("initialized"),b("recentEpoch"),lt("observationIndex"),I("poolId"),H(es,100,"observations"),H(b(),4)]),ts=E([W("rewardState"),b("openTime"),b("endTime"),b("lastUpdateTime"),G("emissionsPerSecondX64"),b("rewardTotalEmissioned"),b("rewardClaimed"),I("tokenMint"),I("tokenVault"),I("creator"),G("rewardGrowthGlobalX64")]),on=E([be(8),W("bump"),I("ammConfig"),I("creator"),I("mintA"),I("mintB"),I("vaultA"),I("vaultB"),I("observationId"),W("mintDecimalsA"),W("mintDecimalsB"),lt("tickSpacing"),G("liquidity"),G("sqrtPriceX64"),we("tickCurrent"),Re(),G("feeGrowthGlobalX64A"),G("feeGrowthGlobalX64B"),b("protocolFeesTokenA"),b("protocolFeesTokenB"),G("swapInAmountTokenA"),G("swapOutAmountTokenB"),G("swapInAmountTokenB"),G("swapOutAmountTokenA"),W("status"),H(W(),7,""),H(ts,3,"rewardInfos"),H(b(),16,"tickArrayBitmap"),b("totalFeesTokenA"),b("totalFeesClaimedTokenA"),b("totalFeesTokenB"),b("totalFeesClaimedTokenB"),b("fundFeesTokenA"),b("fundFeesTokenB"),b("startTime"),H(b(),15*4-3,"padding")]),ns=E([G("growthInsideLastX64"),b("rewardAmountOwed")]),On=E([be(8),W("bump"),I("nftMint"),I("poolId"),we("tickLower"),we("tickUpper"),G("liquidity"),G("feeGrowthInsideLastX64A"),G("feeGrowthInsideLastX64B"),b("tokenFeesOwedA"),b("tokenFeesOwedB"),H(ns,3,"rewardInfos"),H(b(),8,"")]),Hd=E([be(8),W("bump"),I("poolId"),we("tickLowerIndex"),we("tickUpperIndex"),G("liquidity"),G("feeGrowthInsideLastX64A"),G("feeGrowthInsideLastX64B"),b("tokenFeesOwedA"),b("tokenFeesOwedB"),H(G(),3,"rewardGrowthInside"),H(b(),8,"")]),is=E([we("tick"),Ii("liquidityNet"),G("liquidityGross"),G("feeGrowthOutsideX64A"),G("feeGrowthOutsideX64B"),H(G(),3,"rewardGrowthsOutsideX64"),H(Re(),13,"")]),Mt=E([be(8),I("poolId"),we("startTickIndex"),H(is,ye,"ticks"),W("initializedTickCount"),H(W(),115,"")]),rs=E([be(329),H(I(),100,"whitelistMints")]),_i=E([be(8),I("poolId"),H(H(b(),8),Ln,"positiveTickArrayBitmap"),H(H(b(),8),Ln,"negativeTickArrayBitmap")]),Zd=E([b(),W("bump"),I("owner"),I("poolId"),I("positionId"),I("nftAccount"),H(b(),8)]);Di.span;var qi=ie("Raydium_Clmm"),Ue={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},os=[188,37,179,131,82,150,84,73],ss=[16,72,250,198,14,162,212,19],Ft=class{static createPoolInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,g){let f=E([G("sqrtPriceX64"),b("startTime")]),y=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:kt.programId,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1}],A=Buffer.alloc(f.span);f.encode({sqrtPriceX64:p,startTime:g},A);let h=Buffer.from([...Ue.createPool,...A]);return new Ee({keys:y,programId:e,data:h})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:o,ammConfigId:s,initialPriceX64:a,startTime:u}=e,[c,l]=[new x(r.address),new x(o.address)],{publicKey:m}=Mi(t,s,c,l),{publicKey:d}=Fi(t,m),{publicKey:p}=Nn(t,m,c),{publicKey:g}=Nn(t,m,l),f=[this.createPoolInstruction(t,m,n,s,d,c,p,new x(r.programId||me),l,g,new x(o.programId||me),Ke(t,m).publicKey,a,u)];return{signers:[],instructions:f,instructionTypes:[re.CreateAccount,re.ClmmCreatePool],address:{poolId:m,observationId:d,mintAVault:p,mintBVault:g},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,g,f,y,A,h,w,C,F,B,v,O,Q,T){let _=E([we("tickLowerIndex"),we("tickUpperIndex"),we("tickArrayLowerStartIndex"),we("tickArrayUpperStartIndex"),G("liquidity"),b("amountMaxA"),b("amountMaxB"),ve("withMetadata"),W("optionBaseFlag"),ve("baseFlag")]),Ae=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[]],de=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:kt.programId,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:Wi,isSigner:!1,isWritable:!1},{pubkey:At,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},...Ae],xe=Buffer.alloc(_.span);_.encode({tickLowerIndex:h,tickUpperIndex:w,tickArrayLowerStartIndex:C,tickArrayUpperStartIndex:F,liquidity:B,amountMaxA:v,amountMaxB:O,withMetadata:Q==="create",baseFlag:!1,optionBaseFlag:0},xe);let ue=Buffer.from([...Ue.openPosition,...xe]);return new Ee({keys:de,programId:e,data:ue})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,p]=[new x(e.programId),new x(e.id)],g;if(l)g=new x((await l(1))[0]);else{let O=En.generate();m.push(O),g=O.publicKey}let f=R.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=R.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:A}=$(d,p,f),{publicKey:h}=$(d,p,y),{publicKey:w}=Fe(n.wallet,g,me),{publicKey:C}=nn(g),{publicKey:F}=Me(d,g),{publicKey:B}=ut(d,p,r,o),v=this.openPositionFromLiquidityInstruction(d,n.feePayer,p,n.wallet,g,w,C,B,A,h,F,n.tokenAccountA,n.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),r,o,f,y,s,a,u,c);return{signers:m,instructions:[v],instructionTypes:[re.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:g,tickArrayLower:A,tickArrayUpper:h,positionNftAccount:w,metadataAccount:C,personalPosition:F,protocolPosition:B}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,p]=[new x(e.programId),new x(e.id)],g;if(l)g=new x((await l(1))[0]);else{let O=En.generate();m.push(O),g=O.publicKey}let f=R.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=R.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:A}=$(d,p,f),{publicKey:h}=$(d,p,y),{publicKey:w}=Fe(n.wallet,g,me),{publicKey:C}=nn(g),{publicKey:F}=Me(d,g),{publicKey:B}=ut(d,p,r,o),v=this.openPositionFromBaseInstruction(d,n.feePayer,p,n.wallet,g,w,C,B,A,h,F,n.tokenAccountA,n.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),r,o,f,y,c,s,a,u,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,y])?Ke(d,p).publicKey:void 0);return{address:{nftMint:g,tickArrayLower:A,tickArrayUpper:h,positionNftAccount:w,metadataAccount:C,personalPosition:F,protocolPosition:B},instructions:[v],signers:m,instructionTypes:[re.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,g,f,y,A,h,w,C,F,B,v,O,Q,T){let _=E([we("tickLowerIndex"),we("tickUpperIndex"),we("tickArrayLowerStartIndex"),we("tickArrayUpperStartIndex"),G("liquidity"),b("amountMaxA"),b("amountMaxB"),ve("withMetadata"),W("optionBaseFlag"),ve("baseFlag")]),Ae=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[]],de=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:kt.programId,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:Wi,isSigner:!1,isWritable:!1},{pubkey:At,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},...Ae],xe=Buffer.alloc(_.span);_.encode({tickLowerIndex:h,tickUpperIndex:w,tickArrayLowerStartIndex:C,tickArrayUpperStartIndex:F,liquidity:new Vi(0),amountMaxA:v==="MintA"?O:Q,amountMaxB:v==="MintA"?Q:O,withMetadata:B==="create",baseFlag:v==="MintA",optionBaseFlag:1},xe);let ue=Buffer.from([...Ue.openPosition,...xe]);return new Ee({keys:de,programId:e,data:ue})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m,d=[];if(l)m=new x((await l(1))[0]);else{let O=En.generate();d.push(O),m=O.publicKey}let[p,g]=[new x(e.programId),new x(e.id)],f=R.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=R.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:A}=$(p,g,f),{publicKey:h}=$(p,g,y),{publicKey:w}=Fe(n.wallet,m,me),{publicKey:C}=nn(m),{publicKey:F}=Me(p,m),{publicKey:B}=ut(p,g,r,o),v=this.openPositionFromLiquidityInstruction(p,n.wallet,g,n.wallet,m,w,C,B,A,h,F,n.tokenAccountA,n.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(t.mintA.address),new x(t.mintB.address),r,o,f,y,s,a,u,c,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,y])?Ke(p,g).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:A,tickArrayUpper:h,positionNftAccount:w,metadataAccount:C,personalPosition:F,protocolPosition:B},instructions:[v],signers:d,instructionTypes:[re.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=E([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:kt.programId,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([...Ue.closePosition,...u]);return new Ee({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new x(e.programId),{publicKey:s}=Fe(n.wallet,r.nftMint,me),{publicKey:a}=Me(o,r.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[re.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,g,f,y,A,h){let w=E([G("liquidity"),b("amountMaxA"),b("amountMaxB"),W("optionBaseFlag"),ve("baseFlag")]),C=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],F=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...C],B=Buffer.alloc(w.span);w.encode({liquidity:f,amountMaxA:y,amountMaxB:A,optionBaseFlag:0,baseFlag:!1},B);let v=Buffer.from([...Ue.increaseLiquidity,...B]);return new Ee({keys:F,programId:e,data:v})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new x(e.programId),new x(e.id)],l=R.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=R.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=$(u,c,l),{publicKey:p}=$(u,c,m),{publicKey:g}=Fe(r.wallet,n.nftMint,me),{publicKey:f}=Me(u,n.nftMint),{publicKey:y}=ut(u,c,n.tickLower,n.tickUpper),A=this.increasePositionFromLiquidityInstruction(u,r.wallet,g,f,c,y,d,p,r.tokenAccountA,r.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),o,s,a,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Ke(u,c).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:g,personalPosition:f,protocolPosition:y},signers:[],instructions:[A],instructionTypes:[re.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new x(e.programId),new x(e.id)],l=R.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=R.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=$(u,c,l),{publicKey:p}=$(u,c,m),{publicKey:g}=Fe(r.wallet,n.nftMint,me),{publicKey:f}=Me(u,n.nftMint),{publicKey:y}=ut(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:g,personalPosition:f,protocolPosition:y},instructions:[this.increasePositionFromBaseInstruction(u,r.wallet,g,f,c,y,d,p,r.tokenAccountA,r.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),o,s,a,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Ke(u,c).publicKey:void 0)],signers:[],instructionTypes:[re.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,g,f,y,A,h){let w=E([G("liquidity"),b("amountMaxA"),b("amountMaxB"),W("optionBaseFlag"),ve("baseFlag")]),C=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],F=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...C],B=Buffer.alloc(w.span);w.encode({liquidity:new Vi(0),amountMaxA:f==="MintA"?y:A,amountMaxB:f==="MintA"?A:y,baseFlag:f==="MintA",optionBaseFlag:1},B);let v=Buffer.from([...Ue.increaseLiquidity,...B]);return new Ee({keys:F,programId:e,data:v})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,g,f,y,A,h,w){let C=E([G("liquidity"),b("amountMinA"),b("amountMinB")]),F=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...f.map(Q=>[{pubkey:Q.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:Q.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:Q.rewardMint,isSigner:!1,isWritable:!1}]).flat()],B=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:Qt,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...F],v=Buffer.alloc(C.span);C.encode({liquidity:y,amountMinA:A,amountMinB:h},v);let O=Buffer.from([...Ue.decreaseLiquidity,...v]);return new Ee({keys:B,programId:e,data:O})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,l]=[new x(e.programId),new x(e.id)],m=R.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=R.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=$(c,l,m),{publicKey:g}=$(c,l,d),{publicKey:f}=Fe(r.wallet,n.nftMint,u),{publicKey:y}=Me(c,n.nftMint),{publicKey:A}=ut(c,l,n.tickLower,n.tickUpper),h=[];for(let F=0;F<e.rewardDefaultInfos.length;F++)h.push({poolRewardVault:new x(t.rewardInfos[F].vault),ownerRewardVault:r.rewardAccounts[F],rewardMint:new x(e.rewardDefaultInfos[F].mint.address)});let w=[],C=this.decreaseLiquidityInstruction(c,r.wallet,f,y,l,A,p,g,r.tokenAccountA,r.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),h,o,s,a,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?Ke(c,l).publicKey:void 0);return w.push(C),{address:{tickArrayLower:p,tickArrayUpper:g,positionNftAccount:f,personalPosition:y,protocolPosition:A},signers:[],instructions:w,instructionTypes:[re.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,g,f,y,A){let h=E([b("amount"),b("otherAmountThreshold"),G("sqrtPriceLimitX64"),ve("isBaseInput")]),w=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[],...m.map(v=>({pubkey:v,isSigner:!1,isWritable:!0}))],C=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:Qt,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...w],F=Buffer.alloc(h.span);h.encode({amount:p,otherAmountThreshold:g,sqrtPriceLimitX64:f,isBaseInput:y},F);let B=Buffer.from([...Ue.swap,...F]);return new Ee({keys:C,programId:e,data:B})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new x(e.programId),new x(e.id)],[d,p]=[new x(t.vault.A),new x(t.vault.B)],[g,f]=[new x(e.mintA.address),new x(e.mintB.address)],y=e.mintA.address===o.toString(),A=[this.swapInstruction(l,r.wallet,m,new x(e.config.id),y?r.tokenAccountA:r.tokenAccountB,y?r.tokenAccountB:r.tokenAccountA,y?d:p,y?p:d,y?g:f,y?f:g,c,n,s,a,u,!0,Ke(l,m).publicKey)];return{signers:[],instructions:A,instructionTypes:[re.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:o,amountOut:s,amountInMax:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new x(e.programId),new x(e.id)],[d,p]=[new x(t.vault.A),new x(t.vault.B)],[g,f]=[new x(e.mintA.address),new x(e.mintB.address)],y=e.mintA.address===o.toBase58(),A=[this.swapInstruction(l,r.wallet,m,new x(e.config.id),y?r.tokenAccountB:r.tokenAccountA,y?r.tokenAccountA:r.tokenAccountB,y?p:d,y?d:p,y?f:g,y?g:f,c,n,s,a,u,!1,Ke(l,m).publicKey)];return{signers:[],instructions:A,instructionTypes:[re.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,d){let p=E([b("openTime"),b("endTime"),G("emissionsPerSecondX64")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:kt.programId,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1}],f=Buffer.alloc(p.span);p.encode({openTime:oe(l),endTime:oe(m),emissionsPerSecondX64:d},f);let y=Buffer.from([...Ue.initReward,...f]);return new Ee({keys:g,programId:e,data:y})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new x(e.programId),new x(e.id)],a=Ei(o,s,r.mint).publicKey,u=rn(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new x(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[re.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,d){let p=E([W("rewardIndex"),G("emissionsPerSecondX64"),b("openTime"),b("endTime")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(p.span);p.encode({rewardIndex:c,emissionsPerSecondX64:d,openTime:oe(l),endTime:oe(m)},f);let y=Buffer.from([...Ue.setRewardEmissions,...f]);return new Ee({keys:g,programId:e,data:y})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new x(e.programId),new x(e.id)],a,u,c;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===r.mint.toString()&&(a=d,u=new x(t.rewardInfos[d].vault),c=new x(t.rewardInfos[d].mint.address));(a===void 0||u===void 0)&&qi.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=rn(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new x(e.config.id),n.tokenAccount,u,c,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[re.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let u=E([W("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:Qt,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([...Ue.collectReward,...l]);return new Ee({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new x(e.programId),new x(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,u=new x(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&qi.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,r,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[re.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:r,positionNft:o}){let{publicKey:s}=Fe(r,o,me),{publicKey:a}=Me(n,o),u=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Rn(e,a).publicKey,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:kt.programId,isSigner:!1,isWritable:!1}];return new Ee({keys:u,programId:e,data:Buffer.from(os)})}static harvestLockPositionInstruction(e){let[t,n]=[new x(e.poolKeys.programId),new x(e.poolKeys.id)],r=R.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),o=R.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:s}=$(t,n,r),{publicKey:a}=$(t,n,o),{publicKey:u}=Fe(e.owner,e.ownerPosition.nftMint,me),{publicKey:c}=Me(t,e.ownerPosition.nftMint),{publicKey:l}=ut(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),m=[];for(let g=0;g<e.poolKeys.rewardInfos.length;g++)m.push({poolRewardVault:new x(e.poolKeys.rewardInfos[g].vault),ownerRewardVault:e.ownerRewardAccounts[g],rewardMint:new x(e.poolKeys.rewardInfos[g].mint.address)});let d=[...m.map(g=>[{pubkey:g.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:g.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:g.rewardMint,isSigner:!1,isWritable:!1}]).flat()],p=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:Rn(e.programId,c).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:new x(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new x(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:Ct,isSigner:!1,isWritable:!1},{pubkey:new x(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new x(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...d];return new Ee({keys:p,programId:e.programId,data:Buffer.from(ss)})}};var rf=E([be(8),W("bump"),ve("disableCreatePool"),lt("index"),b("tradeFeeRate"),b("protocolFeeRate"),b("fundFeeRate"),b("createPoolFee"),I("protocolOwner"),I("fundOwner"),H(b(),16)]),cs=E([be(8),I("configId"),I("poolCreator"),I("vaultA"),I("vaultB"),I("mintLp"),I("mintA"),I("mintB"),I("mintProgramA"),I("mintProgramB"),I("observationId"),W("bump"),W("status"),W("lpDecimals"),W("mintDecimalA"),W("mintDecimalB"),b("lpAmount"),b("protocolFeesMintA"),b("protocolFeesMintB"),b("fundFeesMintA"),b("fundFeesMintB"),b("openTime"),H(b(),32)]);import{TransactionInstruction as ls}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Pf,TOKEN_2022_PROGRAM_ID as kf,TOKEN_PROGRAM_ID as wf}from"@solana/spl-token";var af=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),uf=Buffer.from("amm_config","utf8"),cf=Buffer.from("pool","utf8"),lf=Buffer.from("pool_lp_mint","utf8"),mf=Buffer.from("pool_vault","utf8"),df=Buffer.from("observation","utf8");var If=ie("Raydium_cpmm"),ms={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173]};function Ui(i,e,t,n,r,o,s,a,u,c,l,m,d,p,g,f){let y=E([b("amountIn"),b("amounOutMin")]),A=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],h=Buffer.alloc(y.span);return y.encode({amountIn:g,amounOutMin:f},h),new ls({keys:A,programId:i,data:Buffer.from([...ms.swapBaseInput,...h])})}import Vf from"bn.js";import qf from"decimal.js-light";import ds from"bn.js";var Rf=new ds(0);import ps from"bn.js";var Ef=new ps(1e6);import Xi from"bn.js";var ib=new Xi(25),rb=new Xi(1e4);var Fn=E([W("instruction"),b("amountIn"),b("minAmountOut")]),vn=E([W("instruction"),b("maxAmountIn"),b("amountOut")]),ub=E([W("instruction"),W("nonce")]),fs=E([W("instruction"),W("nonce"),b("startTime")]),bs=E([b("status"),b("nonce"),b("maxOrder"),b("depth"),b("baseDecimal"),b("quoteDecimal"),b("state"),b("resetFlag"),b("minSize"),b("volMaxCutRatio"),b("amountWaveRatio"),b("baseLotSize"),b("quoteLotSize"),b("minPriceMultiplier"),b("maxPriceMultiplier"),b("systemDecimalValue"),b("minSeparateNumerator"),b("minSeparateDenominator"),b("tradeFeeNumerator"),b("tradeFeeDenominator"),b("pnlNumerator"),b("pnlDenominator"),b("swapFeeNumerator"),b("swapFeeDenominator"),b("baseNeedTakePnl"),b("quoteNeedTakePnl"),b("quoteTotalPnl"),b("baseTotalPnl"),b("poolOpenTime"),b("punishPcAmount"),b("punishCoinAmount"),b("orderbookToInitTime"),G("swapBaseInAmount"),G("swapQuoteOutAmount"),b("swapBase2QuoteFee"),G("swapQuoteInAmount"),G("swapBaseOutAmount"),b("swapQuote2BaseFee"),I("baseVault"),I("quoteVault"),I("baseMint"),I("quoteMint"),I("lpMint"),I("openOrders"),I("marketId"),I("marketProgramId"),I("targetOrders"),I("withdrawQueue"),I("lpVault"),I("owner"),b("lpReserve"),H(b(),3,"padding")]),cb=E([b("accountType"),b("status"),b("nonce"),b("maxOrder"),b("depth"),b("baseDecimal"),b("quoteDecimal"),b("state"),b("resetFlag"),b("minSize"),b("volMaxCutRatio"),b("amountWaveRatio"),b("baseLotSize"),b("quoteLotSize"),b("minPriceMultiplier"),b("maxPriceMultiplier"),b("systemDecimalsValue"),b("abortTradeFactor"),b("priceTickMultiplier"),b("priceTick"),b("minSeparateNumerator"),b("minSeparateDenominator"),b("tradeFeeNumerator"),b("tradeFeeDenominator"),b("pnlNumerator"),b("pnlDenominator"),b("swapFeeNumerator"),b("swapFeeDenominator"),b("baseNeedTakePnl"),b("quoteNeedTakePnl"),b("quoteTotalPnl"),b("baseTotalPnl"),b("poolOpenTime"),b("punishPcAmount"),b("punishCoinAmount"),b("orderbookToInitTime"),G("swapBaseInAmount"),G("swapQuoteOutAmount"),G("swapQuoteInAmount"),G("swapBaseOutAmount"),b("swapQuote2BaseFee"),b("swapBase2QuoteFee"),I("baseVault"),I("quoteVault"),I("baseMint"),I("quoteMint"),I("lpMint"),I("modelDataAccount"),I("openOrders"),I("marketId"),I("marketProgramId"),I("targetOrders"),I("owner"),H(b(),64,"padding")]),ys=E([W("instruction"),b("baseAmountIn"),b("quoteAmountIn"),b("fixedSide"),b("otherAmountMin")]),gs=E([W("instruction"),b("lpAmount"),b("baseAmountMin"),b("quoteAmountMin")]);var lb=E([b("fee")]);import{PublicKey as Qb}from"@solana/web3.js";import Hb from"bn.js";import{TOKEN_PROGRAM_ID as Jb}from"@solana/spl-token";import{PublicKey as Ab,SystemProgram as Pb,SYSVAR_RENT_PUBKEY as kb,TransactionInstruction as Qi}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Tb,TOKEN_PROGRAM_ID as Yi}from"@solana/spl-token";import{PublicKey as As}from"@solana/web3.js";var _n=new As("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Ps=5e4,ks=E([b("x"),b("y"),b("price")]),bb=E([b("accountType"),b("status"),b("multiplier"),b("validDataCount"),H(ks,Ps,"DataElement")]);var zi=ie("Raydium_liquidity_instruction");function ws({poolKeys:i,userKeys:e,amountIn:t,minAmountOut:n},r){let o=Ne(i),s=Buffer.alloc(Fn.span);Fn.encode({instruction:9,amountIn:oe(t),minAmountOut:oe(n)},s);let a=[k({pubkey:Yi,isWritable:!1}),k({pubkey:o.id}),k({pubkey:o.authority,isWritable:!1}),k({pubkey:o.openOrders})];return r===4&&a.push(k({pubkey:o.targetOrders})),a.push(k({pubkey:o.vault.A}),k({pubkey:o.vault.B})),r===5&&a.push(k({pubkey:_n})),a.push(k({pubkey:o.marketProgramId,isWritable:!1}),k({pubkey:o.marketId}),k({pubkey:o.marketBids}),k({pubkey:o.marketAsks}),k({pubkey:o.marketEventQueue}),k({pubkey:o.marketBaseVault}),k({pubkey:o.marketQuoteVault}),k({pubkey:o.marketAuthority,isWritable:!1}),k({pubkey:e.tokenAccountIn}),k({pubkey:e.tokenAccountOut}),k({pubkey:e.owner,isWritable:!1})),new Qi({programId:o.programId,keys:a,data:s})}function Ts({poolKeys:i,userKeys:e,maxAmountIn:t,amountOut:n},r){let o=Ne(i),s=Buffer.alloc(vn.span);vn.encode({instruction:11,maxAmountIn:oe(t),amountOut:oe(n)},s);let a=[k({pubkey:Yi,isWritable:!1}),k({pubkey:o.id}),k({pubkey:o.authority,isWritable:!1}),k({pubkey:o.openOrders}),k({pubkey:o.targetOrders}),k({pubkey:o.vault.A}),k({pubkey:o.vault.B})];return r===5&&a.push(k({pubkey:_n})),a.push(k({pubkey:o.marketProgramId,isWritable:!1}),k({pubkey:o.marketId}),k({pubkey:o.marketBids}),k({pubkey:o.marketAsks}),k({pubkey:o.marketEventQueue}),k({pubkey:o.marketBaseVault}),k({pubkey:o.marketQuoteVault}),k({pubkey:o.marketAuthority,isWritable:!1}),k({pubkey:e.tokenAccountIn}),k({pubkey:e.tokenAccountOut}),k({pubkey:e.owner,isWritable:!1,isSigner:!0})),new Qi({programId:o.programId,keys:a,data:s})}function Hi(i){let{poolKeys:e,version:t,userKeys:n,amountIn:r,amountOut:o,fixedSide:s}=i;if(t===4||t===5){let a={poolKeys:e,userKeys:n};if(s==="in")return ws(te(j({},a),{amountIn:r,minAmountOut:o}),t);if(s==="out")return Ts(te(j({},a),{maxAmountIn:r,amountOut:o}),t);zi.logWithError("invalid params","params",i)}throw zi.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}import{PublicKey as Mb}from"@solana/web3.js";var vb=ie("Raydium_liquidity_serum");import{PublicKey as Ly,SystemProgram as My}from"@solana/web3.js";import vy from"bn.js";import{createCloseAccountInstruction as Wy,createInitializeAccountInstruction as qy,createTransferInstruction as Gy,TOKEN_PROGRAM_ID as Uy}from"@solana/spl-token";import{Keypair as gy,PublicKey as Ay}from"@solana/web3.js";import wy from"bn.js";import{TOKEN_PROGRAM_ID as By}from"@solana/spl-token";var Zi=E([I("mint"),I("owner"),b("amount"),Re("delegateOption"),I("delegate"),W("state"),Re("isNativeOption"),b("isNative"),b("delegatedAmount"),Re("closeAuthorityOption"),I("closeAuthority")]);var xy=ie("Raydium_Util");var hs={[fi.toBase58()]:3};var Bs=E([be(5),be(8),I("ownAddress"),b("vaultSignerNonce"),I("baseMint"),I("quoteMint"),I("baseVault"),b("baseDepositsTotal"),b("baseFeesAccrued"),I("quoteVault"),b("quoteDepositsTotal"),b("quoteFeesAccrued"),b("quoteDustThreshold"),I("requestQueue"),I("eventQueue"),I("bids"),I("asks"),b("baseLotSize"),b("quoteLotSize"),b("feeRateBps"),b("referrerRebatesAccrued"),be(7)]);import{PublicKey as rg}from"@solana/web3.js";var cg=ie("Serum");var gg=E([Re("mintAuthorityOption"),I("mintAuthority"),b("supply"),W("decimals"),W("isInitialized"),Re("freezeAuthorityOption"),I("freezeAuthority")]);import{PublicKey as L,SystemProgram as Dn,TransactionInstruction as Vn}from"@solana/web3.js";import ft from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Is,TOKEN_2022_PROGRAM_ID as xs,TOKEN_PROGRAM_ID as Wn}from"@solana/spl-token";function Lg(i,e,t,n,r,o,s,a,u,c,l,m){let d=E([W("instruction"),b("amountIn"),b("amountOut")]),p=[{pubkey:Dn.programId,isSigner:!1,isWritable:!1},{pubkey:Wn,isSigner:!1,isWritable:!1},{pubkey:new L(t.programId),isSigner:!1,isWritable:!1},{pubkey:new L(t.id),isSigner:!1,isWritable:!0},{pubkey:new L(n.id),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let f=Ne(t);p.push({pubkey:f.config.id,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.A:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.B:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},...m.map(y=>({pubkey:y,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let f=Ne(t);p.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:new L("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0})}else{let f=Ne(t);p.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},...f.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:f.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:f.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0}])}let g=Buffer.alloc(d.span);return d.encode({instruction:4,amountIn:c,amountOut:l},g),new Vn({keys:p,programId:i,data:g})}function Og(i,e,t,n,r,o,s,a,u,c){let l=E([W("instruction")]),m=[{pubkey:Dn.programId,isSigner:!1,isWritable:!1},{pubkey:Wn,isSigner:!1,isWritable:!1},{pubkey:new L(String(n.programId)),isSigner:!1,isWritable:!1},{pubkey:new L(String(n.id)),isSigner:!1,isWritable:!0},{pubkey:new L(String(t.id)),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let p=Ne(n);m.push({pubkey:p.config.id,isSigner:!1,isWritable:!1},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.mintA.address.equals(u)?p.vault.A:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.mintA.address.equals(u)?p.vault.B:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0},...c.map(g=>({pubkey:g,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let p=Ne(n);m.push({pubkey:p.authority,isSigner:!1,isWritable:!1},{pubkey:p.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:new L("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:p.openOrders,isSigner:!1,isWritable:!0},{pubkey:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.marketId,isSigner:!1,isWritable:!0},{pubkey:p.marketBids,isSigner:!1,isWritable:!0},{pubkey:p.marketAsks,isSigner:!1,isWritable:!0},{pubkey:p.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0})}else{let p=Ne(n);m.push({pubkey:p.authority,isSigner:!1,isWritable:!1},{pubkey:p.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:p.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:p.openOrders,isSigner:!1,isWritable:!0},{pubkey:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.marketId,isSigner:!1,isWritable:!0},{pubkey:p.marketBids,isSigner:!1,isWritable:!0},{pubkey:p.marketAsks,isSigner:!1,isWritable:!0},{pubkey:p.marketEventQueue,isSigner:!1,isWritable:!0},...p.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:p.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:p.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0}])}let d=Buffer.alloc(l.span);return l.encode({instruction:5},d),new Vn({keys:m,programId:i,data:d})}function Ss(i,e,t,n,r,o,s,a,u,c,l,m,d,p,g){var B;let f=[],y=[k({pubkey:Wn,isWritable:!1}),k({pubkey:xs,isWritable:!1}),k({pubkey:Is,isWritable:!1}),k({pubkey:Dn.programId,isWritable:!1}),k({pubkey:e,isSigner:!0})];y.push(k({pubkey:t})),y.push(k({pubkey:r}));let A=[u,c],h=[l,m],w=[o,s,a];for(let v=0;v<A.length;v++){let O=A[v],Q=w[v]===O.mintA.address;if(y.push(k({pubkey:new L(O.programId),isWritable:!1})),v===A.length-1?y.push(k({pubkey:r})):y.push(k({pubkey:n})),y.push(k({pubkey:new L(w[v])})),y.push(k({pubkey:new L(w[v+1])})),O.version===6){let T=h[v];y.push(k({pubkey:new L(T.config.id)})),y.push(k({pubkey:new L(T.id)})),y.push(k({pubkey:new L(Q?T.vault.A:T.vault.B)})),y.push(k({pubkey:new L(Q?T.vault.B:T.vault.A)})),y.push(k({pubkey:new L(O.observationId)})),y.push(k({pubkey:Ct})),y.push(k({pubkey:Ke(new L(O.programId),new L(O.id)).publicKey})),f.push(Ks(O.sqrtPriceX64.toString(),Q));for(let _ of(B=g[v])!=null?B:[])y.push(k({pubkey:new L(_)}))}else if(O.version===5){let T=h[v];y.push(k({pubkey:new L(T.id)})),y.push(k({pubkey:new L(T.authority),isWritable:!1})),y.push(k({pubkey:new L(T.marketProgramId)})),y.push(k({pubkey:new L(T.marketAuthority)})),y.push(k({pubkey:bi,isWritable:!1})),y.push(k({pubkey:new L(T.openOrders)})),y.push(k({pubkey:new L(T.vault.A)})),y.push(k({pubkey:new L(T.vault.B)})),y.push(k({pubkey:new L(T.id)})),y.push(k({pubkey:new L(T.id)})),y.push(k({pubkey:new L(T.id)})),y.push(k({pubkey:new L(T.id)})),y.push(k({pubkey:new L(T.id)})),y.push(k({pubkey:new L(T.id)})),y.push(k({pubkey:new L(T.marketId)})),y.push(k({pubkey:new L(T.marketBids)})),y.push(k({pubkey:new L(T.marketAsks)})),y.push(k({pubkey:new L(T.marketEventQueue)})),y.push(k({pubkey:new L(T.marketBaseVault)})),y.push(k({pubkey:new L(T.marketQuoteVault)}))}else if(O.version===4){let T=h[v],_=O.status!==1;y.push(k({pubkey:new L(T.id)})),y.push(k({pubkey:new L(T.authority),isWritable:!1})),y.push(k({pubkey:new L(_?T.id:T.marketProgramId)})),y.push(k({pubkey:new L(_?T.id:T.marketAuthority)})),y.push(k({pubkey:new L(_?T.id:T.openOrders)})),y.push(k({pubkey:new L(T.vault.A)})),y.push(k({pubkey:new L(T.vault.B)})),y.push(k({pubkey:new L(_?T.id:T.marketId)})),y.push(k({pubkey:new L(_?T.id:T.marketBids)})),y.push(k({pubkey:new L(_?T.id:T.marketAsks)})),y.push(k({pubkey:new L(_?T.id:T.marketEventQueue)})),y.push(k({pubkey:new L(_?T.id:T.marketBaseVault)})),y.push(k({pubkey:new L(_?T.id:T.marketQuoteVault)}))}else if(O.version===7){let T=h[v];y.push(k({pubkey:new L(T.authority)})),y.push(k({pubkey:new L(T.config.id)})),y.push(k({pubkey:new L(T.id)})),y.push(k({pubkey:new L(Q?T.vault.A:T.vault.B)})),y.push(k({pubkey:new L(Q?T.vault.B:T.vault.A)})),y.push(k({pubkey:new L(O.observationId)}))}else throw Error("pool type error")}let C=E([W("insId"),b("amountIn"),b("amountOut"),H(G(),f.length,"clmmPriceLimit")]),F=Buffer.alloc(C.span);return C.encode({insId:0,amountIn:d,amountOut:p,clmmPriceLimit:f},F),new Vn({keys:y,programId:i,data:F})}function Ks(i,e){if(i)if(e){let t=new ft(i).div(new ft(25));return t.gt(Jt)?t:Jt}else{let t=new ft(i).mul(new ft(25));return t.lt($t)?t:$t}else return e?Jt:$t}function Cs({routeProgram:i,ownerInfo:e,inputMint:t,swapInfo:n}){var r,o,s,a,u,c,l;if(n.routeType==="amm")if(n.poolInfo[0].version===6){let m=n.poolKey[0],d=Ne(m),p=t.equals(d.mintA.address)?ze.add(Le):Qe.sub(Le);return Ft.makeSwapBaseInInstructions({poolInfo:m,poolKeys:m,observationId:n.poolInfo[0].observationId,ownerInfo:{wallet:e.wallet,tokenAccountA:d.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:d.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((o=(r=n.minAmountOut.fee)==null?void 0:r.raw)!=null?o:new ft(0)),sqrtPriceLimitX64:p,remainingAccounts:(s=n.remainingAccounts[0])!=null?s:[]})}else if(n.poolInfo[0].version===7){let m=n.poolInfo[0],d=t.toString()===n.poolInfo[0].mintA.address;return{signers:[],instructions:[Ui(m.programId,e.wallet,m.authority,m.configId,m.id,e.sourceToken,e.destinationToken,d?m.vaultA:m.vaultB,d?m.vaultB:m.vaultA,d?m.mintProgramA:m.mintProgramB,d?m.mintProgramB:m.mintProgramA,new L(m[d?"mintA":"mintB"].address),new L(m[d?"mintB":"mintA"].address),m.observationId,n.amountIn.amount.raw,n.minAmountOut.amount.raw)],lookupTableAddress:[],instructionTypes:[d?re.CpmmSwapBaseIn:re.CpmmSwapBaseOut],address:{}}}else{let m=n.poolKey[0];return{signers:[],instructions:[Hi({poolKeys:m,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((u=(a=n.minAmountOut.fee)==null?void 0:a.raw)!=null?u:new ft(0)),fixedSide:"in"})],lookupTableAddress:m.lookupTableAccount?[m.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?re.AmmV5SwapBaseIn:re.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let m=n.poolInfo[0],d=n.poolInfo[1],p=n.poolKey[0],g=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[Ss(i,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.middleToken.mint.toString(),n.outputMint.toString(),m,d,p,g,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((l=(c=n.minAmountOut.fee)==null?void 0:c.raw)!=null?l:new ft(0)),n.remainingAccounts)],instructionTypes:[re.RouteSwap],lookupTableAddress:[p.lookupTableAccount,g.lookupTableAccount].filter(f=>f!==void 0),address:{}}}else throw Error("route type error")}var gA=new Ns(0);export{Cs as makeSwapInstruction,Lg as route1Instruction,Og as route2Instruction,Ss as routeInstruction};
//# sourceMappingURL=index.mjs.map