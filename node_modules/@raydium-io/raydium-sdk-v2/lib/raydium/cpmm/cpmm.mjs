var sr=Object.defineProperty,ar=Object.defineProperties;var ur=Object.getOwnPropertyDescriptors;var Je=Object.getOwnPropertySymbols;var rn=Object.prototype.hasOwnProperty,on=Object.prototype.propertyIsEnumerable;var nn=(n,t,e)=>t in n?sr(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,E=(n,t)=>{for(var e in t||(t={}))rn.call(t,e)&&nn(n,e,t[e]);if(Je)for(var e of Je(t))on.call(t,e)&&nn(n,e,t[e]);return n},H=(n,t)=>ar(n,ur(t));var ue=(n,t)=>{var e={};for(var r in n)rn.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&Je)for(var r of Je(n))t.indexOf(r)<0&&on.call(n,r)&&(e[r]=n[r]);return e};import{PublicKey as x}from"@solana/web3.js";import{AccountLayout as $i,NATIVE_MINT as Tt,TOKEN_PROGRAM_ID as de}from"@solana/spl-token";import pe from"bn.js";var Be=9e15,ye=1e9,At="0123456789abcdef",Qe="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",$e="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",xt={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Be,maxE:Be,crypto:!1},cn,ce,I=!0,tt="[DecimalError] ",be=tt+"Invalid argument: ",ln=tt+"Precision limit exceeded",mn=tt+"crypto unavailable",fn="[object Decimal]",J=Math.floor,j=Math.pow,cr=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,lr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,mr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,pn=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,ne=1e7,k=7,fr=9007199254740991,pr=Qe.length-1,Bt=$e.length-1,g={toStringTag:fn};g.absoluteValue=g.abs=function(){var n=new this.constructor(this);return n.s<0&&(n.s=1),B(n)};g.ceil=function(){return B(new this.constructor(this),this.e+1,2)};g.clampedTo=g.clamp=function(n,t){var e,r=this,i=r.constructor;if(n=new i(n),t=new i(t),!n.s||!t.s)return new i(NaN);if(n.gt(t))throw Error(be+t);return e=r.cmp(n),e<0?n:r.cmp(t)>0?t:new i(r)};g.comparedTo=g.cmp=function(n){var t,e,r,i,o=this,s=o.d,a=(n=new o.constructor(n)).d,u=o.s,c=n.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==n.e)return o.e>n.e^u<0?1:-1;for(r=s.length,i=a.length,t=0,e=r<i?r:i;t<e;++t)if(s[t]!==a[t])return s[t]>a[t]^u<0?1:-1;return r===i?0:r>i^u<0?1:-1};g.cosine=g.cos=function(){var n,t,e=this,r=e.constructor;return e.d?e.d[0]?(n=r.precision,t=r.rounding,r.precision=n+Math.max(e.e,e.sd())+k,r.rounding=1,e=dr(r,yn(r,e)),r.precision=n,r.rounding=t,B(ce==2||ce==3?e.neg():e,n,t,!0)):new r(1):new r(NaN)};g.cubeRoot=g.cbrt=function(){var n,t,e,r,i,o,s,a,u,c,m=this,l=m.constructor;if(!m.isFinite()||m.isZero())return new l(m);for(I=!1,o=m.s*j(m.s*m,1/3),!o||Math.abs(o)==1/0?(e=Y(m.d),n=m.e,(o=(n-e.length+1)%3)&&(e+=o==1||o==-2?"0":"00"),o=j(e,1/3),n=J((n+1)/3)-(n%3==(n<0?-1:2)),o==1/0?e="5e"+n:(e=o.toExponential(),e=e.slice(0,e.indexOf("e")+1)+n),r=new l(e),r.s=m.s):r=new l(o.toString()),s=(n=l.precision)+3;;)if(a=r,u=a.times(a).times(a),c=u.plus(m),r=V(c.plus(m).times(a),c.plus(u),s+2,1),Y(a.d).slice(0,s)===(e=Y(r.d)).slice(0,s))if(e=e.slice(s-3,s+1),e=="9999"||!i&&e=="4999"){if(!i&&(B(a,n+1,0),a.times(a).times(a).eq(m))){r=a;break}s+=4,i=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(B(r,n+1,1),t=!r.times(r).times(r).eq(m));break}return I=!0,B(r,n,l.rounding,t)};g.decimalPlaces=g.dp=function(){var n,t=this.d,e=NaN;if(t){if(n=t.length-1,e=(n-J(this.e/k))*k,n=t[n],n)for(;n%10==0;n/=10)e--;e<0&&(e=0)}return e};g.dividedBy=g.div=function(n){return V(this,new this.constructor(n))};g.dividedToIntegerBy=g.divToInt=function(n){var t=this,e=t.constructor;return B(V(t,new e(n),0,1,1),e.precision,e.rounding)};g.equals=g.eq=function(n){return this.cmp(n)===0};g.floor=function(){return B(new this.constructor(this),this.e+1,3)};g.greaterThan=g.gt=function(n){return this.cmp(n)>0};g.greaterThanOrEqualTo=g.gte=function(n){var t=this.cmp(n);return t==1||t===0};g.hyperbolicCosine=g.cosh=function(){var n,t,e,r,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;e=s.precision,r=s.rounding,s.precision=e+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(n=Math.ceil(i/3),t=(1/rt(4,n)).toString()):(n=16,t="2.3283064365386962890625e-10"),o=Se(s,1,o.times(t),new s(1),!0);for(var u,c=n,m=new s(8);c--;)u=o.times(o),o=a.minus(u.times(m.minus(u.times(m))));return B(o,s.precision=e,s.rounding=r,!0)};g.hyperbolicSine=g.sinh=function(){var n,t,e,r,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(t=o.precision,e=o.rounding,o.precision=t+Math.max(i.e,i.sd())+4,o.rounding=1,r=i.d.length,r<3)i=Se(o,2,i,i,!0);else{n=1.4*Math.sqrt(r),n=n>16?16:n|0,i=i.times(1/rt(5,n)),i=Se(o,2,i,i,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);n--;)s=i.times(i),i=i.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=t,o.rounding=e,B(i,t,e,!0)};g.hyperbolicTangent=g.tanh=function(){var n,t,e=this,r=e.constructor;return e.isFinite()?e.isZero()?new r(e):(n=r.precision,t=r.rounding,r.precision=n+7,r.rounding=1,V(e.sinh(),e.cosh(),r.precision=n,r.rounding=t)):new r(e.s)};g.inverseCosine=g.acos=function(){var n,t=this,e=t.constructor,r=t.abs().cmp(1),i=e.precision,o=e.rounding;return r!==-1?r===0?t.isNeg()?te(e,i,o):new e(0):new e(NaN):t.isZero()?te(e,i+4,o).times(.5):(e.precision=i+6,e.rounding=1,t=t.asin(),n=te(e,i+4,o).times(.5),e.precision=i,e.rounding=o,n.minus(t))};g.inverseHyperbolicCosine=g.acosh=function(){var n,t,e=this,r=e.constructor;return e.lte(1)?new r(e.eq(1)?0:NaN):e.isFinite()?(n=r.precision,t=r.rounding,r.precision=n+Math.max(Math.abs(e.e),e.sd())+4,r.rounding=1,I=!1,e=e.times(e).minus(1).sqrt().plus(e),I=!0,r.precision=n,r.rounding=t,e.ln()):new r(e)};g.inverseHyperbolicSine=g.asinh=function(){var n,t,e=this,r=e.constructor;return!e.isFinite()||e.isZero()?new r(e):(n=r.precision,t=r.rounding,r.precision=n+2*Math.max(Math.abs(e.e),e.sd())+6,r.rounding=1,I=!1,e=e.times(e).plus(1).sqrt().plus(e),I=!0,r.precision=n,r.rounding=t,e.ln())};g.inverseHyperbolicTangent=g.atanh=function(){var n,t,e,r,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(n=o.precision,t=o.rounding,r=i.sd(),Math.max(r,n)<2*-i.e-1?B(new o(i),n,t,!0):(o.precision=e=r-i.e,i=V(i.plus(1),new o(1).minus(i),e+n,1),o.precision=n+4,o.rounding=1,i=i.ln(),o.precision=n,o.rounding=t,i.times(.5))):new o(NaN)};g.inverseSine=g.asin=function(){var n,t,e,r,i=this,o=i.constructor;return i.isZero()?new o(i):(t=i.abs().cmp(1),e=o.precision,r=o.rounding,t!==-1?t===0?(n=te(o,e+4,r).times(.5),n.s=i.s,n):new o(NaN):(o.precision=e+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=e,o.rounding=r,i.times(2)))};g.inverseTangent=g.atan=function(){var n,t,e,r,i,o,s,a,u,c=this,m=c.constructor,l=m.precision,f=m.rounding;if(c.isFinite()){if(c.isZero())return new m(c);if(c.abs().eq(1)&&l+4<=Bt)return s=te(m,l+4,f).times(.25),s.s=c.s,s}else{if(!c.s)return new m(NaN);if(l+4<=Bt)return s=te(m,l+4,f).times(.5),s.s=c.s,s}for(m.precision=a=l+10,m.rounding=1,e=Math.min(28,a/k+2|0),n=e;n;--n)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(I=!1,t=Math.ceil(a/k),r=1,u=c.times(c),s=new m(c),i=c;n!==-1;)if(i=i.times(u),o=s.minus(i.div(r+=2)),i=i.times(u),s=o.plus(i.div(r+=2)),s.d[t]!==void 0)for(n=t;s.d[n]===o.d[n]&&n--;);return e&&(s=s.times(2<<e-1)),I=!0,B(s,m.precision=l,m.rounding=f,!0)};g.isFinite=function(){return!!this.d};g.isInteger=g.isInt=function(){return!!this.d&&J(this.e/k)>this.d.length-2};g.isNaN=function(){return!this.s};g.isNegative=g.isNeg=function(){return this.s<0};g.isPositive=g.isPos=function(){return this.s>0};g.isZero=function(){return!!this.d&&this.d[0]===0};g.lessThan=g.lt=function(n){return this.cmp(n)<0};g.lessThanOrEqualTo=g.lte=function(n){return this.cmp(n)<1};g.logarithm=g.log=function(n){var t,e,r,i,o,s,a,u,c=this,m=c.constructor,l=m.precision,f=m.rounding,p=5;if(n==null)n=new m(10),t=!0;else{if(n=new m(n),e=n.d,n.s<0||!e||!e[0]||n.eq(1))return new m(NaN);t=n.eq(10)}if(e=c.d,c.s<0||!e||!e[0]||c.eq(1))return new m(e&&!e[0]?-1/0:c.s!=1?NaN:e?0:1/0);if(t)if(e.length>1)o=!0;else{for(i=e[0];i%10===0;)i/=10;o=i!==1}if(I=!1,a=l+p,s=he(c,a),r=t?et(m,a+10):he(n,a),u=V(s,r,a,1),Me(u.d,i=l,f))do if(a+=10,s=he(c,a),r=t?et(m,a+10):he(n,a),u=V(s,r,a,1),!o){+Y(u.d).slice(i+1,i+15)+1==1e14&&(u=B(u,l+1,0));break}while(Me(u.d,i+=10,f));return I=!0,B(u,l,f)};g.minus=g.sub=function(n){var t,e,r,i,o,s,a,u,c,m,l,f,p=this,b=p.constructor;if(n=new b(n),!p.d||!n.d)return!p.s||!n.s?n=new b(NaN):p.d?n.s=-n.s:n=new b(n.d||p.s!==n.s?p:NaN),n;if(p.s!=n.s)return n.s=-n.s,p.plus(n);if(c=p.d,f=n.d,a=b.precision,u=b.rounding,!c[0]||!f[0]){if(f[0])n.s=-n.s;else if(c[0])n=new b(p);else return new b(u===3?-0:0);return I?B(n,a,u):n}if(e=J(n.e/k),m=J(p.e/k),c=c.slice(),o=m-e,o){for(l=o<0,l?(t=c,o=-o,s=f.length):(t=f,e=m,s=c.length),r=Math.max(Math.ceil(a/k),s)+2,o>r&&(o=r,t.length=1),t.reverse(),r=o;r--;)t.push(0);t.reverse()}else{for(r=c.length,s=f.length,l=r<s,l&&(s=r),r=0;r<s;r++)if(c[r]!=f[r]){l=c[r]<f[r];break}o=0}for(l&&(t=c,c=f,f=t,n.s=-n.s),s=c.length,r=f.length-s;r>0;--r)c[s++]=0;for(r=f.length;r>o;){if(c[--r]<f[r]){for(i=r;i&&c[--i]===0;)c[i]=ne-1;--c[i],c[r]+=ne}c[r]-=f[r]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--e;return c[0]?(n.d=c,n.e=nt(c,e),I?B(n,a,u):n):new b(u===3?-0:0)};g.modulo=g.mod=function(n){var t,e=this,r=e.constructor;return n=new r(n),!e.d||!n.s||n.d&&!n.d[0]?new r(NaN):!n.d||e.d&&!e.d[0]?B(new r(e),r.precision,r.rounding):(I=!1,r.modulo==9?(t=V(e,n.abs(),0,3,1),t.s*=n.s):t=V(e,n,0,r.modulo,1),t=t.times(n),I=!0,e.minus(t))};g.naturalExponential=g.exp=function(){return St(this)};g.naturalLogarithm=g.ln=function(){return he(this)};g.negated=g.neg=function(){var n=new this.constructor(this);return n.s=-n.s,B(n)};g.plus=g.add=function(n){var t,e,r,i,o,s,a,u,c,m,l=this,f=l.constructor;if(n=new f(n),!l.d||!n.d)return!l.s||!n.s?n=new f(NaN):l.d||(n=new f(n.d||l.s===n.s?l:NaN)),n;if(l.s!=n.s)return n.s=-n.s,l.minus(n);if(c=l.d,m=n.d,a=f.precision,u=f.rounding,!c[0]||!m[0])return m[0]||(n=new f(l)),I?B(n,a,u):n;if(o=J(l.e/k),r=J(n.e/k),c=c.slice(),i=o-r,i){for(i<0?(e=c,i=-i,s=m.length):(e=m,r=o,s=c.length),o=Math.ceil(a/k),s=o>s?o+1:s+1,i>s&&(i=s,e.length=1),e.reverse();i--;)e.push(0);e.reverse()}for(s=c.length,i=m.length,s-i<0&&(i=s,e=m,m=c,c=e),t=0;i;)t=(c[--i]=c[i]+m[i]+t)/ne|0,c[i]%=ne;for(t&&(c.unshift(t),++r),s=c.length;c[--s]==0;)c.pop();return n.d=c,n.e=nt(c,r),I?B(n,a,u):n};g.precision=g.sd=function(n){var t,e=this;if(n!==void 0&&n!==!!n&&n!==1&&n!==0)throw Error(be+n);return e.d?(t=dn(e.d),n&&e.e+1>t&&(t=e.e+1)):t=NaN,t};g.round=function(){var n=this,t=n.constructor;return B(new t(n),n.e+1,t.rounding)};g.sine=g.sin=function(){var n,t,e=this,r=e.constructor;return e.isFinite()?e.isZero()?new r(e):(n=r.precision,t=r.rounding,r.precision=n+Math.max(e.e,e.sd())+k,r.rounding=1,e=hr(r,yn(r,e)),r.precision=n,r.rounding=t,B(ce>2?e.neg():e,n,t,!0)):new r(NaN)};g.squareRoot=g.sqrt=function(){var n,t,e,r,i,o,s=this,a=s.d,u=s.e,c=s.s,m=s.constructor;if(c!==1||!a||!a[0])return new m(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(I=!1,c=Math.sqrt(+s),c==0||c==1/0?(t=Y(a),(t.length+u)%2==0&&(t+="0"),c=Math.sqrt(t),u=J((u+1)/2)-(u<0||u%2),c==1/0?t="5e"+u:(t=c.toExponential(),t=t.slice(0,t.indexOf("e")+1)+u),r=new m(t)):r=new m(c.toString()),e=(u=m.precision)+3;;)if(o=r,r=o.plus(V(s,o,e+2,1)).times(.5),Y(o.d).slice(0,e)===(t=Y(r.d)).slice(0,e))if(t=t.slice(e-3,e+1),t=="9999"||!i&&t=="4999"){if(!i&&(B(o,u+1,0),o.times(o).eq(s))){r=o;break}e+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(B(r,u+1,1),n=!r.times(r).eq(s));break}return I=!0,B(r,u,m.rounding,n)};g.tangent=g.tan=function(){var n,t,e=this,r=e.constructor;return e.isFinite()?e.isZero()?new r(e):(n=r.precision,t=r.rounding,r.precision=n+10,r.rounding=1,e=e.sin(),e.s=1,e=V(e,new r(1).minus(e.times(e)).sqrt(),n+10,0),r.precision=n,r.rounding=t,B(ce==2||ce==4?e.neg():e,n,t,!0)):new r(NaN)};g.times=g.mul=function(n){var t,e,r,i,o,s,a,u,c,m=this,l=m.constructor,f=m.d,p=(n=new l(n)).d;if(n.s*=m.s,!f||!f[0]||!p||!p[0])return new l(!n.s||f&&!f[0]&&!p||p&&!p[0]&&!f?NaN:!f||!p?n.s/0:n.s*0);for(e=J(m.e/k)+J(n.e/k),u=f.length,c=p.length,u<c&&(o=f,f=p,p=o,s=u,u=c,c=s),o=[],s=u+c,r=s;r--;)o.push(0);for(r=c;--r>=0;){for(t=0,i=u+r;i>r;)a=o[i]+p[r]*f[i-r-1]+t,o[i--]=a%ne|0,t=a/ne|0;o[i]=(o[i]+t)%ne|0}for(;!o[--s];)o.pop();return t?++e:o.shift(),n.d=o,n.e=nt(o,e),I?B(n,l.precision,l.rounding):n};g.toBinary=function(n,t){return Ct(this,2,n,t)};g.toDecimalPlaces=g.toDP=function(n,t){var e=this,r=e.constructor;return e=new r(e),n===void 0?e:($(n,0,ye),t===void 0?t=r.rounding:$(t,0,8),B(e,n+e.e+1,t))};g.toExponential=function(n,t){var e,r=this,i=r.constructor;return n===void 0?e=se(r,!0):($(n,0,ye),t===void 0?t=i.rounding:$(t,0,8),r=B(new i(r),n+1,t),e=se(r,!0,n+1)),r.isNeg()&&!r.isZero()?"-"+e:e};g.toFixed=function(n,t){var e,r,i=this,o=i.constructor;return n===void 0?e=se(i):($(n,0,ye),t===void 0?t=o.rounding:$(t,0,8),r=B(new o(i),n+i.e+1,t),e=se(r,!1,n+r.e+1)),i.isNeg()&&!i.isZero()?"-"+e:e};g.toFraction=function(n){var t,e,r,i,o,s,a,u,c,m,l,f,p=this,b=p.d,d=p.constructor;if(!b)return new d(p);if(c=e=new d(1),r=u=new d(0),t=new d(r),o=t.e=dn(b)-p.e-1,s=o%k,t.d[0]=j(10,s<0?k+s:s),n==null)n=o>0?t:c;else{if(a=new d(n),!a.isInt()||a.lt(c))throw Error(be+a);n=a.gt(t)?o>0?t:c:a}for(I=!1,a=new d(Y(b)),m=d.precision,d.precision=o=b.length*k*2;l=V(a,t,0,1,1),i=e.plus(l.times(r)),i.cmp(n)!=1;)e=r,r=i,i=c,c=u.plus(l.times(i)),u=i,i=t,t=a.minus(l.times(i)),a=i;return i=V(n.minus(e),r,0,1,1),u=u.plus(i.times(c)),e=e.plus(i.times(r)),u.s=c.s=p.s,f=V(c,r,o,1).minus(p).abs().cmp(V(u,e,o,1).minus(p).abs())<1?[c,r]:[u,e],d.precision=m,I=!0,f};g.toHexadecimal=g.toHex=function(n,t){return Ct(this,16,n,t)};g.toNearest=function(n,t){var e=this,r=e.constructor;if(e=new r(e),n==null){if(!e.d)return e;n=new r(1),t=r.rounding}else{if(n=new r(n),t===void 0?t=r.rounding:$(t,0,8),!e.d)return n.s?e:n;if(!n.d)return n.s&&(n.s=e.s),n}return n.d[0]?(I=!1,e=V(e,n,0,t,1).times(n),I=!0,B(e)):(n.s=e.s,e=n),e};g.toNumber=function(){return+this};g.toOctal=function(n,t){return Ct(this,8,n,t)};g.toPower=g.pow=function(n){var t,e,r,i,o,s,a=this,u=a.constructor,c=+(n=new u(n));if(!a.d||!n.d||!a.d[0]||!n.d[0])return new u(j(+a,c));if(a=new u(a),a.eq(1))return a;if(r=u.precision,o=u.rounding,n.eq(1))return B(a,r,o);if(t=J(n.e/k),t>=n.d.length-1&&(e=c<0?-c:c)<=fr)return i=gn(u,a,e,r),n.s<0?new u(1).div(i):B(i,r,o);if(s=a.s,s<0){if(t<n.d.length-1)return new u(NaN);if((n.d[t]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return e=j(+a,c),t=e==0||!isFinite(e)?J(c*(Math.log("0."+Y(a.d))/Math.LN10+a.e+1)):new u(e+"").e,t>u.maxE+1||t<u.minE-1?new u(t>0?s/0:0):(I=!1,u.rounding=a.s=1,e=Math.min(12,(t+"").length),i=St(n.times(he(a,r+e)),r),i.d&&(i=B(i,r+5,1),Me(i.d,r,o)&&(t=r+10,i=B(St(n.times(he(a,t+e)),t),t+5,1),+Y(i.d).slice(r+1,r+15)+1==1e14&&(i=B(i,r+1,0)))),i.s=s,I=!0,u.rounding=o,B(i,r,o))};g.toPrecision=function(n,t){var e,r=this,i=r.constructor;return n===void 0?e=se(r,r.e<=i.toExpNeg||r.e>=i.toExpPos):($(n,1,ye),t===void 0?t=i.rounding:$(t,0,8),r=B(new i(r),n,t),e=se(r,n<=r.e||r.e<=i.toExpNeg,n)),r.isNeg()&&!r.isZero()?"-"+e:e};g.toSignificantDigits=g.toSD=function(n,t){var e=this,r=e.constructor;return n===void 0?(n=r.precision,t=r.rounding):($(n,1,ye),t===void 0?t=r.rounding:$(t,0,8)),B(new r(e),n,t)};g.toString=function(){var n=this,t=n.constructor,e=se(n,n.e<=t.toExpNeg||n.e>=t.toExpPos);return n.isNeg()&&!n.isZero()?"-"+e:e};g.truncated=g.trunc=function(){return B(new this.constructor(this),this.e+1,1)};g.valueOf=g.toJSON=function(){var n=this,t=n.constructor,e=se(n,n.e<=t.toExpNeg||n.e>=t.toExpPos);return n.isNeg()?"-"+e:e};function Y(n){var t,e,r,i=n.length-1,o="",s=n[0];if(i>0){for(o+=s,t=1;t<i;t++)r=n[t]+"",e=k-r.length,e&&(o+=ge(e)),o+=r;s=n[t],r=s+"",e=k-r.length,e&&(o+=ge(e))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function $(n,t,e){if(n!==~~n||n<t||n>e)throw Error(be+n)}function Me(n,t,e,r){var i,o,s,a;for(o=n[0];o>=10;o/=10)--t;return--t<0?(t+=k,i=0):(i=Math.ceil((t+1)/k),t%=k),o=j(10,k-t),a=n[i]%o|0,r==null?t<3?(t==0?a=a/100|0:t==1&&(a=a/10|0),s=e<4&&a==99999||e>3&&a==49999||a==5e4||a==0):s=(e<4&&a+1==o||e>3&&a+1==o/2)&&(n[i+1]/o/100|0)==j(10,t-2)-1||(a==o/2||a==0)&&(n[i+1]/o/100|0)==0:t<4?(t==0?a=a/1e3|0:t==1?a=a/100|0:t==2&&(a=a/10|0),s=(r||e<4)&&a==9999||!r&&e>3&&a==4999):s=((r||e<4)&&a+1==o||!r&&e>3&&a+1==o/2)&&(n[i+1]/o/1e3|0)==j(10,t-3)-1,s}function Xe(n,t,e){for(var r,i=[0],o,s=0,a=n.length;s<a;){for(o=i.length;o--;)i[o]*=t;for(i[0]+=At.indexOf(n.charAt(s++)),r=0;r<i.length;r++)i[r]>e-1&&(i[r+1]===void 0&&(i[r+1]=0),i[r+1]+=i[r]/e|0,i[r]%=e)}return i.reverse()}function dr(n,t){var e,r,i;if(t.isZero())return t;r=t.d.length,r<32?(e=Math.ceil(r/3),i=(1/rt(4,e)).toString()):(e=16,i="2.3283064365386962890625e-10"),n.precision+=e,t=Se(n,1,t.times(i),new n(1));for(var o=e;o--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return n.precision-=e,t}var V=function(){function n(r,i,o){var s,a=0,u=r.length;for(r=r.slice();u--;)s=r[u]*i+a,r[u]=s%o|0,a=s/o|0;return a&&r.unshift(a),r}function t(r,i,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(r[a]!=i[a]){u=r[a]>i[a]?1:-1;break}return u}function e(r,i,o,s){for(var a=0;o--;)r[o]-=a,a=r[o]<i[o]?1:0,r[o]=a*s+r[o]-i[o];for(;!r[0]&&r.length>1;)r.shift()}return function(r,i,o,s,a,u){var c,m,l,f,p,b,d,T,P,y,w,h,S,A,D,C,R,v,_,U,F=r.constructor,Z=r.s==i.s?1:-1,W=r.d,K=i.d;if(!W||!W[0]||!K||!K[0])return new F(!r.s||!i.s||(W?K&&W[0]==K[0]:!K)?NaN:W&&W[0]==0||!K?Z*0:Z/0);for(u?(p=1,m=r.e-i.e):(u=ne,p=k,m=J(r.e/p)-J(i.e/p)),_=K.length,R=W.length,P=new F(Z),y=P.d=[],l=0;K[l]==(W[l]||0);l++);if(K[l]>(W[l]||0)&&m--,o==null?(A=o=F.precision,s=F.rounding):a?A=o+(r.e-i.e)+1:A=o,A<0)y.push(1),b=!0;else{if(A=A/p+2|0,l=0,_==1){for(f=0,K=K[0],A++;(l<R||f)&&A--;l++)D=f*u+(W[l]||0),y[l]=D/K|0,f=D%K|0;b=f||l<R}else{for(f=u/(K[0]+1)|0,f>1&&(K=n(K,f,u),W=n(W,f,u),_=K.length,R=W.length),C=_,w=W.slice(0,_),h=w.length;h<_;)w[h++]=0;U=K.slice(),U.unshift(0),v=K[0],K[1]>=u/2&&++v;do f=0,c=t(K,w,_,h),c<0?(S=w[0],_!=h&&(S=S*u+(w[1]||0)),f=S/v|0,f>1?(f>=u&&(f=u-1),d=n(K,f,u),T=d.length,h=w.length,c=t(d,w,T,h),c==1&&(f--,e(d,_<T?U:K,T,u))):(f==0&&(c=f=1),d=K.slice()),T=d.length,T<h&&d.unshift(0),e(w,d,h,u),c==-1&&(h=w.length,c=t(K,w,_,h),c<1&&(f++,e(w,_<h?U:K,h,u))),h=w.length):c===0&&(f++,w=[0]),y[l++]=f,c&&w[0]?w[h++]=W[C]||0:(w=[W[C]],h=1);while((C++<R||w[0]!==void 0)&&A--);b=w[0]!==void 0}y[0]||y.shift()}if(p==1)P.e=m,cn=b;else{for(l=1,f=y[0];f>=10;f/=10)l++;P.e=l+m*p-1,B(P,a?o+P.e+1:o,s,b)}return P}}();function B(n,t,e,r){var i,o,s,a,u,c,m,l,f,p=n.constructor;e:if(t!=null){if(l=n.d,!l)return n;for(i=1,a=l[0];a>=10;a/=10)i++;if(o=t-i,o<0)o+=k,s=t,m=l[f=0],u=m/j(10,i-s-1)%10|0;else if(f=Math.ceil((o+1)/k),a=l.length,f>=a)if(r){for(;a++<=f;)l.push(0);m=u=0,i=1,o%=k,s=o-k+1}else break e;else{for(m=a=l[f],i=1;a>=10;a/=10)i++;o%=k,s=o-k+i,u=s<0?0:m/j(10,i-s-1)%10|0}if(r=r||t<0||l[f+1]!==void 0||(s<0?m:m%j(10,i-s-1)),c=e<4?(u||r)&&(e==0||e==(n.s<0?3:2)):u>5||u==5&&(e==4||r||e==6&&(o>0?s>0?m/j(10,i-s):0:l[f-1])%10&1||e==(n.s<0?8:7)),t<1||!l[0])return l.length=0,c?(t-=n.e+1,l[0]=j(10,(k-t%k)%k),n.e=-t||0):l[0]=n.e=0,n;if(o==0?(l.length=f,a=1,f--):(l.length=f+1,a=j(10,k-o),l[f]=s>0?(m/j(10,i-s)%j(10,s)|0)*a:0),c)for(;;)if(f==0){for(o=1,s=l[0];s>=10;s/=10)o++;for(s=l[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(n.e++,l[0]==ne&&(l[0]=1));break}else{if(l[f]+=a,l[f]!=ne)break;l[f--]=0,a=1}for(o=l.length;l[--o]===0;)l.pop()}return I&&(n.e>p.maxE?(n.d=null,n.e=NaN):n.e<p.minE&&(n.e=0,n.d=[0])),n}function se(n,t,e){if(!n.isFinite())return bn(n);var r,i=n.e,o=Y(n.d),s=o.length;return t?(e&&(r=e-s)>0?o=o.charAt(0)+"."+o.slice(1)+ge(r):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(n.e<0?"e":"e+")+n.e):i<0?(o="0."+ge(-i-1)+o,e&&(r=e-s)>0&&(o+=ge(r))):i>=s?(o+=ge(i+1-s),e&&(r=e-i-1)>0&&(o=o+"."+ge(r))):((r=i+1)<s&&(o=o.slice(0,r)+"."+o.slice(r)),e&&(r=e-s)>0&&(i+1===s&&(o+="."),o+=ge(r))),o}function nt(n,t){var e=n[0];for(t*=k;e>=10;e/=10)t++;return t}function et(n,t,e){if(t>pr)throw I=!0,e&&(n.precision=e),Error(ln);return B(new n(Qe),t,1,!0)}function te(n,t,e){if(t>Bt)throw Error(ln);return B(new n($e),t,e,!0)}function dn(n){var t=n.length-1,e=t*k+1;if(t=n[t],t){for(;t%10==0;t/=10)e--;for(t=n[0];t>=10;t/=10)e++}return e}function ge(n){for(var t="";n--;)t+="0";return t}function gn(n,t,e,r){var i,o=new n(1),s=Math.ceil(r/k+4);for(I=!1;;){if(e%2&&(o=o.times(t),an(o.d,s)&&(i=!0)),e=J(e/2),e===0){e=o.d.length-1,i&&o.d[e]===0&&++o.d[e];break}t=t.times(t),an(t.d,s)}return I=!0,o}function sn(n){return n.d[n.d.length-1]&1}function hn(n,t,e){for(var r,i=new n(t[0]),o=0;++o<t.length;)if(r=new n(t[o]),r.s)i[e](r)&&(i=r);else{i=r;break}return i}function St(n,t){var e,r,i,o,s,a,u,c=0,m=0,l=0,f=n.constructor,p=f.rounding,b=f.precision;if(!n.d||!n.d[0]||n.e>17)return new f(n.d?n.d[0]?n.s<0?0:1/0:1:n.s?n.s<0?0:n:0/0);for(t==null?(I=!1,u=b):u=t,a=new f(.03125);n.e>-2;)n=n.times(a),l+=5;for(r=Math.log(j(2,l))/Math.LN10*2+5|0,u+=r,e=o=s=new f(1),f.precision=u;;){if(o=B(o.times(n),u,1),e=e.times(++m),a=s.plus(V(o,e,u,1)),Y(a.d).slice(0,u)===Y(s.d).slice(0,u)){for(i=l;i--;)s=B(s.times(s),u,1);if(t==null)if(c<3&&Me(s.d,u-r,p,c))f.precision=u+=10,e=o=a=new f(1),m=0,c++;else return B(s,f.precision=b,p,I=!0);else return f.precision=b,s}s=a}}function he(n,t){var e,r,i,o,s,a,u,c,m,l,f,p=1,b=10,d=n,T=d.d,P=d.constructor,y=P.rounding,w=P.precision;if(d.s<0||!T||!T[0]||!d.e&&T[0]==1&&T.length==1)return new P(T&&!T[0]?-1/0:d.s!=1?NaN:T?0:d);if(t==null?(I=!1,m=w):m=t,P.precision=m+=b,e=Y(T),r=e.charAt(0),Math.abs(o=d.e)<15e14){for(;r<7&&r!=1||r==1&&e.charAt(1)>3;)d=d.times(n),e=Y(d.d),r=e.charAt(0),p++;o=d.e,r>1?(d=new P("0."+e),o++):d=new P(r+"."+e.slice(1))}else return c=et(P,m+2,w).times(o+""),d=he(new P(r+"."+e.slice(1)),m-b).plus(c),P.precision=w,t==null?B(d,w,y,I=!0):d;for(l=d,u=s=d=V(d.minus(1),d.plus(1),m,1),f=B(d.times(d),m,1),i=3;;){if(s=B(s.times(f),m,1),c=u.plus(V(s,new P(i),m,1)),Y(c.d).slice(0,m)===Y(u.d).slice(0,m))if(u=u.times(2),o!==0&&(u=u.plus(et(P,m+2,w).times(o+""))),u=V(u,new P(p),m,1),t==null)if(Me(u.d,m-b,y,a))P.precision=m+=b,c=s=d=V(l.minus(1),l.plus(1),m,1),f=B(d.times(d),m,1),i=a=1;else return B(u,P.precision=w,y,I=!0);else return P.precision=w,u;u=c,i+=2}}function bn(n){return String(n.s*n.s/0)}function kt(n,t){var e,r,i;for((e=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(e<0&&(e=r),e+=+t.slice(r+1),t=t.substring(0,r)):e<0&&(e=t.length),r=0;t.charCodeAt(r)===48;r++);for(i=t.length;t.charCodeAt(i-1)===48;--i);if(t=t.slice(r,i),t){if(i-=r,n.e=e=e-r-1,n.d=[],r=(e+1)%k,e<0&&(r+=k),r<i){for(r&&n.d.push(+t.slice(0,r)),i-=k;r<i;)n.d.push(+t.slice(r,r+=k));t=t.slice(r),r=k-t.length}else r-=i;for(;r--;)t+="0";n.d.push(+t),I&&(n.e>n.constructor.maxE?(n.d=null,n.e=NaN):n.e<n.constructor.minE&&(n.e=0,n.d=[0]))}else n.e=0,n.d=[0];return n}function gr(n,t){var e,r,i,o,s,a,u,c,m;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),pn.test(t))return kt(n,t)}else if(t==="Infinity"||t==="NaN")return+t||(n.s=NaN),n.e=NaN,n.d=null,n;if(lr.test(t))e=16,t=t.toLowerCase();else if(cr.test(t))e=2;else if(mr.test(t))e=8;else throw Error(be+t);for(o=t.search(/p/i),o>0?(u=+t.slice(o+1),t=t.substring(2,o)):t=t.slice(2),o=t.indexOf("."),s=o>=0,r=n.constructor,s&&(t=t.replace(".",""),a=t.length,o=a-o,i=gn(r,new r(e),o,o*2)),c=Xe(t,e,ne),m=c.length-1,o=m;c[o]===0;--o)c.pop();return o<0?new r(n.s*0):(n.e=nt(c,m),n.d=c,I=!1,s&&(n=V(n,i,a*4)),u&&(n=n.times(Math.abs(u)<54?j(2,u):Re.pow(2,u))),I=!0,n)}function hr(n,t){var e,r=t.d.length;if(r<3)return t.isZero()?t:Se(n,2,t,t);e=1.4*Math.sqrt(r),e=e>16?16:e|0,t=t.times(1/rt(5,e)),t=Se(n,2,t,t);for(var i,o=new n(5),s=new n(16),a=new n(20);e--;)i=t.times(t),t=t.times(o.plus(i.times(s.times(i).minus(a))));return t}function Se(n,t,e,r,i){var o,s,a,u,c=1,m=n.precision,l=Math.ceil(m/k);for(I=!1,u=e.times(e),a=new n(r);;){if(s=V(a.times(u),new n(t++*t++),m,1),a=i?r.plus(s):r.minus(s),r=V(s.times(u),new n(t++*t++),m,1),s=a.plus(r),s.d[l]!==void 0){for(o=l;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=r,r=s,s=o,c++}return I=!0,s.d.length=l+1,s}function rt(n,t){for(var e=n;--t;)e*=n;return e}function yn(n,t){var e,r=t.s<0,i=te(n,n.precision,1),o=i.times(.5);if(t=t.abs(),t.lte(o))return ce=r?4:1,t;if(e=t.divToInt(i),e.isZero())ce=r?3:2;else{if(t=t.minus(e.times(i)),t.lte(o))return ce=sn(e)?r?2:3:r?4:1,t;ce=sn(e)?r?1:4:r?3:2}return t.minus(i).abs()}function Ct(n,t,e,r){var i,o,s,a,u,c,m,l,f,p=n.constructor,b=e!==void 0;if(b?($(e,1,ye),r===void 0?r=p.rounding:$(r,0,8)):(e=p.precision,r=p.rounding),!n.isFinite())m=bn(n);else{for(m=se(n),s=m.indexOf("."),b?(i=2,t==16?e=e*4-3:t==8&&(e=e*3-2)):i=t,s>=0&&(m=m.replace(".",""),f=new p(1),f.e=m.length-s,f.d=Xe(se(f),10,i),f.e=f.d.length),l=Xe(m,10,i),o=u=l.length;l[--u]==0;)l.pop();if(!l[0])m=b?"0p+0":"0";else{if(s<0?o--:(n=new p(n),n.d=l,n.e=o,n=V(n,f,e,r,0,i),l=n.d,o=n.e,c=cn),s=l[e],a=i/2,c=c||l[e+1]!==void 0,c=r<4?(s!==void 0||c)&&(r===0||r===(n.s<0?3:2)):s>a||s===a&&(r===4||c||r===6&&l[e-1]&1||r===(n.s<0?8:7)),l.length=e,c)for(;++l[--e]>i-1;)l[e]=0,e||(++o,l.unshift(1));for(u=l.length;!l[u-1];--u);for(s=0,m="";s<u;s++)m+=At.charAt(l[s]);if(b){if(u>1)if(t==16||t==8){for(s=t==16?4:3,--u;u%s;u++)m+="0";for(l=Xe(m,i,t),u=l.length;!l[u-1];--u);for(s=1,m="1.";s<u;s++)m+=At.charAt(l[s])}else m=m.charAt(0)+"."+m.slice(1);m=m+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)m="0"+m;m="0."+m}else if(++o>u)for(o-=u;o--;)m+="0";else o<u&&(m=m.slice(0,o)+"."+m.slice(o))}m=(t==16?"0x":t==2?"0b":t==8?"0o":"")+m}return n.s<0?"-"+m:m}function an(n,t){if(n.length>t)return n.length=t,!0}function br(n){return new this(n).abs()}function yr(n){return new this(n).acos()}function wr(n){return new this(n).acosh()}function Pr(n,t){return new this(n).plus(t)}function Tr(n){return new this(n).asin()}function Ar(n){return new this(n).asinh()}function xr(n){return new this(n).atan()}function Br(n){return new this(n).atanh()}function Sr(n,t){n=new this(n),t=new this(t);var e,r=this.precision,i=this.rounding,o=r+4;return!n.s||!t.s?e=new this(NaN):!n.d&&!t.d?(e=te(this,o,1).times(t.s>0?.25:.75),e.s=n.s):!t.d||n.isZero()?(e=t.s<0?te(this,r,i):new this(0),e.s=n.s):!n.d||t.isZero()?(e=te(this,o,1).times(.5),e.s=n.s):t.s<0?(this.precision=o,this.rounding=1,e=this.atan(V(n,t,o,1)),t=te(this,o,1),this.precision=r,this.rounding=i,e=n.s<0?e.minus(t):e.plus(t)):e=this.atan(V(n,t,o,1)),e}function kr(n){return new this(n).cbrt()}function Cr(n){return B(n=new this(n),n.e+1,2)}function Ir(n,t,e){return new this(n).clamp(t,e)}function Nr(n){if(!n||typeof n!="object")throw Error(tt+"Object expected");var t,e,r,i=n.defaults===!0,o=["precision",1,ye,"rounding",0,8,"toExpNeg",-Be,0,"toExpPos",0,Be,"maxE",0,Be,"minE",-Be,0,"modulo",0,9];for(t=0;t<o.length;t+=3)if(e=o[t],i&&(this[e]=xt[e]),(r=n[e])!==void 0)if(J(r)===r&&r>=o[t+1]&&r<=o[t+2])this[e]=r;else throw Error(be+e+": "+r);if(e="crypto",i&&(this[e]=xt[e]),(r=n[e])!==void 0)if(r===!0||r===!1||r===0||r===1)if(r)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[e]=!0;else throw Error(mn);else this[e]=!1;else throw Error(be+e+": "+r);return this}function Lr(n){return new this(n).cos()}function Mr(n){return new this(n).cosh()}function wn(n){var t,e,r;function i(o){var s,a,u,c=this;if(!(c instanceof i))return new i(o);if(c.constructor=i,un(o)){c.s=o.s,I?!o.d||o.e>i.maxE?(c.e=NaN,c.d=null):o.e<i.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;I?s>i.maxE?(c.e=NaN,c.d=null):s<i.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return kt(c,o.toString())}else if(u!=="string")throw Error(be+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),pn.test(o)?kt(c,o):gr(c,o)}if(i.prototype=g,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=Nr,i.clone=wn,i.isDecimal=un,i.abs=br,i.acos=yr,i.acosh=wr,i.add=Pr,i.asin=Tr,i.asinh=Ar,i.atan=xr,i.atanh=Br,i.atan2=Sr,i.cbrt=kr,i.ceil=Cr,i.clamp=Ir,i.cos=Lr,i.cosh=Mr,i.div=Rr,i.exp=Dr,i.floor=Er,i.hypot=Kr,i.ln=vr,i.log=_r,i.log10=Fr,i.log2=Or,i.max=Wr,i.min=Vr,i.mod=qr,i.mul=Ur,i.pow=Gr,i.random=Hr,i.round=zr,i.sign=jr,i.sin=Zr,i.sinh=Yr,i.sqrt=Jr,i.sub=Xr,i.sum=Qr,i.tan=$r,i.tanh=ei,i.trunc=ti,n===void 0&&(n={}),n&&n.defaults!==!0)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<r.length;)n.hasOwnProperty(e=r[t++])||(n[e]=this[e]);return i.config(n),i}function Rr(n,t){return new this(n).div(t)}function Dr(n){return new this(n).exp()}function Er(n){return B(n=new this(n),n.e+1,3)}function Kr(){var n,t,e=new this(0);for(I=!1,n=0;n<arguments.length;)if(t=new this(arguments[n++]),t.d)e.d&&(e=e.plus(t.times(t)));else{if(t.s)return I=!0,new this(1/0);e=t}return I=!0,e.sqrt()}function un(n){return n instanceof Re||n&&n.toStringTag===fn||!1}function vr(n){return new this(n).ln()}function _r(n,t){return new this(n).log(t)}function Or(n){return new this(n).log(2)}function Fr(n){return new this(n).log(10)}function Wr(){return hn(this,arguments,"lt")}function Vr(){return hn(this,arguments,"gt")}function qr(n,t){return new this(n).mod(t)}function Ur(n,t){return new this(n).mul(t)}function Gr(n,t){return new this(n).pow(t)}function Hr(n){var t,e,r,i,o=0,s=new this(1),a=[];if(n===void 0?n=this.precision:$(n,1,ye),r=Math.ceil(n/k),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(r));o<r;)i=t[o],i>=429e7?t[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(r*=4);o<r;)i=t[o]+(t[o+1]<<8)+(t[o+2]<<16)+((t[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(t,o):(a.push(i%1e7),o+=4);o=r/4}else throw Error(mn);else for(;o<r;)a[o++]=Math.random()*1e7|0;for(r=a[--o],n%=k,r&&n&&(i=j(10,k-n),a[o]=(r/i|0)*i);a[o]===0;o--)a.pop();if(o<0)e=0,a=[0];else{for(e=-1;a[0]===0;e-=k)a.shift();for(r=1,i=a[0];i>=10;i/=10)r++;r<k&&(e-=k-r)}return s.e=e,s.d=a,s}function zr(n){return B(n=new this(n),n.e+1,this.rounding)}function jr(n){return n=new this(n),n.d?n.d[0]?n.s:0*n.s:n.s||NaN}function Zr(n){return new this(n).sin()}function Yr(n){return new this(n).sinh()}function Jr(n){return new this(n).sqrt()}function Xr(n,t){return new this(n).sub(t)}function Qr(){var n=0,t=arguments,e=new this(t[n]);for(I=!1;e.s&&++n<t.length;)e=e.plus(t[n]);return I=!0,B(e,this.precision,this.rounding)}function $r(n){return new this(n).tan()}function ei(n){return new this(n).tanh()}function ti(n){return B(n=new this(n),n.e+1,1)}g[Symbol.for("nodejs.util.inspect.custom")]=g.toString;g[Symbol.toStringTag]="Decimal";var Re=g.constructor=wn(xt);Qe=new Re(Qe);$e=new Re($e);var ee=Re;import Mi from"big.js";import su from"bn.js";import{get as Pn,set as ni}from"lodash";var It=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let e=t.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(e)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},Tn={},ri={};function X(n){let t=Pn(Tn,n);if(!t){let e=Pn(ri,n);t=new It({name:n,logLevel:e}),ni(Tn,n,t)}return t}import{PublicKey as An}from"@solana/web3.js";import{MINT_SIZE as ii,TOKEN_PROGRAM_ID as oi,getTransferFeeConfig as si,unpackMint as ai}from"@solana/spl-token";var Nt=X("Raydium_accountInfo_util");async function Mt(n,t,e){let{batchRequest:r,commitment:i="confirmed",chunkCount:o=100}=E({batchRequest:!1},e),s=Lt(t,o),a=new Array(s.length).fill([]);if(r){let u=s.map(l=>{let f=n._buildArgs([l.map(p=>p.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:f}}),c=Lt(u,10);a=(await(await Promise.all(c.map(async l=>await n._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&Nt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(f=>{if(f){let{data:p,executable:b,lamports:d,owner:T,rentEpoch:P}=f;return p.length!==2&&p[1]!=="base64"&&Nt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:b,lamports:d,owner:new An(T),rentEpoch:P}}return null})))}else try{a=await Promise.all(s.map(u=>n.getMultipleAccountsInfo(u,i)))}catch(u){u instanceof Error&&Nt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}async function De(n,t,e){let r=await Mt(n,t.map(i=>i.pubkey),e);return t.map((i,o)=>H(E({},i),{accountInfo:r[o]}))}async function xn({connection:n,mints:t,config:e}){var o,s,a;if(t.length===0)return{};let r=await De(n,t.map(u=>({pubkey:it(u)})),e),i={};for(let u of r){if(!u.accountInfo||u.accountInfo.data.length<ii){console.log("invalid mint account",u.pubkey.toBase58());continue}let c=ai(u.pubkey,u.accountInfo,(o=u.accountInfo)==null?void 0:o.owner);i[u.pubkey.toString()]=H(E({},c),{programId:((s=u.accountInfo)==null?void 0:s.owner)||oi,feeConfig:(a=si(c))!=null?a:void 0})}return i[An.default.toBase58()]=i[le.toBase58()],i}import Ee from"bn.js";var Bn=9007199254740991;function me(n){let t=X("Raydium_parseBigNumberish");if(n instanceof Ee)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new Ee(n);t.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&t.logWithError(`BigNumberish number underflow: ${n}`),(n>=Bn||n<=-Bn)&&t.logWithError(`BigNumberish number overflow: ${n}`),new Ee(String(n))):typeof n=="bigint"?new Ee(n.toString()):(t.error(`invalid BigNumberish value: ${n}`),new Ee(0))}import{PublicKey as ui}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Sn}from"@solana/spl-token";var Rt={chainId:101,address:ui.default.toBase58(),programId:Sn.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},we={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Sn.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Kt}from"@solana/web3.js";import{PublicKey as G,SystemProgram as kn,SYSVAR_RENT_PUBKEY as ci}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as li}from"@solana/spl-token";function Dt({pubkey:n,isSigner:t=!1,isWritable:e=!0}){return{pubkey:n,isWritable:e,isSigner:t}}var Bo=[Dt({pubkey:li,isWritable:!1}),Dt({pubkey:kn.programId,isWritable:!1}),Dt({pubkey:ci,isWritable:!1})];function Et({publicKey:n,transformSol:t}){let e=Cn(n.toString());if(e instanceof G)return t&&e.equals(Ke)?le:e;if(t&&e.toString()===Ke.toBase58())return le;if(typeof e=="string"){if(e===G.default.toBase58())return G.default;try{return new G(e)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Cn(n){try{return new G(n)}catch{return n}}var So=new G("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),In=new G("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Nn=new G("SysvarRent111111111111111111111111111111111"),ko=new G("SysvarC1ock11111111111111111111111111111111"),Co=new G("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Io=new G("Sysvar1nstructions1111111111111111111111111"),Ln=kn.programId,No=new G("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Lo=new G("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Mo=new G("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Ro=new G("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Do=new G("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Eo=new G("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Ko=new G("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),vo=new G("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),_o=new G("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Oo=new G("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Fo=new G("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),le=new G("So11111111111111111111111111111111111111112"),Ke=G.default;function it(n){return Et({publicKey:n,transformSol:!0})}var vt=class{constructor({mint:t,decimals:e,symbol:r,name:i,skipMint:o=!1,isToken2022:s=!1}){if(t===Ke.toBase58()||t instanceof Kt&&Ke.equals(t)){this.decimals=we.decimals,this.symbol=we.symbol,this.name=we.name,this.mint=new Kt(we.address),this.isToken2022=!1;return}this.decimals=e,this.symbol=r||t.toString().substring(0,6),this.name=i||t.toString().substring(0,6),this.mint=o?Kt.default:Et({publicKey:t}),this.isToken2022=s}equals(t){return this===t?!0:this.mint.equals(t.mint)}},Te=vt;Te.WSOL=new vt(H(E({},we),{mint:we.address}));var _t=class{constructor({decimals:t,symbol:e="UNKNOWN",name:r="UNKNOWN"}){this.decimals=t,this.symbol=e,this.name=r}equals(t){return this===t}},ot=_t;ot.SOL=new _t(Rt);import mi from"toformat";var fi=mi,ve=fi;import at from"big.js";import di from"bn.js";import gi from"decimal.js-light";var st=X("module/fraction"),Ot=ve(at),_e=ve(gi),hi={[0]:_e.ROUND_DOWN,[1]:_e.ROUND_HALF_UP,[2]:_e.ROUND_UP},bi={[0]:at.roundDown,[1]:at.roundHalfUp,[2]:at.roundUp},q=class{constructor(t,e=new di(1)){this.numerator=me(t),this.denominator=me(e)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new q(this.denominator,this.numerator)}add(t){let e=t instanceof q?t:new q(me(t));return this.denominator.eq(e.denominator)?new q(this.numerator.add(e.numerator),this.denominator):new q(this.numerator.mul(e.denominator).add(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}sub(t){let e=t instanceof q?t:new q(me(t));return this.denominator.eq(e.denominator)?new q(this.numerator.sub(e.numerator),this.denominator):new q(this.numerator.mul(e.denominator).sub(e.numerator.mul(this.denominator)),this.denominator.mul(e.denominator))}mul(t){let e=t instanceof q?t:new q(me(t));return new q(this.numerator.mul(e.numerator),this.denominator.mul(e.denominator))}div(t){let e=t instanceof q?t:new q(me(t));return new q(this.numerator.mul(e.denominator),this.denominator.mul(e.numerator))}toSignificant(t,e={groupSeparator:""},r=1){Number.isInteger(t)||st.logWithError(`${t} is not an integer.`),t<=0&&st.logWithError(`${t} is not positive.`),_e.set({precision:t+1,rounding:hi[r]});let i=new _e(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return i.toFormat(i.decimalPlaces(),e)}toFixed(t,e={groupSeparator:""},r=1){return Number.isInteger(t)||st.logWithError(`${t} is not an integer.`),t<0&&st.logWithError(`${t} is negative.`),Ot.DP=t,Ot.RM=bi[r]||1,new Ot(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,e)}isZero(){return this.numerator.isZero()}};import yi from"bn.js";var Mn=new q(new yi(100)),re=class extends q{toSignificant(t=5,e,r){return this.mul(Mn).toSignificant(t,e,r)}toFixed(t=2,e,r){return this.mul(Mn).toFixed(t,e,r)}};var fs=X("Raydium_price");function Lt(n,t=1,e=[]){let r=[...n];if(t<=0)return e;for(;r.length;)e.push(r.splice(0,t));return e}import{PublicKey as Si}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ki}from"@solana/spl-token";import{ComputeBudgetProgram as Dn,Keypair as Kn,PublicKey as wi,Transaction as vn,TransactionMessage as Pi,VersionedTransaction as _n}from"@solana/web3.js";var fe={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{TOKEN_PROGRAM_ID as Ti}from"@solana/spl-token";var En=X("Raydium_txUtil"),On=1644;function ut(n){let t=[],e=[];return n.microLamports&&(t.push(Dn.setComputeUnitPrice({microLamports:n.microLamports})),e.push(fe.SetComputeUnitPrice)),n.units&&(t.push(Dn.setComputeUnitLimit({units:n.units})),e.push(fe.SetComputeUnitLimit)),{instructions:t,instructionTypes:e}}async function ke(n,t){var r,i;let e=t!=null?t:"confirmed";return(i=await((r=n.getLatestBlockhash)==null?void 0:r.call(n,{commitment:e})))==null?void 0:i.blockhash}async function ct(n,t){return n.getSignatureStatuses([t]),new Promise((e,r)=>{let i=setTimeout(r,6e4);n.onSignature(t,o=>{if(clearTimeout(i),!o.err){e("");return}r(o.err.toString())},"confirmed")})}function Ai(n,t){n.length<1&&En.logWithError(`no instructions provided: ${n.toString()}`),t.length<1&&En.logWithError(`no signers provided:, ${t.toString()}`);let e=new vn;e.recentBlockhash="11111111111111111111111111111111",e.feePayer=t[0],e.add(...n);try{return Buffer.from(e.serialize({verifySignatures:!1})).toString("base64").length<On}catch{return!1}}function Pe(n,t){let[e,r]=wi.findProgramAddressSync(n,t);return{publicKey:e,nonce:r}}function Oe({instructions:n,payer:t,signers:e}){return Ai(n,[t,...e])}function Fe({instructions:n,payer:t,lookupTableAddressAccount:e,recentBlockhash:r=Kn.generate().publicKey.toString()}){let o=new Pi({payerKey:t,recentBlockhash:r,instructions:n}).compileToV0Message(Object.values(e!=null?e:{}));try{return Buffer.from(new _n(o).serialize()).toString("base64").length<On}catch{return!1}}var xi=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),Bi=n=>{let t=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof _n&&(t=xi(t));try{return t instanceof Buffer?t.toString("base64"):Buffer.from(t).toString("base64")}catch{return t.toString("base64")}};function Ae(n){let t=[];return n.forEach(e=>{e instanceof vn&&(e.recentBlockhash||(e.recentBlockhash=Ti.toBase58()),e.feePayer||(e.feePayer=Kn.generate().publicKey)),t.push(Bi(e))}),console.log("simulate tx string:",t),t}function Fn(n,t,e){return Pe([n.toBuffer(),(e!=null?e:ki).toBuffer(),t.toBuffer()],new Si("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as M}from"@solana/web3.js";var zs=new M("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),js=new M("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Zs=new M("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Ys=new M("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Js=new M("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Xs=new M("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Qs=new M("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),$s=new M("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),ea=new M("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),ta=new M("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),na=new M("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ra=new M("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),ia=new M("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),oa=new M("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),sa=new M("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),aa=new M("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),ua=new M("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),ca=new M("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),la=new M("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),ma=new M("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),fa=new M("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Ci=new M("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Ii=new M("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Ni=new M("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");var pa={SERUM_MARKET:M.default,OPENBOOK_MARKET:new M("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:M.default,FarmV3:new M("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new M("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new M("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new M("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new M("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new M("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new M("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new M("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new M("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Ci,CREATE_CPMM_POOL_AUTH:Ii,CREATE_CPMM_POOL_FEE_ACC:Ni,FEE_DESTINATION_ID:new M("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import ie from"bn.js";var We=1e4;function xe(n,t,e,r){if(t===void 0)return{amount:n,fee:void 0,expirationTime:void 0};let i=H(E({},t),{olderTransferFee:{epoch:BigInt(t.olderTransferFee.epoch),maximumFee:BigInt(t.olderTransferFee.maximumFee),transferFeeBasisPoints:t.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(t.newerTransferFee.epoch),maximumFee:BigInt(t.newerTransferFee.maximumFee),transferFeeBasisPoints:t.newerTransferFee.transferFeeBasisPoints}}),o=e.epoch<i.newerTransferFee.epoch?i.olderTransferFee:i.newerTransferFee,s=new ie(o.maximumFee.toString()),a=e.epoch<i.newerTransferFee.epoch?(Number(i.newerTransferFee.epoch)*e.slotsInEpoch-e.absoluteSlot)*400/1e3:void 0;if(r)if(o.transferFeeBasisPoints===We){let u=new ie(o.maximumFee.toString());return{amount:n.add(u),fee:u,expirationTime:a}}else{let u=Ce(n.mul(new ie(We)),new ie(We-o.transferFeeBasisPoints)),c=new ie(o.maximumFee.toString()),m=u.sub(n).gt(c)?n.add(c):u,l=Ce(m.mul(new ie(o.transferFeeBasisPoints)),new ie(We)),f=l.gt(s)?s:l;return{amount:m,fee:f,expirationTime:a}}else{let u=Ce(n.mul(new ie(o.transferFeeBasisPoints)),new ie(We)),c=u.gt(s)?s:u;return{amount:n,fee:c,expirationTime:a}}}function Ce(n,t){let{div:e,mod:r}=n.divmod(t);return r.gt(new ie(0))?e.add(new ie(1)):e}import{PublicKey as Wn,AddressLookupTableAccount as lt}from"@solana/web3.js";async function Vt({connection:n,address:t}){let e=await Mt(n,[...new Set(t.map(i=>i.toString()))].map(i=>new Wn(i))),r={};for(let i=0;i<t.length;i++){let o=e[i],s=t[i];if(!o)continue;let a=new lt({key:s,state:lt.deserialize(o.data)});r[s.toString()]=a,mt[s.toString()]=a}return r}var mt={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new lt({key:new Wn("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:lt.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as Ve,sendAndConfirmTransaction as qt,Transaction as qe,TransactionMessage as Ue,VersionedTransaction as Ge}from"@solana/web3.js";import Li from"axios";var ft=class{constructor(t){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner,this.cluster=t.cluster,this.blockhashCommitment=t.blockhashCommitment,this.api=t.api}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let t=(await Li.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:e}=(r=t==null?void 0:t[15])!=null?r:{};if(!!e)return{units:6e5,microLamports:Math.min(Math.ceil(e*1e6/6e5),25e3)}}addCustomComputeBudget(t){if(t){let{instructions:e,instructionTypes:r}=ut(t);return this.instructions.unshift(...e),this.instructionTypes.unshift(...r),!0}return!1}async calComputeBudget({config:t,defaultIns:e}){try{let r=t||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;e&&this.instructions.unshift(...e)}catch{e&&this.instructions.unshift(...e)}}addInstruction({instructions:t=[],endInstructions:e=[],signers:r=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...t),this.endInstructions.push(...e),this.signers.push(...r),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Ve.default.toString())),this}async versionBuild({txVersion:t,extInfo:e}){return t===0?await this.buildV0(E({},e||{})):this.build(e)}build(t){var r;let e=new qe;return this.allInstructions.length&&e.add(...this.allInstructions),e.feePayer=this.feePayer,((r=this.owner)==null?void 0:r.signer)&&!this.signers.some(i=>i.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:e,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async i=>{var c;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a}=i||{},u=o!=null?o:await ke(this.connection,this.blockhashCommitment);if(e.recentBlockhash=u,this.signers.length&&e.sign(...this.signers),Ae([e]),(c=this.owner)!=null&&c.isKeyPair)return{txId:a?await qt(this.connection,e,this.signers.find(l=>l.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(e.serialize(),{skipPreflight:s}),signedTx:e};if(this.signAllTransactions){let m=await this.signAllTransactions([e]);return{txId:await this.connection.sendRawTransaction(m[0].serialize(),{skipPreflight:s}),signedTx:m[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:t||{}}}buildMultiTx(t){var c;let{extraPreBuildData:e=[],extInfo:r}=t,{transaction:i}=this.build(r),o=e.filter(m=>m.transaction.instructions.length>0),s=[i,...o.map(m=>m.transaction)],a=[this.signers,...o.map(m=>m.signers)],u=[...this.instructionTypes,...o.map(m=>m.instructionTypes).flat()];return(c=this.owner)!=null&&c.signer&&a.forEach(m=>{m.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:u,execute:async m=>{var T;let{sequentially:l,onTxUpdate:f,recentBlockHash:p,skipPreflight:b=!0}=m||{},d=p!=null?p:await ke(this.connection,this.blockhashCommitment);if((T=this.owner)!=null&&T.isKeyPair){if(l){let P=[];for(let y of s){let w=await qt(this.connection,y,this.signers.find(h=>h.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:b});P.push(w)}return{txIds:P,signedTxs:s}}return{txIds:await await Promise.all(s.map(async P=>(P.recentBlockhash=d,await this.connection.sendRawTransaction(P.serialize(),{skipPreflight:b})))),signedTxs:s}}if(this.signAllTransactions){let P=s.map((w,h)=>(w.recentBlockhash=d,a[h].length&&w.sign(...a[h]),w));Ae(P);let y=await this.signAllTransactions(P);if(l){let w=0,h=[],S=async()=>{if(!y[w])return;let A=await this.connection.sendRawTransaction(y[w].serialize(),{skipPreflight:b});h.push({txId:A,status:"sent",signedTx:y[w]}),f==null||f([...h]),w++,this.connection.onSignature(A,D=>{let C=h.findIndex(R=>R.txId===A);C>-1&&(h[C].status=D.err?"error":"success"),f==null||f([...h]),D.err||S()},"processed"),this.connection.getSignatureStatus(A)};return await S(),{txIds:h.map(A=>A.txId),signedTxs:y}}else{let w=[];for(let h=0;h<y.length;h+=1){let S=await this.connection.sendRawTransaction(y[h].serialize(),{skipPreflight:b});w.push(S)}return{txIds:w,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:t,txVersion:e,extInfo:r}){return e===0?await this.buildV0MultiTx({extraPreBuildData:t,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:t,extInfo:r})}async buildV0(t){var d;let b=t||{},{lookupTableCache:e={},lookupTableAddress:r=[],forerunCreate:i,recentBlockhash:o}=b,s=ue(b,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=E(E({},this.cluster==="devnet"?{}:mt),e),u=Array.from(new Set([...r,...this.lookupTableAddress])),c=[];for(let T of u)a[T]===void 0&&c.push(new Ve(T));let m=await Vt({connection:this.connection,address:c});for(let[T,P]of Object.entries(m))a[T]=P;let l=i?Ve.default.toBase58():o!=null?o:await ke(this.connection,this.blockhashCommitment),f=new Ue({payerKey:this.feePayer,recentBlockhash:l,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((d=this.owner)==null?void 0:d.signer)&&!this.signers.some(T=>T.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let p=new Ge(f);return p.sign(this.signers),{builder:this,transaction:p,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async T=>{var w;let{skipPreflight:P=!0,sendAndConfirm:y}=T||{};if(Ae([p]),(w=this.owner)!=null&&w.isKeyPair){let h=await this.connection.sendTransaction(p,{skipPreflight:P});return y&&await ct(this.connection,h),{txId:h,signedTx:p}}if(this.signAllTransactions){let h=await this.signAllTransactions([p]);return{txId:await this.connection.sendTransaction(h[0],{skipPreflight:P}),signedTx:h[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(t){var c;let{extraPreBuildData:e=[],buildProps:r}=t,{transaction:i}=await this.buildV0(r),o=e.filter(m=>m.builder.instructions.length>0),s=[i,...o.map(m=>m.transaction)],a=[this.signers,...o.map(m=>m.signers)],u=[...this.instructionTypes,...o.map(m=>m.instructionTypes).flat()];return(c=this.owner)!=null&&c.signer&&a.forEach(m=>{m.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(m,l)=>{m.sign(a[l])}),{builder:this,transactions:s,signers:a,instructionTypes:u,buildProps:r,execute:async m=>{var d;let{sequentially:l,onTxUpdate:f,recentBlockHash:p,skipPreflight:b=!0}=m||{};if(p&&s.forEach(T=>T.message.recentBlockhash=p),Ae(s),(d=this.owner)!=null&&d.isKeyPair){if(l){let T=[];for(let P of s){let y=await this.connection.sendTransaction(P,{skipPreflight:b});await ct(this.connection,y),T.push(y)}return{txIds:T,signedTxs:s}}return{txIds:await Promise.all(s.map(async T=>await this.connection.sendTransaction(T,{skipPreflight:b}))),signedTxs:s}}if(this.signAllTransactions){let T=await this.signAllTransactions(s);if(l){let P=0,y=[],w=async()=>{if(!T[P])return;let h=await this.connection.sendTransaction(T[P],{skipPreflight:b});y.push({txId:h,status:"sent",signedTx:T[P]}),f==null||f([...y]),P++,this.connection.onSignature(h,S=>{let A=y.findIndex(D=>D.txId===h);A>-1&&(y[A].status=S.err?"error":"success"),f==null||f([...y]),S.err||w()},"processed"),this.connection.getSignatureStatus(h)};return w(),{txIds:[],signedTxs:T}}else{let P=[];for(let y=0;y<T.length;y+=1){let w=await this.connection.sendTransaction(T[y],{skipPreflight:b});P.push(w)}return{txIds:P,signedTxs:T}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(t){var m;let c=t||{},{computeBudgetConfig:e}=c,r=ue(c,["computeBudgetConfig"]),i=e?ut(e):{instructions:[],instructionTypes:[]},o=this.signers.reduce((l,f)=>H(E({},l),{[f.publicKey.toBase58()]:f}),{}),s=[],a=[],u=[];if(this.allInstructions.forEach(l=>{let f=[...u,l],p=e?[...i.instructions,...f]:f,d=[...new Set(f.map(T=>T.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat()).values()].map(T=>new Ve(T));if(u.length<12&&Oe({instructions:p,payer:this.feePayer,signers:d})||Oe({instructions:f,payer:this.feePayer,signers:d}))u.push(l);else{if(u.length===0)throw Error("item ins too big");Oe({instructions:e?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:d})?s.push(new qe().add(...i.instructions,...u)):s.push(new qe().add(...u)),a.push(Array.from(new Set(u.map(T=>T.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat())).map(T=>o[T]).filter(T=>T!==void 0)),u=[l]}}),u.length>0){let f=[...new Set(u.map(p=>p.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat()).values()].map(p=>o[p]).filter(p=>p!==void 0);Oe({instructions:e?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:f.map(p=>p.publicKey)})?s.push(new qe().add(...i.instructions,...u)):s.push(new qe().add(...u)),a.push(f)}return s.forEach(l=>l.feePayer=this.feePayer),(m=this.owner)!=null&&m.signer&&a.forEach(l=>{l.some(f=>f.publicKey.equals(this.owner.publicKey))||l.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async l=>{var P;let{sequentially:f,onTxUpdate:p,recentBlockHash:b,skipPreflight:d=!0}=l||{},T=b!=null?b:await ke(this.connection,this.blockhashCommitment);if(s.forEach(async(y,w)=>{y.recentBlockhash=T,a[w].length&&y.sign(...a[w])}),Ae(s),(P=this.owner)!=null&&P.isKeyPair){if(f){let y=[];for(let w of s){let h=await qt(this.connection,w,this.signers.find(S=>S.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:d});y.push(h)}return{txIds:y,signedTxs:s}}return{txIds:await Promise.all(s.map(async y=>await this.connection.sendRawTransaction(y.serialize(),{skipPreflight:d}))),signedTxs:s}}if(this.signAllTransactions){let y=await this.signAllTransactions(s);if(f){let w=0,h=[],S=async()=>{if(!y[w])return;let A=await this.connection.sendRawTransaction(y[w].serialize(),{skipPreflight:d});h.push({txId:A,status:"sent",signedTx:y[w]}),p==null||p([...h]),w++,this.connection.onSignature(A,D=>{let C=h.findIndex(R=>R.txId===A);C>-1&&(h[C].status=D.err?"error":"success"),p==null||p([...h]),D.err||S()},"processed"),this.connection.getSignatureStatus(A)};return await S(),{txIds:h.map(A=>A.txId),signedTxs:y}}else{let w=[];for(let h=0;h<y.length;h+=1){let S=await this.connection.sendRawTransaction(y[h].serialize(),{skipPreflight:d});w.push(S)}return{txIds:w,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuildV0(t){var P;let T=t||{},{computeBudgetConfig:e,lookupTableCache:r={},lookupTableAddress:i=[]}=T,o=ue(T,["computeBudgetConfig","lookupTableCache","lookupTableAddress"]),s=E(E({},this.cluster==="devnet"?{}:mt),r),a=Array.from(new Set([...this.lookupTableAddress,...i])),u=[];for(let y of a)s[y]===void 0&&u.push(new Ve(y));let c=await Vt({connection:this.connection,address:u});for(let[y,w]of Object.entries(c))s[y]=w;let m=e?ut(e):{instructions:[],instructionTypes:[]},l=await ke(this.connection,this.blockhashCommitment),f=this.signers.reduce((y,w)=>H(E({},y),{[w.publicKey.toBase58()]:w}),{}),p=[],b=[],d=[];if(this.allInstructions.forEach(y=>{let w=[...d,y],h=e?[...m.instructions,...w]:w;if(d.length<12&&Fe({instructions:h,payer:this.feePayer,lookupTableAddressAccount:s})||Fe({instructions:w,payer:this.feePayer,lookupTableAddressAccount:s}))d.push(y);else{if(d.length===0)throw Error("item ins too big");let S={};for(let A of[...new Set(a)])s[A]!==void 0&&(S[A]=s[A]);if(e&&Fe({instructions:[...m.instructions,...d],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:l})){let A=new Ue({payerKey:this.feePayer,recentBlockhash:l,instructions:[...m.instructions,...d]}).compileToV0Message(Object.values(s));p.push(new Ge(A))}else{let A=new Ue({payerKey:this.feePayer,recentBlockhash:l,instructions:[...d]}).compileToV0Message(Object.values(s));p.push(new Ge(A))}b.push(Array.from(new Set(d.map(A=>A.keys.filter(D=>D.isSigner).map(D=>D.pubkey.toString())).flat())).map(A=>f[A]).filter(A=>A!==void 0)),d=[y]}}),d.length>0){let w=[...new Set(d.map(h=>h.keys.filter(S=>S.isSigner).map(S=>S.pubkey.toString())).flat()).values()].map(h=>f[h]).filter(h=>h!==void 0);if(e&&Fe({instructions:[...m.instructions,...d],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:l})){let h=new Ue({payerKey:this.feePayer,recentBlockhash:l,instructions:[...m.instructions,...d]}).compileToV0Message(Object.values(s));p.push(new Ge(h))}else{let h=new Ue({payerKey:this.feePayer,recentBlockhash:l,instructions:[...d]}).compileToV0Message(Object.values(s));p.push(new Ge(h))}b.push(w)}return(P=this.owner)!=null&&P.signer&&b.forEach(y=>{y.some(w=>w.publicKey.equals(this.owner.publicKey))||y.push(this.owner.signer)}),{builder:this,transactions:p,buildProps:t,signers:b,instructionTypes:this.instructionTypes,execute:async y=>{var D;let{sequentially:w,onTxUpdate:h,recentBlockHash:S,skipPreflight:A=!0}=y||{};if(p.map(async(C,R)=>{b[R].length&&C.sign(b[R]),S&&(C.message.recentBlockhash=S)}),Ae(p),(D=this.owner)!=null&&D.isKeyPair){if(w){let C=[];for(let R of p){let v=await this.connection.sendTransaction(R,{skipPreflight:A});await ct(this.connection,v),C.push(v)}return{txIds:C,signedTxs:p}}return{txIds:await Promise.all(p.map(async C=>await this.connection.sendTransaction(C,{skipPreflight:A}))),signedTxs:p}}if(this.signAllTransactions){let C=await this.signAllTransactions(p);if(w){let R=0,v=[],_=async()=>{if(!C[R])return;let U=await this.connection.sendTransaction(C[R],{skipPreflight:A});v.push({txId:U,status:"sent",signedTx:C[R]}),h==null||h([...v]),R++,this.connection.onSignature(U,F=>{let Z=v.findIndex(W=>W.txId===U);Z>-1&&(v[Z].status=F.err?"error":"success"),h==null||h([...v]),F.err||_()},"processed"),this.connection.getSignatureStatus(U)};return _(),{txIds:[],signedTxs:C}}else{let R=[];for(let v=0;v<C.length;v+=1){let _=await this.connection.sendTransaction(C[v],{skipPreflight:A});R.push(_)}return{txIds:R,signedTxs:C}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}};import{PublicKey as Ea}from"@solana/web3.js";import va from"bn.js";var gu=X("Raydium_amount"),hu=ve(Mi);var Wt=new pe(0),Ru=new pe(1),Du=new pe(2),Eu=new pe(3),Ku=new pe(5),Ri=new pe(10),vu=new pe(100),_u=new pe(1e3),Ou=new pe(1e4);import Gt from"bn.js";import ht from"decimal.js-light";import He from"bn.js";function pt(n,t){if(t.isZero())throw Error("divisor is zero");return n.mod(t)}function Di(n,t){if(t.isZero())throw Error("rhs is zero");let e=n.div(t);if(e.isZero())throw Error("quotient is zero");let r=pt(n,t);return r.gt(Ie)&&(e=e.add(new He(1)),t=n.div(e),r=pt(n,e),r.gt(Ie)&&(t=t.add(new He(1)))),[e,t]}var Ie=new He(0),dt=class{static swapWithoutFees(t,e,r){let i=e.mul(r),o=e.add(t),[s,a]=Di(i,o),u=a.sub(e),c=r.sub(s);if(c.isZero())throw Error("destinationAmountSwapped is zero");return{sourceAmountSwapped:u,destinationAmountSwapped:c}}static lpTokensToTradingTokens(t,e,r,i,o){let s=t.mul(r).div(e),a=t.mul(i).div(e);if(o===0)return{tokenAmount0:s,tokenAmount1:a};if(o===1)return pt(t.mul(r),e).gt(Ie)&&s.gt(Ie)&&(s=s.add(new He(1))),pt(t.mul(i),e).gt(Ie)&&a.gt(Ie)&&(a=a.add(new He(1))),{tokenAmount0:s,tokenAmount1:a};throw Error("roundDirection value error")}};import qn from"bn.js";var Ut=new qn(1e6);function Ei(n,t,e){return n.mul(t).add(e).sub(new qn(1)).div(e)}function Vn(n,t,e){return n.mul(t).div(e)}var gt=class{static tradingFee(t,e){return Ei(t,e,Ut)}static protocolFee(t,e){return Vn(t,e,Ut)}static fundFee(t,e){return Vn(t,e,Ut)}};var bt=class{static validate_supply(t,e){if(t.isZero())throw Error("tokenAmount0 is zero");if(e.isZero())throw Error("tokenAmount1 is zero")}static swap(t,e,r,i){let o=gt.tradingFee(t,i),s=t.sub(o),{sourceAmountSwapped:a,destinationAmountSwapped:u}=dt.swapWithoutFees(s,e,r),c=a.add(o);return{newSwapSourceAmount:e.add(c),newSwapDestinationAmount:r.sub(u),sourceAmountSwapped:c,destinationAmountSwapped:u,tradeFee:o}}static swapBaseOut({poolMintA:t,poolMintB:e,tradeFeeRate:r,baseReserve:i,quoteReserve:o,outputMint:s,outputAmount:a}){let[u,c,m,l,f]=e.address===s.toString()?[i,o,t.decimals,e.decimals,t.address]:[o,i,e.decimals,t.decimals,e.address],p=new ht(c.toString()).div(10**l).div(new ht(u.toString()).div(10**m)),b=a.gte(c)?c.sub(new Gt(1)):a,d=c.sub(b),T=Ce(u.mul(b),d),P=Ce(T.mul(new Gt(1e6)),new Gt(1e6).sub(r)),y=P.sub(T),w=new ht(b.toString()).div(10**l).div(new ht(P.toString()).div(10**m)),h=p.isZero()?0:w.sub(p).div(p).abs().toNumber();return{amountRealOut:b,amountIn:P,amountInWithoutFee:T,tradeFee:y,priceImpact:h}}};import z from"bn.js";var Ht=(...n)=>n.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),ze=class{constructor({scope:t,moduleName:e}){this.disabled=!1;this.scope=t,this.logger=X(e)}createTxBuilder(t){return this.scope.checkOwner(),new ft({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(Ht(t))}logInfo(...t){this.logger.info(Ht(t))}logAndCreateError(...t){let e=Ht(t);throw new Error(e)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as qi}from"@solana/web3.js";import jn,{isBN as Zn}from"bn.js";import{bits as oc,BitStructure as sc,blob as Ki,Blob as ac,cstr as uc,f32 as cc,f32be as lc,f64 as mc,f64be as fc,greedy as pc,Layout as vi,ns64 as dc,ns64be as gc,nu64 as hc,nu64be as bc,offset as yc,s16 as wc,s16be as Pc,s24 as Tc,s24be as Ac,s32 as xc,s32be as Bc,s40 as Sc,s40be as kc,s48 as Cc,s48be as Ic,s8 as Nc,seq as _i,struct as Lc,Structure as Oi,u16 as Fi,u16be as Mc,u24 as Rc,u24be as Dc,u32 as Ec,u32be as Kc,u40 as vc,u40be as _c,u48 as Oc,u48be as Fc,u8 as Wi,UInt as Vi,union as Wc,Union as Vc,unionLayoutDiscriminator as qc,utf8 as Uc}from"@solana/buffer-layout";var zt=vi,Un=Oi;var jt=Vi;var Gn=Wi,Hn=Fi;var zn=_i;var Ne=Ki;var Zt=class extends zt{constructor(e,r,i){super(e,i);this.blob=Ne(e),this.signed=r}decode(e,r=0){let i=new jn(this.blob.decode(e,r),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(e,r,i=0){return typeof e=="number"&&(e=new jn(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),r,i)}};function ae(n){return new jt(1,n)}function Jt(n){return new jt(4,n)}function O(n){return new Zt(8,!1,n)}var yt=class extends zt{constructor(e,r,i,o){super(e.span,o);this.layout=e,this.decoder=r,this.encoder=i}decode(e,r){return this.decoder(this.layout.decode(e,r))}encode(e,r,i){return this.layout.encode(this.encoder(e),r,i)}getSpan(e,r){return this.layout.getSpan(e,r)}};function Q(n){return new yt(Ne(32),t=>new qi(t),t=>t.toBuffer(),n)}function Yn(n){return new yt(Gn(),Ui,Gi,n)}function Ui(n){if(n===0)return!1;if(n===1)return!0;throw new Error("Invalid bool: "+n)}function Gi(n){return n?1:0}var Yt=class extends Un{decode(t,e){return super.decode(t,e)}};function oe(n,t,e){return new Yt(n,t,e)}function Xt(n,t,e){let r,i=typeof t=="number"?t:Zn(t)?t.toNumber():new Proxy(t,{get(o,s){if(!r){let a=Reflect.get(o,"count");r=Zn(a)?a.toNumber():a,Reflect.set(o,"count",r)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(r=a),Reflect.set(o,s,a)}});return zn(n,i,e)}var rl=oe([Jt("mintAuthorityOption"),Q("mintAuthority"),O("supply"),ae("decimals"),ae("isInitialized"),Jt("freezeAuthorityOption"),Q("freezeAuthority")]);import{PublicKey as al}from"@solana/web3.js";import{MintLayout as cl,TOKEN_PROGRAM_ID as ml}from"@solana/spl-token";var Le=i=>{var o=i,{address:n,programId:t,decimals:e}=o,r=ue(o,["address","programId","decimals"]);return E({chainId:101,address:it(n).toBase58(),programId:t,logoURI:"",symbol:"",name:"",decimals:e,tags:[],extensions:r.extensions||{}},r)},je=n=>n?H(E({},n),{transferFeeConfigAuthority:n.transferFeeConfigAuthority.toBase58(),withdrawWithheldAuthority:n.withdrawWithheldAuthority.toBase58(),withheldAmount:n.withheldAmount.toString(),olderTransferFee:H(E({},n.olderTransferFee),{epoch:n.olderTransferFee.epoch.toString(),maximumFee:n.olderTransferFee.maximumFee.toString()}),newerTransferFee:H(E({},n.newerTransferFee),{epoch:n.newerTransferFee.epoch.toString(),maximumFee:n.newerTransferFee.maximumFee.toString()})}):void 0;import{TransactionInstruction as Ze}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Xi,TOKEN_2022_PROGRAM_ID as Qn,TOKEN_PROGRAM_ID as $t}from"@solana/spl-token";var Hi=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),xl=Buffer.from("amm_config","utf8"),zi=Buffer.from("pool","utf8"),ji=Buffer.from("pool_lp_mint","utf8"),Zi=Buffer.from("pool_vault","utf8"),Yi=Buffer.from("observation","utf8");function wt(n){return Pe([Hi],n)}function Qt(n,t,e,r){return Pe([zi,t.toBuffer(),e.toBuffer(),r.toBuffer()],n)}function Ji(n,t){return Pe([ji,t.toBuffer()],n)}function Jn(n,t,e){return Pe([Zi,t.toBuffer(),e.toBuffer()],n)}function Pt(n,t){return Pe([Yi,t.toBuffer()],n)}function Xn({poolId:n,programId:t,configId:e,mintA:r,mintB:i}){let o=wt(t).publicKey,s=n||Qt(t,e,r,i).publicKey,a=Ji(t,s).publicKey,u=Jn(t,s,r).publicKey,c=Jn(t,s,i).publicKey,m=Pt(t,s).publicKey;return{poolId:s,configId:e,authority:o,lpMint:a,vaultA:u,vaultB:c,observationId:m}}var Qi=X("Raydium_cpmm"),Ye={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173]};function $n(n,t,e,r,i,o,s,a,u,c,m,l,f,p,b,d,T,P,y,w){let h=oe([O("amountMaxA"),O("amountMaxB"),O("openTime")]),S=Qt(n,e,o,s).publicKey,A=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!i.equals(S),isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:T,isSigner:!1,isWritable:!0},{pubkey:$t,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:Xi,isSigner:!1,isWritable:!1},{pubkey:Ln,isSigner:!1,isWritable:!1},{pubkey:Nn,isSigner:!1,isWritable:!1}],D=Buffer.alloc(h.span);return h.encode({amountMaxA:P,amountMaxB:y,openTime:w},D),new Ze({keys:A,programId:n,data:Buffer.from([...Ye.initialize,...D])})}function er(n,t,e,r,i,o,s,a,u,c,m,l,f,p,b){let d=oe([O("lpAmount"),O("amountMaxA"),O("amountMaxB")]),T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:$t,isSigner:!1,isWritable:!1},{pubkey:Qn,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0}],P=Buffer.alloc(d.span);return Qi.debug("cpmm deposit data",{lpAmount:f.toString(),amountMaxA:p.toString(),amountMaxB:b.toString()}),d.encode({lpAmount:f,amountMaxA:p,amountMaxB:b},P),new Ze({keys:T,programId:n,data:Buffer.from([...Ye.deposit,...P])})}function tr(n,t,e,r,i,o,s,a,u,c,m,l,f,p,b){let d=oe([O("lpAmount"),O("amountMinA"),O("amountMinB")]),T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:$t,isSigner:!1,isWritable:!1},{pubkey:Qn,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:In,isSigner:!1,isWritable:!1}],P=Buffer.alloc(d.span);return d.encode({lpAmount:f,amountMinA:p,amountMinB:b},P),new Ze({keys:T,programId:n,data:Buffer.from([...Ye.withdraw,...P])})}function nr(n,t,e,r,i,o,s,a,u,c,m,l,f,p,b,d){let T=oe([O("amountIn"),O("amounOutMin")]),P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],y=Buffer.alloc(T.span);return T.encode({amountIn:b,amounOutMin:d},y),new Ze({keys:P,programId:n,data:Buffer.from([...Ye.swapBaseInput,...y])})}function rr(n,t,e,r,i,o,s,a,u,c,m,l,f,p,b,d){let T=oe([O("amountInMax"),O("amountOut")]),P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],y=Buffer.alloc(T.span);return T.encode({amountInMax:b,amountOut:d},y),new Ze({keys:P,programId:n,data:Buffer.from([...Ye.swapBaseOutput,...y])})}var ir=oe([Ne(8),ae("bump"),Yn("disableCreatePool"),Hn("index"),O("tradeFeeRate"),O("protocolFeeRate"),O("fundFeeRate"),O("createPoolFee"),Q("protocolOwner"),Q("fundOwner"),Xt(O(),16)]),or=oe([Ne(8),Q("configId"),Q("poolCreator"),Q("vaultA"),Q("vaultB"),Q("mintLp"),Q("mintA"),Q("mintB"),Q("mintProgramA"),Q("mintProgramB"),Q("observationId"),ae("bump"),ae("status"),ae("lpDecimals"),ae("mintDecimalA"),ae("mintDecimalB"),O("lpAmount"),O("protocolFeesMintA"),O("protocolFeesMintB"),O("fundFeesMintA"),O("fundFeesMintB"),O("openTime"),Xt(O(),32)]);var en=class extends ze{constructor(t){super(t)}async load(){this.checkDisabled()}async getCpmmPoolKeys(t){return(await this.scope.api.fetchPoolKeysById({idList:[t]}))[0]}async getRpcPoolInfo(t,e){return(await this.getRpcPoolInfos([t],e))[t]}async getRpcPoolInfos(t,e){let r=await De(this.scope.connection,t.map(l=>({pubkey:new x(l)}))),i={},o=new Set,s=[];for(let l=0;l<t.length;l++){let f=r[l];if(f.accountInfo===null)throw Error("fetch pool info error: "+String(t[l]));let p=or.decode(f.accountInfo.data);i[String(t[l])]=H(E({},p),{programId:f.accountInfo.owner}),o.add(String(p.configId)),s.push(p.vaultA,p.vaultB)}let a={};if(e){let l=[...o],f=await De(this.scope.connection,l.map(p=>({pubkey:new x(p)})));for(let p=0;p<l.length;p++){let b=f[p].accountInfo;if(b===null)throw Error("fetch pool config error: "+l[p]);a[l[p]]=ir.decode(b.data)}}let u={},c=await De(this.scope.connection,s.map(l=>({pubkey:new x(l)})));for(let l=0;l<s.length;l++){let f=c[l].accountInfo;if(f===null)throw Error("fetch vault info error: "+s[l]);u[String(s[l])]=new z($i.decode(f.data).amount.toString())}let m={};for(let[l,f]of Object.entries(i)){let p=u[f.vaultA.toString()].sub(f.protocolFeesMintA).sub(f.fundFeesMintA),b=u[f.vaultB.toString()].sub(f.protocolFeesMintB).sub(f.fundFeesMintB);m[l]=H(E({},f),{baseReserve:p,quoteReserve:b,vaultAAmount:u[f.vaultA.toString()],vaultBAmount:u[f.vaultB.toString()],configInfo:a[f.configId.toString()],poolPrice:new ee(b.toString()).div(new ee(10).pow(f.mintDecimalB)).div(new ee(p.toString()).div(new ee(10).pow(f.mintDecimalA)))})}return m}toComputePoolInfos({pools:t,mintInfos:e}){return Object.keys(t).reduce((r,i)=>{var u,c,m,l;let o=t[i],[s,a]=[o.mintA.toBase58(),o.mintB.toBase58()];return H(E({},r),{[i]:H(E({},o),{id:new x(i),configInfo:o.configInfo,version:7,authority:wt(o.programId).publicKey,mintA:Le({address:s,decimals:o.mintDecimalA,programId:o.mintProgramA.toBase58(),extensions:{feeConfig:(u=e[s])!=null&&u.feeConfig?je((c=e[s])==null?void 0:c.feeConfig):void 0}}),mintB:Le({address:a,decimals:o.mintDecimalB,programId:o.mintProgramB.toBase58(),extensions:{feeConfig:(m=e[a])!=null&&m.feeConfig?je((l=e[a])==null?void 0:l.feeConfig):void 0}})})})},{})}async getPoolInfoFromRpc(t){let e=await this.getRpcPoolInfo(t,!0),r=await xn({connection:this.scope.connection,mints:[e.mintA,e.mintB]}),i=Le({address:e.mintA.toBase58(),decimals:e.mintDecimalA,programId:e.mintProgramA.toBase58(),extensions:{feeConfig:r[e.mintA.toBase58()].feeConfig?je(r[e.mintA.toBase58()].feeConfig):void 0}}),o=Le({address:e.mintB.toBase58(),decimals:e.mintDecimalB,programId:e.mintProgramB.toBase58(),extensions:{feeConfig:r[e.mintB.toBase58()].feeConfig?je(r[e.mintB.toBase58()].feeConfig):void 0}}),s=Le({address:e.mintLp.toBase58(),decimals:e.lpDecimals,programId:de.toBase58()}),a={id:e.configId.toBase58(),index:e.configInfo.index,protocolFeeRate:e.configInfo.protocolFeeRate.toNumber(),tradeFeeRate:e.configInfo.tradeFeeRate.toNumber(),fundFeeRate:e.configInfo.fundFeeRate.toNumber(),createPoolFee:e.configInfo.createPoolFee.toString()},u={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]};return{poolInfo:{programId:e.programId.toBase58(),id:t,type:"Standard",lpMint:s,lpPrice:0,lpAmount:e.lpAmount.toNumber(),config:a,mintA:i,mintB:o,rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:e.poolPrice.toNumber(),mintAmountA:new ee(e.vaultAAmount.toString()).div(10**i.decimals).toNumber(),mintAmountB:new ee(e.vaultBAmount.toString()).div(10**o.decimals).toNumber(),feeRate:e.configInfo.tradeFeeRate.toNumber(),openTime:e.openTime.toString(),tvl:0,burnPercent:0,day:u,week:u,month:u,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0},poolKeys:{programId:e.programId.toBase58(),id:t,mintA:i,mintB:o,openTime:e.openTime.toString(),vault:{A:e.vaultA.toBase58(),B:e.vaultB.toBase58()},authority:wt(e.programId).publicKey.toBase58(),mintLp:s,config:a},rpcData:e}}async createPool(f){var p=f,{poolId:t,programId:e,poolFeeAccount:r,startTime:i,ownerInfo:o,associatedOnly:s=!1,checkCreateATAOwner:a=!1,txVersion:u,feeConfig:c,computeBudgetConfig:m}=p,l=ue(p,["poolId","programId","poolFeeAccount","startTime","ownerInfo","associatedOnly","checkCreateATAOwner","txVersion","feeConfig","computeBudgetConfig"]);var Z,W,K;let b=o.feePayer||((Z=this.scope.owner)==null?void 0:Z.publicKey),d=new z(new x(l.mintA.address).toBuffer()).lte(new z(new x(l.mintB.address).toBuffer())),[T,P]=d?[l.mintA,l.mintB]:[l.mintB,l.mintA],[y,w]=d?[l.mintAAmount,l.mintBAmount]:[l.mintBAmount,l.mintAAmount],h=o.useSOLBalance&&T.address===Tt.toBase58(),S=o.useSOLBalance&&P.address===Tt.toBase58(),[A,D]=[new x(T.address),new x(P.address)],C=this.createTxBuilder(),{account:R,instructionParams:v}=await this.scope.account.getOrCreateTokenAccount({mint:A,tokenProgram:T.programId,owner:this.scope.ownerPubKey,createInfo:h?{payer:b,amount:y}:void 0,notUseTokenAccount:h,skipCloseAccount:!h,associatedOnly:h?!1:s,checkCreateATAOwner:a});C.addInstruction(v||{});let{account:_,instructionParams:U}=await this.scope.account.getOrCreateTokenAccount({mint:new x(P.address),tokenProgram:P.programId,owner:this.scope.ownerPubKey,createInfo:S?{payer:b,amount:w}:void 0,notUseTokenAccount:S,skipCloseAccount:!S,associatedOnly:S?!1:s,checkCreateATAOwner:a});if(C.addInstruction(U||{}),R===void 0||_===void 0)throw Error("you don't has some token account");let F=Xn({poolId:t,programId:e,configId:new x(c.id),mintA:A,mintB:D});return C.addInstruction({instructions:[$n(e,this.scope.ownerPubKey,new x(c.id),F.authority,F.poolId,A,D,F.lpMint,R,_,Fn(this.scope.ownerPubKey,F.lpMint).publicKey,F.vaultA,F.vaultB,r,new x((W=T.programId)!=null?W:de),new x((K=P.programId)!=null?K:de),F.observationId,y,w,i)],instructionTypes:[fe.CpmmCreatePool]}),C.addCustomComputeBudget(m),C.versionBuild({txVersion:u,extInfo:{address:H(E({},F),{mintA:T,mintB:P,programId:e,poolFeeAccount:r,feeConfig:c})}})}async addLiquidity(t){let{poolInfo:e,poolKeys:r,inputAmount:i,baseIn:o,slippage:s,computeResult:a,computeBudgetConfig:u,config:c,txVersion:m}=t;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region"),i.isZero()&&this.logAndCreateError("amounts must greater than zero","amountInA",{amountInA:i.toString()});let{account:l}=this.scope,{bypassAssociatedCheck:f,checkCreateATAOwner:p}=E({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},c),b=a?void 0:await this.getRpcPoolInfo(e.id),{liquidity:d,inputAmountFee:T,anotherAmount:P}=a||this.computePairAmount({poolInfo:H(E({},e),{lpAmount:new ee(b.lpAmount.toString()).div(10**e.lpMint.decimals).toNumber()}),baseReserve:b.baseReserve,quoteReserve:b.quoteReserve,slippage:new re(0),baseIn:o,epochInfo:await this.scope.fetchEpochInfo(),amount:new ee(i.toString()).div(10**(o?e.mintA.decimals:e.mintB.decimals))}),y=P.amount,w=e.mintA.address===Tt.toString(),h=e.mintB.address===Tt.toString(),S=this.createTxBuilder(),[A,D]=[new x(e.mintA.address),new x(e.mintB.address)],{account:C,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new x(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:w||(o?i:y).isZero()?{payer:this.scope.ownerPubKey,amount:o?i:y}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:!1,checkCreateATAOwner:p});S.addInstruction(R||{});let{account:v,instructionParams:_}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new x(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:h||(o?y:i).isZero()?{payer:this.scope.ownerPubKey,amount:o?y:i}:void 0,skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:!1,checkCreateATAOwner:p});S.addInstruction(_||{}),!C&&!v&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",l.tokenAccounts);let U=await l.getCreatedTokenAccount({mint:new x(e.lpMint.address)}),tn=await l.handleTokenAccount({side:"out",amount:0,mint:new x(e.lpMint.address),tokenAccount:U,bypassAssociatedCheck:f,checkCreateATAOwner:p}),{tokenAccount:F}=tn,Z=ue(tn,["tokenAccount"]);S.addInstruction(Z);let W=r!=null?r:await this.getCpmmPoolKeys(e.id),K=new re(new z(1)).sub(s);return S.addInstruction({instructions:[er(new x(e.programId),this.scope.ownerPubKey,new x(W.authority),new x(e.id),F,C,v,new x(W.vault.A),new x(W.vault.B),A,D,new x(e.lpMint.address),a?a==null?void 0:a.liquidity:K.mul(d).quotient,o?T.amount:y,o?y:T.amount)],instructionTypes:[fe.CpmmAddLiquidity],lookupTableAddress:W.lookupTableAccount?[W.lookupTableAccount]:[]}),S.addCustomComputeBudget(u),S.versionBuild({txVersion:m})}async withdrawLiquidity(t){var F,Z;let{poolInfo:e,poolKeys:r,lpAmount:i,slippage:o,computeBudgetConfig:s,txVersion:a}=t;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region");let u=new re(new z(1)).sub(o),c=await this.getRpcPoolInfo(e.id),[m,l]=[u.mul(i.mul(c.baseReserve).div(c.lpAmount)).quotient,u.mul(i.mul(c.quoteReserve).div(c.lpAmount)).quotient],f=await this.scope.fetchEpochInfo(),[p,b]=[xe(m,e.mintA.extensions.feeConfig,f,!1),xe(l,e.mintB.extensions.feeConfig,f,!1)],{account:d}=this.scope,T=this.createTxBuilder(),[P,y]=[new x(e.mintA.address),new x(e.mintB.address)],w=P.equals(le),h=y.equals(le),S,A,{account:D,instructionParams:C}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new x(e.mintA.address),notUseTokenAccount:w,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!w,associatedOnly:!w,checkCreateATAOwner:!1});S=D,C&&T.addInstruction(C);let{account:R,instructionParams:v}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new x(e.mintB.address),notUseTokenAccount:h,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!h,associatedOnly:!h,checkCreateATAOwner:!1});A=R,v&&T.addInstruction(v),(!S||!A)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",d.tokenAccounts);let _=await d.getCreatedTokenAccount({mint:new x(e.lpMint.address)});_||this.logAndCreateError("cannot found lp token account","tokenAccounts",d.tokenAccounts);let U=r!=null?r:await this.getCpmmPoolKeys(e.id);return T.addInstruction({instructions:[tr(new x(e.programId),this.scope.ownerPubKey,new x(U.authority),new x(e.id),_,S,A,new x(U.vault.A),new x(U.vault.B),P,y,new x(e.lpMint.address),i,m.sub((F=p.fee)!=null?F:new z(0)),l.sub((Z=b.fee)!=null?Z:new z(0)))],instructionTypes:[fe.CpmmWithdrawLiquidity],lookupTableAddress:U.lookupTableAccount?[U.lookupTableAccount]:[]}),T.addCustomComputeBudget(s),T.versionBuild({txVersion:a})}async swap(t){var R,v,_,U,F,Z;let{poolInfo:e,poolKeys:r,baseIn:i,fixedOut:o,inputAmount:s,swapResult:a,slippage:u=0,config:c,computeBudgetConfig:m,txVersion:l}=t,{bypassAssociatedCheck:f,checkCreateATAOwner:p,associatedOnly:b}=E({bypassAssociatedCheck:!1,checkCreateATAOwner:!1,associatedOnly:!0},c),d=this.createTxBuilder(),[T,P]=[new x(e.mintA.address),new x(e.mintB.address)];o?a.sourceAmountSwapped=a.sourceAmountSwapped.mul(new z((1+u)*1e4)).div(new z(1e4)):a.destinationAmountSwapped=a.destinationAmountSwapped.mul(new z((1-u)*1e4)).div(new z(1e4));let y=e.mintA.address===le.toBase58(),w=e.mintB.address===le.toBase58(),{account:h,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({mint:T,tokenProgram:new x((R=e.mintA.programId)!=null?R:de),owner:this.scope.ownerPubKey,createInfo:y||!i?{payer:this.scope.ownerPubKey,amount:i?a.sourceAmountSwapped:0}:void 0,notUseTokenAccount:y,skipCloseAccount:!y,associatedOnly:y?!1:b,checkCreateATAOwner:p});S&&d.addInstruction(S);let{account:A,instructionParams:D}=await this.scope.account.getOrCreateTokenAccount({mint:P,tokenProgram:new x((v=e.mintB.programId)!=null?v:de),owner:this.scope.ownerPubKey,createInfo:w||i?{payer:this.scope.ownerPubKey,amount:i?0:a.sourceAmountSwapped}:void 0,notUseTokenAccount:w,skipCloseAccount:!w,associatedOnly:w?!1:b,checkCreateATAOwner:p});D&&d.addInstruction(D),(!h||!A)&&this.logAndCreateError("user do not have token account",{mintA:e.mintA.symbol||e.mintA.address,mintB:e.mintB.symbol||e.mintB.address,mintATokenAcc:h,mintBTokenAcc:A,mintAUseSOLBalance:y,mintBUseSOLBalance:w,associatedOnly:b});let C=r!=null?r:await this.getCpmmPoolKeys(e.id);return d.addInstruction({instructions:[o?rr(new x(e.programId),this.scope.ownerPubKey,new x(C.authority),new x(C.config.id),new x(e.id),i?h:A,i?A:h,new x(C.vault[i?"A":"B"]),new x(C.vault[i?"B":"A"]),new x((F=e[i?"mintA":"mintB"].programId)!=null?F:de),new x((Z=e[i?"mintB":"mintA"].programId)!=null?Z:de),i?T:P,i?P:T,Pt(new x(e.programId),new x(e.id)).publicKey,a.sourceAmountSwapped,a.destinationAmountSwapped):nr(new x(e.programId),this.scope.ownerPubKey,new x(C.authority),new x(C.config.id),new x(e.id),i?h:A,i?A:h,new x(C.vault[i?"A":"B"]),new x(C.vault[i?"B":"A"]),new x((_=e[i?"mintA":"mintB"].programId)!=null?_:de),new x((U=e[i?"mintB":"mintA"].programId)!=null?U:de),i?T:P,i?P:T,Pt(new x(e.programId),new x(e.id)).publicKey,s,a.destinationAmountSwapped)],instructionTypes:[o?fe.CpmmSwapBaseOut:fe.ClmmSwapBaseIn]}),d.addCustomComputeBudget(m),d.versionBuild({txVersion:l})}computeSwapAmount({pool:t,amountIn:e,outputMint:r,slippage:i}){let o=r.toString()===t.mintB.address,s=bt.swap(e,o?t.baseReserve:t.quoteReserve,o?t.quoteReserve:t.baseReserve,t.configInfo.tradeFeeRate),a=new ee(s.destinationAmountSwapped.toString()).div(s.sourceAmountSwapped.toString()),u=s.destinationAmountSwapped.mul(new z((1-i)*1e4)).div(new z(1e4));return{allTrade:s.sourceAmountSwapped.eq(e),amountIn:e,amountOut:s.destinationAmountSwapped,minAmountOut:u,executionPrice:a,fee:s.tradeFee,priceImpact:t.poolPrice.sub(a).div(t.poolPrice)}}computePairAmount({poolInfo:t,baseReserve:e,quoteReserve:r,amount:i,slippage:o,epochInfo:s,baseIn:a}){var h,S,A,D,C,R,v,_,U;let u=1-Number(o.toSignificant())/100,c=new z(new ee(i).mul(10**t[a?"mintA":"mintB"].decimals).mul(u).toFixed(0)),m=xe(c,t[a?"mintA":"mintB"].extensions.feeConfig,s,!1),l=c.sub((h=m.fee)!=null?h:new z(0)),f=new z(new ee(t.lpAmount).mul(10**t.lpMint.decimals).toFixed(0,ee.ROUND_DOWN));this.logDebug("baseReserve:",e.toString(),"quoteReserve:",r.toString()),this.logDebug("tokenIn:",a?t.mintA.symbol:t.mintB.symbol,"amountIn:",c.toString(),"amountInFee:",(A=(S=m.fee)==null?void 0:S.toString())!=null?A:0,"anotherToken:",a?t.mintB.symbol:t.mintA.symbol,"slippage:",`${o.toSignificant()}%`);let p=a?"base":"quote";this.logDebug("input side:",p);let b=l.mul(f).div(p==="base"?e:r),d={amount:Wt,fee:void 0,expirationTime:void 0};if(!l.isZero()){let F=eo(b,e,r,f);this.logDebug("lpAmountData:",{amountA:F.amountA.toString(),amountB:F.amountB.toString()}),d=xe(F[a?"amountB":"amountA"],t[a?"mintB":"mintA"].extensions.feeConfig,s,!0)}let T=new re(new z(1)).add(o),P=new re(new z(1)).sub(o),y=xe(T.mul(d.amount.sub((D=d.fee)!=null?D:new z(0))).quotient,t[a?"mintB":"mintA"].extensions.feeConfig,s,!0),w=xe(P.mul(d.amount.sub((C=d.fee)!=null?C:new z(0))).quotient,t[a?"mintB":"mintA"].extensions.feeConfig,s,!0);return this.logDebug("anotherAmount:",d.amount.toString(),"anotherAmountFee:",(v=(R=d.fee)==null?void 0:R.toString())!=null?v:0,"maxAnotherAmount:",y.amount.toString(),"maxAnotherAmountFee:",(U=(_=y.fee)==null?void 0:_.toString())!=null?U:0),{inputAmountFee:m,anotherAmount:d,maxAnotherAmount:y,minAnotherAmount:w,liquidity:b}}};function eo(n,t,e,r){let i=n.mul(t).div(r);!i.isZero()&&!n.mul(t).mod(r).isZero()&&(i=i.add(new z(1)));let o=n.mul(e).div(r);return!o.isZero()&&!n.mul(e).mod(r).isZero()&&(o=o.add(new z(1))),{amountA:i,amountB:o}}export{en as default};
//# sourceMappingURL=cpmm.mjs.map