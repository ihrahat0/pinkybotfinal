var Io=Object.defineProperty,Bo=Object.defineProperties;var So=Object.getOwnPropertyDescriptors;var yn=Object.getOwnPropertySymbols;var Gr=Object.prototype.hasOwnProperty,Ur=Object.prototype.propertyIsEnumerable;var qr=(r,e,t)=>e in r?Io(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,G=(r,e)=>{for(var t in e||(e={}))Gr.call(e,t)&&qr(r,t,e[t]);if(yn)for(var t of yn(e))Ur.call(e,t)&&qr(r,t,e[t]);return r},Q=(r,e)=>Bo(r,So(e));var _e=(r,e)=>{var t={};for(var n in r)Gr.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&yn)for(var n of yn(r))e.indexOf(n)<0&&Ur.call(r,n)&&(t[n]=r[n]);return t};import{PublicKey as Ke}from"@solana/web3.js";import{AccountLayout as Au,NATIVE_MINT as xo,TOKEN_PROGRAM_ID as Vt}from"@solana/spl-token";import{PublicKey as ta}from"@solana/web3.js";import $e from"bn.js";var St=9e15,at=1e9,Yn="0123456789abcdef",wn="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",kn="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Qn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-St,maxE:St,crypto:!1},Yr,je,X=!0,An="[DecimalError] ",st=An+"Invalid argument: ",Qr=An+"Precision limit exceeded",Zr=An+"crypto unavailable",jr="[object Decimal]",Te=Math.floor,ye=Math.pow,Ko=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Lo=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,No=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,$r=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Ge=1e7,W=7,Ro=9007199254740991,Co=wn.length-1,Zn=kn.length-1,B={toStringTag:jr};B.absoluteValue=B.abs=function(){var r=new this.constructor(this);return r.s<0&&(r.s=1),V(r)};B.ceil=function(){return V(new this.constructor(this),this.e+1,2)};B.clampedTo=B.clamp=function(r,e){var t,n=this,i=n.constructor;if(r=new i(r),e=new i(e),!r.s||!e.s)return new i(NaN);if(r.gt(e))throw Error(st+e);return t=n.cmp(r),t<0?r:n.cmp(e)>0?e:new i(n)};B.comparedTo=B.cmp=function(r){var e,t,n,i,o=this,s=o.d,a=(r=new o.constructor(r)).d,u=o.s,c=r.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==r.e)return o.e>r.e^u<0?1:-1;for(n=s.length,i=a.length,e=0,t=n<i?n:i;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===i?0:n>i^u<0?1:-1};B.cosine=B.cos=function(){var r,e,t=this,n=t.constructor;return t.d?t.d[0]?(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+W,n.rounding=1,t=Mo(n,ri(n,t)),n.precision=r,n.rounding=e,V(je==2||je==3?t.neg():t,r,e,!0)):new n(1):new n(NaN)};B.cubeRoot=B.cbrt=function(){var r,e,t,n,i,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(X=!1,o=l.s*ye(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=he(l.d),r=l.e,(o=(r-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=ye(t,1/3),r=Te((r+1)/3)-(r%3==(r<0?-1:2)),o==1/0?t="5e"+r:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+r),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(r=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=se(c.plus(l).times(a),c.plus(u),s+2,1),he(a.d).slice(0,s)===(t=he(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!i&&t=="4999"){if(!i&&(V(a,r+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(V(n,r+1,1),e=!n.times(n).times(n).eq(l));break}return X=!0,V(n,r,m.rounding,e)};B.decimalPlaces=B.dp=function(){var r,e=this.d,t=NaN;if(e){if(r=e.length-1,t=(r-Te(this.e/W))*W,r=e[r],r)for(;r%10==0;r/=10)t--;t<0&&(t=0)}return t};B.dividedBy=B.div=function(r){return se(this,new this.constructor(r))};B.dividedToIntegerBy=B.divToInt=function(r){var e=this,t=e.constructor;return V(se(e,new t(r),0,1,1),t.precision,t.rounding)};B.equals=B.eq=function(r){return this.cmp(r)===0};B.floor=function(){return V(new this.constructor(this),this.e+1,3)};B.greaterThan=B.gt=function(r){return this.cmp(r)>0};B.greaterThanOrEqualTo=B.gte=function(r){var e=this.cmp(r);return e==1||e===0};B.hyperbolicCosine=B.cosh=function(){var r,e,t,n,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(r=Math.ceil(i/3),e=(1/Tn(4,r)).toString()):(r=16,e="2.3283064365386962890625e-10"),o=Kt(s,1,o.times(e),new s(1),!0);for(var u,c=r,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return V(o,s.precision=t,s.rounding=n,!0)};B.hyperbolicSine=B.sinh=function(){var r,e,t,n,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(i.e,i.sd())+4,o.rounding=1,n=i.d.length,n<3)i=Kt(o,2,i,i,!0);else{r=1.4*Math.sqrt(n),r=r>16?16:r|0,i=i.times(1/Tn(5,r)),i=Kt(o,2,i,i,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);r--;)s=i.times(i),i=i.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,V(i,e,t,!0)};B.hyperbolicTangent=B.tanh=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+7,n.rounding=1,se(t.sinh(),t.cosh(),n.precision=r,n.rounding=e)):new n(t.s)};B.inverseCosine=B.acos=function(){var r,e=this,t=e.constructor,n=e.abs().cmp(1),i=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?qe(t,i,o):new t(0):new t(NaN):e.isZero()?qe(t,i+4,o).times(.5):(t.precision=i+6,t.rounding=1,e=e.asin(),r=qe(t,i+4,o).times(.5),t.precision=i,t.rounding=o,r.minus(e))};B.inverseHyperbolicCosine=B.acosh=function(){var r,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(r=n.precision,e=n.rounding,n.precision=r+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,X=!1,t=t.times(t).minus(1).sqrt().plus(t),X=!0,n.precision=r,n.rounding=e,t.ln()):new n(t)};B.inverseHyperbolicSine=B.asinh=function(){var r,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,X=!1,t=t.times(t).plus(1).sqrt().plus(t),X=!0,n.precision=r,n.rounding=e,t.ln())};B.inverseHyperbolicTangent=B.atanh=function(){var r,e,t,n,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(r=o.precision,e=o.rounding,n=i.sd(),Math.max(n,r)<2*-i.e-1?V(new o(i),r,e,!0):(o.precision=t=n-i.e,i=se(i.plus(1),new o(1).minus(i),t+r,1),o.precision=r+4,o.rounding=1,i=i.ln(),o.precision=r,o.rounding=e,i.times(.5))):new o(NaN)};B.inverseSine=B.asin=function(){var r,e,t,n,i=this,o=i.constructor;return i.isZero()?new o(i):(e=i.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(r=qe(o,t+4,n).times(.5),r.s=i.s,r):new o(NaN):(o.precision=t+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,i.times(2)))};B.inverseTangent=B.atan=function(){var r,e,t,n,i,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=Zn)return s=qe(l,m+4,d).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=Zn)return s=qe(l,m+4,d).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/W+2|0),r=t;r;--r)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(X=!1,e=Math.ceil(a/W),n=1,u=c.times(c),s=new l(c),i=c;r!==-1;)if(i=i.times(u),o=s.minus(i.div(n+=2)),i=i.times(u),s=o.plus(i.div(n+=2)),s.d[e]!==void 0)for(r=e;s.d[r]===o.d[r]&&r--;);return t&&(s=s.times(2<<t-1)),X=!0,V(s,l.precision=m,l.rounding=d,!0)};B.isFinite=function(){return!!this.d};B.isInteger=B.isInt=function(){return!!this.d&&Te(this.e/W)>this.d.length-2};B.isNaN=function(){return!this.s};B.isNegative=B.isNeg=function(){return this.s<0};B.isPositive=B.isPos=function(){return this.s>0};B.isZero=function(){return!!this.d&&this.d[0]===0};B.lessThan=B.lt=function(r){return this.cmp(r)<0};B.lessThanOrEqualTo=B.lte=function(r){return this.cmp(r)<1};B.logarithm=B.log=function(r){var e,t,n,i,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding,p=5;if(r==null)r=new l(10),e=!0;else{if(r=new l(r),t=r.d,r.s<0||!t||!t[0]||r.eq(1))return new l(NaN);e=r.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(i=t[0];i%10===0;)i/=10;o=i!==1}if(X=!1,a=m+p,s=ot(c,a),n=e?hn(l,a+10):ot(r,a),u=se(s,n,a,1),qt(u.d,i=m,d))do if(a+=10,s=ot(c,a),n=e?hn(l,a+10):ot(r,a),u=se(s,n,a,1),!o){+he(u.d).slice(i+1,i+15)+1==1e14&&(u=V(u,m+1,0));break}while(qt(u.d,i+=10,d));return X=!0,V(u,m,d)};B.minus=B.sub=function(r){var e,t,n,i,o,s,a,u,c,l,m,d,p=this,y=p.constructor;if(r=new y(r),!p.d||!r.d)return!p.s||!r.s?r=new y(NaN):p.d?r.s=-r.s:r=new y(r.d||p.s!==r.s?p:NaN),r;if(p.s!=r.s)return r.s=-r.s,p.plus(r);if(c=p.d,d=r.d,a=y.precision,u=y.rounding,!c[0]||!d[0]){if(d[0])r.s=-r.s;else if(c[0])r=new y(p);else return new y(u===3?-0:0);return X?V(r,a,u):r}if(t=Te(r.e/W),l=Te(p.e/W),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=d.length):(e=d,t=l,s=c.length),n=Math.max(Math.ceil(a/W),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=d[n]){m=c[n]<d[n];break}o=0}for(m&&(e=c,c=d,d=e,r.s=-r.s),s=c.length,n=d.length-s;n>0;--n)c[s++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(i=n;i&&c[--i]===0;)c[i]=Ge-1;--c[i],c[n]+=Ge}c[n]-=d[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(r.d=c,r.e=Pn(c,t),X?V(r,a,u):r):new y(u===3?-0:0)};B.modulo=B.mod=function(r){var e,t=this,n=t.constructor;return r=new n(r),!t.d||!r.s||r.d&&!r.d[0]?new n(NaN):!r.d||t.d&&!t.d[0]?V(new n(t),n.precision,n.rounding):(X=!1,n.modulo==9?(e=se(t,r.abs(),0,3,1),e.s*=r.s):e=se(t,r,0,n.modulo,1),e=e.times(r),X=!0,t.minus(e))};B.naturalExponential=B.exp=function(){return jn(this)};B.naturalLogarithm=B.ln=function(){return ot(this)};B.negated=B.neg=function(){var r=new this.constructor(this);return r.s=-r.s,V(r)};B.plus=B.add=function(r){var e,t,n,i,o,s,a,u,c,l,m=this,d=m.constructor;if(r=new d(r),!m.d||!r.d)return!m.s||!r.s?r=new d(NaN):m.d||(r=new d(r.d||m.s===r.s?m:NaN)),r;if(m.s!=r.s)return r.s=-r.s,m.minus(r);if(c=m.d,l=r.d,a=d.precision,u=d.rounding,!c[0]||!l[0])return l[0]||(r=new d(m)),X?V(r,a,u):r;if(o=Te(m.e/W),n=Te(r.e/W),c=c.slice(),i=o-n,i){for(i<0?(t=c,i=-i,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/W),s=o>s?o+1:s+1,i>s&&(i=s,t.length=1),t.reverse();i--;)t.push(0);t.reverse()}for(s=c.length,i=l.length,s-i<0&&(i=s,t=l,l=c,c=t),e=0;i;)e=(c[--i]=c[i]+l[i]+e)/Ge|0,c[i]%=Ge;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return r.d=c,r.e=Pn(c,n),X?V(r,a,u):r};B.precision=B.sd=function(r){var e,t=this;if(r!==void 0&&r!==!!r&&r!==1&&r!==0)throw Error(st+r);return t.d?(e=Jr(t.d),r&&t.e+1>e&&(e=t.e+1)):e=NaN,e};B.round=function(){var r=this,e=r.constructor;return V(new e(r),r.e+1,e.rounding)};B.sine=B.sin=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+W,n.rounding=1,t=Eo(n,ri(n,t)),n.precision=r,n.rounding=e,V(je>2?t.neg():t,r,e,!0)):new n(NaN)};B.squareRoot=B.sqrt=function(){var r,e,t,n,i,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(X=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=he(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=Te((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(se(s,o,t+2,1)).times(.5),he(o.d).slice(0,t)===(e=he(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!i&&e=="4999"){if(!i&&(V(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,i=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(V(n,u+1,1),r=!n.times(n).eq(s));break}return X=!0,V(n,u,l.rounding,r)};B.tangent=B.tan=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+10,n.rounding=1,t=t.sin(),t.s=1,t=se(t,new n(1).minus(t.times(t)).sqrt(),r+10,0),n.precision=r,n.rounding=e,V(je==2||je==4?t.neg():t,r,e,!0)):new n(NaN)};B.times=B.mul=function(r){var e,t,n,i,o,s,a,u,c,l=this,m=l.constructor,d=l.d,p=(r=new m(r)).d;if(r.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!r.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?r.s/0:r.s*0);for(t=Te(l.e/W)+Te(r.e/W),u=d.length,c=p.length,u<c&&(o=d,d=p,p=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,i=u+n;i>n;)a=o[i]+p[n]*d[i-n-1]+e,o[i--]=a%Ge|0,e=a/Ge|0;o[i]=(o[i]+e)%Ge|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),r.d=o,r.e=Pn(o,t),X?V(r,m.precision,m.rounding):r};B.toBinary=function(r,e){return Jn(this,2,r,e)};B.toDecimalPlaces=B.toDP=function(r,e){var t=this,n=t.constructor;return t=new n(t),r===void 0?t:(Ne(r,0,at),e===void 0?e=n.rounding:Ne(e,0,8),V(t,r+t.e+1,e))};B.toExponential=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=He(n,!0):(Ne(r,0,at),e===void 0?e=i.rounding:Ne(e,0,8),n=V(new i(n),r+1,e),t=He(n,!0,r+1)),n.isNeg()&&!n.isZero()?"-"+t:t};B.toFixed=function(r,e){var t,n,i=this,o=i.constructor;return r===void 0?t=He(i):(Ne(r,0,at),e===void 0?e=o.rounding:Ne(e,0,8),n=V(new o(i),r+i.e+1,e),t=He(n,!1,r+n.e+1)),i.isNeg()&&!i.isZero()?"-"+t:t};B.toFraction=function(r){var e,t,n,i,o,s,a,u,c,l,m,d,p=this,y=p.d,f=p.constructor;if(!y)return new f(p);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=Jr(y)-p.e-1,s=o%W,e.d[0]=ye(10,s<0?W+s:s),r==null)r=o>0?e:c;else{if(a=new f(r),!a.isInt()||a.lt(c))throw Error(st+a);r=a.gt(e)?o>0?e:c:a}for(X=!1,a=new f(he(y)),l=f.precision,f.precision=o=y.length*W*2;m=se(a,e,0,1,1),i=t.plus(m.times(n)),i.cmp(r)!=1;)t=n,n=i,i=c,c=u.plus(m.times(i)),u=i,i=e,e=a.minus(m.times(i)),a=i;return i=se(r.minus(t),n,0,1,1),u=u.plus(i.times(c)),t=t.plus(i.times(n)),u.s=c.s=p.s,d=se(c,n,o,1).minus(p).abs().cmp(se(u,t,o,1).minus(p).abs())<1?[c,n]:[u,t],f.precision=l,X=!0,d};B.toHexadecimal=B.toHex=function(r,e){return Jn(this,16,r,e)};B.toNearest=function(r,e){var t=this,n=t.constructor;if(t=new n(t),r==null){if(!t.d)return t;r=new n(1),e=n.rounding}else{if(r=new n(r),e===void 0?e=n.rounding:Ne(e,0,8),!t.d)return r.s?t:r;if(!r.d)return r.s&&(r.s=t.s),r}return r.d[0]?(X=!1,t=se(t,r,0,e,1).times(r),X=!0,V(t)):(r.s=t.s,t=r),t};B.toNumber=function(){return+this};B.toOctal=function(r,e){return Jn(this,8,r,e)};B.toPower=B.pow=function(r){var e,t,n,i,o,s,a=this,u=a.constructor,c=+(r=new u(r));if(!a.d||!r.d||!a.d[0]||!r.d[0])return new u(ye(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,r.eq(1))return V(a,n,o);if(e=Te(r.e/W),e>=r.d.length-1&&(t=c<0?-c:c)<=Ro)return i=ei(u,a,t,n),r.s<0?new u(1).div(i):V(i,n,o);if(s=a.s,s<0){if(e<r.d.length-1)return new u(NaN);if((r.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=ye(+a,c),e=t==0||!isFinite(t)?Te(c*(Math.log("0."+he(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(X=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),i=jn(r.times(ot(a,n+t)),n),i.d&&(i=V(i,n+5,1),qt(i.d,n,o)&&(e=n+10,i=V(jn(r.times(ot(a,e+t)),e),e+5,1),+he(i.d).slice(n+1,n+15)+1==1e14&&(i=V(i,n+1,0)))),i.s=s,X=!0,u.rounding=o,V(i,n,o))};B.toPrecision=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=He(n,n.e<=i.toExpNeg||n.e>=i.toExpPos):(Ne(r,1,at),e===void 0?e=i.rounding:Ne(e,0,8),n=V(new i(n),r,e),t=He(n,r<=n.e||n.e<=i.toExpNeg,r)),n.isNeg()&&!n.isZero()?"-"+t:t};B.toSignificantDigits=B.toSD=function(r,e){var t=this,n=t.constructor;return r===void 0?(r=n.precision,e=n.rounding):(Ne(r,1,at),e===void 0?e=n.rounding:Ne(e,0,8)),V(new n(t),r,e)};B.toString=function(){var r=this,e=r.constructor,t=He(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()&&!r.isZero()?"-"+t:t};B.truncated=B.trunc=function(){return V(new this.constructor(this),this.e+1,1)};B.valueOf=B.toJSON=function(){var r=this,e=r.constructor,t=He(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()?"-"+t:t};function he(r){var e,t,n,i=r.length-1,o="",s=r[0];if(i>0){for(o+=s,e=1;e<i;e++)n=r[e]+"",t=W-n.length,t&&(o+=it(t)),o+=n;s=r[e],n=s+"",t=W-n.length,t&&(o+=it(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Ne(r,e,t){if(r!==~~r||r<e||r>t)throw Error(st+r)}function qt(r,e,t,n){var i,o,s,a;for(o=r[0];o>=10;o/=10)--e;return--e<0?(e+=W,i=0):(i=Math.ceil((e+1)/W),e%=W),o=ye(10,W-e),a=r[i]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(r[i+1]/o/100|0)==ye(10,e-2)-1||(a==o/2||a==0)&&(r[i+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(r[i+1]/o/1e3|0)==ye(10,e-3)-1,s}function gn(r,e,t){for(var n,i=[0],o,s=0,a=r.length;s<a;){for(o=i.length;o--;)i[o]*=e;for(i[0]+=Yn.indexOf(r.charAt(s++)),n=0;n<i.length;n++)i[n]>t-1&&(i[n+1]===void 0&&(i[n+1]=0),i[n+1]+=i[n]/t|0,i[n]%=t)}return i.reverse()}function Mo(r,e){var t,n,i;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),i=(1/Tn(4,t)).toString()):(t=16,i="2.3283064365386962890625e-10"),r.precision+=t,e=Kt(r,1,e.times(i),new r(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return r.precision-=t,e}var se=function(){function r(n,i,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*i+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,i,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=i[a]){u=n[a]>i[a]?1:-1;break}return u}function t(n,i,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<i[o]?1:0,n[o]=a*s+n[o]-i[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,i,o,s,a,u){var c,l,m,d,p,y,f,w,g,h,k,A,I,P,N,x,C,E,O,re,Z=n.constructor,ue=n.s==i.s?1:-1,te=n.d,U=i.d;if(!te||!te[0]||!U||!U[0])return new Z(!n.s||!i.s||(te?U&&te[0]==U[0]:!U)?NaN:te&&te[0]==0||!U?ue*0:ue/0);for(u?(p=1,l=n.e-i.e):(u=Ge,p=W,l=Te(n.e/p)-Te(i.e/p)),O=U.length,C=te.length,g=new Z(ue),h=g.d=[],m=0;U[m]==(te[m]||0);m++);if(U[m]>(te[m]||0)&&l--,o==null?(P=o=Z.precision,s=Z.rounding):a?P=o+(n.e-i.e)+1:P=o,P<0)h.push(1),y=!0;else{if(P=P/p+2|0,m=0,O==1){for(d=0,U=U[0],P++;(m<C||d)&&P--;m++)N=d*u+(te[m]||0),h[m]=N/U|0,d=N%U|0;y=d||m<C}else{for(d=u/(U[0]+1)|0,d>1&&(U=r(U,d,u),te=r(te,d,u),O=U.length,C=te.length),x=O,k=te.slice(0,O),A=k.length;A<O;)k[A++]=0;re=U.slice(),re.unshift(0),E=U[0],U[1]>=u/2&&++E;do d=0,c=e(U,k,O,A),c<0?(I=k[0],O!=A&&(I=I*u+(k[1]||0)),d=I/E|0,d>1?(d>=u&&(d=u-1),f=r(U,d,u),w=f.length,A=k.length,c=e(f,k,w,A),c==1&&(d--,t(f,O<w?re:U,w,u))):(d==0&&(c=d=1),f=U.slice()),w=f.length,w<A&&f.unshift(0),t(k,f,A,u),c==-1&&(A=k.length,c=e(U,k,O,A),c<1&&(d++,t(k,O<A?re:U,A,u))),A=k.length):c===0&&(d++,k=[0]),h[m++]=d,c&&k[0]?k[A++]=te[x]||0:(k=[te[x]],A=1);while((x++<C||k[0]!==void 0)&&P--);y=k[0]!==void 0}h[0]||h.shift()}if(p==1)g.e=l,Yr=y;else{for(m=1,d=h[0];d>=10;d/=10)m++;g.e=m+l*p-1,V(g,a?o+g.e+1:o,s,y)}return g}}();function V(r,e,t,n){var i,o,s,a,u,c,l,m,d,p=r.constructor;e:if(e!=null){if(m=r.d,!m)return r;for(i=1,a=m[0];a>=10;a/=10)i++;if(o=e-i,o<0)o+=W,s=e,l=m[d=0],u=l/ye(10,i-s-1)%10|0;else if(d=Math.ceil((o+1)/W),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=u=0,i=1,o%=W,s=o-W+1}else break e;else{for(l=a=m[d],i=1;a>=10;a/=10)i++;o%=W,s=o-W+i,u=s<0?0:l/ye(10,i-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%ye(10,i-s-1)),c=t<4?(u||n)&&(t==0||t==(r.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/ye(10,i-s):0:m[d-1])%10&1||t==(r.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=r.e+1,m[0]=ye(10,(W-e%W)%W),r.e=-e||0):m[0]=r.e=0,r;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=ye(10,W-o),m[d]=s>0?(l/ye(10,i-s)%ye(10,s)|0)*a:0),c)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(r.e++,m[0]==Ge&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=Ge)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return X&&(r.e>p.maxE?(r.d=null,r.e=NaN):r.e<p.minE&&(r.e=0,r.d=[0])),r}function He(r,e,t){if(!r.isFinite())return ni(r);var n,i=r.e,o=he(r.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+it(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(r.e<0?"e":"e+")+r.e):i<0?(o="0."+it(-i-1)+o,t&&(n=t-s)>0&&(o+=it(n))):i>=s?(o+=it(i+1-s),t&&(n=t-i-1)>0&&(o=o+"."+it(n))):((n=i+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(i+1===s&&(o+="."),o+=it(n))),o}function Pn(r,e){var t=r[0];for(e*=W;t>=10;t/=10)e++;return e}function hn(r,e,t){if(e>Co)throw X=!0,t&&(r.precision=t),Error(Qr);return V(new r(wn),e,1,!0)}function qe(r,e,t){if(e>Zn)throw Error(Qr);return V(new r(kn),e,t,!0)}function Jr(r){var e=r.length-1,t=e*W+1;if(e=r[e],e){for(;e%10==0;e/=10)t--;for(e=r[0];e>=10;e/=10)t++}return t}function it(r){for(var e="";r--;)e+="0";return e}function ei(r,e,t,n){var i,o=new r(1),s=Math.ceil(n/W+4);for(X=!1;;){if(t%2&&(o=o.times(e),zr(o.d,s)&&(i=!0)),t=Te(t/2),t===0){t=o.d.length-1,i&&o.d[t]===0&&++o.d[t];break}e=e.times(e),zr(e.d,s)}return X=!0,o}function Xr(r){return r.d[r.d.length-1]&1}function ti(r,e,t){for(var n,i=new r(e[0]),o=0;++o<e.length;)if(n=new r(e[o]),n.s)i[t](n)&&(i=n);else{i=n;break}return i}function jn(r,e){var t,n,i,o,s,a,u,c=0,l=0,m=0,d=r.constructor,p=d.rounding,y=d.precision;if(!r.d||!r.d[0]||r.e>17)return new d(r.d?r.d[0]?r.s<0?0:1/0:1:r.s?r.s<0?0:r:0/0);for(e==null?(X=!1,u=y):u=e,a=new d(.03125);r.e>-2;)r=r.times(a),m+=5;for(n=Math.log(ye(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new d(1),d.precision=u;;){if(o=V(o.times(r),u,1),t=t.times(++l),a=s.plus(se(o,t,u,1)),he(a.d).slice(0,u)===he(s.d).slice(0,u)){for(i=m;i--;)s=V(s.times(s),u,1);if(e==null)if(c<3&&qt(s.d,u-n,p,c))d.precision=u+=10,t=o=a=new d(1),l=0,c++;else return V(s,d.precision=y,p,X=!0);else return d.precision=y,s}s=a}}function ot(r,e){var t,n,i,o,s,a,u,c,l,m,d,p=1,y=10,f=r,w=f.d,g=f.constructor,h=g.rounding,k=g.precision;if(f.s<0||!w||!w[0]||!f.e&&w[0]==1&&w.length==1)return new g(w&&!w[0]?-1/0:f.s!=1?NaN:w?0:f);if(e==null?(X=!1,l=k):l=e,g.precision=l+=y,t=he(w),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(r),t=he(f.d),n=t.charAt(0),p++;o=f.e,n>1?(f=new g("0."+t),o++):f=new g(n+"."+t.slice(1))}else return c=hn(g,l+2,k).times(o+""),f=ot(new g(n+"."+t.slice(1)),l-y).plus(c),g.precision=k,e==null?V(f,k,h,X=!0):f;for(m=f,u=s=f=se(f.minus(1),f.plus(1),l,1),d=V(f.times(f),l,1),i=3;;){if(s=V(s.times(d),l,1),c=u.plus(se(s,new g(i),l,1)),he(c.d).slice(0,l)===he(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(hn(g,l+2,k).times(o+""))),u=se(u,new g(p),l,1),e==null)if(qt(u.d,l-y,h,a))g.precision=l+=y,c=s=f=se(m.minus(1),m.plus(1),l,1),d=V(f.times(f),l,1),i=a=1;else return V(u,g.precision=k,h,X=!0);else return g.precision=k,u;u=c,i+=2}}function ni(r){return String(r.s*r.s/0)}function $n(r,e){var t,n,i;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(i=e.length;e.charCodeAt(i-1)===48;--i);if(e=e.slice(n,i),e){if(i-=n,r.e=t=t-n-1,r.d=[],n=(t+1)%W,t<0&&(n+=W),n<i){for(n&&r.d.push(+e.slice(0,n)),i-=W;n<i;)r.d.push(+e.slice(n,n+=W));e=e.slice(n),n=W-e.length}else n-=i;for(;n--;)e+="0";r.d.push(+e),X&&(r.e>r.constructor.maxE?(r.d=null,r.e=NaN):r.e<r.constructor.minE&&(r.e=0,r.d=[0]))}else r.e=0,r.d=[0];return r}function vo(r,e){var t,n,i,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),$r.test(e))return $n(r,e)}else if(e==="Infinity"||e==="NaN")return+e||(r.s=NaN),r.e=NaN,r.d=null,r;if(Lo.test(e))t=16,e=e.toLowerCase();else if(Ko.test(e))t=2;else if(No.test(e))t=8;else throw Error(st+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=r.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,i=ei(n,new n(t),o,o*2)),c=gn(e,t,Ge),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(r.s*0):(r.e=Pn(c,l),r.d=c,X=!1,s&&(r=se(r,i,a*4)),u&&(r=r.times(Math.abs(u)<54?ye(2,u):Gt.pow(2,u))),X=!0,r)}function Eo(r,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:Kt(r,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/Tn(5,t)),e=Kt(r,2,e,e);for(var i,o=new r(5),s=new r(16),a=new r(20);t--;)i=e.times(e),e=e.times(o.plus(i.times(s.times(i).minus(a))));return e}function Kt(r,e,t,n,i){var o,s,a,u,c=1,l=r.precision,m=Math.ceil(l/W);for(X=!1,u=t.times(t),a=new r(n);;){if(s=se(a.times(u),new r(e++*e++),l,1),a=i?n.plus(s):n.minus(s),n=se(s.times(u),new r(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return X=!0,s.d.length=m+1,s}function Tn(r,e){for(var t=r;--e;)t*=r;return t}function ri(r,e){var t,n=e.s<0,i=qe(r,r.precision,1),o=i.times(.5);if(e=e.abs(),e.lte(o))return je=n?4:1,e;if(t=e.divToInt(i),t.isZero())je=n?3:2;else{if(e=e.minus(t.times(i)),e.lte(o))return je=Xr(t)?n?2:3:n?4:1,e;je=Xr(t)?n?1:4:n?3:2}return e.minus(i).abs()}function Jn(r,e,t,n){var i,o,s,a,u,c,l,m,d,p=r.constructor,y=t!==void 0;if(y?(Ne(t,1,at),n===void 0?n=p.rounding:Ne(n,0,8)):(t=p.precision,n=p.rounding),!r.isFinite())l=ni(r);else{for(l=He(r),s=l.indexOf("."),y?(i=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):i=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=gn(He(d),10,i),d.e=d.d.length),m=gn(l,10,i),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=y?"0p+0":"0";else{if(s<0?o--:(r=new p(r),r.d=m,r.e=o,r=se(r,d,t,n,0,i),m=r.d,o=r.e,c=Yr),s=m[t],a=i/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(r.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(r.s<0?8:7)),m.length=t,c)for(;++m[--t]>i-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=Yn.charAt(m[s]);if(y){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=gn(l,i,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=Yn.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return r.s<0?"-"+l:l}function zr(r,e){if(r.length>e)return r.length=e,!0}function _o(r){return new this(r).abs()}function Fo(r){return new this(r).acos()}function Oo(r){return new this(r).acosh()}function Vo(r,e){return new this(r).plus(e)}function Do(r){return new this(r).asin()}function Wo(r){return new this(r).asinh()}function qo(r){return new this(r).atan()}function Go(r){return new this(r).atanh()}function Uo(r,e){r=new this(r),e=new this(e);var t,n=this.precision,i=this.rounding,o=n+4;return!r.s||!e.s?t=new this(NaN):!r.d&&!e.d?(t=qe(this,o,1).times(e.s>0?.25:.75),t.s=r.s):!e.d||r.isZero()?(t=e.s<0?qe(this,n,i):new this(0),t.s=r.s):!r.d||e.isZero()?(t=qe(this,o,1).times(.5),t.s=r.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(se(r,e,o,1)),e=qe(this,o,1),this.precision=n,this.rounding=i,t=r.s<0?t.minus(e):t.plus(e)):t=this.atan(se(r,e,o,1)),t}function Xo(r){return new this(r).cbrt()}function zo(r){return V(r=new this(r),r.e+1,2)}function Ho(r,e,t){return new this(r).clamp(e,t)}function Yo(r){if(!r||typeof r!="object")throw Error(An+"Object expected");var e,t,n,i=r.defaults===!0,o=["precision",1,at,"rounding",0,8,"toExpNeg",-St,0,"toExpPos",0,St,"maxE",0,St,"minE",-St,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],i&&(this[t]=Qn[t]),(n=r[t])!==void 0)if(Te(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(st+t+": "+n);if(t="crypto",i&&(this[t]=Qn[t]),(n=r[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Zr);else this[t]=!1;else throw Error(st+t+": "+n);return this}function Qo(r){return new this(r).cos()}function Zo(r){return new this(r).cosh()}function ii(r){var e,t,n;function i(o){var s,a,u,c=this;if(!(c instanceof i))return new i(o);if(c.constructor=i,Hr(o)){c.s=o.s,X?!o.d||o.e>i.maxE?(c.e=NaN,c.d=null):o.e<i.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;X?s>i.maxE?(c.e=NaN,c.d=null):s<i.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return $n(c,o.toString())}else if(u!=="string")throw Error(st+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),$r.test(o)?$n(c,o):vo(c,o)}if(i.prototype=B,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=Yo,i.clone=ii,i.isDecimal=Hr,i.abs=_o,i.acos=Fo,i.acosh=Oo,i.add=Vo,i.asin=Do,i.asinh=Wo,i.atan=qo,i.atanh=Go,i.atan2=Uo,i.cbrt=Xo,i.ceil=zo,i.clamp=Ho,i.cos=Qo,i.cosh=Zo,i.div=jo,i.exp=$o,i.floor=Jo,i.hypot=es,i.ln=ts,i.log=ns,i.log10=is,i.log2=rs,i.max=os,i.min=ss,i.mod=as,i.mul=us,i.pow=cs,i.random=ls,i.round=ms,i.sign=ds,i.sin=ps,i.sinh=fs,i.sqrt=bs,i.sub=ys,i.sum=gs,i.tan=ws,i.tanh=ks,i.trunc=hs,r===void 0&&(r={}),r&&r.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)r.hasOwnProperty(t=n[e++])||(r[t]=this[t]);return i.config(r),i}function jo(r,e){return new this(r).div(e)}function $o(r){return new this(r).exp()}function Jo(r){return V(r=new this(r),r.e+1,3)}function es(){var r,e,t=new this(0);for(X=!1,r=0;r<arguments.length;)if(e=new this(arguments[r++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return X=!0,new this(1/0);t=e}return X=!0,t.sqrt()}function Hr(r){return r instanceof Gt||r&&r.toStringTag===jr||!1}function ts(r){return new this(r).ln()}function ns(r,e){return new this(r).log(e)}function rs(r){return new this(r).log(2)}function is(r){return new this(r).log(10)}function os(){return ti(this,arguments,"lt")}function ss(){return ti(this,arguments,"gt")}function as(r,e){return new this(r).mod(e)}function us(r,e){return new this(r).mul(e)}function cs(r,e){return new this(r).pow(e)}function ls(r){var e,t,n,i,o=0,s=new this(1),a=[];if(r===void 0?r=this.precision:Ne(r,1,at),n=Math.ceil(r/W),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)i=e[o],i>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)i=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(i%1e7),o+=4);o=n/4}else throw Error(Zr);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],r%=W,n&&r&&(i=ye(10,W-r),a[o]=(n/i|0)*i);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=W)a.shift();for(n=1,i=a[0];i>=10;i/=10)n++;n<W&&(t-=W-n)}return s.e=t,s.d=a,s}function ms(r){return V(r=new this(r),r.e+1,this.rounding)}function ds(r){return r=new this(r),r.d?r.d[0]?r.s:0*r.s:r.s||NaN}function ps(r){return new this(r).sin()}function fs(r){return new this(r).sinh()}function bs(r){return new this(r).sqrt()}function ys(r,e){return new this(r).sub(e)}function gs(){var r=0,e=arguments,t=new this(e[r]);for(X=!1;t.s&&++r<e.length;)t=t.plus(e[r]);return X=!0,V(t,this.precision,this.rounding)}function ws(r){return new this(r).tan()}function ks(r){return new this(r).tanh()}function hs(r){return V(r=new this(r),r.e+1,1)}B[Symbol.for("nodejs.util.inspect.custom")]=B.toString;B[Symbol.toStringTag]="Decimal";var Gt=B.constructor=ii(Qn);wn=new Gt(wn);kn=new Gt(kn);var S=Gt;import Ns from"big.js";import Bn from"bn.js";import{get as oi,set as As}from"lodash";var er=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},si={},Ps={};function ae(r){let e=oi(si,r);if(!e){let t=oi(Ps,r);e=new er({name:r,logLevel:t}),As(si,r,e)}return e}import Ts from"toformat";var xs=Ts,Ut=xs;import In from"big.js";import Bs from"bn.js";import Ss from"decimal.js-light";import Xt from"bn.js";var ai=9007199254740991;function $(r){let e=ae("Raydium_parseBigNumberish");if(r instanceof Xt)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new Xt(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=ai||r<=-ai)&&e.logWithError(`BigNumberish number overflow: ${r}`),new Xt(String(r))):typeof r=="bigint"?new Xt(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new Xt(0))}var xn=ae("module/fraction"),tr=Ut(In),zt=Ut(Ss),Ks={[0]:zt.ROUND_DOWN,[1]:zt.ROUND_HALF_UP,[2]:zt.ROUND_UP},Ls={[0]:In.roundDown,[1]:In.roundHalfUp,[2]:In.roundUp},ie=class{constructor(e,t=new Bs(1)){this.numerator=$(e),this.denominator=$(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new ie(this.denominator,this.numerator)}add(e){let t=e instanceof ie?e:new ie($(e));return this.denominator.eq(t.denominator)?new ie(this.numerator.add(t.numerator),this.denominator):new ie(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof ie?e:new ie($(e));return this.denominator.eq(t.denominator)?new ie(this.numerator.sub(t.numerator),this.denominator):new ie(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof ie?e:new ie($(e));return new ie(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof ie?e:new ie($(e));return new ie(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||xn.logWithError(`${e} is not an integer.`),e<=0&&xn.logWithError(`${e} is not positive.`),zt.set({precision:e+1,rounding:Ks[n]});let i=new zt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||xn.logWithError(`${e} is not an integer.`),e<0&&xn.logWithError(`${e} is negative.`),tr.DP=e,tr.RM=Ls[n]||1,new tr(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Rs=ae("Raydium_amount"),ui=Ut(Ns);function Cs(r,e){let t="0",n="0";if(r.includes(".")){let i=r.split(".");i.length===2?([t,n]=i,n=n.padEnd(e,"0")):Rs.logWithError(`invalid number string, num: ${r}`)}else t=r;return[t,n.slice(0,e)||n]}var me=class extends ie{constructor(t,n,i=!0,o){let s=new Bn(0),a=nr.pow(new Bn(t.decimals));if(i)s=$(n);else{let u=new Bn(0),c=new Bn(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=Cs(n.toString(),t.decimals);u=$(l),c=$(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=ae(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new me(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new me(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,i=0){return super.toSignificant(t,n,i)}toFixed(t=this.token.decimals,n,i=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,i)}toExact(t={groupSeparator:""}){return ui.DP=this.token.decimals,new ui(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as Ms}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ci}from"@solana/spl-token";var rr={chainId:101,address:Ms.default.toBase58(),programId:ci.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ut={chainId:101,address:"So11111111111111111111111111111111111111112",programId:ci.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as sr}from"@solana/web3.js";import{PublicKey as le,SystemProgram as li,SYSVAR_RENT_PUBKEY as vs}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Es}from"@solana/spl-token";function T({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var _s=[T({pubkey:Es,isWritable:!1}),T({pubkey:li.programId,isWritable:!1}),T({pubkey:vs,isWritable:!1})];function ir({publicKey:r,transformSol:e}){let t=or(r.toString());if(t instanceof le)return e&&t.equals(Nt)?Lt:t;if(e&&t.toString()===Nt.toBase58())return Lt;if(typeof t=="string"){if(t===le.default.toBase58())return le.default;try{return new le(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function or(r){try{return new le(r)}catch{return r}}var Sn=new le("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),mi=new le("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ct=new le("SysvarRent111111111111111111111111111111111"),nc=new le("SysvarC1ock11111111111111111111111111111111"),Rt=new le("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Fs=new le("Sysvar1nstructions1111111111111111111111111"),rc=li.programId,ic=new le("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),oc=new le("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),sc=new le("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ac=new le("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),uc=new le("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),cc=new le("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),lc=new le("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),mc=new le("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),dc=new le("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),pc=new le("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),fc=new le("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Lt=new le("So11111111111111111111111111111111111111112"),Nt=le.default;function Ct(r){return ir({publicKey:r,transformSol:!0})}var ar=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:o=!1,isToken2022:s=!1}){if(e===Nt.toBase58()||e instanceof sr&&Nt.equals(e)){this.decimals=ut.decimals,this.symbol=ut.symbol,this.name=ut.name,this.mint=new sr(ut.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=o?sr.default:ir({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},xe=ar;xe.WSOL=new ar(Q(G({},ut),{mint:ut.address}));var ur=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Kn=ur;Kn.SOL=new ur(rr);import Os from"bn.js";var di=new ie(new Os(100)),Fe=class extends ie{toSignificant(e=5,t,n){return this.mul(di).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(di).toFixed(e,t,n)}};var Vs=ae("Raydium_price"),Oe=class extends ie{constructor(t){let{baseToken:n,quoteToken:i,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=i,this.scalar=new ie(cr(n.decimals),cr(i.decimals))}get raw(){return new ie(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Oe({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Vs.logWithError("mul token not equals");let n=super.mul(t);return new Oe({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,i){return this.adjusted.toSignificant(t,n,i)}toFixed(t=this.quoteToken.decimals,n,i){return this.adjusted.toFixed(t,n,i)}};import{PublicKey as Ds}from"@solana/web3.js";import Ws from"bn.js";function pi(r){return typeof r=="object"&&r!==null&&![xe,me,Ds,ie,Ws,Oe,Fe].some(e=>typeof e=="object"&&r instanceof e)}function pt(r){return typeof r=="string"?or(r):Array.isArray(r)?r.map(e=>pt(e)):pi(r)?Object.fromEntries(Object.entries(r).map(([e,t])=>[e,pt(t)])):r}var Ht=new $e(0),fi=new $e(1),cl=new $e(2),ll=new $e(3),ml=new $e(5),nr=new $e(10),dl=new $e(100),pl=new $e(1e3),fl=new $e(1e4);function cr(r){return nr.pow($(r))}function Ln(r,e){let t=r.divmod(e);return t.mod.isZero()?t.div:t.div.isNeg()?t.div.isubn(1):t.div.iaddn(1)}function lr(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Ys}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Qs}from"@solana/spl-token";import{ComputeBudgetProgram as bi,Keypair as gi,PublicKey as qs,Transaction as wi,TransactionMessage as Gs,VersionedTransaction as ki}from"@solana/web3.js";var J={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{TOKEN_PROGRAM_ID as Us}from"@solana/spl-token";var yi=ae("Raydium_txUtil"),hi=1644;function Nn(r){let e=[],t=[];return r.microLamports&&(e.push(bi.setComputeUnitPrice({microLamports:r.microLamports})),t.push(J.SetComputeUnitPrice)),r.units&&(e.push(bi.setComputeUnitLimit({units:r.units})),t.push(J.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Mt(r,e){var n,i;let t=e!=null?e:"confirmed";return(i=await((n=r.getLatestBlockhash)==null?void 0:n.call(r,{commitment:t})))==null?void 0:i.blockhash}async function Rn(r,e){return r.getSignatureStatuses([e]),new Promise((t,n)=>{let i=setTimeout(n,6e4);r.onSignature(e,o=>{if(clearTimeout(i),!o.err){t("");return}n(o.err.toString())},"confirmed")})}function Xs(r,e){r.length<1&&yi.logWithError(`no instructions provided: ${r.toString()}`),e.length<1&&yi.logWithError(`no signers provided:, ${e.toString()}`);let t=new wi;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...r);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<hi}catch{return!1}}function de(r,e){let[t,n]=qs.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}function Yt({instructions:r,payer:e,signers:t}){return Xs(r,[e,...t])}function Qt({instructions:r,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=gi.generate().publicKey.toString()}){let o=new Gs({payerKey:e,recentBlockhash:n,instructions:r}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new ki(o).serialize()).toString("base64").length<hi}catch{return!1}}var zs=r=>Buffer.isBuffer(r)?r:r instanceof Uint8Array?Buffer.from(r.buffer,r.byteOffset,r.byteLength):Buffer.from(r),Hs=r=>{let e=r.serialize({requireAllSignatures:!1,verifySignatures:!1});r instanceof ki&&(e=zs(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function ft(r){let e=[];return r.forEach(t=>{t instanceof wi&&(t.recentBlockhash||(t.recentBlockhash=Us.toBase58()),t.feePayer||(t.feePayer=gi.generate().publicKey)),e.push(Hs(t))}),console.log("simulate tx string:",e),e}function Re(r,e,t){return de([r.toBuffer(),(t!=null?t:Qs).toBuffer(),e.toBuffer()],new Ys("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as j}from"@solana/web3.js";var Ai=new j("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Pi=new j("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Ti=new j("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),El=new j("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),_l=new j("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Fl=new j("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Ol=new j("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Vl=new j("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Dl=new j("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Wl=new j("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),ql=new j("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Gl=new j("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Ul=new j("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Xl=new j("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),zl=new j("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Hl=new j("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Yl=new j("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Ql=new j("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Zl=new j("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),jl=new j("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),$l=new j("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Zs=new j("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),js=new j("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),$s=new j("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");var Jl={SERUM_MARKET:j.default,OPENBOOK_MARKET:new j("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:j.default,FarmV3:new j("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new j("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new j("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new j("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new j("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new j("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new j("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new j("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new j("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Zs,CREATE_CPMM_POOL_AUTH:js,CREATE_CPMM_POOL_FEE_ACC:$s,FEE_DESTINATION_ID:new j("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import Ue from"bn.js";var Zt=1e4;function pe(r,e,t,n){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let i=Q(G({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<i.newerTransferFee.epoch?i.olderTransferFee:i.newerTransferFee,s=new Ue(o.maximumFee.toString()),a=t.epoch<i.newerTransferFee.epoch?(Number(i.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Zt){let u=new Ue(o.maximumFee.toString());return{amount:r.add(u),fee:u,expirationTime:a}}else{let u=jt(r.mul(new Ue(Zt)),new Ue(Zt-o.transferFeeBasisPoints)),c=new Ue(o.maximumFee.toString()),l=u.sub(r).gt(c)?r.add(c):u,m=jt(l.mul(new Ue(o.transferFeeBasisPoints)),new Ue(Zt)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let u=jt(r.mul(new Ue(o.transferFeeBasisPoints)),new Ue(Zt)),c=u.gt(s)?s:u;return{amount:r,fee:c,expirationTime:a}}}function lt(r,e){return r===void 0?e:e===void 0?r:Math.min(r,e)}function jt(r,e){let{div:t,mod:n}=r.divmod(e);return n.gt(new Ue(0))?t.add(new Ue(1)):t}import{PublicKey as xi,AddressLookupTableAccount as Cn}from"@solana/web3.js";async function mr({connection:r,address:e}){let t=await Je(r,[...new Set(e.map(i=>i.toString()))].map(i=>new xi(i))),n={};for(let i=0;i<e.length;i++){let o=t[i],s=e[i];if(!o)continue;let a=new Cn({key:s,state:Cn.deserialize(o.data)});n[s.toString()]=a,Mn[s.toString()]=a}return n}var Mn={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new Cn({key:new xi("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:Cn.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as $t,sendAndConfirmTransaction as dr,Transaction as Jt,TransactionMessage as en,VersionedTransaction as tn}from"@solana/web3.js";import ea from"axios";var vn=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.api=e.api}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await ea.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=Nn(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==$t.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(G({},t||{})):this.build(t)}build(e){var n;let t=new Jt;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(i=>i.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async i=>{var c;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a}=i||{},u=o!=null?o:await Mt(this.connection,this.blockhashCommitment);if(t.recentBlockhash=u,this.signers.length&&t.sign(...this.signers),ft([t]),(c=this.owner)!=null&&c.isKeyPair)return{txId:a?await dr(this.connection,t,this.signers.find(m=>m.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let l=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var c;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:i}=this.build(n),o=t.filter(l=>l.transaction.instructions.length>0),s=[i,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],u=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(c=this.owner)!=null&&c.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:u,execute:async l=>{var w;let{sequentially:m,onTxUpdate:d,recentBlockHash:p,skipPreflight:y=!0}=l||{},f=p!=null?p:await Mt(this.connection,this.blockhashCommitment);if((w=this.owner)!=null&&w.isKeyPair){if(m){let g=[];for(let h of s){let k=await dr(this.connection,h,this.signers.find(A=>A.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:y});g.push(k)}return{txIds:g,signedTxs:s}}return{txIds:await await Promise.all(s.map(async g=>(g.recentBlockhash=f,await this.connection.sendRawTransaction(g.serialize(),{skipPreflight:y})))),signedTxs:s}}if(this.signAllTransactions){let g=s.map((k,A)=>(k.recentBlockhash=f,a[A].length&&k.sign(...a[A]),k));ft(g);let h=await this.signAllTransactions(g);if(m){let k=0,A=[],I=async()=>{if(!h[k])return;let P=await this.connection.sendRawTransaction(h[k].serialize(),{skipPreflight:y});A.push({txId:P,status:"sent",signedTx:h[k]}),d==null||d([...A]),k++,this.connection.onSignature(P,N=>{let x=A.findIndex(C=>C.txId===P);x>-1&&(A[x].status=N.err?"error":"success"),d==null||d([...A]),N.err||I()},"processed"),this.connection.getSignatureStatus(P)};return await I(),{txIds:A.map(P=>P.txId),signedTxs:h}}else{let k=[];for(let A=0;A<h.length;A+=1){let I=await this.connection.sendRawTransaction(h[A].serialize(),{skipPreflight:y});k.push(I)}return{txIds:k,signedTxs:h}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var f;let y=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:i,recentBlockhash:o}=y,s=_e(y,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=G(G({},this.cluster==="devnet"?{}:Mn),t),u=Array.from(new Set([...n,...this.lookupTableAddress])),c=[];for(let w of u)a[w]===void 0&&c.push(new $t(w));let l=await mr({connection:this.connection,address:c});for(let[w,g]of Object.entries(l))a[w]=g;let m=i?$t.default.toBase58():o!=null?o:await Mt(this.connection,this.blockhashCommitment),d=new en({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((f=this.owner)==null?void 0:f.signer)&&!this.signers.some(w=>w.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let p=new tn(d);return p.sign(this.signers),{builder:this,transaction:p,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async w=>{var k;let{skipPreflight:g=!0,sendAndConfirm:h}=w||{};if(ft([p]),(k=this.owner)!=null&&k.isKeyPair){let A=await this.connection.sendTransaction(p,{skipPreflight:g});return h&&await Rn(this.connection,A),{txId:A,signedTx:p}}if(this.signAllTransactions){let A=await this.signAllTransactions([p]);return{txId:await this.connection.sendTransaction(A[0],{skipPreflight:g}),signedTx:A[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var c;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:i}=await this.buildV0(n),o=t.filter(l=>l.builder.instructions.length>0),s=[i,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],u=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(c=this.owner)!=null&&c.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,m)=>{l.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:u,buildProps:n,execute:async l=>{var f;let{sequentially:m,onTxUpdate:d,recentBlockHash:p,skipPreflight:y=!0}=l||{};if(p&&s.forEach(w=>w.message.recentBlockhash=p),ft(s),(f=this.owner)!=null&&f.isKeyPair){if(m){let w=[];for(let g of s){let h=await this.connection.sendTransaction(g,{skipPreflight:y});await Rn(this.connection,h),w.push(h)}return{txIds:w,signedTxs:s}}return{txIds:await Promise.all(s.map(async w=>await this.connection.sendTransaction(w,{skipPreflight:y}))),signedTxs:s}}if(this.signAllTransactions){let w=await this.signAllTransactions(s);if(m){let g=0,h=[],k=async()=>{if(!w[g])return;let A=await this.connection.sendTransaction(w[g],{skipPreflight:y});h.push({txId:A,status:"sent",signedTx:w[g]}),d==null||d([...h]),g++,this.connection.onSignature(A,I=>{let P=h.findIndex(N=>N.txId===A);P>-1&&(h[P].status=I.err?"error":"success"),d==null||d([...h]),I.err||k()},"processed"),this.connection.getSignatureStatus(A)};return k(),{txIds:[],signedTxs:w}}else{let g=[];for(let h=0;h<w.length;h+=1){let k=await this.connection.sendTransaction(w[h],{skipPreflight:y});g.push(k)}return{txIds:g,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var l;let c=e||{},{computeBudgetConfig:t}=c,n=_e(c,["computeBudgetConfig"]),i=t?Nn(t):{instructions:[],instructionTypes:[]},o=this.signers.reduce((m,d)=>Q(G({},m),{[d.publicKey.toBase58()]:d}),{}),s=[],a=[],u=[];if(this.allInstructions.forEach(m=>{let d=[...u,m],p=t?[...i.instructions,...d]:d,f=[...new Set(d.map(w=>w.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(w=>new $t(w));if(u.length<12&&Yt({instructions:p,payer:this.feePayer,signers:f})||Yt({instructions:d,payer:this.feePayer,signers:f}))u.push(m);else{if(u.length===0)throw Error("item ins too big");Yt({instructions:t?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:f})?s.push(new Jt().add(...i.instructions,...u)):s.push(new Jt().add(...u)),a.push(Array.from(new Set(u.map(w=>w.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat())).map(w=>o[w]).filter(w=>w!==void 0)),u=[m]}}),u.length>0){let d=[...new Set(u.map(p=>p.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(p=>o[p]).filter(p=>p!==void 0);Yt({instructions:t?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:d.map(p=>p.publicKey)})?s.push(new Jt().add(...i.instructions,...u)):s.push(new Jt().add(...u)),a.push(d)}return s.forEach(m=>m.feePayer=this.feePayer),(l=this.owner)!=null&&l.signer&&a.forEach(m=>{m.some(d=>d.publicKey.equals(this.owner.publicKey))||m.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async m=>{var g;let{sequentially:d,onTxUpdate:p,recentBlockHash:y,skipPreflight:f=!0}=m||{},w=y!=null?y:await Mt(this.connection,this.blockhashCommitment);if(s.forEach(async(h,k)=>{h.recentBlockhash=w,a[k].length&&h.sign(...a[k])}),ft(s),(g=this.owner)!=null&&g.isKeyPair){if(d){let h=[];for(let k of s){let A=await dr(this.connection,k,this.signers.find(I=>I.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f});h.push(A)}return{txIds:h,signedTxs:s}}return{txIds:await Promise.all(s.map(async h=>await this.connection.sendRawTransaction(h.serialize(),{skipPreflight:f}))),signedTxs:s}}if(this.signAllTransactions){let h=await this.signAllTransactions(s);if(d){let k=0,A=[],I=async()=>{if(!h[k])return;let P=await this.connection.sendRawTransaction(h[k].serialize(),{skipPreflight:f});A.push({txId:P,status:"sent",signedTx:h[k]}),p==null||p([...A]),k++,this.connection.onSignature(P,N=>{let x=A.findIndex(C=>C.txId===P);x>-1&&(A[x].status=N.err?"error":"success"),p==null||p([...A]),N.err||I()},"processed"),this.connection.getSignatureStatus(P)};return await I(),{txIds:A.map(P=>P.txId),signedTxs:h}}else{let k=[];for(let A=0;A<h.length;A+=1){let I=await this.connection.sendRawTransaction(h[A].serialize(),{skipPreflight:f});k.push(I)}return{txIds:k,signedTxs:h}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuildV0(e){var g;let w=e||{},{computeBudgetConfig:t,lookupTableCache:n={},lookupTableAddress:i=[]}=w,o=_e(w,["computeBudgetConfig","lookupTableCache","lookupTableAddress"]),s=G(G({},this.cluster==="devnet"?{}:Mn),n),a=Array.from(new Set([...this.lookupTableAddress,...i])),u=[];for(let h of a)s[h]===void 0&&u.push(new $t(h));let c=await mr({connection:this.connection,address:u});for(let[h,k]of Object.entries(c))s[h]=k;let l=t?Nn(t):{instructions:[],instructionTypes:[]},m=await Mt(this.connection,this.blockhashCommitment),d=this.signers.reduce((h,k)=>Q(G({},h),{[k.publicKey.toBase58()]:k}),{}),p=[],y=[],f=[];if(this.allInstructions.forEach(h=>{let k=[...f,h],A=t?[...l.instructions,...k]:k;if(f.length<12&&Qt({instructions:A,payer:this.feePayer,lookupTableAddressAccount:s})||Qt({instructions:k,payer:this.feePayer,lookupTableAddressAccount:s}))f.push(h);else{if(f.length===0)throw Error("item ins too big");let I={};for(let P of[...new Set(a)])s[P]!==void 0&&(I[P]=s[P]);if(t&&Qt({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let P=new en({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new tn(P))}else{let P=new en({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new tn(P))}y.push(Array.from(new Set(f.map(P=>P.keys.filter(N=>N.isSigner).map(N=>N.pubkey.toString())).flat())).map(P=>d[P]).filter(P=>P!==void 0)),f=[h]}}),f.length>0){let k=[...new Set(f.map(A=>A.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat()).values()].map(A=>d[A]).filter(A=>A!==void 0);if(t&&Qt({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let A=new en({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new tn(A))}else{let A=new en({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new tn(A))}y.push(k)}return(g=this.owner)!=null&&g.signer&&y.forEach(h=>{h.some(k=>k.publicKey.equals(this.owner.publicKey))||h.push(this.owner.signer)}),{builder:this,transactions:p,buildProps:e,signers:y,instructionTypes:this.instructionTypes,execute:async h=>{var N;let{sequentially:k,onTxUpdate:A,recentBlockHash:I,skipPreflight:P=!0}=h||{};if(p.map(async(x,C)=>{y[C].length&&x.sign(y[C]),I&&(x.message.recentBlockhash=I)}),ft(p),(N=this.owner)!=null&&N.isKeyPair){if(k){let x=[];for(let C of p){let E=await this.connection.sendTransaction(C,{skipPreflight:P});await Rn(this.connection,E),x.push(E)}return{txIds:x,signedTxs:p}}return{txIds:await Promise.all(p.map(async x=>await this.connection.sendTransaction(x,{skipPreflight:P}))),signedTxs:p}}if(this.signAllTransactions){let x=await this.signAllTransactions(p);if(k){let C=0,E=[],O=async()=>{if(!x[C])return;let re=await this.connection.sendTransaction(x[C],{skipPreflight:P});E.push({txId:re,status:"sent",signedTx:x[C]}),A==null||A([...E]),C++,this.connection.onSignature(re,Z=>{let ue=E.findIndex(te=>te.txId===re);ue>-1&&(E[ue].status=Z.err?"error":"success"),A==null||A([...E]),Z.err||O()},"processed"),this.connection.getSignatureStatus(re)};return O(),{txIds:[],signedTxs:x}}else{let C=[];for(let E=0;E<x.length;E+=1){let O=await this.connection.sendTransaction(x[E],{skipPreflight:P});C.push(O)}return{txIds:C,signedTxs:x}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}};import{MINT_SIZE as Gm,TOKEN_PROGRAM_ID as Um,getTransferFeeConfig as Xm,unpackMint as zm}from"@solana/spl-token";var pr=ae("Raydium_accountInfo_util");async function Je(r,e,t){let{batchRequest:n,commitment:i="confirmed",chunkCount:o=100}=G({batchRequest:!1},t),s=lr(e,o),a=new Array(s.length).fill([]);if(n){let u=s.map(m=>{let d=r._buildArgs([m.map(p=>p.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:d}}),c=lr(u,10);a=(await(await Promise.all(c.map(async m=>await r._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&pr.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:p,executable:y,lamports:f,owner:w,rentEpoch:g}=d;return p.length!==2&&p[1]!=="base64"&&pr.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:y,lamports:f,owner:new ta(w),rentEpoch:g}}return null})))}else try{a=await Promise.all(s.map(u=>r.getMultipleAccountsInfo(u,i)))}catch(u){u instanceof Error&&pr.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}async function bt(r,e,t){let n=await Je(r,e.map(i=>i.pubkey),t);return e.map((i,o)=>Q(G({},i),{accountInfo:n[o]}))}import{PublicKey as la}from"@solana/web3.js";import Ki,{isBN as Li}from"bn.js";import{bits as Qm,BitStructure as Zm,blob as na,Blob as jm,cstr as $m,f32 as Jm,f32be as ed,f64 as td,f64be as nd,greedy as rd,Layout as ra,ns64 as id,ns64be as od,nu64 as sd,nu64be as ad,offset as ud,s16 as cd,s16be as ld,s24 as md,s24be as dd,s32 as ia,s32be as pd,s40 as fd,s40be as bd,s48 as yd,s48be as gd,s8 as wd,seq as oa,struct as kd,Structure as sa,u16 as aa,u16be as hd,u24 as Ad,u24be as Pd,u32 as Td,u32be as xd,u40 as Id,u40be as Bd,u48 as Sd,u48be as Kd,u8 as ua,UInt as ca,union as Ld,Union as Nd,unionLayoutDiscriminator as Rd,utf8 as Cd}from"@solana/buffer-layout";var fr=ra,Ii=sa;var br=ca;var Bi=ua,nn=aa;var Ae=ia;var Si=oa;var Ie=na;var yt=class extends fr{constructor(t,n,i){super(t,i);this.blob=Ie(t),this.signed=n}decode(t,n=0){let i=new Ki(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new Ki(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function F(r){return new br(1,r)}function Ce(r){return new br(4,r)}function b(r){return new yt(8,!1,r)}function q(r){return new yt(16,!1,r)}function Ni(r){return new yt(1,!0,r)}function vt(r){return new yt(8,!0,r)}function Ri(r){return new yt(16,!0,r)}var En=class extends fr{constructor(t,n,i,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function K(r){return new En(Ie(32),e=>new la(e),e=>e.toBuffer(),r)}function Me(r){return new En(Bi(),ma,da,r)}function ma(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function da(r){return r?1:0}var yr=class extends Ii{decode(e,t){return super.decode(e,t)}};function R(r,e,t){return new yr(r,e,t)}function D(r,e,t){let n,i=typeof e=="number"?e:Li(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=Li(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return Si(r,i,t)}import{PublicKey as Ci}from"@solana/web3.js";var jd=ae("Raydium_farm_config"),$d=new Ci("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Jd=new Ci("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1");var Mi={3:wr,5:vi,6:Ei};var _n={"Standard SPL":0,"Option tokens":1},gr={[Ai.toString()]:3,[Pi.toString()]:5,[Ti.toString()]:6};var kr=R([F("instruction")]),ya=R([F("instruction")]),ga=R([b("rewardState"),b("rewardOpenTime"),b("rewardEndTime"),b("rewardLastUpdateTime"),b("totalReward"),b("totalRewardEmissioned"),b("rewardClaimed"),b("rewardPerSecond"),q("accRewardPerShare"),K("rewardVault"),K("rewardMint"),K("rewardSender"),b("rewardType"),D(b(),15,"padding")]),wa=R([b("state"),b("nonce"),K("lpVault"),K("rewardVault"),K(),K(),b(),b(),b("totalReward"),q("perShareReward"),b("lastSlot"),b("perSlotReward")]),ka=R([b("state"),b("nonce"),K("lpVault"),K("rewardVaultA"),b("totalRewardA"),q("perShareRewardA"),b("perSlotRewardA"),F("option"),K("rewardVaultB"),Ie(7),b("totalRewardB"),q("perShareRewardB"),b("perSlotRewardB"),b("lastSlot"),K()]),ha=R([b(),b("state"),b("nonce"),b("validRewardTokenNum"),q("rewardMultiplier"),b("rewardPeriodMax"),b("rewardPeriodMin"),b("rewardPeriodExtend"),K("lpMint"),K("lpVault"),D(ga,5,"rewardInfos"),K("creator"),K(),D(b(),32,"padding")]),pa=new Proxy(wa,{get(r,e,t){return e==="decode"?(...n)=>{let i=r.decode(...n);return Q(G({},i),{version:3,rewardInfos:[{rewardVault:i.rewardVault,totalReward:i.totalReward,perSlotReward:i.perSlotReward,perShareReward:i.perShareReward}]})}:Reflect.get(r,e,t)}}),fa=new Proxy(ka,{get(r,e,t){return e==="decode"?(...n)=>{let i=r.decode(...n);return Q(G({},i),{version:5,rewardInfos:[{rewardVault:i.rewardVaultA,totalReward:i.totalRewardA,perSlotReward:i.perSlotRewardA,perShareReward:i.perShareRewardA},{rewardVault:i.rewardVaultB,totalReward:i.totalRewardB,perSlotReward:i.perSlotRewardB,perShareReward:i.perShareRewardB}]})}:Reflect.get(r,e,t)}}),ba=new Proxy(ha,{get(r,e,t){return e==="decode"?(...n)=>{let i=r.decode(...n);return Q(G({},i),{version:6,rewardInfos:i.rewardInfos.map(o=>{var s;return Q(G({},o),{rewardType:((s=Object.entries(_n).find(a=>String(a[1])===o.rewardType.toString()))!=null?s:["Standard SPL"])[0]})})})}:Reflect.get(r,e,t)}}),Aa=R([b("isSet"),b("rewardPerSecond"),b("rewardOpenTime"),b("rewardEndTime"),b("rewardType")]),Pa=R([F("instruction"),b("nonce"),D(Aa,5,"rewardTimeInfo")]),Ta=R([F("instruction"),b("rewardReopenTime"),b("rewardEndTime"),b("rewardPerSecond")]),xa=R([F("instruction"),b("isSet"),b("rewardPerSecond"),b("rewardOpenTime"),b("rewardEndTime"),b("rewardType")]),sp=R([b("state"),K("id"),K("owner"),b("deposited"),D(b(),1,"rewardDebts")]),wr=R([b("state"),K("id"),K("owner"),b("deposited"),D(q(),1,"rewardDebts"),b(""),b("voteLockedBalance"),D(b(),15)]),ap=R([b("state"),K("id"),K("owner"),b("deposited"),D(b(),2,"rewardDebts")]),vi=R([b("state"),K("id"),K("owner"),b("deposited"),D(q(),2,"rewardDebts"),D(b(),17)]),Ei=R([b(),b("state"),K("id"),K("owner"),b("deposited"),D(q(),5,"rewardDebts"),D(b(),16)]),gt=R([F("instruction"),b("amount")]),Ia=R([K("mint"),K("grantAuthority"),b("baselineVoteWeightScaledFactor"),b("maxExtraLockupVoteWeightScaledFactor"),b("lockupSaturationSecs"),Ni("digitShift"),D(F(),7,"reserved1"),D(b(),7,"reserved2")]),Ba=R([Ie(8),K("governanceProgramId"),K("realm"),K("realmGoverningTokenMint"),K("realmAuthority"),D(F(),32,"reserved1"),D(Ia,4,"votingMints"),vt("timeOffset"),F("bump"),D(F(),7,"reserved2"),D(b(),11,"reserved3")]),Sa=R([vt("startTime"),vt("endTime"),F("kind"),D(F(),15,"reserved")]),Ka=R([D(Sa,1,"lockup"),b("amountDeposited_native"),b("amountInitiallyLockedNative"),Me("isUsed"),Me("allowClawback"),F("votingMintConfigIdx"),D(F(),29,"reserved")]),La=R([Ie(8),K("voterAuthority"),K("registrar"),D(Ka,32,"deposits"),F("voterBump"),F("voterWweightRecordBump"),D(F(),94,"reserved")]);import bp from"bn.js";var Na=R([K("mint"),K("owner"),b("amount"),Ce("delegateOption"),K("delegate"),F("state"),Ce("isNativeOption"),b("isNative"),b("delegatedAmount"),Ce("closeAuthorityOption"),K("closeAuthority")]);var Ra=ae("Raydium.farm.util");function Et({programId:r,poolId:e,owner:t,version:n}){let{publicKey:i}=de([e.toBuffer(),t.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],r);return i}function _i(r){let e=Mi[r];return e||Ra.logWithError("invalid version",r),e}import{PublicKey as Be,SystemProgram as Ca,SYSVAR_CLOCK_PUBKEY as Fi,SYSVAR_RENT_PUBKEY as Ma,TransactionInstruction as Fn}from"@solana/web3.js";import Wp from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Gp,createAssociatedTokenAccountInstruction as Up,TOKEN_PROGRAM_ID as hr}from"@solana/spl-token";var va=ae("Raydium_farm_instruction"),tf={voterStakeRegistryCreateVoter:Buffer.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:Buffer.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:Buffer.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:Buffer.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:Buffer.from([45,185,3,36,109,190,115,169])};function Oi(r){let{version:e,id:t,ledger:n,programId:i,owner:o}=r,s={3:9,5:10}[e];s||va.logWithError(`invalid farm pool version: ${e}`);let a=Buffer.alloc(kr.span);kr.encode({instruction:s},a);let u=[T({pubkey:t}),T({pubkey:n}),T({pubkey:o,isWritable:!1}),T({pubkey:Ca.programId,isWritable:!1}),T({pubkey:Ma,isWritable:!1})];return{instruction:new Fn({programId:i,keys:u,data:a}),instructionType:J.FarmV3CreateLedger}}function Vi(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s}=r,[a,u]=[new Be(e.programId),new Be(e.id)],c=Et({programId:a,poolId:u,owner:o,version:6}),l=Buffer.alloc(gt.span);gt.encode({instruction:2,amount:$(s)},l);let m=[T({pubkey:hr,isWritable:!1}),T({pubkey:u}),T({pubkey:new Be(t.authority),isWritable:!1}),T({pubkey:new Be(t.lpVault)}),T({pubkey:c}),T({pubkey:o,isWritable:!1,isSigner:!0}),T({pubkey:n})];for(let d=0;d<t.rewardInfos.length;d++)m.push(T({pubkey:new Be(t.rewardInfos[d].vault)})),m.push(T({pubkey:i[d]}));return new Fn({programId:a,keys:m,data:l})}function Di(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s,userAuxiliaryLedgers:a}=r,[u,c]=[new Be(e.programId),new Be(e.id)],l=Et({programId:u,poolId:c,owner:o,version:5}),m=Buffer.alloc(gt.span);gt.encode({instruction:12,amount:$(s)},m);let d=[T({pubkey:c}),T({pubkey:new Be(t.authority),isWritable:!1}),T({pubkey:l}),T({pubkey:o,isWritable:!1,isSigner:!0}),T({pubkey:n}),T({pubkey:new Be(t.lpVault)}),T({pubkey:i[0]}),T({pubkey:new Be(t.rewardInfos[0].vault)}),T({pubkey:Fi,isWritable:!1}),T({pubkey:hr,isWritable:!1})];for(let p=1;p<t.rewardInfos.length;p++)d.push(T({pubkey:i[p]})),d.push(T({pubkey:new Be(t.rewardInfos[p].vault)}));if(a)for(let p of a)d.push(T({pubkey:p}));return new Fn({programId:u,keys:d,data:m})}function Wi(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s,userAuxiliaryLedgers:a}=r,[u,c]=[new Be(e.programId),new Be(e.id)],l=Et({programId:u,poolId:c,owner:o,version:3}),m=Buffer.alloc(gt.span);gt.encode({instruction:11,amount:$(s)},m);let d=[T({pubkey:c}),T({pubkey:new Be(t.authority),isWritable:!1}),T({pubkey:l}),T({pubkey:o,isWritable:!1,isSigner:!0}),T({pubkey:n}),T({pubkey:new Be(t.lpVault)}),T({pubkey:i[0]}),T({pubkey:new Be(t.rewardInfos[0].vault)}),T({pubkey:Fi,isWritable:!1}),T({pubkey:hr,isWritable:!1})];if(a)for(let p of a)d.push(T({pubkey:p}));return new Fn({programId:u,keys:d,data:m})}import{Keypair as Lr,PublicKey as L,SystemProgram as _t,TransactionInstruction as Ee}from"@solana/web3.js";import io from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as oo,TOKEN_2022_PROGRAM_ID as nt,TOKEN_PROGRAM_ID as be}from"@solana/spl-token";import Xa from"bn.js";import Ve from"bn.js";var fe=new Ve(0),Ye=new Ve(1),et=new Ve(-1),ve=new Ve(1).shln(64),On=new Ve(1).shln(128),Ar=ve.sub(Ye),rn=64,qi=On.subn(1),Se=-443636,Le=-Se,wt=new Ve("4295048016"),kt=new Ve("79226673521066979257578248091"),df=new Ve("4295048017"),pf=new Ve("79226673521066979257578248090"),Gi=16,Ui="59543866431248",Xi="184467440737095516",zi="15793534762490258745",Vn=new Ve(10).pow(new Ve(6));var ff=new Ve("18446744073700000000");import Y from"bn.js";function Dn(r){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,r,!1),new Uint8Array(e)}function Pr(r,e){let t=0;for(let n=r-1;n>=0&&!e.testn(n);n--)t++;return t}function Tr(r,e){let t=0;for(let n=0;n<r&&!e.testn(n);n++)t++;return t}function on(r,e){for(let t=0;t<r;t++)if(e.testn(t))return!1;return!0}function Hi(r,e){return on(r,e)?null:Pr(r,e)}function Yi(r,e){return on(r,e)?null:Tr(r,e)}var hf=Buffer.from("amm_config","utf8"),Ea=Buffer.from("pool","utf8"),_a=Buffer.from("pool_vault","utf8"),Fa=Buffer.from("pool_reward_vault","utf8"),Qi=Buffer.from("position","utf8"),Oa=Buffer.from("tick_array","utf8"),Va=Buffer.from("operation","utf8"),Da=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Wa=Buffer.from("observation","utf8");function Zi(r,e,t,n){return de([Ea,e.toBuffer(),t.toBuffer(),n.toBuffer()],r)}function xr(r,e,t){return de([_a,e.toBuffer(),t.toBuffer()],r)}function ji(r,e,t){return de([Fa,e.toBuffer(),t.toBuffer()],r)}function oe(r,e,t){return de([Oa,e.toBuffer(),Dn(t)],r)}function mt(r,e,t,n){return de([Qi,e.toBuffer(),Dn(t),Dn(n)],r)}function De(r,e){return de([Qi,e.toBuffer()],r)}function Wn(r){return de([Buffer.from("metadata","utf8"),Rt.toBuffer(),r.toBuffer()],Rt)}function Ir(r){return de([Va],r)}function We(r,e){return de([Da,e.toBuffer()],r)}function $i(r,e){return de([Wa,e.toBuffer()],r)}var qa=Buffer.from("locked_position","utf8");function Br(r,e){return de([qa,e.toBuffer()],r)}import{PublicKey as Xe}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Ji}from"@solana/spl-token";import ce from"bn.js";import Qe from"bn.js";var sn=class{static getfeeGrowthInside(e,t,n){let i=new Qe(0),o=new Qe(0);e.tickCurrent>=t.tick?(i=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new Qe(0),a=new Qe(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=H.wrappingSubU128(H.wrappingSubU128(e.feeGrowthGlobalX64A,i),s),c=H.wrappingSubU128(H.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),a=H.mulDivFloor(H.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,ve),u=t.tokenFeesOwedA.add(a),c=H.mulDivFloor(H.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,ve),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),a=H.mulDivFloor(H.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,ve),u=t.tokenFeesOwedA.add(a),c=H.mulDivFloor(H.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,ve),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,i){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=H.wrappingSubU128(u,c.growthInsideLastX64),m=H.mulDivFloor(l,t.liquidity,ve),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,i){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=H.wrappingSubU128(u,c.growthInsideLastX64),m=H.mulDivFloor(l,t.liquidity,ve),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let a=new Qe(0);t.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<t.tick?a=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new Qe(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(H.wrappingSubU128(H.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let a=new Qe(0);t.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<t.tick?a=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new Qe(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(H.wrappingSubU128(H.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:i,add:o,epochInfo:s}){var w,g,h,k;let a=z.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),u=z.getSqrtPriceX64FromTick(t.tickLower),c=z.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+i:1-i,m=ne.getAmountsFromLiquidity(a,u,c,n,o),[d,p]=[pe(m.amountA,(w=e.mintA.extensions)==null?void 0:w.feeConfig,s,!0),pe(m.amountB,(g=e.mintB.extensions)==null?void 0:g.feeConfig,s,!0)],[y,f]=[pe(new Qe(new S(m.amountA.toString()).mul(l).toFixed(0)),(h=e.mintA.extensions)==null?void 0:h.feeConfig,s,!0),pe(new Qe(new S(m.amountB.toString()).mul(l).toFixed(0)),(k=e.mintB.extensions)==null?void 0:k.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:p,amountSlippageA:y,amountSlippageB:f,expirationTime:lt(d.expirationTime,p.expirationTime)}}};var Ga=15,ee=class{static async getTickArrays(e,t,n,i,o,s,a){let u=[],c=_.getTickArrayStartIndexByTick(i,o),l=_.getInitializedTickArrayInRange(s,a,o,c,Math.floor(Ga/2));for(let p=0;p<l.length;p++){let{publicKey:y}=oe(t,n,l[p]);u.push(y)}let m=(await Je(e,u)).map(p=>p!==null?an.decode(p.data):null),d={};for(let p=0;p<u.length;p++){let y=m[p];y!==null&&(d[y.startTickIndex]=Q(G({},y),{address:u[p]}))}return d}static nextInitializedTick(e,t,n,i,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,i,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=_.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:p}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,d,p]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,i,o){let s=Math.floor(e/ee.tickCount(t)),a=n?_.searchLowBitFromStart(i,o,s-1,1,t):_.searchHightBitFromStart(i,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,i){let o;if(i){let a=ge-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<ge;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=oe(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,i,o,s){let a=_.getTickArrayStartIndexByTick(i,o),u=Math.floor((i-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u-1}else for(u=u+1;u<ge;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u+1}let{publicKey:m}=oe(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(_.checkIsOutOfBoundary(e)){if(e>Le)return!1;let n=_.getTickArrayStartIndexByTick(Se,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return ge*e}};var Sr=14,tt=class{static maxTickInTickarrayBitmap(e){return e*ge*ht}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(i+=1);let o=n*i;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,i){if(!ee.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=i?t-ee.tickCount(n):t+ee.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*ge,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(i){let l=e.shln(1024-c-1),m=Hi(1024,l);if(m!==null){let d=(c-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=Yi(1024,l);if(m!==null){let d=(c+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-ee.tickCount(n)}}}},un=class{static getBitmapOffset(e,t){if(!ee.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=tt.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&i--,i}static getBitmap(e,t,n){let i=this.getBitmapOffset(e,t);return e<0?{offset:i,tickarrayBitmap:n.negativeTickArrayBitmap[i]}:{offset:i,tickarrayBitmap:n.positiveTickArrayBitmap[i]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:i}=this.extensionTickBoundary(t);if(e>=i&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=tt.maxTickInTickarrayBitmap(e),n=-t;if(Le<=t)throw Error(`extensionTickBoundary check error: ${Le}, ${t}`);if(n<=Se)throw Error(`extensionTickBoundary check error: ${n}, ${Se}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:i}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:_.mergeTickArrayBitmap(i).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,i){let o=ee.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,i);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,i){let{minValue:o,maxValue:s}=tt.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(i){let u=_.mergeTickArrayBitmap(e).shln(ht-1-a),c=on(512,u)?null:Pr(512,u);if(c!==null){let l=t-c*ee.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=_.mergeTickArrayBitmap(e).shrn(a),c=on(512,u)?null:Tr(512,u);if(c!==null){let l=t+c*ee.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-ee.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%tt.maxTickInTickarrayBitmap(t),i=Math.floor(n/ee.tickCount(t));return e<0&&n!=0&&(i=ht-i),i}};var Pe=class{static getOutputAmountAndRemainAccounts(e,t,n,i,o,s=!1){let a=n.toBase58()===e.mintA.address,u=[],{isExist:c,startIndex:l,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,a);if(!c||l===void 0||!m)throw new Error("Invalid tick array");u.push(m);let{allTrade:d,amountCalculated:p,accounts:y,sqrtPriceX64:f,feeAmount:w}=At.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i,l,o,s);return u.push(...y),{allTrade:d,expectedAmountOut:p.mul(et),remainingAccounts:u,executionPrice:f,feeAmount:w}}static getInputAmountAndRemainAccounts(e,t,n,i,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:w}=oe(e.programId,e.id,f.nextStartIndex);a.push(w)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:y}=At.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i.mul(et),c,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:p,feeAmount:y}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:i}=Pe.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?un.checkTickArrayIsInit(ee.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):_.checkTickArrayIsInitialized(_.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=oe(e.programId,e.id,i);return{isExist:!0,startIndex:i,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,ee.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=oe(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/ee.tickCount(e.tickSpacing)),i=t?_.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):_.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return i.length>0?{isExist:!0,nextStartIndex:i[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=ee.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:i,tickIndex:o}=tt.nextInitializedTickArrayStartIndex(_.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(i)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=un.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Se||t>Le)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:i,rewardInfos:o}){var a,u,c;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(c=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(d===void 0)throw Error("get new reward mint info error");let p=Q(G({},m),{perSecond:H.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Xe(d)});if(p.tokenMint.equals(Xe.default))continue;if(n<=p.openTime.toNumber()||i.eq(fe)){s.push(p);continue}let y=new ce(Math.min(p.endTime.toNumber(),n)),f=y.sub(p.lastUpdateTime),w=H.mulDivFloor(f,p.emissionsPerSecondX64,i),g=p.rewardGrowthGlobalX64.add(w),h=H.mulDivFloor(f,p.emissionsPerSecondX64,ve),k=p.rewardTotalEmissioned.add(h);s.push(Q(G({},p),{rewardGrowthGlobalX64:g,rewardTotalEmissioned:k,lastUpdateTime:y}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:i}=this.tickRange(e);for(let o of t){let s=_.getTickArrayStartIndexByTick(o,e);if(s>=n||s<i)return!0}return!1}static tickRange(e){let t=tt.maxTickInTickarrayBitmap(e),n=-t;return t>Le&&(t=ee.getArrayStartIndex(Le,e)+ee.tickCount(e)),n<Se&&(n=ee.getArrayStartIndex(Se,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!ee.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/ee.tickCount(t)*ht}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let i=await bt(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of i)s.accountInfo!==null&&(o[s.pubkey.toString()]=no.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let i={},o=[];for(let u of t){let c=_.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=_.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:d}=oe(u.programId,u.id,m);o.push({pubkey:d}),i[d.toString()]=u.id}}let s=await bt(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=i[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=an.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]=Q(G({},l),{address:u.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:i=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(l=>l.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(d=>d.accountInfo.mint),c=[];for(let d of u)for(let p of s)c.push(De(p,d).publicKey);let l=await Je(t,c,{batchRequest:i}),m={};for(let d of l){if(d===null)continue;let p=to.decode(d.data),y=p.poolId.toString(),f=e.find(x=>x.state.id.toBase58()===y);if(f===void 0)continue;let w=f.state,g=_._getTickPriceLegacy({poolInfo:w,tick:p.tickLower,baseIn:!0}),h=_._getTickPriceLegacy({poolInfo:w,tick:p.tickUpper,baseIn:!0}),{amountA:k,amountB:A}=ne.getAmountsFromLiquidity(w.sqrtPriceX64,g.tickSqrtPriceX64,h.tickSqrtPriceX64,p.liquidity,!1),I=1/(1-Math.sqrt(Math.sqrt(g.price.div(h.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:p.poolId,nftMint:p.nftMint,priceLower:g.price,priceUpper:h.price,amountA:k,amountB:A,tickLower:p.tickLower,tickUpper:p.tickUpper,liquidity:p.liquidity,feeGrowthInsideLastX64A:p.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:p.feeGrowthInsideLastX64B,tokenFeesOwedA:p.tokenFeesOwedA,tokenFeesOwedB:p.tokenFeesOwedB,rewardInfos:p.rewardInfos.map(x=>Q(G({},x),{pendingReward:new ce(0)})),leverage:I,tokenFeeAmountA:new ce(0),tokenFeeAmountB:new ce(0)}];let P=await _.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickLower,f.state.tickSpacing),N=await _.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickUpper,f.state.tickSpacing);m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickLower}`]=P,m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickUpper}`]=N}if(o){let d=Object.values(m),p=await Je(t,d,{batchRequest:i}),y={};for(let f=0;f<d.length;f++){let w=p[f];if(w===null)continue;let g=d[f].toString();y[g]=an.decode(w.data)}for(let{state:f,positionAccount:w}of e)if(!!w)for(let g of w){let h=`${f.programId.toString()}-${f.id.toString()}-${g.tickLower}`,k=`${f.programId.toString()}-${f.id.toString()}-${g.tickUpper}`,A=y[m[h].toString()],I=y[m[k].toString()],P=A.ticks[_.getTickOffsetInArray(g.tickLower,f.tickSpacing)],N=I.ticks[_.getTickOffsetInArray(g.tickUpper,f.tickSpacing)],{tokenFeeAmountA:x,tokenFeeAmountB:C}=await sn.GetPositionFees(f,g,P,N),E=await sn.GetPositionRewards(f,g,P,N);g.tokenFeeAmountA=x.gte(new ce(0))?x:new ce(0),g.tokenFeeAmountB=C.gte(new ce(0))?C:new ce(0);for(let O=0;O<E.length;O++)g.rewardInfos[O].pendingReward=E[O].gte(new ce(0))?E[O]:new ce(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountIn:o,slippage:s,priceLimit:a=new S(0),catchLiquidityInsufficient:u=!1}){var re;let c,l=n.toBase58()===e.mintA.address,[m,d]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new S(0))?c=l?wt.add(new ce(1)):kt.sub(new ce(1)):c=z.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let p=pe(o,m,i,!1),{allTrade:y,expectedAmountOut:f,remainingAccounts:w,executionPrice:g,feeAmount:h}=Pe.getOutputAmountAndRemainAccounts(e,t,n,p.amount.sub((re=p.fee)!=null?re:fe),c,u),k=pe(f,d,i,!1),A=z.sqrtPriceX64ToPrice(g,e.mintA.decimals,e.mintB.decimals),I=l?A:new S(1).div(A),P=f.mul(new ce(Math.floor((1-s)*1e10))).div(new ce(1e10)),N=pe(P,d,i,!1),x=l?e.currentPrice:new S(1).div(e.currentPrice),C=new S(I).sub(x).abs(),E=x,O=new Fe(new S(C).mul(10**15).toFixed(0),new S(E).mul(10**15).toFixed(0));return{allTrade:y,realAmountIn:p,amountOut:k,minAmountOut:N,expirationTime:lt(p.expirationTime,k.expirationTime),currentPrice:e.currentPrice,executionPrice:I,priceImpact:O,fee:h,remainingAccounts:w,executionPriceX64:g}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:i,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let u=i.address===e.mintB.address,[c,l]=u?[e.mintA,e.mintB]:[e.mintB,e.mintA],[m,d]=[new xe(Q(G({},c),{mint:c.address,isToken2022:c.programId===Ji.toBase58()})),new xe(Q(G({},l),{mint:l.address,isToken2022:l.programId===Ji.toBase58()}))],{allTrade:p,realAmountIn:y,amountOut:f,minAmountOut:w,expirationTime:g,currentPrice:h,executionPrice:k,priceImpact:A,fee:I,remainingAccounts:P,executionPriceX64:N}=Pe.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Xe(c.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),x=Q(G({},y),{amount:new me(m,y.amount),fee:y.fee===void 0?void 0:new me(m,y.fee)}),C=Q(G({},f),{amount:new me(d,f.amount),fee:f.fee===void 0?void 0:new me(d,f.fee)}),E=Q(G({},w),{amount:new me(d,w.amount),fee:w.fee===void 0?void 0:new me(d,w.fee)}),O=new Oe({baseToken:m,denominator:new ce(10).pow(new ce(20+m.decimals)),quoteToken:d,numerator:h.mul(new S(10**(20+d.decimals))).toFixed(0)}),re=new Oe({baseToken:m,denominator:new ce(10).pow(new ce(20+m.decimals)),quoteToken:d,numerator:k.mul(new S(10**(20+d.decimals))).toFixed(0)}),Z=new me(m,I);return{allTrade:p,realAmountIn:x,amountOut:C,minAmountOut:E,expirationTime:g,currentPrice:O,executionPrice:re,priceImpact:A,fee:Z,remainingAccounts:P,executionPriceX64:N}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountOut:o,slippage:s,priceLimit:a=new S(0)}){var E;let u=n.toBase58()===e.mintA.address,c={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;a.equals(new S(0))?l=u?kt.sub(new ce(1)):wt.add(new ce(1)):l=z.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let m=pe(o,c[n.toString()],i,!0),{expectedAmountIn:d,remainingAccounts:p,executionPrice:y,feeAmount:f}=Pe.getInputAmountAndRemainAccounts(e,t,n,m.amount.sub((E=m.fee)!=null?E:fe),l),w=u?e.mintB.address:e.mintA.address,g=pe(d,c[w],i,!1),h=z.sqrtPriceX64ToPrice(y,e.mintA.decimals,e.mintB.decimals),k=u?h:new S(1).div(h),A=d.mul(new ce(Math.floor((1+s)*1e10))).div(new ce(1e10)),I=pe(A,c[w],i,!0),P=u?e.currentPrice:new S(1).div(e.currentPrice),N=new S(k).sub(P).abs(),x=P,C=new Fe(new S(N).mul(10**15).toFixed(0),new S(x).mul(10**15).toFixed(0));return{amountIn:g,maxAmountIn:I,realAmountOut:m,expirationTime:lt(g.expirationTime,m.expirationTime),currentPrice:e.currentPrice,executionPrice:k,priceImpact:C,fee:f,remainingAccounts:p}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:i}){var y,f,w;let o=e[t],s=_.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=_.getTickPrice({poolInfo:e,tick:i,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,d=o.priceMax-o.priceMin,p;return l<=0?p=0:m===l?p=d/l:d===l?p=l/m:p=l/d*(l/m),{feeApr:o.feeApr*p,rewardsApr:[((y=o.rewardApr[0])!=null?y:0)*p,((f=o.rewardApr[1])!=null?f:0)*p,((w=o.rewardApr[2])!=null?w:0)*p],apr:o.apr*p}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:i,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=i[Ct(e.mintA.address).toString()],d=i[Ct(e.mintB.address).toString()],p=e.mintA.decimals,y=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=z.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),w=z.getSqrtPriceX64FromTick(s),g=z.getSqrtPriceX64FromTick(a),{amountSlippageA:h,amountSlippageB:k}=ne.getAmountsFromLiquidityWithSlippage(f,w,g,t,!1,!1,0),{amountSlippageA:A,amountSlippageB:I}=ne.getAmountsFromLiquidityWithSlippage(f,w,g,o,!1,!1,0),P=new S(h.toString()).div(new S(10).pow(p)).mul(m.value).add(new S(k.toString()).div(new S(10).pow(y)).mul(d.value)),N=new S(A.toString()).div(new S(10).pow(p)).mul(m.value).add(new S(I.toString()).div(new S(10).pow(y)).mul(d.value)),x=new S(1).div(P.add(N)),E=new S(l.volumeFee).mul(365).div(c).mul(x).mul(100).toNumber(),O=3600*24*365,re=e.rewardDefaultInfos.map(Z=>{var U,dt;let ue=Z.mint.decimals,te=i[Z.mint.address];return u<((U=Z.startTime)!=null?U:0)||u>((dt=Z.endTime)!=null?dt:0)||!Z.perSecond||!te||ue===void 0?0:new S(te.value).mul(new S(Z.perSecond).mul(O)).div(new S(10).pow(ue)).mul(x).mul(100).toNumber()});return{feeApr:E,rewardsApr:re,apr:E+re.reduce((Z,ue)=>Z+ue,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:i,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var g,h;let l=z.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),m=z.getSqrtPriceX64FromTick(n),d=z.getSqrtPriceX64FromTick(i),p=a?1-s:1+s,y=pe(o,(g=e[t?"mintA":"mintB"].extensions)==null?void 0:g.feeConfig,u,!c),f=new ce(new S(y.amount.sub((h=y.fee)!=null?h:fe).toString()).mul(p).toFixed(0)),w;if(l.lte(m))w=t?ne.getLiquidityFromTokenAmountA(m,d,f,!a):new ce(0);else if(l.lte(d)){let k=ne.getLiquidityFromTokenAmountA(l,d,f,!a),A=ne.getLiquidityFromTokenAmountB(m,l,f);w=t?k:A}else w=t?new ce(0):ne.getLiquidityFromTokenAmountB(m,d,f);return Pe.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:i,liquidity:w,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:i,liquidity:o,slippage:s,add:a}){var w,g,h,k;let u=z.getSqrtPriceX64FromTick(n),c=z.getSqrtPriceX64FromTick(i),l=a?1+s:1-s,m=ne.getAmountsFromLiquidity(z.priceToSqrtPriceX64(new S(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[d,p]=[pe(m.amountA,(w=t.mintA.extensions)==null?void 0:w.feeConfig,e,!0),pe(m.amountB,(g=t.mintB.extensions)==null?void 0:g.feeConfig,e,!0)],[y,f]=[pe(m.amountA.muln(l),(h=t.mintA.extensions)==null?void 0:h.feeConfig,e,!0),pe(m.amountB.muln(l),(k=t.mintB.extensions)==null?void 0:k.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:p,amountSlippageA:y,amountSlippageB:f,expirationTime:lt(d.expirationTime,p.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let i=t.filter(u=>!n[u.id]).map(u=>new Xe(u.id));(await Je(e,i)).forEach((u,c)=>{!u||(n[i[c].toBase58()]=eo.decode(u.data))});let s=t.map(u=>We(new Xe(u.programId),new Xe(u.id)).publicKey),a=await Pe.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((u,c)=>Q(G({},u),{[c.id]:Q(G({},n[c.id]),{id:new Xe(c.id),version:6,programId:new Xe(c.programId),mintA:c.mintA,mintB:c.mintB,ammConfig:Q(G({},c.config),{id:new Xe(c.config.id),fundOwner:""}),currentPrice:new S(c.price),exBitmapInfo:a[We(new Xe(c.programId),new Xe(c.id)).publicKey.toBase58()],startTime:n[c.id].startTime.toNumber()})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var H=class{static mulDivRoundingUp(e,t,n){let i=e.mul(t),o=i.div(n);return i.mod(n).eq(fe)||(o=o.add(Ye)),o}static mulDivFloor(e,t,n){if(n.eq(fe))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(fe))throw new Error("division by 0");return e.mul(t).add(n.sub(Ye)).div(n)}static x64ToDecimal(e,t){return new S(e.toString()).div(S.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new Y(e.mul(S.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(On).sub(t).mod(On)}};function we(r,e){return Kr(r.mul(e),64,256)}function Ua(r,e,t){let n=r.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Kr(r,e,t){let n=r.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var z=class{static sqrtPriceX64ToPrice(e,t,n){return H.x64ToDecimal(e).pow(2).mul(S.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return H.decimalToX64(e.mul(S.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,i){if(!e.gt(fe))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(fe))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,i){if(!e.gt(fe))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(fe))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,i){if(n.eq(fe))return e;let o=t.shln(rn);if(i){let s=o,a=o.add(n.mul(e));return a.gte(s)?H.mulDivCeil(s,e,a):H.mulDivRoundingUp(s,Ye,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return H.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,i){let o=n.shln(rn);if(i)return e.add(o.div(t));{let s=H.mulDivRoundingUp(o,Ye,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Se||e>Le)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new Y("18445821805675395072"):new Y("18446744073709551616");return(t&2)!=0&&(n=we(n,new Y("18444899583751176192"))),(t&4)!=0&&(n=we(n,new Y("18443055278223355904"))),(t&8)!=0&&(n=we(n,new Y("18439367220385607680"))),(t&16)!=0&&(n=we(n,new Y("18431993317065453568"))),(t&32)!=0&&(n=we(n,new Y("18417254355718170624"))),(t&64)!=0&&(n=we(n,new Y("18387811781193609216"))),(t&128)!=0&&(n=we(n,new Y("18329067761203558400"))),(t&256)!=0&&(n=we(n,new Y("18212142134806163456"))),(t&512)!=0&&(n=we(n,new Y("17980523815641700352"))),(t&1024)!=0&&(n=we(n,new Y("17526086738831433728"))),(t&2048)!=0&&(n=we(n,new Y("16651378430235570176"))),(t&4096)!=0&&(n=we(n,new Y("15030750278694412288"))),(t&8192)!=0&&(n=we(n,new Y("12247334978884435968"))),(t&16384)!=0&&(n=we(n,new Y("8131365268886854656"))),(t&32768)!=0&&(n=we(n,new Y("3584323654725218816"))),(t&65536)!=0&&(n=we(n,new Y("696457651848324352"))),(t&131072)!=0&&(n=we(n,new Y("26294789957507116"))),(t&262144)!=0&&(n=we(n,new Y("37481735321082"))),e>0&&(n=qi.div(n)),n}static getTickFromPrice(e,t,n){return z.getTickFromSqrtPriceX64(z.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(kt)||e.lt(wt))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new Y(t-64),i=Ua(n,32,128),o=new Y("8000000000000000","hex"),s=0,a=new Y(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new Y(0))&&s<Gi;){u=u.mul(u);let y=u.shrn(127);u=u.shrn(63+y.toNumber()),a=a.add(o.mul(y)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=i.add(c).mul(new Y(Ui)),d=Kr(m.sub(new Y(Xi)),64,128).toNumber(),p=Kr(m.add(new Y(zi)),64,128).toNumber();return d==p?d:z.getSqrtPriceX64FromTick(p).lte(e)?p:d}},Pt=class{static getTickWithPriceAndTickspacing(e,t,n,i){let s=z.getTickFromSqrtPriceX64(z.priceToSqrtPriceX64(e,n,i))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,i){let o=Pt.getTickWithPriceAndTickspacing(e,t,n,i),s=z.getSqrtPriceX64FromTick(o);return z.sqrtPriceX64ToPrice(s,n,i)}},ne=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(fe))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(rn),s=t.sub(e);return i?H.mulDivRoundingUp(H.mulDivCeil(o,s,t),Ye,e):H.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(fe))throw new Error("sqrtPriceX64A must greater than 0");return i?H.mulDivCeil(n,t.sub(e),ve):H.mulDivFloor(n,t.sub(e),ve)}static getLiquidityFromTokenAmountA(e,t,n,i){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return i?H.mulDivRoundingUp(a,Ye,Ar):a.shrn(rn)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),H.mulDivFloor(n,Ar,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return ne.getLiquidityFromTokenAmountA(t,n,i,!1);if(e.lt(n)){let s=ne.getLiquidityFromTokenAmountA(e,n,i,!1),a=ne.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return ne.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:ne.getTokenAmountAFromLiquidity(t,n,i,o),amountB:new Y(0)};if(e.lt(n)){let s=ne.getTokenAmountAFromLiquidity(e,n,i,o),a=ne.getTokenAmountBFromLiquidity(t,e,i,o);return{amountA:s,amountB:a}}else return{amountA:new Y(0),amountB:ne.getTokenAmountBFromLiquidity(t,n,i,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,i,o,s,a){let{amountA:u,amountB:c}=ne.getAmountsFromLiquidity(e,t,n,i,s),l=o?1+a:1-a,m=new Y(new S(u.toString()).mul(l).toFixed(0)),d=new Y(new S(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:i,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var h,k,A,I;let c=z.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),l=z.getSqrtPriceX64FromTick(t),m=z.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,p=ne.getAmountsFromLiquidity(c,l,m,i,s),[y,f]=[pe(p.amountA,(h=e.mintA.extensions)==null?void 0:h.feeConfig,a,u),pe(p.amountB,(k=e.mintB.extensions)==null?void 0:k.feeConfig,a,u)],[w,g]=[pe(new Y(new S(p.amountA.toString()).mul(d).toFixed(0)),(A=e.mintA.extensions)==null?void 0:A.feeConfig,a,u),pe(new Y(new S(p.amountB.toString()).mul(d).toFixed(0)),(I=e.mintB.extensions)==null?void 0:I.feeConfig,a,u)];return{liquidity:i,amountA:y,amountB:f,amountSlippageA:w,amountSlippageB:g,expirationTime:lt(y.expirationTime,f.expirationTime)}}},At=class{static swapCompute(e,t,n,i,o,s,a,u,c,l,m,d,p,y,f=!1){if(d.eq(fe))throw new Error("amountSpecified must not be 0");if(y||(y=s?wt.add(Ye):kt.sub(Ye)),s){if(y.lt(wt))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(y.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(y.gt(kt))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(y.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let w=d.gt(fe),g={amountSpecifiedRemaining:d,amountCalculated:fe,sqrtPriceX64:m,tick:c>p?Math.min(p+ee.tickCount(l)-1,c):p,accounts:[],liquidity:u,feeAmount:new Y(0)},h=p,k=n[p],A=0,I=!s&&k.startTickIndex===g.tick;for(;!g.amountSpecifiedRemaining.eq(fe)&&!g.sqrtPriceX64.eq(y);){A>10;let P={};P.sqrtPriceStartX64=g.sqrtPriceX64;let N=_.nextInitTick(k,g.tick,l,s,I),x=N||null,C=null;if(!(x!=null&&x.liquidityGross.gtn(0))){let O=Pe.nextInitializedTickArrayStartIndex({tickCurrent:g.tick,tickSpacing:l,tickArrayBitmap:i,exBitmapInfo:o},h,s);if(!O.isExist){if(f)return{allTrade:!1,amountSpecifiedRemaining:g.amountSpecifiedRemaining,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts};throw Error("swapCompute LiquidityInsufficient")}h=O.nextStartIndex;let{publicKey:re}=oe(e,t,h);C=re,k=n[h];try{x=_.firstInitializedTick(k,s)}catch{throw Error("not found next tick info")}}P.tickNext=x.tick,P.initialized=x.liquidityGross.gtn(0),p!==h&&C&&(g.accounts.push(C),p=h),P.tickNext<Se?P.tickNext=Se:P.tickNext>Le&&(P.tickNext=Le),P.sqrtPriceNextX64=z.getSqrtPriceX64FromTick(P.tickNext);let E;if(s&&P.sqrtPriceNextX64.lt(y)||!s&&P.sqrtPriceNextX64.gt(y)?E=y:E=P.sqrtPriceNextX64,[g.sqrtPriceX64,P.amountIn,P.amountOut,P.feeAmount]=At.swapStepCompute(g.sqrtPriceX64,E,g.liquidity,g.amountSpecifiedRemaining,a),g.feeAmount=g.feeAmount.add(P.feeAmount),w?(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.sub(P.amountIn.add(P.feeAmount)),g.amountCalculated=g.amountCalculated.sub(P.amountOut)):(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.add(P.amountOut),g.amountCalculated=g.amountCalculated.add(P.amountIn.add(P.feeAmount))),g.sqrtPriceX64.eq(P.sqrtPriceNextX64)){if(P.initialized){let O=x.liquidityNet;s&&(O=O.mul(et)),g.liquidity=ne.addDelta(g.liquidity,O)}I=P.tickNext!=g.tick&&!s&&k.startTickIndex===P.tickNext,g.tick=s?P.tickNext-1:P.tickNext}else if(g.sqrtPriceX64!=P.sqrtPriceStartX64){let O=z.getTickFromSqrtPriceX64(g.sqrtPriceX64);I=O!=g.tick&&!s&&k.startTickIndex===O,g.tick=O}++A}try{let{nextStartIndex:P,isExist:N}=ee.nextInitializedTickArray(g.tick,l,s,i,o);N&&p!==P&&(g.accounts.push(oe(e,t,P).publicKey),p=P)}catch{}return{allTrade:!0,amountSpecifiedRemaining:fe,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts}}static swapStepCompute(e,t,n,i,o){let s={sqrtPriceX64Next:new Y(0),amountIn:new Y(0),amountOut:new Y(0),feeAmount:new Y(0)},a=e.gte(t),u=i.gte(fe);if(u){let l=H.mulDivFloor(i,Vn.sub(new Y(o.toString())),Vn);s.amountIn=a?ne.getTokenAmountAFromLiquidity(t,e,n,!0):ne.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=z.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?ne.getTokenAmountBFromLiquidity(t,e,n,!1):ne.getTokenAmountAFromLiquidity(e,t,n,!1),i.mul(et).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=z.getNextSqrtPriceX64FromOutput(e,n,i.mul(et),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=ne.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=ne.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:ne.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:ne.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(i.mul(et))&&(s.amountOut=i.mul(et)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=i.sub(s.amountIn):s.feeAmount=H.mulDivCeil(s.amountIn,new Y(o),Vn.sub(new Y(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var ge=60,ht=512,_=class{static getTickArrayAddressByTick(e,t,n,i){let o=_.getTickArrayStartIndexByTick(n,i),{publicKey:s}=oe(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=_.getTickArrayStartIndexByTick(e,t),i=Math.floor((e-n)/t);if(i<0||i>=ge)throw new Error("tick offset in array overflow");return i}static getTickArrayBitIndex(e,t){let n=ee.tickCount(t),i=e/n;return e<0&&e%n!=0?i=Math.ceil(i)-1:i=Math.floor(i),i}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*ee.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*ge,i=Math.floor(e/n)+512;return Math.abs(i)}static checkTickArrayIsInitialized(e,t,n){let i=n*ge,o=Math.floor(t/i)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*i}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*ge:e+t*ge}static mergeTickArrayBitmap(e){let t=new Xa(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,i,o){let s=Math.floor(i/(n*ge));return[..._.searchLowBitFromStart(e,t,s-1,o,n),..._.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return _.searchHightBitFromStart(e,t,0,ht,n)}static getAllInitializedTickArrayInfo(e,t,n,i,o){let s=[],a=_.getAllInitializedTickArrayStartIndex(n,i,o);for(let u of a){let{publicKey:c}=oe(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>_.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===i)break}let u=ee.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>_.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===i)break}let u=ee.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<Se||e>Le}static nextInitTick(e,t,n,i,o){if(ee.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(i)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<ge;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=ge-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<ge;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let i=z.getSqrtPriceX64FromTick(t),o=z.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new S(1).div(o),tickSqrtPriceX64:i}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let i=n?t:new S(1).div(t),o=Pt.getTickWithPriceAndTickspacing(i,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=z.getSqrtPriceX64FromTick(o),a=z.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new S(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let i=z.getSqrtPriceX64FromTick(t),o=z.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new S(1).div(o),tickSqrtPriceX64:i}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let i=n?t:new S(1).div(t),o=Pt.getTickWithPriceAndTickspacing(i,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=z.getSqrtPriceX64FromTick(o),a=z.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new S(1).div(a)}}};var Kb=R([Ie(8),F("bump"),nn("index"),K(""),Ce("protocolFeeRate"),Ce("tradeFeeRate"),nn("tickSpacing"),D(b(),8,"")]),za=R([Ce("blockTimestamp"),vt("tickCumulative"),D(b(),4)]),ro=R([Ie(8),Me("initialized"),b("recentEpoch"),nn("observationIndex"),K("poolId"),D(za,100,"observations"),D(b(),4)]),Ha=R([F("rewardState"),b("openTime"),b("endTime"),b("lastUpdateTime"),q("emissionsPerSecondX64"),b("rewardTotalEmissioned"),b("rewardClaimed"),K("tokenMint"),K("tokenVault"),K("creator"),q("rewardGrowthGlobalX64")]),eo=R([Ie(8),F("bump"),K("ammConfig"),K("creator"),K("mintA"),K("mintB"),K("vaultA"),K("vaultB"),K("observationId"),F("mintDecimalsA"),F("mintDecimalsB"),nn("tickSpacing"),q("liquidity"),q("sqrtPriceX64"),Ae("tickCurrent"),Ce(),q("feeGrowthGlobalX64A"),q("feeGrowthGlobalX64B"),b("protocolFeesTokenA"),b("protocolFeesTokenB"),q("swapInAmountTokenA"),q("swapOutAmountTokenB"),q("swapInAmountTokenB"),q("swapOutAmountTokenA"),F("status"),D(F(),7,""),D(Ha,3,"rewardInfos"),D(b(),16,"tickArrayBitmap"),b("totalFeesTokenA"),b("totalFeesClaimedTokenA"),b("totalFeesTokenB"),b("totalFeesClaimedTokenB"),b("fundFeesTokenA"),b("fundFeesTokenB"),b("startTime"),D(b(),15*4-3,"padding")]),Ya=R([q("growthInsideLastX64"),b("rewardAmountOwed")]),to=R([Ie(8),F("bump"),K("nftMint"),K("poolId"),Ae("tickLower"),Ae("tickUpper"),q("liquidity"),q("feeGrowthInsideLastX64A"),q("feeGrowthInsideLastX64B"),b("tokenFeesOwedA"),b("tokenFeesOwedB"),D(Ya,3,"rewardInfos"),D(b(),8,"")]),Lb=R([Ie(8),F("bump"),K("poolId"),Ae("tickLowerIndex"),Ae("tickUpperIndex"),q("liquidity"),q("feeGrowthInsideLastX64A"),q("feeGrowthInsideLastX64B"),b("tokenFeesOwedA"),b("tokenFeesOwedB"),D(q(),3,"rewardGrowthInside"),D(b(),8,"")]),Qa=R([Ae("tick"),Ri("liquidityNet"),q("liquidityGross"),q("feeGrowthOutsideX64A"),q("feeGrowthOutsideX64B"),D(q(),3,"rewardGrowthsOutsideX64"),D(Ce(),13,"")]),an=R([Ie(8),K("poolId"),Ae("startTickIndex"),D(Qa,ge,"ticks"),F("initializedTickCount"),D(F(),115,"")]),Nb=R([Ie(329),D(K(),100,"whitelistMints")]),no=R([Ie(8),K("poolId"),D(D(b(),8),Sr,"positiveTickArrayBitmap"),D(D(b(),8),Sr,"negativeTickArrayBitmap")]),Rb=R([b(),F("bump"),K("owner"),K("poolId"),K("positionId"),K("nftAccount"),D(b(),8)]);ro.span;var so=ae("Raydium_Clmm"),ze={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Za=[188,37,179,131,82,150,84,73],ja=[16,72,250,198,14,162,212,19],qn=class{static createPoolInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,y){let f=R([q("sqrtPriceX64"),b("startTime")]),w=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:_t.programId,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1}],g=Buffer.alloc(f.span);f.encode({sqrtPriceX64:p,startTime:y},g);let h=Buffer.from([...ze.createPool,...g]);return new Ee({keys:w,programId:e,data:h})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:i,mintB:o,ammConfigId:s,initialPriceX64:a,startTime:u}=e,[c,l]=[new L(i.address),new L(o.address)],{publicKey:m}=Zi(t,s,c,l),{publicKey:d}=$i(t,m),{publicKey:p}=xr(t,m,c),{publicKey:y}=xr(t,m,l),f=[this.createPoolInstruction(t,m,n,s,d,c,p,new L(i.programId||be),l,y,new L(o.programId||be),We(t,m).publicKey,a,u)];return{signers:[],instructions:f,instructionTypes:[J.CreateAccount,J.ClmmCreatePool],address:{poolId:m,observationId:d,mintAVault:p,mintBVault:y},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,y,f,w,g,h,k,A,I,P,N,x,C,E){let O=R([Ae("tickLowerIndex"),Ae("tickUpperIndex"),Ae("tickArrayLowerStartIndex"),Ae("tickArrayUpperStartIndex"),q("liquidity"),b("amountMaxA"),b("amountMaxB"),Me("withMetadata"),F("optionBaseFlag"),Me("baseFlag")]),re=[...E?[{pubkey:E,isSigner:!1,isWritable:!0}]:[]],Z=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:_t.programId,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:oo,isSigner:!1,isWritable:!1},{pubkey:Rt,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...re],ue=Buffer.alloc(O.span);O.encode({tickLowerIndex:h,tickUpperIndex:k,tickArrayLowerStartIndex:A,tickArrayUpperStartIndex:I,liquidity:P,amountMaxA:N,amountMaxB:x,withMetadata:C==="create",baseFlag:!1,optionBaseFlag:0},ue);let te=Buffer.from([...ze.openPosition,...ue]);return new Ee({keys:Z,programId:e,data:te})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,p]=[new L(e.programId),new L(e.id)],y;if(l)y=new L((await l(1))[0]);else{let x=Lr.generate();m.push(x),y=x.publicKey}let f=_.getTickArrayStartIndexByTick(i,e.config.tickSpacing),w=_.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:g}=oe(d,p,f),{publicKey:h}=oe(d,p,w),{publicKey:k}=Re(n.wallet,y,be),{publicKey:A}=Wn(y),{publicKey:I}=De(d,y),{publicKey:P}=mt(d,p,i,o),N=this.openPositionFromLiquidityInstruction(d,n.feePayer,p,n.wallet,y,k,A,P,g,h,I,n.tokenAccountA,n.tokenAccountB,new L(t.vault.A),new L(t.vault.B),new L(e.mintA.address),new L(e.mintB.address),i,o,f,w,s,a,u,c);return{signers:m,instructions:[N],instructionTypes:[J.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:y,tickArrayLower:g,tickArrayUpper:h,positionNftAccount:k,metadataAccount:A,personalPosition:I,protocolPosition:P}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,p]=[new L(e.programId),new L(e.id)],y;if(l)y=new L((await l(1))[0]);else{let x=Lr.generate();m.push(x),y=x.publicKey}let f=_.getTickArrayStartIndexByTick(i,e.config.tickSpacing),w=_.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:g}=oe(d,p,f),{publicKey:h}=oe(d,p,w),{publicKey:k}=Re(n.wallet,y,be),{publicKey:A}=Wn(y),{publicKey:I}=De(d,y),{publicKey:P}=mt(d,p,i,o),N=this.openPositionFromBaseInstruction(d,n.feePayer,p,n.wallet,y,k,A,P,g,h,I,n.tokenAccountA,n.tokenAccountB,new L(t.vault.A),new L(t.vault.B),new L(e.mintA.address),new L(e.mintB.address),i,o,f,w,c,s,a,u,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,w])?We(d,p).publicKey:void 0);return{address:{nftMint:y,tickArrayLower:g,tickArrayUpper:h,positionNftAccount:k,metadataAccount:A,personalPosition:I,protocolPosition:P},instructions:[N],signers:m,instructionTypes:[J.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,y,f,w,g,h,k,A,I,P,N,x,C,E){let O=R([Ae("tickLowerIndex"),Ae("tickUpperIndex"),Ae("tickArrayLowerStartIndex"),Ae("tickArrayUpperStartIndex"),q("liquidity"),b("amountMaxA"),b("amountMaxB"),Me("withMetadata"),F("optionBaseFlag"),Me("baseFlag")]),re=[...E?[{pubkey:E,isSigner:!1,isWritable:!0}]:[]],Z=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:_t.programId,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:oo,isSigner:!1,isWritable:!1},{pubkey:Rt,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...re],ue=Buffer.alloc(O.span);O.encode({tickLowerIndex:h,tickUpperIndex:k,tickArrayLowerStartIndex:A,tickArrayUpperStartIndex:I,liquidity:new io(0),amountMaxA:N==="MintA"?x:C,amountMaxB:N==="MintA"?C:x,withMetadata:P==="create",baseFlag:N==="MintA",optionBaseFlag:1},ue);let te=Buffer.from([...ze.openPosition,...ue]);return new Ee({keys:Z,programId:e,data:te})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m,d=[];if(l)m=new L((await l(1))[0]);else{let x=Lr.generate();d.push(x),m=x.publicKey}let[p,y]=[new L(e.programId),new L(e.id)],f=_.getTickArrayStartIndexByTick(i,e.config.tickSpacing),w=_.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:g}=oe(p,y,f),{publicKey:h}=oe(p,y,w),{publicKey:k}=Re(n.wallet,m,be),{publicKey:A}=Wn(m),{publicKey:I}=De(p,m),{publicKey:P}=mt(p,y,i,o),N=this.openPositionFromLiquidityInstruction(p,n.wallet,y,n.wallet,m,k,A,P,g,h,I,n.tokenAccountA,n.tokenAccountB,new L(t.vault.A),new L(t.vault.B),new L(t.mintA.address),new L(t.mintB.address),i,o,f,w,s,a,u,c,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,w])?We(p,y).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:g,tickArrayUpper:h,positionNftAccount:k,metadataAccount:A,personalPosition:I,protocolPosition:P},instructions:[N],signers:d,instructionTypes:[J.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,i,o){let s=R([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:_t.programId,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([...ze.closePosition,...u]);return new Ee({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:i}){let o=new L(e.programId),{publicKey:s}=Re(n.wallet,i.nftMint,be),{publicKey:a}=De(o,i.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,i.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[J.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,y,f,w,g,h){let k=R([q("liquidity"),b("amountMaxA"),b("amountMaxB"),F("optionBaseFlag"),Me("baseFlag")]),A=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],I=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...A],P=Buffer.alloc(k.span);k.encode({liquidity:f,amountMaxA:w,amountMaxB:g,optionBaseFlag:0,baseFlag:!1},P);let N=Buffer.from([...ze.increaseLiquidity,...P]);return new Ee({keys:I,programId:e,data:N})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new L(e.programId),new L(e.id)],l=_.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=_.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=oe(u,c,l),{publicKey:p}=oe(u,c,m),{publicKey:y}=Re(i.wallet,n.nftMint,be),{publicKey:f}=De(u,n.nftMint),{publicKey:w}=mt(u,c,n.tickLower,n.tickUpper),g=this.increasePositionFromLiquidityInstruction(u,i.wallet,y,f,c,w,d,p,i.tokenAccountA,i.tokenAccountB,new L(t.vault.A),new L(t.vault.B),new L(e.mintA.address),new L(e.mintB.address),o,s,a,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?We(u,c).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:y,personalPosition:f,protocolPosition:w},signers:[],instructions:[g],instructionTypes:[J.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new L(e.programId),new L(e.id)],l=_.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=_.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=oe(u,c,l),{publicKey:p}=oe(u,c,m),{publicKey:y}=Re(i.wallet,n.nftMint,be),{publicKey:f}=De(u,n.nftMint),{publicKey:w}=mt(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:y,personalPosition:f,protocolPosition:w},instructions:[this.increasePositionFromBaseInstruction(u,i.wallet,y,f,c,w,d,p,i.tokenAccountA,i.tokenAccountB,new L(t.vault.A),new L(t.vault.B),new L(e.mintA.address),new L(e.mintB.address),o,s,a,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?We(u,c).publicKey:void 0)],signers:[],instructionTypes:[J.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,y,f,w,g,h){let k=R([q("liquidity"),b("amountMaxA"),b("amountMaxB"),F("optionBaseFlag"),Me("baseFlag")]),A=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],I=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...A],P=Buffer.alloc(k.span);k.encode({liquidity:new io(0),amountMaxA:f==="MintA"?w:g,amountMaxB:f==="MintA"?g:w,baseFlag:f==="MintA",optionBaseFlag:1},P);let N=Buffer.from([...ze.increaseLiquidity,...P]);return new Ee({keys:I,programId:e,data:N})}static decreaseLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,y,f,w,g,h,k){let A=R([q("liquidity"),b("amountMinA"),b("amountMinB")]),I=[...k?[{pubkey:k,isSigner:!1,isWritable:!0}]:[],...f.map(C=>[{pubkey:C.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:C.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:C.rewardMint,isSigner:!1,isWritable:!1}]).flat()],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:Sn,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...I],N=Buffer.alloc(A.span);A.encode({liquidity:w,amountMinA:g,amountMinB:h},N);let x=Buffer.from([...ze.decreaseLiquidity,...N]);return new Ee({keys:P,programId:e,data:x})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,l]=[new L(e.programId),new L(e.id)],m=_.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=_.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=oe(c,l,m),{publicKey:y}=oe(c,l,d),{publicKey:f}=Re(i.wallet,n.nftMint,u),{publicKey:w}=De(c,n.nftMint),{publicKey:g}=mt(c,l,n.tickLower,n.tickUpper),h=[];for(let I=0;I<e.rewardDefaultInfos.length;I++)h.push({poolRewardVault:new L(t.rewardInfos[I].vault),ownerRewardVault:i.rewardAccounts[I],rewardMint:new L(e.rewardDefaultInfos[I].mint.address)});let k=[],A=this.decreaseLiquidityInstruction(c,i.wallet,f,w,l,g,p,y,i.tokenAccountA,i.tokenAccountB,new L(t.vault.A),new L(t.vault.B),new L(e.mintA.address),new L(e.mintB.address),h,o,s,a,Pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?We(c,l).publicKey:void 0);return k.push(A),{address:{tickArrayLower:p,tickArrayUpper:y,positionNftAccount:f,personalPosition:w,protocolPosition:g},signers:[],instructions:k,instructionTypes:[J.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,y,f,w,g){let h=R([b("amount"),b("otherAmountThreshold"),q("sqrtPriceLimitX64"),Me("isBaseInput")]),k=[...g?[{pubkey:g,isSigner:!1,isWritable:!0}]:[],...m.map(N=>({pubkey:N,isSigner:!1,isWritable:!0}))],A=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:Sn,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...k],I=Buffer.alloc(h.span);h.encode({amount:p,otherAmountThreshold:y,sqrtPriceLimitX64:f,isBaseInput:w},I);let P=Buffer.from([...ze.swap,...I]);return new Ee({keys:A,programId:e,data:P})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:i,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new L(e.programId),new L(e.id)],[d,p]=[new L(t.vault.A),new L(t.vault.B)],[y,f]=[new L(e.mintA.address),new L(e.mintB.address)],w=e.mintA.address===o.toString(),g=[this.swapInstruction(l,i.wallet,m,new L(e.config.id),w?i.tokenAccountA:i.tokenAccountB,w?i.tokenAccountB:i.tokenAccountA,w?d:p,w?p:d,w?y:f,w?f:y,c,n,s,a,u,!0,We(l,m).publicKey)];return{signers:[],instructions:g,instructionTypes:[J.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:i,outputMint:o,amountOut:s,amountInMax:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new L(e.programId),new L(e.id)],[d,p]=[new L(t.vault.A),new L(t.vault.B)],[y,f]=[new L(e.mintA.address),new L(e.mintB.address)],w=e.mintA.address===o.toBase58(),g=[this.swapInstruction(l,i.wallet,m,new L(e.config.id),w?i.tokenAccountB:i.tokenAccountA,w?i.tokenAccountA:i.tokenAccountB,w?p:d,w?d:p,w?f:y,w?y:f,c,n,s,a,u,!1,We(l,m).publicKey)];return{signers:[],instructions:g,instructionTypes:[J.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,i,o,s,a,u,c,l,m,d){let p=R([b("openTime"),b("endTime"),q("emissionsPerSecondX64")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:_t.programId,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1}],f=Buffer.alloc(p.span);p.encode({openTime:$(l),endTime:$(m),emissionsPerSecondX64:d},f);let w=Buffer.from([...ze.initReward,...f]);return new Ee({keys:y,programId:e,data:w})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,s]=[new L(e.programId),new L(e.id)],a=ji(o,s,i.mint).publicKey,u=Ir(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new L(e.config.id),n.tokenAccount,i.programId,i.mint,a,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[J.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,i,o,s,a,u,c,l,m,d){let p=R([F("rewardIndex"),q("emissionsPerSecondX64"),b("openTime"),b("endTime")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(p.span);p.encode({rewardIndex:c,emissionsPerSecondX64:d,openTime:$(l),endTime:$(m)},f);let w=Buffer.from([...ze.setRewardEmissions,...f]);return new Ee({keys:y,programId:e,data:w})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,s]=[new L(e.programId),new L(e.id)],a,u,c;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===i.mint.toString()&&(a=d,u=new L(t.rewardInfos[d].vault),c=new L(t.rewardInfos[d].mint.address));(a===void 0||u===void 0)&&so.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=Ir(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new L(e.config.id),n.tokenAccount,u,c,a,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[J.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,i,o,s,a){let u=R([F("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:Sn,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([...ze.collectReward,...l]);return new Ee({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:i}){let[o,s]=[new L(e.programId),new L(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===i.toString()&&(a=l,u=new L(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&so.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,i,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[J.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:i,positionNft:o}){let{publicKey:s}=Re(i,o,be),{publicKey:a}=De(n,o),u=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Br(e,a).publicKey,isSigner:!1,isWritable:!0},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:_t.programId,isSigner:!1,isWritable:!1}];return new Ee({keys:u,programId:e,data:Buffer.from(Za)})}static harvestLockPositionInstruction(e){let[t,n]=[new L(e.poolKeys.programId),new L(e.poolKeys.id)],i=_.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),o=_.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:s}=oe(t,n,i),{publicKey:a}=oe(t,n,o),{publicKey:u}=Re(e.owner,e.ownerPosition.nftMint,be),{publicKey:c}=De(t,e.ownerPosition.nftMint),{publicKey:l}=mt(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),m=[];for(let y=0;y<e.poolKeys.rewardInfos.length;y++)m.push({poolRewardVault:new L(e.poolKeys.rewardInfos[y].vault),ownerRewardVault:e.ownerRewardAccounts[y],rewardMint:new L(e.poolKeys.rewardInfos[y].mint.address)});let d=[...m.map(y=>[{pubkey:y.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:y.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:y.rewardMint,isSigner:!1,isWritable:!1}]).flat()],p=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:Br(e.programId,c).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:new L(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new L(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:mi,isSigner:!1,isWritable:!1},{pubkey:new L(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new L(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...d];return new Ee({keys:p,programId:e.programId,data:Buffer.from(ja)})}};var Nr=(...r)=>r.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),cn=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=ae(t)}createTxBuilder(e){return this.scope.checkOwner(),new vn({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Nr(e))}logInfo(...e){this.logger.info(Nr(e))}logAndCreateError(...e){let t=Nr(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var jb=R([Ce("mintAuthorityOption"),K("mintAuthority"),b("supply"),F("decimals"),F("isInitialized"),Ce("freezeAuthorityOption"),K("freezeAuthority")]);import{PublicKey as ty}from"@solana/web3.js";import{MintLayout as ry,TOKEN_PROGRAM_ID as oy}from"@solana/spl-token";var ao=r=>new xe({mint:r.address,decimals:r.decimals,symbol:r.symbol,name:r.name});var Gn=i=>{var o=i,{address:r,programId:e,decimals:t}=o,n=_e(o,["address","programId","decimals"]);return G({chainId:101,address:Ct(r).toBase58(),programId:e,logoURI:"",symbol:"",name:"",decimals:t,tags:[],extensions:n.extensions||{}},n)};import uo from"bn.js";var Rr=new uo(25),Un=new uo(1e4);import{PublicKey as Ze,SystemProgram as mu,SYSVAR_RENT_PUBKEY as Ky,TransactionInstruction as Ot}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as du,TOKEN_PROGRAM_ID as mn}from"@solana/spl-token";var Cr=R([F("instruction"),b("amountIn"),b("minAmountOut")]),Mr=R([F("instruction"),b("maxAmountIn"),b("amountOut")]),hy=R([F("instruction"),F("nonce")]),$a=R([F("instruction"),F("nonce"),b("startTime")]),co=R([b("status"),b("nonce"),b("maxOrder"),b("depth"),b("baseDecimal"),b("quoteDecimal"),b("state"),b("resetFlag"),b("minSize"),b("volMaxCutRatio"),b("amountWaveRatio"),b("baseLotSize"),b("quoteLotSize"),b("minPriceMultiplier"),b("maxPriceMultiplier"),b("systemDecimalValue"),b("minSeparateNumerator"),b("minSeparateDenominator"),b("tradeFeeNumerator"),b("tradeFeeDenominator"),b("pnlNumerator"),b("pnlDenominator"),b("swapFeeNumerator"),b("swapFeeDenominator"),b("baseNeedTakePnl"),b("quoteNeedTakePnl"),b("quoteTotalPnl"),b("baseTotalPnl"),b("poolOpenTime"),b("punishPcAmount"),b("punishCoinAmount"),b("orderbookToInitTime"),q("swapBaseInAmount"),q("swapQuoteOutAmount"),b("swapBase2QuoteFee"),q("swapQuoteInAmount"),q("swapBaseOutAmount"),b("swapQuote2BaseFee"),K("baseVault"),K("quoteVault"),K("baseMint"),K("quoteMint"),K("lpMint"),K("openOrders"),K("marketId"),K("marketProgramId"),K("targetOrders"),K("withdrawQueue"),K("lpVault"),K("owner"),b("lpReserve"),D(b(),3,"padding")]),Ay=R([b("accountType"),b("status"),b("nonce"),b("maxOrder"),b("depth"),b("baseDecimal"),b("quoteDecimal"),b("state"),b("resetFlag"),b("minSize"),b("volMaxCutRatio"),b("amountWaveRatio"),b("baseLotSize"),b("quoteLotSize"),b("minPriceMultiplier"),b("maxPriceMultiplier"),b("systemDecimalsValue"),b("abortTradeFactor"),b("priceTickMultiplier"),b("priceTick"),b("minSeparateNumerator"),b("minSeparateDenominator"),b("tradeFeeNumerator"),b("tradeFeeDenominator"),b("pnlNumerator"),b("pnlDenominator"),b("swapFeeNumerator"),b("swapFeeDenominator"),b("baseNeedTakePnl"),b("quoteNeedTakePnl"),b("quoteTotalPnl"),b("baseTotalPnl"),b("poolOpenTime"),b("punishPcAmount"),b("punishCoinAmount"),b("orderbookToInitTime"),q("swapBaseInAmount"),q("swapQuoteOutAmount"),q("swapQuoteInAmount"),q("swapBaseOutAmount"),b("swapQuote2BaseFee"),b("swapBase2QuoteFee"),K("baseVault"),K("quoteVault"),K("baseMint"),K("quoteMint"),K("lpMint"),K("modelDataAccount"),K("openOrders"),K("marketId"),K("marketProgramId"),K("targetOrders"),K("owner"),D(b(),64,"padding")]),vr=R([F("instruction"),b("baseAmountIn"),b("quoteAmountIn"),b("fixedSide"),b("otherAmountMin")]),Er=R([F("instruction"),b("lpAmount"),b("baseAmountMin"),b("quoteAmountMin")]);var lo=R([b("fee")]);import{PublicKey as Ja}from"@solana/web3.js";var Ft=new Ja("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),xt=5e4,eu=R([b("x"),b("y"),b("price")]),tu=R([b("accountType"),b("status"),b("multiplier"),b("validDataCount"),D(eu,xt,"DataElement")]);function nu(r,e){return[0,xt-2]}function ru(r){return[0,xt-2]}function iu(r){return[0,xt-2]}function ou(r,e,t){let[n,i]=nu(e,t),o=n,s=i,a=0,u=e*r.multiplier/t;for(;o<=s;){if(a=Math.floor((s+o)/2),a===0||a>=xt-2)return[a,a,!1];let c=r.DataElement[a].x*r.multiplier/r.DataElement[a].y,l=r.DataElement[a-1].x*r.multiplier/r.DataElement[a-1].y,m=r.DataElement[a+1].x*r.multiplier/r.DataElement[a+1].y;if(u===c)return[a,a,!0];if(u===l)return[a-1,a-1,!0];if(u===m)return[a+1,a+1,!0];if(u<l)s=a-1;else{if(u>l&&u<c)return[a-1,a,!0];if(u>c&&u<m)return[a,a+1,!0];o=a+1}}return[a,a,!1]}function _r(r,e,t){let[n,i,o]=ou(r,e,t);if(!o)return 0;if(n===i){let s=r.DataElement[n].x;return e*r.multiplier/s}else{let s=r.DataElement[n].x,a=r.DataElement[n].y,u=r.DataElement[i].x,c=r.DataElement[i].y,l=t*(u*a-s*c),m=s*l,d=(u-s)*(e*a-s*t)*c,p=m+d;return e*r.multiplier*l/p}}function Tt(r,e,t){return e*r.multiplier/t}function mo(r,e,t){return e*t/r.multiplier}function su(r,e){let[t,n]=ru(e),i=t,o=n,s=0,a=e;for(;i<o;){if(s=Math.floor((o+i)/2),s<=0||s>xt-2)return[s,s,!1];let u=r.DataElement[s].x,c=r.DataElement[s-1].x,l=r.DataElement[s+1].x;if(a===u)return[s,s,!0];if(a===c)return[s-1,s-1,!0];if(a===l)return[s+1,s+1,!0];if(a<c)o=s-1;else{if(a>c&&a<u)return[s-1,s,!0];if(a>u&&a<l)return[s,s+1,!0];i=s+1}}return[s,s,!1]}function au(r,e){let[t,n]=iu(e),i=t,o=n,s=0,a=e;for(;i<=o;){if(s=Math.floor((o+i)/2),s<=0||s>=xt-2)return[s,s,!1];let u=r.DataElement[s].y,c=r.DataElement[s-1].y,l=r.DataElement[s+1].y;if(a===u)return[s,s,!0];if(a===c)return[s-1,s-1,!0];if(a===l)return[s+1,s+1,!0];if(a<l)i=s+1;else{if(a<c&&a>u)return[s-1,s,!0];if(a<u&&a>l)return[s,s+1,!0];o=s-1}}return[s,s,!1]}function po(r,e,t,n){let i=n?e+t:e-t,[o,s,a]=su(r,i);if(!a)return[0,0,!1,a];if(o===s)return[r.DataElement[s].price,r.DataElement[s].y,!1,a];{let u=r.DataElement[o].x,c=r.DataElement[s].x,l=r.DataElement[o].price,m=r.DataElement[s].price,d=r.DataElement[o].y,p=r.DataElement[s].y;if(e>=u&&e<=c)return n?[m,p,!0,a]:[l,d,!0,a];{let y,f;return n?(y=l+(m-l)*(e-u)/(c-u),f=d-(i-u)*r.multiplier/m):(y=l+(m-l)*(e-u)/(c-u),f=p+(c-i)*r.multiplier/l),[y,f,!1,a]}}}function uu(r,e,t,n){let i=n?e-t:e+t,[o,s,a]=au(r,i);if(!a)return[0,0,!1,a];if(o===s)return[r.DataElement[s].price,r.DataElement[s].x,!1,a];{let u=r.DataElement[o].x,c=r.DataElement[s].x,l=r.DataElement[o].price,m=r.DataElement[s].price,d=r.DataElement[o].y,p=r.DataElement[s].y;if(e>=p&&e<=d)return n?[m,c,!0,a]:[l,u,!0,a];{let y,f;return n?(y=l+(m-l)*(d-e)/(d-p),f=u+m*(d-i)/r.multiplier):(y=l+(m-l)*(d-e)/(d-p),f=c-l*(i-p)/r.multiplier),[y,f,!1,a]}}}function cu(r,e){let t=po(r,e,0,!1);return t[3]?t[0]:0}function fo(r,e,t,n){let i=_r(r,e,t),o=Tt(r,e,i),s=Tt(r,t,i),a=Tt(r,n,i),u=!0,[c,l,m,d]=po(r,o,a,u);if(!d)return 0;if(m)return n*r.multiplier/c;{let p=s-l;return mo(r,p,i)}}function bo(r,e,t,n){let i=_r(r,e,t),o=Tt(r,e,i),s=Tt(r,t,i),a=Tt(r,n,i),u=!1,[c,l,m,d]=uu(r,s,a,u);if(!d)return 0;if(m)return n*c/r.multiplier;{let p=o-l;return mo(r,p,i)}}function lu(r){let e=tu.decode(r);return{accountType:e.accountType.toNumber(),status:e.status.toNumber(),multiplier:e.multiplier.toNumber(),validDataCount:e.validDataCount.toNumber(),DataElement:e.DataElement.map(t=>({x:t.x.toNumber(),y:t.y.toNumber(),price:t.price.toNumber()}))}}function yo(r,e,t,n){let i=cu(r,Tt(r,e,_r(r,e,t)))/r.multiplier;return n?i:1/i}var ln=class{constructor({connection:e}){this._layoutData={accountType:0,status:0,multiplier:0,validDataCount:0,DataElement:[]};this.connection=e}get stableModelData(){return this._layoutData}async initStableModelLayout(){if(this._layoutData.validDataCount===0&&this.connection){let e=await this.connection.getAccountInfo(Ft);e&&(this._layoutData=lu(e==null?void 0:e.data))}}};var go=ae("Raydium_liquidity_instruction");function wo(r){let{poolInfo:e,poolKeys:t,userKeys:n,baseAmountIn:i,quoteAmountIn:o,fixedSide:s,otherAmountMin:a}=r,u=Buffer.alloc(vr.span);vr.encode({instruction:3,baseAmountIn:$(i),quoteAmountIn:$(o),otherAmountMin:$(a),fixedSide:s==="base"?Ht:fi},u);let c=[T({pubkey:mn,isWritable:!1}),T({pubkey:new Ze(e.id)}),T({pubkey:new Ze(t.authority),isWritable:!1}),T({pubkey:new Ze(t.openOrders),isWritable:!1}),T({pubkey:new Ze(t.targetOrders)}),T({pubkey:new Ze(e.lpMint.address)}),T({pubkey:new Ze(t.vault.A)}),T({pubkey:new Ze(t.vault.B)})];return e.pooltype.includes("StablePool")&&c.push(T({pubkey:Ft})),c.push(T({pubkey:new Ze(e.marketId),isWritable:!1}),T({pubkey:n.baseTokenAccount}),T({pubkey:n.quoteTokenAccount}),T({pubkey:n.lpTokenAccount}),T({pubkey:n.owner,isWritable:!1,isSigner:!0}),T({pubkey:new Ze(t.marketEventQueue),isWritable:!1})),new Ot({programId:new Ze(e.programId),keys:c,data:u})}function Fr(r){let{poolInfo:e,poolKeys:t,userKeys:n,lpAmount:i,baseAmountMin:o,quoteAmountMin:s}=r,a=pt(t),u=4;if(e.pooltype.includes("StablePool")&&(u=5),u===4||u===5){let c=Buffer.alloc(Er.span);Er.encode({instruction:4,lpAmount:$(i),baseAmountMin:$(o),quoteAmountMin:$(s)},c);let l=[T({pubkey:mn,isWritable:!1}),T({pubkey:a.id}),T({pubkey:a.authority,isWritable:!1}),T({pubkey:a.openOrders}),T({pubkey:a.targetOrders}),T({pubkey:a.mintLp.address}),T({pubkey:a.vault.A}),T({pubkey:a.vault.B})];return u===5?l.push(T({pubkey:Ft})):(l.push(T({pubkey:a.id})),l.push(T({pubkey:a.id}))),l.push(T({pubkey:a.marketProgramId,isWritable:!1}),T({pubkey:a.marketId}),T({pubkey:a.marketBaseVault}),T({pubkey:a.marketQuoteVault}),T({pubkey:a.marketAuthority,isWritable:!1}),T({pubkey:n.lpTokenAccount}),T({pubkey:n.baseTokenAccount}),T({pubkey:n.quoteTokenAccount}),T({pubkey:n.owner,isWritable:!1,isSigner:!0}),T({pubkey:a.marketEventQueue}),T({pubkey:a.marketBids}),T({pubkey:a.marketAsks})),new Ot({programId:a.programId,keys:l,data:c})}return new Ot({programId:a.programId,keys:[]})}function ko({programId:r,ammId:e,ammAuthority:t,ammOpenOrders:n,lpMint:i,coinMint:o,pcMint:s,coinVault:a,pcVault:u,withdrawQueue:c,ammTargetOrders:l,poolTempLp:m,marketProgramId:d,marketId:p,userWallet:y,userCoinVault:f,userPcVault:w,userLpVault:g,nonce:h,openTime:k,coinAmount:A,pcAmount:I,ammConfigId:P,feeDestinationId:N}){let x=R([F("instruction"),F("nonce"),b("openTime"),b("pcAmount"),b("coinAmount")]),C=[{pubkey:mn,isSigner:!1,isWritable:!1},{pubkey:du,isSigner:!1,isWritable:!1},{pubkey:mu.programId,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:P,isSigner:!1,isWritable:!1},{pubkey:N,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!0,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:w,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0}],E=Buffer.alloc(x.span);return x.encode({instruction:1,nonce:h,openTime:k,coinAmount:A,pcAmount:I},E),{instruction:new Ot({keys:C,programId:r,data:E}),instructionType:J.AmmV4CreatePool}}function pu({poolKeys:r,userKeys:e,amountIn:t,minAmountOut:n},i){let o=pt(r),s=Buffer.alloc(Cr.span);Cr.encode({instruction:9,amountIn:$(t),minAmountOut:$(n)},s);let a=[T({pubkey:mn,isWritable:!1}),T({pubkey:o.id}),T({pubkey:o.authority,isWritable:!1}),T({pubkey:o.openOrders})];return i===4&&a.push(T({pubkey:o.targetOrders})),a.push(T({pubkey:o.vault.A}),T({pubkey:o.vault.B})),i===5&&a.push(T({pubkey:Ft})),a.push(T({pubkey:o.marketProgramId,isWritable:!1}),T({pubkey:o.marketId}),T({pubkey:o.marketBids}),T({pubkey:o.marketAsks}),T({pubkey:o.marketEventQueue}),T({pubkey:o.marketBaseVault}),T({pubkey:o.marketQuoteVault}),T({pubkey:o.marketAuthority,isWritable:!1}),T({pubkey:e.tokenAccountIn}),T({pubkey:e.tokenAccountOut}),T({pubkey:e.owner,isWritable:!1})),new Ot({programId:o.programId,keys:a,data:s})}function fu({poolKeys:r,userKeys:e,maxAmountIn:t,amountOut:n},i){let o=pt(r),s=Buffer.alloc(Mr.span);Mr.encode({instruction:11,maxAmountIn:$(t),amountOut:$(n)},s);let a=[T({pubkey:mn,isWritable:!1}),T({pubkey:o.id}),T({pubkey:o.authority,isWritable:!1}),T({pubkey:o.openOrders}),T({pubkey:o.targetOrders}),T({pubkey:o.vault.A}),T({pubkey:o.vault.B})];return i===5&&a.push(T({pubkey:Ft})),a.push(T({pubkey:o.marketProgramId,isWritable:!1}),T({pubkey:o.marketId}),T({pubkey:o.marketBids}),T({pubkey:o.marketAsks}),T({pubkey:o.marketEventQueue}),T({pubkey:o.marketBaseVault}),T({pubkey:o.marketQuoteVault}),T({pubkey:o.marketAuthority,isWritable:!1}),T({pubkey:e.tokenAccountIn}),T({pubkey:e.tokenAccountOut}),T({pubkey:e.owner,isWritable:!1,isSigner:!0})),new Ot({programId:o.programId,keys:a,data:s})}function ho(r){let{poolKeys:e,version:t,userKeys:n,amountIn:i,amountOut:o,fixedSide:s}=r;if(t===4||t===5){let a={poolKeys:e,userKeys:n};if(s==="in")return pu(Q(G({},a),{amountIn:i,minAmountOut:o}),t);if(s==="out")return fu(Q(G({},a),{maxAmountIn:i,amountOut:o}),t);go.logWithError("invalid params","params",r)}throw go.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}import{PublicKey as gu}from"@solana/web3.js";import jy from"bn.js";import{TOKEN_PROGRAM_ID as wu}from"@solana/spl-token";import{PublicKey as bu}from"@solana/web3.js";var yu=ae("Raydium_liquidity_serum");function Ao({programId:r,marketId:e}){let t=[e.toBuffer()],n=0,i;for(;n<100;){try{let o=t.concat(Buffer.from([n]),Buffer.alloc(7));i=bu.createProgramAddressSync(o,r)}catch(o){if(o instanceof TypeError)throw o;n++;continue}return{publicKey:i,nonce:n}}throw yu.logWithError("unable to find a viable program address nonce","params",{programId:r,marketId:e}),new Error("unable to find a viable program address nonce")}function Xn({programId:r}){let{publicKey:e}=de([Buffer.from("amm_config_account_seed","utf-8")],r);return e}function It({name:r,programId:e,marketId:t}){let{publicKey:n}=de([e.toBuffer(),t.toBuffer(),Buffer.from(r,"utf-8")],e);return n}function ku({programId:r,marketId:e}){let{publicKey:t}=de([r.toBuffer(),e.toBuffer(),Buffer.from("open_order_associated_seed","utf-8")],r);return t}function hu({programId:r}){return de([Buffer.from([97,109,109,32,97,117,116,104,111,114,105,116,121])],r)}function Po({version:r,marketVersion:e,marketId:t,baseMint:n,quoteMint:i,baseDecimals:o,quoteDecimals:s,programId:a,marketProgramId:u}){let c=It({name:"amm_associated_seed",programId:a,marketId:t}),l=It({name:"lp_mint_associated_seed",programId:a,marketId:t}),{publicKey:m,nonce:d}=hu({programId:a}),p=It({name:"coin_vault_associated_seed",programId:a,marketId:t}),y=It({name:"pc_vault_associated_seed",programId:a,marketId:t}),f=It({name:"temp_lp_token_associated_seed",programId:a,marketId:t}),w=ku({programId:a,marketId:t}),g=It({name:"target_associated_seed",programId:a,marketId:t}),h=It({name:"withdraw_associated_seed",programId:a,marketId:t}),{publicKey:k}=Ao({programId:u,marketId:t});return{id:c,baseMint:n,quoteMint:i,lpMint:l,baseDecimals:o,quoteDecimals:s,lpDecimals:o,version:r,programId:a,authority:m,nonce:d,baseVault:p,quoteVault:y,lpVault:f,openOrders:w,targetOrders:g,withdrawQueue:h,marketVersion:e,marketProgramId:u,marketId:t,marketAuthority:k,lookupTableAccount:gu.default,configId:Xn({programId:a})}}var Or={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]},To=r=>{let e={},t=wu.toBase58();return Object.keys(r).map(n=>{let i=r[n],[o,s]=[i.baseMint.toBase58(),i.quoteMint.toBase58()];e[n]={id:n,version:4,status:i.status.toNumber(),programId:i.programId.toBase58(),mintA:Gn({address:o,programId:t,decimals:i.baseDecimal.toNumber()}),mintB:Gn({address:s,programId:t,decimals:i.quoteDecimal.toNumber()}),rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:i.poolPrice.toNumber(),mintAmountA:new S(i.mintAAmount.toString()).div(10**i.baseDecimal.toNumber()).toNumber(),mintAmountB:new S(i.mintBAmount.toString()).div(10**i.quoteDecimal.toNumber()).toNumber(),baseReserve:i.baseReserve,quoteReserve:i.quoteReserve,feeRate:new S(i.tradeFeeNumerator.toString()).div(i.tradeFeeDenominator.toString()).toNumber(),openTime:i.poolOpenTime.toString(),tvl:0,day:Or,week:Or,month:Or,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,type:"Standard",marketId:i.marketId.toBase58(),configId:Xn({programId:i.programId}).toBase58(),lpPrice:0,lpAmount:0,lpMint:Gn({address:i.lpMint.toBase58(),programId:t,decimals:Math.min(i.baseDecimal.toNumber(),i.quoteDecimal.toNumber())}),burnPercent:0}}),e};import ke from"bn.js";var Vr=class extends cn{constructor(t){super(t);this.stableLayout=new ln({connection:this.scope.connection})}async initLayout(){await this.stableLayout.initStableModelLayout()}async load(){this.checkDisabled()}computePairAmount({poolInfo:t,amount:n,slippage:i,baseIn:o}){let s=new ke(new S(n).mul(10**t[o?"mintA":"mintB"].decimals).toFixed(0)),a=ao(t[o?"mintB":"mintA"]),[u,c]=[new ke(new S(t.mintAmountA).mul(10**t.mintA.decimals).toString()),new ke(new S(t.mintAmountB).mul(10**t.mintB.decimals).toString())],l=new ke(new S(t.lpAmount).mul(10**t.lpMint.decimals).toFixed(0,S.ROUND_DOWN));this.logDebug("baseReserve:",u.toString(),"quoteReserve:",c.toString()),this.logDebug("tokenIn:",o?t.mintA.symbol:t.mintB.symbol,"amountIn:",s.toString(),"anotherToken:",o?t.mintB.symbol:t.mintA.symbol,"slippage:",`${i.toSignificant()}%`,"baseReserve",u.toString(),"quoteReserve",c.toString());let m=o?"base":"quote";this.logDebug("input side:",m);let d=Ht;s.isZero()||(d=m==="base"?Ln(s.mul(c),u):Ln(s.mul(u),c)),this.logDebug("amountRaw:",d.toString(),"lpAmount:",l.toString());let p=Ln(s.mul(l),m==="base"?u:c);this.logDebug("liquidity:",p.toString());let y=new Fe(new ke(1)).add(i),f=new Fe(new ke(1)).sub(i),w=y.mul(d).quotient,g=f.mul(d).quotient,h=new me(a,d),k=new me(a,w),A=new me(a,g);return this.logDebug("anotherAmount:",h.toFixed(),"maxAnotherAmount:",k.toFixed()),{anotherAmount:h,maxAnotherAmount:k,minAnotherAmount:A,liquidity:p}}async getAmmPoolKeys(t){return(await this.scope.api.fetchPoolKeysById({idList:[t]}))[0]}async addLiquidity(t){let{poolInfo:n,poolKeys:i,amountInA:o,amountInB:s,otherAmountMin:a,fixedSide:u,config:c,txVersion:l,computeBudgetConfig:m}=t;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region"),this.logDebug("amountInA:",o,"amountInB:",s),(o.isZero()||s.isZero())&&this.logAndCreateError("amounts must greater than zero","amountInA & amountInB",{amountInA:o.toFixed(),amountInB:s.toFixed()});let{account:d}=this.scope,{bypassAssociatedCheck:p,checkCreateATAOwner:y}=G({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},c),[f,w]=[o.token,s.token],g=await d.getCreatedTokenAccount({mint:f.mint,associatedOnly:!1}),h=await d.getCreatedTokenAccount({mint:w.mint,associatedOnly:!1});!g&&!h&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",d.tokenAccounts);let k=await d.getCreatedTokenAccount({mint:new Ke(n.lpMint.address)}),A=[f,w],I=[g,h],P=[o.raw,s.raw],N=o.token.mint.toBase58()===n.mintA.address?"base":"quote",x="base";["quote","base"].includes(N)||this.logAndCreateError("invalid fixedSide","fixedSide",u),N==="quote"?(A.reverse(),I.reverse(),P.reverse(),x=u==="a"?"quote":"base"):N==="base"&&(x=u==="a"?"base":"quote");let[C,E]=A,[O,re]=I,[Z,ue]=P,te=i!=null?i:await this.getAmmPoolKeys(n.id),U=this.createTxBuilder(),Bt=await d.handleTokenAccount({side:"in",amount:Z,mint:C.mint,tokenAccount:O,bypassAssociatedCheck:p,checkCreateATAOwner:y}),{tokenAccount:dt}=Bt,dn=_e(Bt,["tokenAccount"]);U.addInstruction(dn);let fn=await d.handleTokenAccount({side:"in",amount:ue,mint:E.mint,tokenAccount:re,bypassAssociatedCheck:p,checkCreateATAOwner:y}),{tokenAccount:pn}=fn,Dt=_e(fn,["tokenAccount"]);U.addInstruction(Dt);let bn=await d.handleTokenAccount({side:"out",amount:0,mint:new Ke(n.lpMint.address),tokenAccount:k,bypassAssociatedCheck:p,checkCreateATAOwner:y}),{tokenAccount:zn}=bn,Wt=_e(bn,["tokenAccount"]);return U.addInstruction(Wt),U.addInstruction({instructions:[wo({poolInfo:n,poolKeys:te,userKeys:{baseTokenAccount:dt,quoteTokenAccount:pn,lpTokenAccount:zn,owner:this.scope.ownerPubKey},baseAmountIn:Z,quoteAmountIn:ue,otherAmountMin:a.raw,fixedSide:x})],instructionTypes:[n.pooltype.includes("StablePool")?J.AmmV5AddLiquidity:J.AmmV4AddLiquidity],lookupTableAddress:te.lookupTableAccount?[te.lookupTableAccount]:[]}),U.addCustomComputeBudget(m),l===0&&await U.buildV0(),U.build()}async removeLiquidity(t){this.scope.availability.removeStandardPosition===!1&&this.logAndCreateError("remove liquidity feature disabled in your region");let{poolInfo:n,poolKeys:i,lpAmount:o,baseAmountMin:s,quoteAmountMin:a,config:u,txVersion:c,computeBudgetConfig:l}=t,m=i!=null?i:await this.getAmmPoolKeys(n.id),[d,p,y]=[new Ke(n.mintA.address),new Ke(n.mintB.address),new Ke(n.lpMint.address)];this.logDebug("lpAmount:",o),this.logDebug("baseAmountMin:",s),this.logDebug("quoteAmountMin:",a),o.isZero()&&this.logAndCreateError("amount must greater than zero","lpAmount",o.toString());let{account:f}=this.scope,w=await f.getCreatedTokenAccount({mint:y,associatedOnly:!1});w||this.logAndCreateError("cannot found lpTokenAccount","tokenAccounts",f.tokenAccounts);let g=await f.getCreatedTokenAccount({mint:d}),h=await f.getCreatedTokenAccount({mint:p}),k=this.createTxBuilder(),{bypassAssociatedCheck:A,checkCreateATAOwner:I}=G({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},u),E=await f.handleTokenAccount({side:"out",amount:0,mint:d,tokenAccount:g,bypassAssociatedCheck:A,checkCreateATAOwner:I}),{tokenAccount:P}=E,N=_e(E,["tokenAccount"]);k.addInstruction(N);let O=await f.handleTokenAccount({side:"out",amount:0,mint:p,tokenAccount:h,bypassAssociatedCheck:A,checkCreateATAOwner:I}),{tokenAccount:x}=O,C=_e(O,["tokenAccount"]);return k.addInstruction(C),k.addInstruction({instructions:[Fr({poolInfo:n,poolKeys:m,userKeys:{lpTokenAccount:w,baseTokenAccount:P,quoteTokenAccount:x,owner:this.scope.ownerPubKey},lpAmount:o,baseAmountMin:s,quoteAmountMin:a})],lookupTableAddress:m.lookupTableAccount?[m.lookupTableAccount]:[],instructionTypes:[n.pooltype.includes("StablePool")?J.AmmV5RemoveLiquidity:J.AmmV4RemoveLiquidity]}),k.addCustomComputeBudget(l),c===0?await k.buildV0():k.build()}async removeAllLpAndCreateClmmPosition({poolInfo:t,clmmPoolInfo:n,removeLpAmount:i,createPositionInfo:o,farmInfo:s,userFarmLpAmount:a,base:u,computeBudgetConfig:c,payer:l,userAuxiliaryLedgers:m,tokenProgram:d=Vt,checkCreateATAOwner:p=!0,getEphemeralSigners:y,txVersion:f}){if((this.scope.availability.removeStandardPosition===!1||this.scope.availability.createConcentratedPosition===!1)&&this.logAndCreateError("remove liquidity or create position feature disabled in your region"),!(t.mintA.address===n.mintA.address||t.mintA.address===n.mintB.address)||!(t.mintB.address===n.mintA.address||t.mintB.address===n.mintB.address))throw Error("mint check error");let w=this.createTxBuilder();w.addCustomComputeBudget(c);let g={};for(let U of this.scope.account.tokenAccountRawInfos)(g[U.accountInfo.mint.toString()]===void 0||Re(this.scope.ownerPubKey,U.accountInfo.mint,Vt).publicKey.equals(U.pubkey))&&(g[U.accountInfo.mint.toString()]=U.pubkey);let h=g[t.lpMint.address];if(h===void 0)throw Error("find lp account error in trade accounts");let k=i.add(a!=null?a:new ke(0)),A=t.mintA.address===xe.WSOL.mint.toString(),I=t.mintB.address===xe.WSOL.mint.toString(),{account:P,instructionParams:N}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:Vt,mint:new Ke(t.mintA.address),owner:this.scope.ownerPubKey,createInfo:A?{payer:this.scope.ownerPubKey}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:!0,checkCreateATAOwner:p});if(w.addInstruction(N||{}),P===void 0)throw new Error("base token account not found");let{account:x,instructionParams:C}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:Vt,mint:new Ke(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:I?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!I,notUseTokenAccount:I,associatedOnly:!0,checkCreateATAOwner:p});if(w.addInstruction(C||{}),x===void 0)throw new Error("quote token account not found");if(g[t.mintA.address]=P,g[t.mintB.address]=x,s!==void 0&&!(a!=null&&a.isZero())){let U=gr[s.programId],dt=Et({programId:new Ke(s.programId),poolId:new Ke(s.id),owner:this.scope.ownerPubKey,version:U}),dn,pn=await this.scope.connection.getAccountInfo(dt);if(pn&&(dn=_i(U).decode(pn.data)),U!==6&&!dn){let{instruction:rt,instructionType:Hn}=Oi({id:new Ke(s.id),programId:new Ke(s.programId),version:U,ledger:dt,owner:this.scope.ownerPubKey});w.addInstruction({instructions:[rt],instructionTypes:[Hn]})}let Dt=[];for(let rt of s.rewardInfos){let Hn=rt.mint.address===xe.WSOL.mint.toString();if(g[rt.mint.address])Dt.push(g[rt.mint.address]);else{let{account:Dr,instructionParams:Wr}=await this.scope.account.getOrCreateTokenAccount({mint:new Ke(rt.mint.address),tokenProgram:d,owner:this.scope.ownerPubKey,skipCloseAccount:!Hn,createInfo:{payer:l||this.scope.ownerPubKey},associatedOnly:!0,checkCreateATAOwner:p});Dr||this.logAndCreateError("farm reward account not found:",rt.mint.address),Wr&&w.addInstruction(Wr),Dt.push(Dr)}}let zn=(await this.scope.api.fetchFarmKeysById({ids:s.id}))[0],Wt={userAuxiliaryLedgers:m,amount:a,owner:this.scope.ownerPubKey,farmInfo:s,farmKeys:zn,lpAccount:h,rewardAccounts:Dt},Bt=gr[s.programId],fn=Bt===6?Vi(Wt):Bt===5?Di(Wt):Wi(Wt),bn={3:J.FarmV3Withdraw,5:J.FarmV5Withdraw,6:J.FarmV6Withdraw};w.addInstruction({instructions:[fn],instructionTypes:[bn[Bt]]})}let E=await this.getAmmPoolKeys(t.id),O=Fr({poolInfo:t,poolKeys:E,userKeys:{lpTokenAccount:h,baseTokenAccount:P,quoteTokenAccount:x,owner:this.scope.ownerPubKey},lpAmount:k,baseAmountMin:0,quoteAmountMin:0});w.addInstruction({instructions:[O],instructionTypes:[t.pooltype.includes("StablePool")?J.AmmV5RemoveLiquidity:J.AmmV4RemoveLiquidity],lookupTableAddress:E.lookupTableAccount?[E.lookupTableAccount]:[]});let[re,Z]=t.mintA.address===n.mintA.address?[P,x]:[x,P],ue=await this.scope.clmm.getClmmPoolKeys(n.id),te=await qn.openPositionFromBaseInstructions(Q(G({poolInfo:n,poolKeys:ue,ownerInfo:{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:re,tokenAccountB:Z},withMetadata:"create"},o),{base:u,getEphemeralSigners:y}));return w.addInstruction({instructions:[...te.instructions],signers:te.signers,instructionTypes:[...te.instructionTypes],lookupTableAddress:ue.lookupTableAccount?[ue.lookupTableAccount]:[]}),f===0?w.sizeCheckBuildV0():w.sizeCheckBuild()}async createPoolV4({programId:t,marketInfo:n,baseMintInfo:i,quoteMintInfo:o,baseAmount:s,quoteAmount:a,startTime:u,ownerInfo:c,associatedOnly:l=!1,checkCreateATAOwner:m=!1,tokenProgram:d,txVersion:p,feeDestinationId:y,computeBudgetConfig:f}){var re;let w=c.feePayer||((re=this.scope.owner)==null?void 0:re.publicKey),g=c.useSOLBalance&&i.mint.equals(xo),h=c.useSOLBalance&&o.mint.equals(xo),k=this.createTxBuilder(),{account:A,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({mint:i.mint,owner:this.scope.ownerPubKey,createInfo:g?{payer:w,amount:s}:void 0,notUseTokenAccount:g,skipCloseAccount:!g,associatedOnly:g?!1:l,checkCreateATAOwner:m});k.addInstruction(I||{});let{account:P,instructionParams:N}=await this.scope.account.getOrCreateTokenAccount({mint:o.mint,owner:this.scope.ownerPubKey,createInfo:h?{payer:w,amount:a}:void 0,notUseTokenAccount:h,skipCloseAccount:!h,associatedOnly:h?!1:l,checkCreateATAOwner:m});if(k.addInstruction(N||{}),A===void 0||P===void 0)throw Error("you don't has some token account");let x=Po({version:4,marketVersion:3,marketId:n.marketId,baseMint:i.mint,quoteMint:o.mint,baseDecimals:i.decimals,quoteDecimals:o.decimals,programId:t,marketProgramId:n.programId}),C={programId:t,ammId:x.id,ammAuthority:x.authority,ammOpenOrders:x.openOrders,lpMint:x.lpMint,coinMint:x.baseMint,pcMint:x.quoteMint,coinVault:x.baseVault,pcVault:x.quoteVault,withdrawQueue:x.withdrawQueue,ammTargetOrders:x.targetOrders,poolTempLp:x.lpVault,marketProgramId:x.marketProgramId,marketId:x.marketId,ammConfigId:x.configId,feeDestinationId:y},{instruction:E,instructionType:O}=ko(Q(G({},C),{userWallet:this.scope.ownerPubKey,userCoinVault:A,userPcVault:P,userLpVault:Re(this.scope.ownerPubKey,x.lpMint,d).publicKey,nonce:x.nonce,openTime:u,coinAmount:s,pcAmount:a}));return k.addInstruction({instructions:[E],instructionTypes:[O]}),k.addCustomComputeBudget(f),k.versionBuild({txVersion:p,extInfo:{address:C}})}async getCreatePoolFee({programId:t}){let n=Xn({programId:t}),i=await this.scope.connection.getAccountInfo(n,{dataSlice:{offset:536,length:8}});if(i===null)throw Error("get config account error");return lo.decode(i.data).fee}computeAmountOut({poolInfo:t,amountIn:n,mintIn:i,mintOut:o,slippage:s}){let[a,u]=[i.toString(),o.toString()];if(a!==t.mintA.address&&a!==t.mintB.address)throw new Error("toke not match");if(u!==t.mintA.address&&u!==t.mintB.address)throw new Error("toke not match");let{baseReserve:c,quoteReserve:l}=t,m=[c,l],d=[t.mintA.decimals,t.mintB.decimals],p=a==t.mintA.address?"base":"quote";p==="quote"&&(m.reverse(),d.reverse());let[y,f]=m,[w,g]=d,h=t.version===4,k;if(h)k=new S(f.toString()).div(10**g).div(new S(y.toString()).div(10**w));else{let Z=yo(this.stableLayout.stableModelData,c.toNumber(),l.toNumber(),!1);p==="quote"?k=new S(1e6).div(Z*1e6):k=new S(Z*1e6).div(1e6)}let A=n,I=new ke(0),P=new ke(0);if(!A.isZero())if(h){P=jt(A.mul(Rr),Un);let Z=A.sub(P),ue=y.add(Z);I=f.mul(Z).div(ue)}else{P=A.mul(new ke(2)).div(new ke(1e4));let Z=A.sub(P);p==="quote"?I=new ke(fo(this.stableLayout.stableModelData,l.toNumber(),c.toNumber(),Z.toNumber())):I=new ke(bo(this.stableLayout.stableModelData,l.toNumber(),c.toNumber(),Z.toNumber()))}let N=new ke(new S(I.toString()).mul(1-s).toFixed(0)),x=I,C=N,E=new S(I.toString()).div(new S(A.sub(P).toString()).toFixed(0));!A.isZero()&&!I.isZero()&&(E=new S(I.toString()).div(10**g).div(new S(A.sub(P).toString()).div(10**w)));let O=k.sub(E).div(k).mul(100);return{amountOut:x,minAmountOut:C,currentPrice:k,executionPrice:E,priceImpact:O,fee:P}}computeAmountIn({poolInfo:t,amountOut:n,mintIn:i,mintOut:o,slippage:s}){let{baseReserve:a,quoteReserve:u}=t;i.toString()!==t.mintA.address&&i.toString()!==t.mintB.address&&this.logAndCreateError("mintIn does not match pool"),o.toString()!==t.mintA.address&&o.toString()!==t.mintB.address&&this.logAndCreateError("mintOut does not match pool"),this.logDebug("baseReserve:",a.toString()),this.logDebug("quoteReserve:",u.toString());let c=i.toString()===t.mintA.address,[l,m]=c?[t.mintA,t.mintB]:[t.mintB,t.mintA];this.logDebug("currencyOut:",m.symbol||m.address),this.logDebug("amountOut:",new S(n.toString()).div(10**m.decimals).toDecimalPlaces(m.decimals).toString(),l.symbol||l.address),this.logDebug("slippage:",`${s*100}%`);let d=[a,u],p=c?"quote":"base";p==="base"&&d.reverse(),this.logDebug("output side:",p);let[y,f]=d,w=new S(f.toString()).div(10**t[c?"mintB":"mintA"].decimals).div(new S(y.toString()).div(10**t[c?"mintA":"mintB"].decimals));this.logDebug("currentPrice:",`1 ${l.symbol||l.address} \u2248 ${w.toString()} ${m.symbol||m.address}`),this.logDebug("currentPrice invert:",`1 ${m.symbol||m.address} \u2248 ${new S(1).div(w).toString()} ${l.symbol||l.address}`);let g=new ke(0),h=n;if(!h.isZero()){h.gt(f)&&(h=f.sub(new ke(1)));let C=f.sub(h);g=y.mul(h).div(C).mul(Un).div(Un.sub(Rr))}let k=new ke(new S(g.toString()).mul(1+s).toFixed(0)),A=g,I=k;this.logDebug("amountIn:",new S(A.toString()).div(10**l.decimals).toDecimalPlaces(l.decimals).toString()),this.logDebug("maxAmountIn:",new S(I.toString()).div(10**l.decimals).toDecimalPlaces(l.decimals).toString());let P=null;!g.isZero()&&!h.isZero()&&(P=new S(h.toString()).div(10**m.decimals).div(new S(g.toString()).div(10**l.decimals)),this.logDebug("executionPrice:",`1 ${m.symbol||m.address} \u2248 ${P.toDecimalPlaces(Math.max(t.mintA.decimals,t.mintB.decimals)).toString()} ${l.symbol||l.address}`),this.logDebug("executionPrice invert:",`1 ${m.symbol||m.address} \u2248 ${new S(1).div(P).toDecimalPlaces(Math.max(t.mintA.decimals,t.mintB.decimals)).toString()} ${l.symbol||l.address}`));let N=w.mul(A.toString()),x=N.sub(n.toString()).abs().div(N);return this.logDebug("priceImpact:",`${x.toString()}%`),{amountIn:A,maxAmountIn:I,currentPrice:w,executionPrice:P,priceImpact:x}}async swap({poolInfo:t,poolKeys:n,amountIn:i,amountOut:o,inputMint:s,fixedSide:a,txVersion:u,config:c,computeBudgetConfig:l}){let m=this.createTxBuilder(),{associatedOnly:d=!0,inputUseSolBalance:p=!0,outputUseSolBalance:y=!0}=c||{},[f,w]=s===t.mintA.address?[t.mintA,t.mintB]:[t.mintB,t.mintA],g=p&&f.address===Lt.toBase58(),h=y&&w.address===Lt.toBase58(),{account:k,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:Vt,mint:new Ke(f.address),owner:this.scope.ownerPubKey,createInfo:g?{payer:this.scope.ownerPubKey,amount:i}:void 0,skipCloseAccount:!g,notUseTokenAccount:g,associatedOnly:d});m.addInstruction(A||{}),k||this.logAndCreateError("input token account not found",{token:f.symbol||f.address,tokenAccountIn:k,inputTokenUseSolBalance:g,associatedOnly:d});let{account:I,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:Vt,mint:new Ke(w.address),owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:h?!1:d});m.addInstruction(P||{}),I===void 0&&this.logAndCreateError("output token account not found",{token:w.symbol||w.address,tokenAccountOut:I,outputTokenUseSolBalance:h,associatedOnly:d});let N=n||await this.getAmmPoolKeys(t.id),x=4;return t.pooltype.includes("StablePool")&&(x=5),m.addInstruction({instructions:[ho({version:x,poolKeys:N,userKeys:{tokenAccountIn:k,tokenAccountOut:I,owner:this.scope.ownerPubKey},amountIn:i,amountOut:o,fixedSide:a})],instructionTypes:[x===4?J.AmmV4SwapBaseIn:J.AmmV5SwapBaseIn]}),m.addCustomComputeBudget(l),m.versionBuild({txVersion:u})}async getRpcPoolInfo(t){return(await this.getRpcPoolInfos([t]))[t]}async getRpcPoolInfos(t,n){let i=await bt(this.scope.connection,t.map(l=>({pubkey:new Ke(l)})),n),o={},s=[];for(let l=0;l<t.length;l++){let m=i[l];if(m===null||!m.accountInfo)throw Error("fetch pool info error: "+String(t[l]));let d=co.decode(m.accountInfo.data);o[String(t[l])]=Q(G({},d),{programId:m.accountInfo.owner}),s.push(d.baseVault,d.quoteVault)}let a={},u=await bt(this.scope.connection,s.map(l=>({pubkey:new Ke(l)})),n);for(let l=0;l<s.length;l++){let m=u[l].accountInfo;if(m===null)throw Error("fetch vault info error: "+s[l]);a[String(s[l])]=new ke(Au.decode(m.data).amount.toString())}let c={};for(let[l,m]of Object.entries(o)){let d=a[m.baseVault.toString()].sub(m.baseNeedTakePnl),p=a[m.quoteVault.toString()].sub(m.quoteNeedTakePnl);c[l]=Q(G({},m),{baseReserve:d,mintAAmount:a[m.baseVault.toString()],mintBAmount:a[m.quoteVault.toString()],quoteReserve:p,poolPrice:new S(p.toString()).div(new S(10).pow(m.quoteDecimal.toString())).div(new S(d.toString()).div(new S(10).pow(m.baseDecimal.toString())))})}return c}async getPoolInfoFromRpc({poolId:t}){let n=await this.getRpcPoolInfo(t),i=To({[t]:n}),o=i[t],s=await this.scope.tradeV2.computePoolToPoolKeys({pools:[i[t]],ammRpcData:{[t]:n}});return{poolRpcData:n,poolInfo:o,poolKeys:s[0]}}};export{Vr as default};
//# sourceMappingURL=liquidity.mjs.map