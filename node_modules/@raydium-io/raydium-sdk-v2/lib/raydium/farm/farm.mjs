var Nn=Object.defineProperty,Mn=Object.defineProperties;var vn=Object.getOwnPropertyDescriptors;var ot=Object.getOwnPropertySymbols;var Sr=Object.prototype.hasOwnProperty,Lr=Object.prototype.propertyIsEnumerable;var Ir=(e,t,r)=>t in e?Nn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,j=(e,t)=>{for(var r in t||(t={}))Sr.call(t,r)&&Ir(e,r,t[r]);if(ot)for(var r of ot(t))Lr.call(t,r)&&Ir(e,r,t[r]);return e},te=(e,t)=>Mn(e,vn(t));var it=(e,t)=>{var r={};for(var n in e)Sr.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&ot)for(var n of ot(e))t.indexOf(n)<0&&Lr.call(e,n)&&(r[n]=e[n]);return r};import{PublicKey as U,SystemProgram as $i}from"@solana/web3.js";import{createAssociatedTokenAccountInstruction as es}from"@solana/spl-token";import{PublicKey as On}from"@solana/web3.js";import{get as Br,set as _n}from"lodash";var Ct=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let r=t.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(r)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},Rr={},Dn={};function Q(e){let t=Br(Rr,e);if(!t){let r=Br(Dn,e);t=new Ct({name:e,logLevel:r}),_n(Rr,e,t)}return t}import{MINT_SIZE as ds,TOKEN_PROGRAM_ID as fs,getTransferFeeConfig as ps,unpackMint as ms}from"@solana/spl-token";var Vt=Q("Raydium_accountInfo_util");async function Kr(e,t,r){let{batchRequest:n,commitment:o="confirmed",chunkCount:i=100}=j({batchRequest:!1},r),s=Et(t,i),a=new Array(s.length).fill([]);if(n){let c=s.map(d=>{let f=e._buildArgs([d.map(p=>p.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:f}}),u=Et(c,10);a=(await(await Promise.all(u.map(async d=>await e._rpcBatchRequest(d)))).flat()).map(d=>(d.error&&Vt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${d.error.message}`),d.result.value.map(f=>{if(f){let{data:p,executable:m,lamports:g,owner:T,rentEpoch:P}=f;return p.length!==2&&p[1]!=="base64"&&Vt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:m,lamports:g,owner:new On(T),rentEpoch:P}}return null})))}else try{a=await Promise.all(s.map(c=>e.getMultipleAccountsInfo(c,o)))}catch(c){c instanceof Error&&Vt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}import xe from"bn.js";var Ne=9e15,Se=1e9,Ft="0123456789abcdef",at="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",ut="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Nt={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Ne,maxE:Ne,crypto:!1},Fr,ye,R=!0,lt="[DecimalError] ",Ie=lt+"Invalid argument: ",Nr=lt+"Precision limit exceeded",Mr=lt+"crypto unavailable",vr="[object Decimal]",ie=Math.floor,re=Math.pow,Wn=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Un=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,qn=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,_r=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,le=1e7,S=7,Gn=9007199254740991,Hn=at.length-1,Mt=ut.length-1,y={toStringTag:vr};y.absoluteValue=y.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),I(e)};y.ceil=function(){return I(new this.constructor(this),this.e+1,2)};y.clampedTo=y.clamp=function(e,t){var r,n=this,o=n.constructor;if(e=new o(e),t=new o(t),!e.s||!t.s)return new o(NaN);if(e.gt(t))throw Error(Ie+t);return r=n.cmp(e),r<0?e:n.cmp(t)>0?t:new o(n)};y.comparedTo=y.cmp=function(e){var t,r,n,o,i=this,s=i.d,a=(e=new i.constructor(e)).d,c=i.s,u=e.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(i.e!==e.e)return i.e>e.e^c<0?1:-1;for(n=s.length,o=a.length,t=0,r=n<o?n:o;t<r;++t)if(s[t]!==a[t])return s[t]>a[t]^c<0?1:-1;return n===o?0:n>o^c<0?1:-1};y.cosine=y.cos=function(){var e,t,r=this,n=r.constructor;return r.d?r.d[0]?(e=n.precision,t=n.rounding,n.precision=e+Math.max(r.e,r.sd())+S,n.rounding=1,r=jn(n,qr(n,r)),n.precision=e,n.rounding=t,I(ye==2||ye==3?r.neg():r,e,t,!0)):new n(1):new n(NaN)};y.cubeRoot=y.cbrt=function(){var e,t,r,n,o,i,s,a,c,u,l=this,d=l.constructor;if(!l.isFinite()||l.isZero())return new d(l);for(R=!1,i=l.s*re(l.s*l,1/3),!i||Math.abs(i)==1/0?(r=oe(l.d),e=l.e,(i=(e-r.length+1)%3)&&(r+=i==1||i==-2?"0":"00"),i=re(r,1/3),e=ie((e+1)/3)-(e%3==(e<0?-1:2)),i==1/0?r="5e"+e:(r=i.toExponential(),r=r.slice(0,r.indexOf("e")+1)+e),n=new d(r),n.s=l.s):n=new d(i.toString()),s=(e=d.precision)+3;;)if(a=n,c=a.times(a).times(a),u=c.plus(l),n=G(u.plus(l).times(a),u.plus(c),s+2,1),oe(a.d).slice(0,s)===(r=oe(n.d)).slice(0,s))if(r=r.slice(s-3,s+1),r=="9999"||!o&&r=="4999"){if(!o&&(I(a,e+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,o=1}else{(!+r||!+r.slice(1)&&r.charAt(0)=="5")&&(I(n,e+1,1),t=!n.times(n).times(n).eq(l));break}return R=!0,I(n,e,d.rounding,t)};y.decimalPlaces=y.dp=function(){var e,t=this.d,r=NaN;if(t){if(e=t.length-1,r=(e-ie(this.e/S))*S,e=t[e],e)for(;e%10==0;e/=10)r--;r<0&&(r=0)}return r};y.dividedBy=y.div=function(e){return G(this,new this.constructor(e))};y.dividedToIntegerBy=y.divToInt=function(e){var t=this,r=t.constructor;return I(G(t,new r(e),0,1,1),r.precision,r.rounding)};y.equals=y.eq=function(e){return this.cmp(e)===0};y.floor=function(){return I(new this.constructor(this),this.e+1,3)};y.greaterThan=y.gt=function(e){return this.cmp(e)>0};y.greaterThanOrEqualTo=y.gte=function(e){var t=this.cmp(e);return t==1||t===0};y.hyperbolicCosine=y.cosh=function(){var e,t,r,n,o,i=this,s=i.constructor,a=new s(1);if(!i.isFinite())return new s(i.s?1/0:NaN);if(i.isZero())return a;r=s.precision,n=s.rounding,s.precision=r+Math.max(i.e,i.sd())+4,s.rounding=1,o=i.d.length,o<32?(e=Math.ceil(o/3),t=(1/ft(4,e)).toString()):(e=16,t="2.3283064365386962890625e-10"),i=Me(s,1,i.times(t),new s(1),!0);for(var c,u=e,l=new s(8);u--;)c=i.times(i),i=a.minus(c.times(l.minus(c.times(l))));return I(i,s.precision=r,s.rounding=n,!0)};y.hyperbolicSine=y.sinh=function(){var e,t,r,n,o=this,i=o.constructor;if(!o.isFinite()||o.isZero())return new i(o);if(t=i.precision,r=i.rounding,i.precision=t+Math.max(o.e,o.sd())+4,i.rounding=1,n=o.d.length,n<3)o=Me(i,2,o,o,!0);else{e=1.4*Math.sqrt(n),e=e>16?16:e|0,o=o.times(1/ft(5,e)),o=Me(i,2,o,o,!0);for(var s,a=new i(5),c=new i(16),u=new i(20);e--;)s=o.times(o),o=o.times(a.plus(s.times(c.times(s).plus(u))))}return i.precision=t,i.rounding=r,I(o,t,r,!0)};y.hyperbolicTangent=y.tanh=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+7,n.rounding=1,G(r.sinh(),r.cosh(),n.precision=e,n.rounding=t)):new n(r.s)};y.inverseCosine=y.acos=function(){var e,t=this,r=t.constructor,n=t.abs().cmp(1),o=r.precision,i=r.rounding;return n!==-1?n===0?t.isNeg()?ce(r,o,i):new r(0):new r(NaN):t.isZero()?ce(r,o+4,i).times(.5):(r.precision=o+6,r.rounding=1,t=t.asin(),e=ce(r,o+4,i).times(.5),r.precision=o,r.rounding=i,e.minus(t))};y.inverseHyperbolicCosine=y.acosh=function(){var e,t,r=this,n=r.constructor;return r.lte(1)?new n(r.eq(1)?0:NaN):r.isFinite()?(e=n.precision,t=n.rounding,n.precision=e+Math.max(Math.abs(r.e),r.sd())+4,n.rounding=1,R=!1,r=r.times(r).minus(1).sqrt().plus(r),R=!0,n.precision=e,n.rounding=t,r.ln()):new n(r)};y.inverseHyperbolicSine=y.asinh=function(){var e,t,r=this,n=r.constructor;return!r.isFinite()||r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+2*Math.max(Math.abs(r.e),r.sd())+6,n.rounding=1,R=!1,r=r.times(r).plus(1).sqrt().plus(r),R=!0,n.precision=e,n.rounding=t,r.ln())};y.inverseHyperbolicTangent=y.atanh=function(){var e,t,r,n,o=this,i=o.constructor;return o.isFinite()?o.e>=0?new i(o.abs().eq(1)?o.s/0:o.isZero()?o:NaN):(e=i.precision,t=i.rounding,n=o.sd(),Math.max(n,e)<2*-o.e-1?I(new i(o),e,t,!0):(i.precision=r=n-o.e,o=G(o.plus(1),new i(1).minus(o),r+e,1),i.precision=e+4,i.rounding=1,o=o.ln(),i.precision=e,i.rounding=t,o.times(.5))):new i(NaN)};y.inverseSine=y.asin=function(){var e,t,r,n,o=this,i=o.constructor;return o.isZero()?new i(o):(t=o.abs().cmp(1),r=i.precision,n=i.rounding,t!==-1?t===0?(e=ce(i,r+4,n).times(.5),e.s=o.s,e):new i(NaN):(i.precision=r+6,i.rounding=1,o=o.div(new i(1).minus(o.times(o)).sqrt().plus(1)).atan(),i.precision=r,i.rounding=n,o.times(2)))};y.inverseTangent=y.atan=function(){var e,t,r,n,o,i,s,a,c,u=this,l=u.constructor,d=l.precision,f=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&d+4<=Mt)return s=ce(l,d+4,f).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(d+4<=Mt)return s=ce(l,d+4,f).times(.5),s.s=u.s,s}for(l.precision=a=d+10,l.rounding=1,r=Math.min(28,a/S+2|0),e=r;e;--e)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(R=!1,t=Math.ceil(a/S),n=1,c=u.times(u),s=new l(u),o=u;e!==-1;)if(o=o.times(c),i=s.minus(o.div(n+=2)),o=o.times(c),s=i.plus(o.div(n+=2)),s.d[t]!==void 0)for(e=t;s.d[e]===i.d[e]&&e--;);return r&&(s=s.times(2<<r-1)),R=!0,I(s,l.precision=d,l.rounding=f,!0)};y.isFinite=function(){return!!this.d};y.isInteger=y.isInt=function(){return!!this.d&&ie(this.e/S)>this.d.length-2};y.isNaN=function(){return!this.s};y.isNegative=y.isNeg=function(){return this.s<0};y.isPositive=y.isPos=function(){return this.s>0};y.isZero=function(){return!!this.d&&this.d[0]===0};y.lessThan=y.lt=function(e){return this.cmp(e)<0};y.lessThanOrEqualTo=y.lte=function(e){return this.cmp(e)<1};y.logarithm=y.log=function(e){var t,r,n,o,i,s,a,c,u=this,l=u.constructor,d=l.precision,f=l.rounding,p=5;if(e==null)e=new l(10),t=!0;else{if(e=new l(e),r=e.d,e.s<0||!r||!r[0]||e.eq(1))return new l(NaN);t=e.eq(10)}if(r=u.d,u.s<0||!r||!r[0]||u.eq(1))return new l(r&&!r[0]?-1/0:u.s!=1?NaN:r?0:1/0);if(t)if(r.length>1)i=!0;else{for(o=r[0];o%10===0;)o/=10;i=o!==1}if(R=!1,a=d+p,s=Ae(u,a),n=t?ct(l,a+10):Ae(e,a),c=G(s,n,a,1),We(c.d,o=d,f))do if(a+=10,s=Ae(u,a),n=t?ct(l,a+10):Ae(e,a),c=G(s,n,a,1),!i){+oe(c.d).slice(o+1,o+15)+1==1e14&&(c=I(c,d+1,0));break}while(We(c.d,o+=10,f));return R=!0,I(c,d,f)};y.minus=y.sub=function(e){var t,r,n,o,i,s,a,c,u,l,d,f,p=this,m=p.constructor;if(e=new m(e),!p.d||!e.d)return!p.s||!e.s?e=new m(NaN):p.d?e.s=-e.s:e=new m(e.d||p.s!==e.s?p:NaN),e;if(p.s!=e.s)return e.s=-e.s,p.plus(e);if(u=p.d,f=e.d,a=m.precision,c=m.rounding,!u[0]||!f[0]){if(f[0])e.s=-e.s;else if(u[0])e=new m(p);else return new m(c===3?-0:0);return R?I(e,a,c):e}if(r=ie(e.e/S),l=ie(p.e/S),u=u.slice(),i=l-r,i){for(d=i<0,d?(t=u,i=-i,s=f.length):(t=f,r=l,s=u.length),n=Math.max(Math.ceil(a/S),s)+2,i>n&&(i=n,t.length=1),t.reverse(),n=i;n--;)t.push(0);t.reverse()}else{for(n=u.length,s=f.length,d=n<s,d&&(s=n),n=0;n<s;n++)if(u[n]!=f[n]){d=u[n]<f[n];break}i=0}for(d&&(t=u,u=f,f=t,e.s=-e.s),s=u.length,n=f.length-s;n>0;--n)u[s++]=0;for(n=f.length;n>i;){if(u[--n]<f[n]){for(o=n;o&&u[--o]===0;)u[o]=le-1;--u[o],u[n]+=le}u[n]-=f[n]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--r;return u[0]?(e.d=u,e.e=dt(u,r),R?I(e,a,c):e):new m(c===3?-0:0)};y.modulo=y.mod=function(e){var t,r=this,n=r.constructor;return e=new n(e),!r.d||!e.s||e.d&&!e.d[0]?new n(NaN):!e.d||r.d&&!r.d[0]?I(new n(r),n.precision,n.rounding):(R=!1,n.modulo==9?(t=G(r,e.abs(),0,3,1),t.s*=e.s):t=G(r,e,0,n.modulo,1),t=t.times(e),R=!0,r.minus(t))};y.naturalExponential=y.exp=function(){return vt(this)};y.naturalLogarithm=y.ln=function(){return Ae(this)};y.negated=y.neg=function(){var e=new this.constructor(this);return e.s=-e.s,I(e)};y.plus=y.add=function(e){var t,r,n,o,i,s,a,c,u,l,d=this,f=d.constructor;if(e=new f(e),!d.d||!e.d)return!d.s||!e.s?e=new f(NaN):d.d||(e=new f(e.d||d.s===e.s?d:NaN)),e;if(d.s!=e.s)return e.s=-e.s,d.minus(e);if(u=d.d,l=e.d,a=f.precision,c=f.rounding,!u[0]||!l[0])return l[0]||(e=new f(d)),R?I(e,a,c):e;if(i=ie(d.e/S),n=ie(e.e/S),u=u.slice(),o=i-n,o){for(o<0?(r=u,o=-o,s=l.length):(r=l,n=i,s=u.length),i=Math.ceil(a/S),s=i>s?i+1:s+1,o>s&&(o=s,r.length=1),r.reverse();o--;)r.push(0);r.reverse()}for(s=u.length,o=l.length,s-o<0&&(o=s,r=l,l=u,u=r),t=0;o;)t=(u[--o]=u[o]+l[o]+t)/le|0,u[o]%=le;for(t&&(u.unshift(t),++n),s=u.length;u[--s]==0;)u.pop();return e.d=u,e.e=dt(u,n),R?I(e,a,c):e};y.precision=y.sd=function(e){var t,r=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Ie+e);return r.d?(t=Dr(r.d),e&&r.e+1>t&&(t=r.e+1)):t=NaN,t};y.round=function(){var e=this,t=e.constructor;return I(new t(e),e.e+1,t.rounding)};y.sine=y.sin=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+Math.max(r.e,r.sd())+S,n.rounding=1,r=Yn(n,qr(n,r)),n.precision=e,n.rounding=t,I(ye>2?r.neg():r,e,t,!0)):new n(NaN)};y.squareRoot=y.sqrt=function(){var e,t,r,n,o,i,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(R=!1,u=Math.sqrt(+s),u==0||u==1/0?(t=oe(a),(t.length+c)%2==0&&(t+="0"),u=Math.sqrt(t),c=ie((c+1)/2)-(c<0||c%2),u==1/0?t="5e"+c:(t=u.toExponential(),t=t.slice(0,t.indexOf("e")+1)+c),n=new l(t)):n=new l(u.toString()),r=(c=l.precision)+3;;)if(i=n,n=i.plus(G(s,i,r+2,1)).times(.5),oe(i.d).slice(0,r)===(t=oe(n.d)).slice(0,r))if(t=t.slice(r-3,r+1),t=="9999"||!o&&t=="4999"){if(!o&&(I(i,c+1,0),i.times(i).eq(s))){n=i;break}r+=4,o=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(I(n,c+1,1),e=!n.times(n).eq(s));break}return R=!0,I(n,c,l.rounding,e)};y.tangent=y.tan=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+10,n.rounding=1,r=r.sin(),r.s=1,r=G(r,new n(1).minus(r.times(r)).sqrt(),e+10,0),n.precision=e,n.rounding=t,I(ye==2||ye==4?r.neg():r,e,t,!0)):new n(NaN)};y.times=y.mul=function(e){var t,r,n,o,i,s,a,c,u,l=this,d=l.constructor,f=l.d,p=(e=new d(e)).d;if(e.s*=l.s,!f||!f[0]||!p||!p[0])return new d(!e.s||f&&!f[0]&&!p||p&&!p[0]&&!f?NaN:!f||!p?e.s/0:e.s*0);for(r=ie(l.e/S)+ie(e.e/S),c=f.length,u=p.length,c<u&&(i=f,f=p,p=i,s=c,c=u,u=s),i=[],s=c+u,n=s;n--;)i.push(0);for(n=u;--n>=0;){for(t=0,o=c+n;o>n;)a=i[o]+p[n]*f[o-n-1]+t,i[o--]=a%le|0,t=a/le|0;i[o]=(i[o]+t)%le|0}for(;!i[--s];)i.pop();return t?++r:i.shift(),e.d=i,e.e=dt(i,r),R?I(e,d.precision,d.rounding):e};y.toBinary=function(e,t){return Dt(this,2,e,t)};y.toDecimalPlaces=y.toDP=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(ae(e,0,Se),t===void 0?t=n.rounding:ae(t,0,8),I(r,e+r.e+1,t))};y.toExponential=function(e,t){var r,n=this,o=n.constructor;return e===void 0?r=pe(n,!0):(ae(e,0,Se),t===void 0?t=o.rounding:ae(t,0,8),n=I(new o(n),e+1,t),r=pe(n,!0,e+1)),n.isNeg()&&!n.isZero()?"-"+r:r};y.toFixed=function(e,t){var r,n,o=this,i=o.constructor;return e===void 0?r=pe(o):(ae(e,0,Se),t===void 0?t=i.rounding:ae(t,0,8),n=I(new i(o),e+o.e+1,t),r=pe(n,!1,e+n.e+1)),o.isNeg()&&!o.isZero()?"-"+r:r};y.toFraction=function(e){var t,r,n,o,i,s,a,c,u,l,d,f,p=this,m=p.d,g=p.constructor;if(!m)return new g(p);if(u=r=new g(1),n=c=new g(0),t=new g(n),i=t.e=Dr(m)-p.e-1,s=i%S,t.d[0]=re(10,s<0?S+s:s),e==null)e=i>0?t:u;else{if(a=new g(e),!a.isInt()||a.lt(u))throw Error(Ie+a);e=a.gt(t)?i>0?t:u:a}for(R=!1,a=new g(oe(m)),l=g.precision,g.precision=i=m.length*S*2;d=G(a,t,0,1,1),o=r.plus(d.times(n)),o.cmp(e)!=1;)r=n,n=o,o=u,u=c.plus(d.times(o)),c=o,o=t,t=a.minus(d.times(o)),a=o;return o=G(e.minus(r),n,0,1,1),c=c.plus(o.times(u)),r=r.plus(o.times(n)),c.s=u.s=p.s,f=G(u,n,i,1).minus(p).abs().cmp(G(c,r,i,1).minus(p).abs())<1?[u,n]:[c,r],g.precision=l,R=!0,f};y.toHexadecimal=y.toHex=function(e,t){return Dt(this,16,e,t)};y.toNearest=function(e,t){var r=this,n=r.constructor;if(r=new n(r),e==null){if(!r.d)return r;e=new n(1),t=n.rounding}else{if(e=new n(e),t===void 0?t=n.rounding:ae(t,0,8),!r.d)return e.s?r:e;if(!e.d)return e.s&&(e.s=r.s),e}return e.d[0]?(R=!1,r=G(r,e,0,t,1).times(e),R=!0,I(r)):(e.s=r.s,r=e),r};y.toNumber=function(){return+this};y.toOctal=function(e,t){return Dt(this,8,e,t)};y.toPower=y.pow=function(e){var t,r,n,o,i,s,a=this,c=a.constructor,u=+(e=new c(e));if(!a.d||!e.d||!a.d[0]||!e.d[0])return new c(re(+a,u));if(a=new c(a),a.eq(1))return a;if(n=c.precision,i=c.rounding,e.eq(1))return I(a,n,i);if(t=ie(e.e/S),t>=e.d.length-1&&(r=u<0?-u:u)<=Gn)return o=Or(c,a,r,n),e.s<0?new c(1).div(o):I(o,n,i);if(s=a.s,s<0){if(t<e.d.length-1)return new c(NaN);if((e.d[t]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return r=re(+a,u),t=r==0||!isFinite(r)?ie(u*(Math.log("0."+oe(a.d))/Math.LN10+a.e+1)):new c(r+"").e,t>c.maxE+1||t<c.minE-1?new c(t>0?s/0:0):(R=!1,c.rounding=a.s=1,r=Math.min(12,(t+"").length),o=vt(e.times(Ae(a,n+r)),n),o.d&&(o=I(o,n+5,1),We(o.d,n,i)&&(t=n+10,o=I(vt(e.times(Ae(a,t+r)),t),t+5,1),+oe(o.d).slice(n+1,n+15)+1==1e14&&(o=I(o,n+1,0)))),o.s=s,R=!0,c.rounding=i,I(o,n,i))};y.toPrecision=function(e,t){var r,n=this,o=n.constructor;return e===void 0?r=pe(n,n.e<=o.toExpNeg||n.e>=o.toExpPos):(ae(e,1,Se),t===void 0?t=o.rounding:ae(t,0,8),n=I(new o(n),e,t),r=pe(n,e<=n.e||n.e<=o.toExpNeg,e)),n.isNeg()&&!n.isZero()?"-"+r:r};y.toSignificantDigits=y.toSD=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(ae(e,1,Se),t===void 0?t=n.rounding:ae(t,0,8)),I(new n(r),e,t)};y.toString=function(){var e=this,t=e.constructor,r=pe(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+r:r};y.truncated=y.trunc=function(){return I(new this.constructor(this),this.e+1,1)};y.valueOf=y.toJSON=function(){var e=this,t=e.constructor,r=pe(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+r:r};function oe(e){var t,r,n,o=e.length-1,i="",s=e[0];if(o>0){for(i+=s,t=1;t<o;t++)n=e[t]+"",r=S-n.length,r&&(i+=ke(r)),i+=n;s=e[t],n=s+"",r=S-n.length,r&&(i+=ke(r))}else if(s===0)return"0";for(;s%10===0;)s/=10;return i+s}function ae(e,t,r){if(e!==~~e||e<t||e>r)throw Error(Ie+e)}function We(e,t,r,n){var o,i,s,a;for(i=e[0];i>=10;i/=10)--t;return--t<0?(t+=S,o=0):(o=Math.ceil((t+1)/S),t%=S),i=re(10,S-t),a=e[o]%i|0,n==null?t<3?(t==0?a=a/100|0:t==1&&(a=a/10|0),s=r<4&&a==99999||r>3&&a==49999||a==5e4||a==0):s=(r<4&&a+1==i||r>3&&a+1==i/2)&&(e[o+1]/i/100|0)==re(10,t-2)-1||(a==i/2||a==0)&&(e[o+1]/i/100|0)==0:t<4?(t==0?a=a/1e3|0:t==1?a=a/100|0:t==2&&(a=a/10|0),s=(n||r<4)&&a==9999||!n&&r>3&&a==4999):s=((n||r<4)&&a+1==i||!n&&r>3&&a+1==i/2)&&(e[o+1]/i/1e3|0)==re(10,t-3)-1,s}function st(e,t,r){for(var n,o=[0],i,s=0,a=e.length;s<a;){for(i=o.length;i--;)o[i]*=t;for(o[0]+=Ft.indexOf(e.charAt(s++)),n=0;n<o.length;n++)o[n]>r-1&&(o[n+1]===void 0&&(o[n+1]=0),o[n+1]+=o[n]/r|0,o[n]%=r)}return o.reverse()}function jn(e,t){var r,n,o;if(t.isZero())return t;n=t.d.length,n<32?(r=Math.ceil(n/3),o=(1/ft(4,r)).toString()):(r=16,o="2.3283064365386962890625e-10"),e.precision+=r,t=Me(e,1,t.times(o),new e(1));for(var i=r;i--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return e.precision-=r,t}var G=function(){function e(n,o,i){var s,a=0,c=n.length;for(n=n.slice();c--;)s=n[c]*o+a,n[c]=s%i|0,a=s/i|0;return a&&n.unshift(a),n}function t(n,o,i,s){var a,c;if(i!=s)c=i>s?1:-1;else for(a=c=0;a<i;a++)if(n[a]!=o[a]){c=n[a]>o[a]?1:-1;break}return c}function r(n,o,i,s){for(var a=0;i--;)n[i]-=a,a=n[i]<o[i]?1:0,n[i]=a*s+n[i]-o[i];for(;!n[0]&&n.length>1;)n.shift()}return function(n,o,i,s,a,c){var u,l,d,f,p,m,g,T,P,x,b,w,B,A,W,M,L,v,q,H,F=n.constructor,ee=n.s==o.s?1:-1,Y=n.d,D=o.d;if(!Y||!Y[0]||!D||!D[0])return new F(!n.s||!o.s||(Y?D&&Y[0]==D[0]:!D)?NaN:Y&&Y[0]==0||!D?ee*0:ee/0);for(c?(p=1,l=n.e-o.e):(c=le,p=S,l=ie(n.e/p)-ie(o.e/p)),q=D.length,L=Y.length,P=new F(ee),x=P.d=[],d=0;D[d]==(Y[d]||0);d++);if(D[d]>(Y[d]||0)&&l--,i==null?(A=i=F.precision,s=F.rounding):a?A=i+(n.e-o.e)+1:A=i,A<0)x.push(1),m=!0;else{if(A=A/p+2|0,d=0,q==1){for(f=0,D=D[0],A++;(d<L||f)&&A--;d++)W=f*c+(Y[d]||0),x[d]=W/D|0,f=W%D|0;m=f||d<L}else{for(f=c/(D[0]+1)|0,f>1&&(D=e(D,f,c),Y=e(Y,f,c),q=D.length,L=Y.length),M=q,b=Y.slice(0,q),w=b.length;w<q;)b[w++]=0;H=D.slice(),H.unshift(0),v=D[0],D[1]>=c/2&&++v;do f=0,u=t(D,b,q,w),u<0?(B=b[0],q!=w&&(B=B*c+(b[1]||0)),f=B/v|0,f>1?(f>=c&&(f=c-1),g=e(D,f,c),T=g.length,w=b.length,u=t(g,b,T,w),u==1&&(f--,r(g,q<T?H:D,T,c))):(f==0&&(u=f=1),g=D.slice()),T=g.length,T<w&&g.unshift(0),r(b,g,w,c),u==-1&&(w=b.length,u=t(D,b,q,w),u<1&&(f++,r(b,q<w?H:D,w,c))),w=b.length):u===0&&(f++,b=[0]),x[d++]=f,u&&b[0]?b[w++]=Y[M]||0:(b=[Y[M]],w=1);while((M++<L||b[0]!==void 0)&&A--);m=b[0]!==void 0}x[0]||x.shift()}if(p==1)P.e=l,Fr=m;else{for(d=1,f=x[0];f>=10;f/=10)d++;P.e=d+l*p-1,I(P,a?i+P.e+1:i,s,m)}return P}}();function I(e,t,r,n){var o,i,s,a,c,u,l,d,f,p=e.constructor;e:if(t!=null){if(d=e.d,!d)return e;for(o=1,a=d[0];a>=10;a/=10)o++;if(i=t-o,i<0)i+=S,s=t,l=d[f=0],c=l/re(10,o-s-1)%10|0;else if(f=Math.ceil((i+1)/S),a=d.length,f>=a)if(n){for(;a++<=f;)d.push(0);l=c=0,o=1,i%=S,s=i-S+1}else break e;else{for(l=a=d[f],o=1;a>=10;a/=10)o++;i%=S,s=i-S+o,c=s<0?0:l/re(10,o-s-1)%10|0}if(n=n||t<0||d[f+1]!==void 0||(s<0?l:l%re(10,o-s-1)),u=r<4?(c||n)&&(r==0||r==(e.s<0?3:2)):c>5||c==5&&(r==4||n||r==6&&(i>0?s>0?l/re(10,o-s):0:d[f-1])%10&1||r==(e.s<0?8:7)),t<1||!d[0])return d.length=0,u?(t-=e.e+1,d[0]=re(10,(S-t%S)%S),e.e=-t||0):d[0]=e.e=0,e;if(i==0?(d.length=f,a=1,f--):(d.length=f+1,a=re(10,S-i),d[f]=s>0?(l/re(10,o-s)%re(10,s)|0)*a:0),u)for(;;)if(f==0){for(i=1,s=d[0];s>=10;s/=10)i++;for(s=d[0]+=a,a=1;s>=10;s/=10)a++;i!=a&&(e.e++,d[0]==le&&(d[0]=1));break}else{if(d[f]+=a,d[f]!=le)break;d[f--]=0,a=1}for(i=d.length;d[--i]===0;)d.pop()}return R&&(e.e>p.maxE?(e.d=null,e.e=NaN):e.e<p.minE&&(e.e=0,e.d=[0])),e}function pe(e,t,r){if(!e.isFinite())return Ur(e);var n,o=e.e,i=oe(e.d),s=i.length;return t?(r&&(n=r-s)>0?i=i.charAt(0)+"."+i.slice(1)+ke(n):s>1&&(i=i.charAt(0)+"."+i.slice(1)),i=i+(e.e<0?"e":"e+")+e.e):o<0?(i="0."+ke(-o-1)+i,r&&(n=r-s)>0&&(i+=ke(n))):o>=s?(i+=ke(o+1-s),r&&(n=r-o-1)>0&&(i=i+"."+ke(n))):((n=o+1)<s&&(i=i.slice(0,n)+"."+i.slice(n)),r&&(n=r-s)>0&&(o+1===s&&(i+="."),i+=ke(n))),i}function dt(e,t){var r=e[0];for(t*=S;r>=10;r/=10)t++;return t}function ct(e,t,r){if(t>Hn)throw R=!0,r&&(e.precision=r),Error(Nr);return I(new e(at),t,1,!0)}function ce(e,t,r){if(t>Mt)throw Error(Nr);return I(new e(ut),t,r,!0)}function Dr(e){var t=e.length-1,r=t*S+1;if(t=e[t],t){for(;t%10==0;t/=10)r--;for(t=e[0];t>=10;t/=10)r++}return r}function ke(e){for(var t="";e--;)t+="0";return t}function Or(e,t,r,n){var o,i=new e(1),s=Math.ceil(n/S+4);for(R=!1;;){if(r%2&&(i=i.times(t),Vr(i.d,s)&&(o=!0)),r=ie(r/2),r===0){r=i.d.length-1,o&&i.d[r]===0&&++i.d[r];break}t=t.times(t),Vr(t.d,s)}return R=!0,i}function Cr(e){return e.d[e.d.length-1]&1}function Wr(e,t,r){for(var n,o=new e(t[0]),i=0;++i<t.length;)if(n=new e(t[i]),n.s)o[r](n)&&(o=n);else{o=n;break}return o}function vt(e,t){var r,n,o,i,s,a,c,u=0,l=0,d=0,f=e.constructor,p=f.rounding,m=f.precision;if(!e.d||!e.d[0]||e.e>17)return new f(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:0/0);for(t==null?(R=!1,c=m):c=t,a=new f(.03125);e.e>-2;)e=e.times(a),d+=5;for(n=Math.log(re(2,d))/Math.LN10*2+5|0,c+=n,r=i=s=new f(1),f.precision=c;;){if(i=I(i.times(e),c,1),r=r.times(++l),a=s.plus(G(i,r,c,1)),oe(a.d).slice(0,c)===oe(s.d).slice(0,c)){for(o=d;o--;)s=I(s.times(s),c,1);if(t==null)if(u<3&&We(s.d,c-n,p,u))f.precision=c+=10,r=i=a=new f(1),l=0,u++;else return I(s,f.precision=m,p,R=!0);else return f.precision=m,s}s=a}}function Ae(e,t){var r,n,o,i,s,a,c,u,l,d,f,p=1,m=10,g=e,T=g.d,P=g.constructor,x=P.rounding,b=P.precision;if(g.s<0||!T||!T[0]||!g.e&&T[0]==1&&T.length==1)return new P(T&&!T[0]?-1/0:g.s!=1?NaN:T?0:g);if(t==null?(R=!1,l=b):l=t,P.precision=l+=m,r=oe(T),n=r.charAt(0),Math.abs(i=g.e)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)g=g.times(e),r=oe(g.d),n=r.charAt(0),p++;i=g.e,n>1?(g=new P("0."+r),i++):g=new P(n+"."+r.slice(1))}else return u=ct(P,l+2,b).times(i+""),g=Ae(new P(n+"."+r.slice(1)),l-m).plus(u),P.precision=b,t==null?I(g,b,x,R=!0):g;for(d=g,c=s=g=G(g.minus(1),g.plus(1),l,1),f=I(g.times(g),l,1),o=3;;){if(s=I(s.times(f),l,1),u=c.plus(G(s,new P(o),l,1)),oe(u.d).slice(0,l)===oe(c.d).slice(0,l))if(c=c.times(2),i!==0&&(c=c.plus(ct(P,l+2,b).times(i+""))),c=G(c,new P(p),l,1),t==null)if(We(c.d,l-m,x,a))P.precision=l+=m,u=s=g=G(d.minus(1),d.plus(1),l,1),f=I(g.times(g),l,1),o=a=1;else return I(c,P.precision=b,x,R=!0);else return P.precision=b,c;c=u,o+=2}}function Ur(e){return String(e.s*e.s/0)}function _t(e,t){var r,n,o;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;n++);for(o=t.length;t.charCodeAt(o-1)===48;--o);if(t=t.slice(n,o),t){if(o-=n,e.e=r=r-n-1,e.d=[],n=(r+1)%S,r<0&&(n+=S),n<o){for(n&&e.d.push(+t.slice(0,n)),o-=S;n<o;)e.d.push(+t.slice(n,n+=S));t=t.slice(n),n=S-t.length}else n-=o;for(;n--;)t+="0";e.d.push(+t),R&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function zn(e,t){var r,n,o,i,s,a,c,u,l;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),_r.test(t))return _t(e,t)}else if(t==="Infinity"||t==="NaN")return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(Un.test(t))r=16,t=t.toLowerCase();else if(Wn.test(t))r=2;else if(qn.test(t))r=8;else throw Error(Ie+t);for(i=t.search(/p/i),i>0?(c=+t.slice(i+1),t=t.substring(2,i)):t=t.slice(2),i=t.indexOf("."),s=i>=0,n=e.constructor,s&&(t=t.replace(".",""),a=t.length,i=a-i,o=Or(n,new n(r),i,i*2)),u=st(t,r,le),l=u.length-1,i=l;u[i]===0;--i)u.pop();return i<0?new n(e.s*0):(e.e=dt(u,l),e.d=u,R=!1,s&&(e=G(e,o,a*4)),c&&(e=e.times(Math.abs(c)<54?re(2,c):Ue.pow(2,c))),R=!0,e)}function Yn(e,t){var r,n=t.d.length;if(n<3)return t.isZero()?t:Me(e,2,t,t);r=1.4*Math.sqrt(n),r=r>16?16:r|0,t=t.times(1/ft(5,r)),t=Me(e,2,t,t);for(var o,i=new e(5),s=new e(16),a=new e(20);r--;)o=t.times(t),t=t.times(i.plus(o.times(s.times(o).minus(a))));return t}function Me(e,t,r,n,o){var i,s,a,c,u=1,l=e.precision,d=Math.ceil(l/S);for(R=!1,c=r.times(r),a=new e(n);;){if(s=G(a.times(c),new e(t++*t++),l,1),a=o?n.plus(s):n.minus(s),n=G(s.times(c),new e(t++*t++),l,1),s=a.plus(n),s.d[d]!==void 0){for(i=d;s.d[i]===a.d[i]&&i--;);if(i==-1)break}i=a,a=n,n=s,s=i,u++}return R=!0,s.d.length=d+1,s}function ft(e,t){for(var r=e;--t;)r*=e;return r}function qr(e,t){var r,n=t.s<0,o=ce(e,e.precision,1),i=o.times(.5);if(t=t.abs(),t.lte(i))return ye=n?4:1,t;if(r=t.divToInt(o),r.isZero())ye=n?3:2;else{if(t=t.minus(r.times(o)),t.lte(i))return ye=Cr(r)?n?2:3:n?4:1,t;ye=Cr(r)?n?1:4:n?3:2}return t.minus(o).abs()}function Dt(e,t,r,n){var o,i,s,a,c,u,l,d,f,p=e.constructor,m=r!==void 0;if(m?(ae(r,1,Se),n===void 0?n=p.rounding:ae(n,0,8)):(r=p.precision,n=p.rounding),!e.isFinite())l=Ur(e);else{for(l=pe(e),s=l.indexOf("."),m?(o=2,t==16?r=r*4-3:t==8&&(r=r*3-2)):o=t,s>=0&&(l=l.replace(".",""),f=new p(1),f.e=l.length-s,f.d=st(pe(f),10,o),f.e=f.d.length),d=st(l,10,o),i=c=d.length;d[--c]==0;)d.pop();if(!d[0])l=m?"0p+0":"0";else{if(s<0?i--:(e=new p(e),e.d=d,e.e=i,e=G(e,f,r,n,0,o),d=e.d,i=e.e,u=Fr),s=d[r],a=o/2,u=u||d[r+1]!==void 0,u=n<4?(s!==void 0||u)&&(n===0||n===(e.s<0?3:2)):s>a||s===a&&(n===4||u||n===6&&d[r-1]&1||n===(e.s<0?8:7)),d.length=r,u)for(;++d[--r]>o-1;)d[r]=0,r||(++i,d.unshift(1));for(c=d.length;!d[c-1];--c);for(s=0,l="";s<c;s++)l+=Ft.charAt(d[s]);if(m){if(c>1)if(t==16||t==8){for(s=t==16?4:3,--c;c%s;c++)l+="0";for(d=st(l,o,t),c=d.length;!d[c-1];--c);for(s=1,l="1.";s<c;s++)l+=Ft.charAt(d[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(i<0?"p":"p+")+i}else if(i<0){for(;++i;)l="0"+l;l="0."+l}else if(++i>c)for(i-=c;i--;)l+="0";else i<c&&(l=l.slice(0,i)+"."+l.slice(i))}l=(t==16?"0x":t==2?"0b":t==8?"0o":"")+l}return e.s<0?"-"+l:l}function Vr(e,t){if(e.length>t)return e.length=t,!0}function Zn(e){return new this(e).abs()}function Xn(e){return new this(e).acos()}function Jn(e){return new this(e).acosh()}function Qn(e,t){return new this(e).plus(t)}function $n(e){return new this(e).asin()}function eo(e){return new this(e).asinh()}function to(e){return new this(e).atan()}function ro(e){return new this(e).atanh()}function no(e,t){e=new this(e),t=new this(t);var r,n=this.precision,o=this.rounding,i=n+4;return!e.s||!t.s?r=new this(NaN):!e.d&&!t.d?(r=ce(this,i,1).times(t.s>0?.25:.75),r.s=e.s):!t.d||e.isZero()?(r=t.s<0?ce(this,n,o):new this(0),r.s=e.s):!e.d||t.isZero()?(r=ce(this,i,1).times(.5),r.s=e.s):t.s<0?(this.precision=i,this.rounding=1,r=this.atan(G(e,t,i,1)),t=ce(this,i,1),this.precision=n,this.rounding=o,r=e.s<0?r.minus(t):r.plus(t)):r=this.atan(G(e,t,i,1)),r}function oo(e){return new this(e).cbrt()}function io(e){return I(e=new this(e),e.e+1,2)}function so(e,t,r){return new this(e).clamp(t,r)}function ao(e){if(!e||typeof e!="object")throw Error(lt+"Object expected");var t,r,n,o=e.defaults===!0,i=["precision",1,Se,"rounding",0,8,"toExpNeg",-Ne,0,"toExpPos",0,Ne,"maxE",0,Ne,"minE",-Ne,0,"modulo",0,9];for(t=0;t<i.length;t+=3)if(r=i[t],o&&(this[r]=Nt[r]),(n=e[r])!==void 0)if(ie(n)===n&&n>=i[t+1]&&n<=i[t+2])this[r]=n;else throw Error(Ie+r+": "+n);if(r="crypto",o&&(this[r]=Nt[r]),(n=e[r])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[r]=!0;else throw Error(Mr);else this[r]=!1;else throw Error(Ie+r+": "+n);return this}function uo(e){return new this(e).cos()}function co(e){return new this(e).cosh()}function Gr(e){var t,r,n;function o(i){var s,a,c,u=this;if(!(u instanceof o))return new o(i);if(u.constructor=o,Er(i)){u.s=i.s,R?!i.d||i.e>o.maxE?(u.e=NaN,u.d=null):i.e<o.minE?(u.e=0,u.d=[0]):(u.e=i.e,u.d=i.d.slice()):(u.e=i.e,u.d=i.d?i.d.slice():i.d);return}if(c=typeof i,c==="number"){if(i===0){u.s=1/i<0?-1:1,u.e=0,u.d=[0];return}if(i<0?(i=-i,u.s=-1):u.s=1,i===~~i&&i<1e7){for(s=0,a=i;a>=10;a/=10)s++;R?s>o.maxE?(u.e=NaN,u.d=null):s<o.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[i]):(u.e=s,u.d=[i]);return}else if(i*0!==0){i||(u.s=NaN),u.e=NaN,u.d=null;return}return _t(u,i.toString())}else if(c!=="string")throw Error(Ie+i);return(a=i.charCodeAt(0))===45?(i=i.slice(1),u.s=-1):(a===43&&(i=i.slice(1)),u.s=1),_r.test(i)?_t(u,i):zn(u,i)}if(o.prototype=y,o.ROUND_UP=0,o.ROUND_DOWN=1,o.ROUND_CEIL=2,o.ROUND_FLOOR=3,o.ROUND_HALF_UP=4,o.ROUND_HALF_DOWN=5,o.ROUND_HALF_EVEN=6,o.ROUND_HALF_CEIL=7,o.ROUND_HALF_FLOOR=8,o.EUCLID=9,o.config=o.set=ao,o.clone=Gr,o.isDecimal=Er,o.abs=Zn,o.acos=Xn,o.acosh=Jn,o.add=Qn,o.asin=$n,o.asinh=eo,o.atan=to,o.atanh=ro,o.atan2=no,o.cbrt=oo,o.ceil=io,o.clamp=so,o.cos=uo,o.cosh=co,o.div=lo,o.exp=fo,o.floor=po,o.hypot=mo,o.ln=go,o.log=yo,o.log10=bo,o.log2=ho,o.max=wo,o.min=xo,o.mod=Po,o.mul=To,o.pow=ko,o.random=Ao,o.round=Io,o.sign=So,o.sin=Lo,o.sinh=Bo,o.sqrt=Ro,o.sub=Ko,o.sum=Co,o.tan=Vo,o.tanh=Eo,o.trunc=Fo,e===void 0&&(e={}),e&&e.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return o.config(e),o}function lo(e,t){return new this(e).div(t)}function fo(e){return new this(e).exp()}function po(e){return I(e=new this(e),e.e+1,3)}function mo(){var e,t,r=new this(0);for(R=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)r.d&&(r=r.plus(t.times(t)));else{if(t.s)return R=!0,new this(1/0);r=t}return R=!0,r.sqrt()}function Er(e){return e instanceof Ue||e&&e.toStringTag===vr||!1}function go(e){return new this(e).ln()}function yo(e,t){return new this(e).log(t)}function ho(e){return new this(e).log(2)}function bo(e){return new this(e).log(10)}function wo(){return Wr(this,arguments,"lt")}function xo(){return Wr(this,arguments,"gt")}function Po(e,t){return new this(e).mod(t)}function To(e,t){return new this(e).mul(t)}function ko(e,t){return new this(e).pow(t)}function Ao(e){var t,r,n,o,i=0,s=new this(1),a=[];if(e===void 0?e=this.precision:ae(e,1,Se),n=Math.ceil(e/S),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(n));i<n;)o=t[i],o>=429e7?t[i]=crypto.getRandomValues(new Uint32Array(1))[0]:a[i++]=o%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(n*=4);i<n;)o=t[i]+(t[i+1]<<8)+(t[i+2]<<16)+((t[i+3]&127)<<24),o>=214e7?crypto.randomBytes(4).copy(t,i):(a.push(o%1e7),i+=4);i=n/4}else throw Error(Mr);else for(;i<n;)a[i++]=Math.random()*1e7|0;for(n=a[--i],e%=S,n&&e&&(o=re(10,S-e),a[i]=(n/o|0)*o);a[i]===0;i--)a.pop();if(i<0)r=0,a=[0];else{for(r=-1;a[0]===0;r-=S)a.shift();for(n=1,o=a[0];o>=10;o/=10)n++;n<S&&(r-=S-n)}return s.e=r,s.d=a,s}function Io(e){return I(e=new this(e),e.e+1,this.rounding)}function So(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function Lo(e){return new this(e).sin()}function Bo(e){return new this(e).sinh()}function Ro(e){return new this(e).sqrt()}function Ko(e,t){return new this(e).sub(t)}function Co(){var e=0,t=arguments,r=new this(t[e]);for(R=!1;r.s&&++e<t.length;)r=r.plus(t[e]);return R=!0,I(r,this.precision,this.rounding)}function Vo(e){return new this(e).tan()}function Eo(e){return new this(e).tanh()}function Fo(e){return I(e=new this(e),e.e+1,1)}y[Symbol.for("nodejs.util.inspect.custom")]=y.toString;y[Symbol.toStringTag]="Decimal";var Ue=y.constructor=Gr(Nt);at=new Ue(at);ut=new Ue(ut);var Ot=Ue;import Uo from"big.js";import gt from"bn.js";import No from"toformat";var Mo=No,qe=Mo;import mt from"big.js";import _o from"bn.js";import Do from"decimal.js-light";import Ge from"bn.js";var Hr=9007199254740991;function V(e){let t=Q("Raydium_parseBigNumberish");if(e instanceof Ge)return e;if(typeof e=="string"){if(e.match(/^-?[0-9]+$/))return new Ge(e);t.logWithError(`invalid BigNumberish string: ${e}`)}return typeof e=="number"?(e%1&&t.logWithError(`BigNumberish number underflow: ${e}`),(e>=Hr||e<=-Hr)&&t.logWithError(`BigNumberish number overflow: ${e}`),new Ge(String(e))):typeof e=="bigint"?new Ge(e.toString()):(t.error(`invalid BigNumberish value: ${e}`),new Ge(0))}var pt=Q("module/fraction"),Wt=qe(mt),He=qe(Do),Oo={[0]:He.ROUND_DOWN,[1]:He.ROUND_HALF_UP,[2]:He.ROUND_UP},Wo={[0]:mt.roundDown,[1]:mt.roundHalfUp,[2]:mt.roundUp},O=class{constructor(t,r=new _o(1)){this.numerator=V(t),this.denominator=V(r)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new O(this.denominator,this.numerator)}add(t){let r=t instanceof O?t:new O(V(t));return this.denominator.eq(r.denominator)?new O(this.numerator.add(r.numerator),this.denominator):new O(this.numerator.mul(r.denominator).add(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}sub(t){let r=t instanceof O?t:new O(V(t));return this.denominator.eq(r.denominator)?new O(this.numerator.sub(r.numerator),this.denominator):new O(this.numerator.mul(r.denominator).sub(r.numerator.mul(this.denominator)),this.denominator.mul(r.denominator))}mul(t){let r=t instanceof O?t:new O(V(t));return new O(this.numerator.mul(r.numerator),this.denominator.mul(r.denominator))}div(t){let r=t instanceof O?t:new O(V(t));return new O(this.numerator.mul(r.denominator),this.denominator.mul(r.numerator))}toSignificant(t,r={groupSeparator:""},n=1){Number.isInteger(t)||pt.logWithError(`${t} is not an integer.`),t<=0&&pt.logWithError(`${t} is not positive.`),He.set({precision:t+1,rounding:Oo[n]});let o=new He(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return o.toFormat(o.decimalPlaces(),r)}toFixed(t,r={groupSeparator:""},n=1){return Number.isInteger(t)||pt.logWithError(`${t} is not an integer.`),t<0&&pt.logWithError(`${t} is negative.`),Wt.DP=t,Wt.RM=Wo[n]||1,new Wt(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,r)}isZero(){return this.numerator.isZero()}};var qo=Q("Raydium_amount"),jr=qe(Uo);function Go(e,t){let r="0",n="0";if(e.includes(".")){let o=e.split(".");o.length===2?([r,n]=o,n=n.padEnd(t,"0")):qo.logWithError(`invalid number string, num: ${e}`)}else r=e;return[r,n.slice(0,t)||n]}var he=class extends O{constructor(r,n,o=!0,i){let s=new gt(0),a=Ut.pow(new gt(r.decimals));if(o)s=V(n);else{let c=new gt(0),u=new gt(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,d]=Go(n.toString(),r.decimals);c=V(l),u=V(d)}c=c.mul(a),s=c.add(u)}super(s,a);this.logger=Q(i||"TokenAmount"),this.token=r}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(r){return this.token.equals(r.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(r.raw)}lt(r){return this.token.equals(r.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(r.raw)}add(r){return this.token.equals(r.token)||this.logger.logWithError("add token not equals"),new he(this.token,this.raw.add(r.raw))}subtract(r){return this.token.equals(r.token)||this.logger.logWithError("sub token not equals"),new he(this.token,this.raw.sub(r.raw))}toSignificant(r=this.token.decimals,n,o=0){return super.toSignificant(r,n,o)}toFixed(r=this.token.decimals,n,o=0){return r>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(r,n,o)}toExact(r={groupSeparator:""}){return jr.DP=this.token.decimals,new jr(this.numerator.toString()).div(this.denominator.toString()).toFormat(r)}};import{PublicKey as Ho}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as zr}from"@solana/spl-token";var Yr={chainId:101,address:Ho.default.toBase58(),programId:zr.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},se={chainId:101,address:"So11111111111111111111111111111111111111112",programId:zr.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Ht}from"@solana/web3.js";import{PublicKey as X,SystemProgram as Zr,SYSVAR_RENT_PUBKEY as jo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as zo}from"@solana/spl-token";function h({pubkey:e,isSigner:t=!1,isWritable:r=!0}){return{pubkey:e,isWritable:r,isSigner:t}}var qt=[h({pubkey:zo,isWritable:!1}),h({pubkey:Zr.programId,isWritable:!1}),h({pubkey:jo,isWritable:!1})];function Xr({publicKey:e,transformSol:t}){let r=Gt(e.toString());if(r instanceof X)return t&&r.equals(ne)?ge:r;if(t&&r.toString()===ne.toBase58())return ge;if(typeof r=="string"){if(r===X.default.toBase58())return X.default;try{return new X(r)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Gt(e){try{return new X(e)}catch{return e}}var Ys=new X("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Zs=new X("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Yo=new X("SysvarRent111111111111111111111111111111111"),Xs=new X("SysvarC1ock11111111111111111111111111111111"),Js=new X("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Zo=new X("Sysvar1nstructions1111111111111111111111111"),Qs=Zr.programId,$s=new X("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),ea=new X("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ta=new X("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ra=new X("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),na=new X("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),oa=new X("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ia=new X("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),sa=new X("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),aa=new X("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),ua=new X("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),ca=new X("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ge=new X("So11111111111111111111111111111111111111112"),ne=X.default;var jt=class{constructor({mint:t,decimals:r,symbol:n,name:o,skipMint:i=!1,isToken2022:s=!1}){if(t===ne.toBase58()||t instanceof Ht&&ne.equals(t)){this.decimals=se.decimals,this.symbol=se.symbol,this.name=se.name,this.mint=new Ht(se.address),this.isToken2022=!1;return}this.decimals=r,this.symbol=n||t.toString().substring(0,6),this.name=o||t.toString().substring(0,6),this.mint=i?Ht.default:Xr({publicKey:t}),this.isToken2022=s}equals(t){return this===t?!0:this.mint.equals(t.mint)}},Ce=jt;Ce.WSOL=new jt(te(j({},se),{mint:se.address}));var zt=class{constructor({decimals:t,symbol:r="UNKNOWN",name:n="UNKNOWN"}){this.decimals=t,this.symbol=r,this.name=n}equals(t){return this===t}},yt=zt;yt.SOL=new zt(Yr);import Xo from"bn.js";var Jr=new O(new Xo(100)),ve=class extends O{toSignificant(t=5,r,n){return this.mul(Jr).toSignificant(t,r,n)}toFixed(t=2,r,n){return this.mul(Jr).toFixed(t,r,n)}};var Jo=Q("Raydium_price"),be=class extends O{constructor(r){let{baseToken:n,quoteToken:o,numerator:i,denominator:s}=r;super(i,s);this.baseToken=n,this.quoteToken=o,this.scalar=new O(Yt(n.decimals),Yt(o.decimals))}get raw(){return new O(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new be({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(r){this.quoteToken!==r.baseToken&&Jo.logWithError("mul token not equals");let n=super.mul(r);return new be({baseToken:this.baseToken,quoteToken:r.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(r=this.quoteToken.decimals,n,o){return this.adjusted.toSignificant(r,n,o)}toFixed(r=this.quoteToken.decimals,n,o){return this.adjusted.toFixed(r,n,o)}};import{PublicKey as Qo}from"@solana/web3.js";import $o from"bn.js";function Qr(e){return typeof e=="object"&&e!==null&&![Ce,he,Qo,O,$o,be,ve].some(t=>typeof t=="object"&&e instanceof t)}function we(e){return typeof e=="string"?Gt(e):Array.isArray(e)?e.map(t=>we(t)):Qr(e)?Object.fromEntries(Object.entries(e).map(([t,r])=>[t,we(r)])):e}var Zt=new xe(0),ou=new xe(1),iu=new xe(2),su=new xe(3),au=new xe(5),Ut=new xe(10),uu=new xe(100),cu=new xe(1e3),lu=new xe(1e4);function Yt(e){return Ut.pow(V(e))}function Et(e,t=1,r=[]){let n=[...e];if(t<=0)return r;for(;n.length;)r.push(n.splice(0,t));return r}import{PublicKey as si}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ai}from"@solana/spl-token";import{ComputeBudgetProgram as $r,Keypair as tn,PublicKey as ei,Transaction as rn,TransactionMessage as ti,VersionedTransaction as nn}from"@solana/web3.js";var z={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{TOKEN_PROGRAM_ID as ri}from"@solana/spl-token";var en=Q("Raydium_txUtil"),on=1644;function ht(e){let t=[],r=[];return e.microLamports&&(t.push($r.setComputeUnitPrice({microLamports:e.microLamports})),r.push(z.SetComputeUnitPrice)),e.units&&(t.push($r.setComputeUnitLimit({units:e.units})),r.push(z.SetComputeUnitLimit)),{instructions:t,instructionTypes:r}}async function _e(e,t){var n,o;let r=t!=null?t:"confirmed";return(o=await((n=e.getLatestBlockhash)==null?void 0:n.call(e,{commitment:r})))==null?void 0:o.blockhash}async function bt(e,t){return e.getSignatureStatuses([t]),new Promise((r,n)=>{let o=setTimeout(n,6e4);e.onSignature(t,i=>{if(clearTimeout(o),!i.err){r("");return}n(i.err.toString())},"confirmed")})}function ni(e,t){e.length<1&&en.logWithError(`no instructions provided: ${e.toString()}`),t.length<1&&en.logWithError(`no signers provided:, ${t.toString()}`);let r=new rn;r.recentBlockhash="11111111111111111111111111111111",r.feePayer=t[0],r.add(...e);try{return Buffer.from(r.serialize({verifySignatures:!1})).toString("base64").length<on}catch{return!1}}function Ve(e,t){let[r,n]=ei.findProgramAddressSync(e,t);return{publicKey:r,nonce:n}}function je({instructions:e,payer:t,signers:r}){return ni(e,[t,...r])}function ze({instructions:e,payer:t,lookupTableAddressAccount:r,recentBlockhash:n=tn.generate().publicKey.toString()}){let i=new ti({payerKey:t,recentBlockhash:n,instructions:e}).compileToV0Message(Object.values(r!=null?r:{}));try{return Buffer.from(new nn(i).serialize()).toString("base64").length<on}catch{return!1}}var oi=e=>Buffer.isBuffer(e)?e:e instanceof Uint8Array?Buffer.from(e.buffer,e.byteOffset,e.byteLength):Buffer.from(e),ii=e=>{let t=e.serialize({requireAllSignatures:!1,verifySignatures:!1});e instanceof nn&&(t=oi(t));try{return t instanceof Buffer?t.toString("base64"):Buffer.from(t).toString("base64")}catch{return t.toString("base64")}};function Ee(e){let t=[];return e.forEach(r=>{r instanceof rn&&(r.recentBlockhash||(r.recentBlockhash=ri.toBase58()),r.feePayer||(r.feePayer=tn.generate().publicKey)),t.push(ii(r))}),console.log("simulate tx string:",t),t}function De(e,t,r){return Ve([e.toBuffer(),(r!=null?r:ai).toBuffer(),t.toBuffer()],new si("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as N}from"@solana/web3.js";var sn=new N("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),an=new N("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Ye=new N("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Cu=new N("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Vu=new N("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Eu=new N("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Fu=new N("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Nu=new N("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Mu=new N("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),vu=new N("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),_u=new N("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Du=new N("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Ou=new N("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Wu=new N("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Uu=new N("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),qu=new N("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Gu=new N("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Hu=new N("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),ju=new N("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),zu=new N("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Yu=new N("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),ui=new N("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),ci=new N("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),li=new N("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");var Zu={SERUM_MARKET:N.default,OPENBOOK_MARKET:new N("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:N.default,FarmV3:new N("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new N("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new N("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new N("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new N("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new N("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new N("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new N("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new N("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:ui,CREATE_CPMM_POOL_AUTH:ci,CREATE_CPMM_POOL_FEE_ACC:li,FEE_DESTINATION_ID:new N("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import Qu from"bn.js";import{PublicKey as un,AddressLookupTableAccount as wt}from"@solana/web3.js";async function Xt({connection:e,address:t}){let r=await Kr(e,[...new Set(t.map(o=>o.toString()))].map(o=>new un(o))),n={};for(let o=0;o<t.length;o++){let i=r[o],s=t[o];if(!i)continue;let a=new wt({key:s,state:wt.deserialize(i.data)});n[s.toString()]=a,xt[s.toString()]=a}return n}var xt={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new wt({key:new un("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:wt.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as Ze,sendAndConfirmTransaction as Jt,Transaction as Xe,TransactionMessage as Je,VersionedTransaction as Qe}from"@solana/web3.js";import fi from"axios";var Pt=class{constructor(t){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner,this.cluster=t.cluster,this.blockhashCommitment=t.blockhashCommitment,this.api=t.api}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let t=(await fi.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:r}=(n=t==null?void 0:t[15])!=null?n:{};if(!!r)return{units:6e5,microLamports:Math.min(Math.ceil(r*1e6/6e5),25e3)}}addCustomComputeBudget(t){if(t){let{instructions:r,instructionTypes:n}=ht(t);return this.instructions.unshift(...r),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:t,defaultIns:r}){try{let n=t||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;r&&this.instructions.unshift(...r)}catch{r&&this.instructions.unshift(...r)}}addInstruction({instructions:t=[],endInstructions:r=[],signers:n=[],instructionTypes:o=[],endInstructionTypes:i=[],lookupTableAddress:s=[]}){return this.instructions.push(...t),this.endInstructions.push(...r),this.signers.push(...n),this.instructionTypes.push(...o),this.endInstructionTypes.push(...i),this.lookupTableAddress.push(...s.filter(a=>a!==Ze.default.toString())),this}async versionBuild({txVersion:t,extInfo:r}){return t===0?await this.buildV0(j({},r||{})):this.build(r)}build(t){var n;let r=new Xe;return this.allInstructions.length&&r.add(...this.allInstructions),r.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(o=>o.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:r,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async o=>{var u;let{recentBlockHash:i,skipPreflight:s=!0,sendAndConfirm:a}=o||{},c=i!=null?i:await _e(this.connection,this.blockhashCommitment);if(r.recentBlockhash=c,this.signers.length&&r.sign(...this.signers),Ee([r]),(u=this.owner)!=null&&u.isKeyPair)return{txId:a?await Jt(this.connection,r,this.signers.find(d=>d.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(r.serialize(),{skipPreflight:s}),signedTx:r};if(this.signAllTransactions){let l=await this.signAllTransactions([r]);return{txId:await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:t||{}}}buildMultiTx(t){var u;let{extraPreBuildData:r=[],extInfo:n}=t,{transaction:o}=this.build(n),i=r.filter(l=>l.transaction.instructions.length>0),s=[o,...i.map(l=>l.transaction)],a=[this.signers,...i.map(l=>l.signers)],c=[...this.instructionTypes,...i.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(d=>d.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async l=>{var T;let{sequentially:d,onTxUpdate:f,recentBlockHash:p,skipPreflight:m=!0}=l||{},g=p!=null?p:await _e(this.connection,this.blockhashCommitment);if((T=this.owner)!=null&&T.isKeyPair){if(d){let P=[];for(let x of s){let b=await Jt(this.connection,x,this.signers.find(w=>w.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:m});P.push(b)}return{txIds:P,signedTxs:s}}return{txIds:await await Promise.all(s.map(async P=>(P.recentBlockhash=g,await this.connection.sendRawTransaction(P.serialize(),{skipPreflight:m})))),signedTxs:s}}if(this.signAllTransactions){let P=s.map((b,w)=>(b.recentBlockhash=g,a[w].length&&b.sign(...a[w]),b));Ee(P);let x=await this.signAllTransactions(P);if(d){let b=0,w=[],B=async()=>{if(!x[b])return;let A=await this.connection.sendRawTransaction(x[b].serialize(),{skipPreflight:m});w.push({txId:A,status:"sent",signedTx:x[b]}),f==null||f([...w]),b++,this.connection.onSignature(A,W=>{let M=w.findIndex(L=>L.txId===A);M>-1&&(w[M].status=W.err?"error":"success"),f==null||f([...w]),W.err||B()},"processed"),this.connection.getSignatureStatus(A)};return await B(),{txIds:w.map(A=>A.txId),signedTxs:x}}else{let b=[];for(let w=0;w<x.length;w+=1){let B=await this.connection.sendRawTransaction(x[w].serialize(),{skipPreflight:m});b.push(B)}return{txIds:b,signedTxs:x}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:t,txVersion:r,extInfo:n}){return r===0?await this.buildV0MultiTx({extraPreBuildData:t,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:t,extInfo:n})}async buildV0(t){var g;let m=t||{},{lookupTableCache:r={},lookupTableAddress:n=[],forerunCreate:o,recentBlockhash:i}=m,s=it(m,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=j(j({},this.cluster==="devnet"?{}:xt),r),c=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let T of c)a[T]===void 0&&u.push(new Ze(T));let l=await Xt({connection:this.connection,address:u});for(let[T,P]of Object.entries(l))a[T]=P;let d=o?Ze.default.toBase58():i!=null?i:await _e(this.connection,this.blockhashCommitment),f=new Je({payerKey:this.feePayer,recentBlockhash:d,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((g=this.owner)==null?void 0:g.signer)&&!this.signers.some(T=>T.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let p=new Qe(f);return p.sign(this.signers),{builder:this,transaction:p,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async T=>{var b;let{skipPreflight:P=!0,sendAndConfirm:x}=T||{};if(Ee([p]),(b=this.owner)!=null&&b.isKeyPair){let w=await this.connection.sendTransaction(p,{skipPreflight:P});return x&&await bt(this.connection,w),{txId:w,signedTx:p}}if(this.signAllTransactions){let w=await this.signAllTransactions([p]);return{txId:await this.connection.sendTransaction(w[0],{skipPreflight:P}),signedTx:w[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(t){var u;let{extraPreBuildData:r=[],buildProps:n}=t,{transaction:o}=await this.buildV0(n),i=r.filter(l=>l.builder.instructions.length>0),s=[o,...i.map(l=>l.transaction)],a=[this.signers,...i.map(l=>l.signers)],c=[...this.instructionTypes,...i.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(d=>d.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,d)=>{l.sign(a[d])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async l=>{var g;let{sequentially:d,onTxUpdate:f,recentBlockHash:p,skipPreflight:m=!0}=l||{};if(p&&s.forEach(T=>T.message.recentBlockhash=p),Ee(s),(g=this.owner)!=null&&g.isKeyPair){if(d){let T=[];for(let P of s){let x=await this.connection.sendTransaction(P,{skipPreflight:m});await bt(this.connection,x),T.push(x)}return{txIds:T,signedTxs:s}}return{txIds:await Promise.all(s.map(async T=>await this.connection.sendTransaction(T,{skipPreflight:m}))),signedTxs:s}}if(this.signAllTransactions){let T=await this.signAllTransactions(s);if(d){let P=0,x=[],b=async()=>{if(!T[P])return;let w=await this.connection.sendTransaction(T[P],{skipPreflight:m});x.push({txId:w,status:"sent",signedTx:T[P]}),f==null||f([...x]),P++,this.connection.onSignature(w,B=>{let A=x.findIndex(W=>W.txId===w);A>-1&&(x[A].status=B.err?"error":"success"),f==null||f([...x]),B.err||b()},"processed"),this.connection.getSignatureStatus(w)};return b(),{txIds:[],signedTxs:T}}else{let P=[];for(let x=0;x<T.length;x+=1){let b=await this.connection.sendTransaction(T[x],{skipPreflight:m});P.push(b)}return{txIds:P,signedTxs:T}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(t){var l;let u=t||{},{computeBudgetConfig:r}=u,n=it(u,["computeBudgetConfig"]),o=r?ht(r):{instructions:[],instructionTypes:[]},i=this.signers.reduce((d,f)=>te(j({},d),{[f.publicKey.toBase58()]:f}),{}),s=[],a=[],c=[];if(this.allInstructions.forEach(d=>{let f=[...c,d],p=r?[...o.instructions,...f]:f,g=[...new Set(f.map(T=>T.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat()).values()].map(T=>new Ze(T));if(c.length<12&&je({instructions:p,payer:this.feePayer,signers:g})||je({instructions:f,payer:this.feePayer,signers:g}))c.push(d);else{if(c.length===0)throw Error("item ins too big");je({instructions:r?[...o.instructions,...c]:[...c],payer:this.feePayer,signers:g})?s.push(new Xe().add(...o.instructions,...c)):s.push(new Xe().add(...c)),a.push(Array.from(new Set(c.map(T=>T.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat())).map(T=>i[T]).filter(T=>T!==void 0)),c=[d]}}),c.length>0){let f=[...new Set(c.map(p=>p.keys.filter(m=>m.isSigner).map(m=>m.pubkey.toString())).flat()).values()].map(p=>i[p]).filter(p=>p!==void 0);je({instructions:r?[...o.instructions,...c]:[...c],payer:this.feePayer,signers:f.map(p=>p.publicKey)})?s.push(new Xe().add(...o.instructions,...c)):s.push(new Xe().add(...c)),a.push(f)}return s.forEach(d=>d.feePayer=this.feePayer),(l=this.owner)!=null&&l.signer&&a.forEach(d=>{d.some(f=>f.publicKey.equals(this.owner.publicKey))||d.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async d=>{var P;let{sequentially:f,onTxUpdate:p,recentBlockHash:m,skipPreflight:g=!0}=d||{},T=m!=null?m:await _e(this.connection,this.blockhashCommitment);if(s.forEach(async(x,b)=>{x.recentBlockhash=T,a[b].length&&x.sign(...a[b])}),Ee(s),(P=this.owner)!=null&&P.isKeyPair){if(f){let x=[];for(let b of s){let w=await Jt(this.connection,b,this.signers.find(B=>B.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g});x.push(w)}return{txIds:x,signedTxs:s}}return{txIds:await Promise.all(s.map(async x=>await this.connection.sendRawTransaction(x.serialize(),{skipPreflight:g}))),signedTxs:s}}if(this.signAllTransactions){let x=await this.signAllTransactions(s);if(f){let b=0,w=[],B=async()=>{if(!x[b])return;let A=await this.connection.sendRawTransaction(x[b].serialize(),{skipPreflight:g});w.push({txId:A,status:"sent",signedTx:x[b]}),p==null||p([...w]),b++,this.connection.onSignature(A,W=>{let M=w.findIndex(L=>L.txId===A);M>-1&&(w[M].status=W.err?"error":"success"),p==null||p([...w]),W.err||B()},"processed"),this.connection.getSignatureStatus(A)};return await B(),{txIds:w.map(A=>A.txId),signedTxs:x}}else{let b=[];for(let w=0;w<x.length;w+=1){let B=await this.connection.sendRawTransaction(x[w].serialize(),{skipPreflight:g});b.push(B)}return{txIds:b,signedTxs:x}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuildV0(t){var P;let T=t||{},{computeBudgetConfig:r,lookupTableCache:n={},lookupTableAddress:o=[]}=T,i=it(T,["computeBudgetConfig","lookupTableCache","lookupTableAddress"]),s=j(j({},this.cluster==="devnet"?{}:xt),n),a=Array.from(new Set([...this.lookupTableAddress,...o])),c=[];for(let x of a)s[x]===void 0&&c.push(new Ze(x));let u=await Xt({connection:this.connection,address:c});for(let[x,b]of Object.entries(u))s[x]=b;let l=r?ht(r):{instructions:[],instructionTypes:[]},d=await _e(this.connection,this.blockhashCommitment),f=this.signers.reduce((x,b)=>te(j({},x),{[b.publicKey.toBase58()]:b}),{}),p=[],m=[],g=[];if(this.allInstructions.forEach(x=>{let b=[...g,x],w=r?[...l.instructions,...b]:b;if(g.length<12&&ze({instructions:w,payer:this.feePayer,lookupTableAddressAccount:s})||ze({instructions:b,payer:this.feePayer,lookupTableAddressAccount:s}))g.push(x);else{if(g.length===0)throw Error("item ins too big");let B={};for(let A of[...new Set(a)])s[A]!==void 0&&(B[A]=s[A]);if(r&&ze({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:d})){let A=new Je({payerKey:this.feePayer,recentBlockhash:d,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(s));p.push(new Qe(A))}else{let A=new Je({payerKey:this.feePayer,recentBlockhash:d,instructions:[...g]}).compileToV0Message(Object.values(s));p.push(new Qe(A))}m.push(Array.from(new Set(g.map(A=>A.keys.filter(W=>W.isSigner).map(W=>W.pubkey.toString())).flat())).map(A=>f[A]).filter(A=>A!==void 0)),g=[x]}}),g.length>0){let b=[...new Set(g.map(w=>w.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat()).values()].map(w=>f[w]).filter(w=>w!==void 0);if(r&&ze({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:d})){let w=new Je({payerKey:this.feePayer,recentBlockhash:d,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(s));p.push(new Qe(w))}else{let w=new Je({payerKey:this.feePayer,recentBlockhash:d,instructions:[...g]}).compileToV0Message(Object.values(s));p.push(new Qe(w))}m.push(b)}return(P=this.owner)!=null&&P.signer&&m.forEach(x=>{x.some(b=>b.publicKey.equals(this.owner.publicKey))||x.push(this.owner.signer)}),{builder:this,transactions:p,buildProps:t,signers:m,instructionTypes:this.instructionTypes,execute:async x=>{var W;let{sequentially:b,onTxUpdate:w,recentBlockHash:B,skipPreflight:A=!0}=x||{};if(p.map(async(M,L)=>{m[L].length&&M.sign(m[L]),B&&(M.message.recentBlockhash=B)}),Ee(p),(W=this.owner)!=null&&W.isKeyPair){if(b){let M=[];for(let L of p){let v=await this.connection.sendTransaction(L,{skipPreflight:A});await bt(this.connection,v),M.push(v)}return{txIds:M,signedTxs:p}}return{txIds:await Promise.all(p.map(async M=>await this.connection.sendTransaction(M,{skipPreflight:A}))),signedTxs:p}}if(this.signAllTransactions){let M=await this.signAllTransactions(p);if(b){let L=0,v=[],q=async()=>{if(!M[L])return;let H=await this.connection.sendTransaction(M[L],{skipPreflight:A});v.push({txId:H,status:"sent",signedTx:M[L]}),w==null||w([...v]),L++,this.connection.onSignature(H,F=>{let ee=v.findIndex(Y=>Y.txId===H);ee>-1&&(v[ee].status=F.err?"error":"success"),w==null||w([...v]),F.err||q()},"processed"),this.connection.getSignatureStatus(H)};return q(),{txIds:[],signedTxs:M}}else{let L=[];for(let v=0;v<M.length;v+=1){let q=await this.connection.sendTransaction(M[v],{skipPreflight:A});L.push(q)}return{txIds:L,signedTxs:M}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}};import{Keypair as Si,PublicKey as Li}from"@solana/web3.js";import Xl from"bn.js";import{TOKEN_PROGRAM_ID as Bi}from"@solana/spl-token";function pi(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function Qt(e,...t){if(!pi(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function $t(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function cn(e,t){Qt(e);let r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}var kt=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),de=(e,t)=>e<<32-t|e>>>t;var Nc=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function mi(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function er(e){return typeof e=="string"&&(e=mi(e)),Qt(e),e}var Tt=class{clone(){return this._cloneInto()}},Mc={}.toString;function ln(e){let t=n=>e().update(er(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function gi(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);let o=BigInt(32),i=BigInt(4294967295),s=Number(r>>o&i),a=Number(r&i),c=n?4:0,u=n?0:4;e.setUint32(t+c,s,n),e.setUint32(t+u,a,n)}var dn=(e,t,r)=>e&t^~e&r,fn=(e,t,r)=>e&t^e&r^t&r,At=class extends Tt{constructor(t,r,n,o){super(),this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=kt(this.buffer)}update(t){$t(this);let{view:r,buffer:n,blockLen:o}=this;t=er(t);let i=t.length;for(let s=0;s<i;){let a=Math.min(o-this.pos,i-s);if(a===o){let c=kt(t);for(;o<=i-s;s+=o)this.process(c,s);continue}n.set(t.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){$t(this),cn(t,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:i}=this,{pos:s}=this;r[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>o-s&&(this.process(n,0),s=0);for(let d=s;d<o;d++)r[d]=0;gi(n,o-8,BigInt(this.length*8),i),this.process(n,0);let a=kt(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<u;d++)a.setUint32(4*d,l[d],i)}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:i,destroyed:s,pos:a}=this;return t.length=o,t.pos=a,t.finished=i,t.destroyed=s,o%r&&t.buffer.set(n),t}};var yi=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Le=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Be=new Uint32Array(64),tr=class extends At{constructor(){super(64,32,8,!1),this.A=Le[0]|0,this.B=Le[1]|0,this.C=Le[2]|0,this.D=Le[3]|0,this.E=Le[4]|0,this.F=Le[5]|0,this.G=Le[6]|0,this.H=Le[7]|0}get(){let{A:t,B:r,C:n,D:o,E:i,F:s,G:a,H:c}=this;return[t,r,n,o,i,s,a,c]}set(t,r,n,o,i,s,a,c){this.A=t|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=a|0,this.H=c|0}process(t,r){for(let d=0;d<16;d++,r+=4)Be[d]=t.getUint32(r,!1);for(let d=16;d<64;d++){let f=Be[d-15],p=Be[d-2],m=de(f,7)^de(f,18)^f>>>3,g=de(p,17)^de(p,19)^p>>>10;Be[d]=g+Be[d-7]+m+Be[d-16]|0}let{A:n,B:o,C:i,D:s,E:a,F:c,G:u,H:l}=this;for(let d=0;d<64;d++){let f=de(a,6)^de(a,11)^de(a,25),p=l+f+dn(a,c,u)+yi[d]+Be[d]|0,g=(de(n,2)^de(n,13)^de(n,22))+fn(n,o,i)|0;l=u,u=c,c=a,a=s+p|0,s=i,i=o,o=n,n=p+g|0}n=n+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,o,i,s,a,c,u,l)}roundClean(){Be.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var pn=ln(()=>new tr);import{PublicKey as ki}from"@solana/web3.js";import hn,{isBN as bn}from"bn.js";import{bits as Hc,BitStructure as jc,blob as hi,Blob as zc,cstr as Yc,f32 as Zc,f32be as Xc,f64 as Jc,f64be as Qc,greedy as $c,Layout as bi,ns64 as el,ns64be as tl,nu64 as rl,nu64be as nl,offset as ol,s16 as il,s16be as sl,s24 as al,s24be as ul,s32 as cl,s32be as ll,s40 as dl,s40be as fl,s48 as pl,s48be as ml,s8 as gl,seq as wi,struct as yl,Structure as xi,u16 as hl,u16be as bl,u24 as wl,u24be as xl,u32 as Pl,u32be as Tl,u40 as kl,u40be as Al,u48 as Il,u48be as Sl,u8 as Pi,UInt as Ti,union as Ll,Union as Bl,unionLayoutDiscriminator as Rl,utf8 as Kl}from"@solana/buffer-layout";var rr=bi,mn=xi;var nr=Ti;var gn=Pi;var yn=wi;var Fe=hi;var Oe=class extends rr{constructor(r,n,o){super(r,o);this.blob=Fe(r),this.signed=n}decode(r,n=0){let o=new hn(this.blob.decode(r,n),10,"le");return this.signed?o.fromTwos(this.span*8).clone():o}encode(r,n,o=0){return typeof r=="number"&&(r=new hn(r)),this.signed&&(r=r.toTwos(this.span*8)),this.blob.encode(r.toArrayLike(Buffer,"le",this.span),n,o)}};function $(e){return new nr(1,e)}function $e(e){return new nr(4,e)}function k(e){return new Oe(8,!1,e)}function Pe(e){return new Oe(16,!1,e)}function wn(e){return new Oe(1,!0,e)}function St(e){return new Oe(8,!0,e)}var It=class extends rr{constructor(r,n,o,i){super(r.span,i);this.layout=r,this.decoder=n,this.encoder=o}decode(r,n){return this.decoder(this.layout.decode(r,n))}encode(r,n,o){return this.layout.encode(this.encoder(r),n,o)}getSpan(r,n){return this.layout.getSpan(r,n)}};function E(e){return new It(Fe(32),t=>new ki(t),t=>t.toBuffer(),e)}function Lt(e){return new It(gn(),Ai,Ii,e)}function Ai(e){if(e===0)return!1;if(e===1)return!0;throw new Error("Invalid bool: "+e)}function Ii(e){return e?1:0}var or=class extends mn{decode(t,r){return super.decode(t,r)}};function Z(e,t,r){return new or(e,t,r)}function J(e,t,r){let n,o=typeof t=="number"?t:bn(t)?t.toNumber():new Proxy(t,{get(i,s){if(!n){let a=Reflect.get(i,"count");n=bn(a)?a.toNumber():a,Reflect.set(i,"count",n)}return Reflect.get(i,s)},set(i,s,a){return s==="count"&&(n=a),Reflect.set(i,s,a)}});return yn(e,o,r)}var et=Z([E("mint"),E("owner"),k("amount"),$e("delegateOption"),E("delegate"),$("state"),$e("isNativeOption"),k("isNative"),k("delegatedAmount"),$e("closeAuthorityOption"),E("closeAuthority")]);var td=Q("Raydium_Util");function Bt({fromPublicKey:e,programId:t=Bi}){let r=Si.generate().publicKey.toBase58().slice(0,32);return{publicKey:Ri(e,r,t),seed:r}}function Ri(e,t,r){let n=Buffer.concat([e.toBuffer(),Buffer.from(t),r.toBuffer()]),o=pn(n);return new Li(o)}import{PublicKey as Ki,SystemProgram as Ci}from"@solana/web3.js";import Vi from"bn.js";import{createCloseAccountInstruction as Ei,createInitializeAccountInstruction as Fi,createTransferInstruction as fd,TOKEN_PROGRAM_ID as tt}from"@solana/spl-token";function Ni(e){let{mint:t,tokenAccount:r,owner:n,programId:o=tt}=e;return Fi(r,t,n,o)}function Mi(e){let{tokenAccount:t,payer:r,multiSigners:n=[],owner:o,programId:i=tt}=e;return Ei(t,r,o,n,i)}async function ir(e){let{connection:t,amount:r,commitment:n,payer:o,owner:i,skipCloseAccount:s}=e,a=await t.getMinimumBalanceForRentExemption(et.span,n),c=V(r).add(new Vi(a)),u=Bt({fromPublicKey:o,programId:tt});return{addresses:{newAccount:u.publicKey},signers:[],instructions:[Ci.createAccountWithSeed({fromPubkey:o,basePubkey:o,seed:u.seed,newAccountPubkey:u.publicKey,lamports:c.toNumber(),space:et.span,programId:tt}),Ni({mint:new Ki(se.address),tokenAccount:u.publicKey,owner:i,programId:tt})],instructionTypes:[z.CreateAccount,z.InitAccount],endInstructionTypes:s?[]:[z.CloseAccount],endInstructions:s?[]:[Mi({tokenAccount:u.publicKey,payer:o,owner:i})]}}var sr=(...e)=>e.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),rt=class{constructor({scope:t,moduleName:r}){this.disabled=!1;this.scope=t,this.logger=Q(r)}createTxBuilder(t){return this.scope.checkOwner(),new Pt({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(sr(t))}logInfo(...t){this.logger.info(sr(t))}logAndCreateError(...t){let r=sr(t);throw new Error(r)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as Tn}from"@solana/web3.js";var ar=Z([$("instruction")]),ur=Z([$("instruction")]),vi=Z([k("rewardState"),k("rewardOpenTime"),k("rewardEndTime"),k("rewardLastUpdateTime"),k("totalReward"),k("totalRewardEmissioned"),k("rewardClaimed"),k("rewardPerSecond"),Pe("accRewardPerShare"),E("rewardVault"),E("rewardMint"),E("rewardSender"),k("rewardType"),J(k(),15,"padding")]),_i=Z([k("state"),k("nonce"),E("lpVault"),E("rewardVault"),E(),E(),k(),k(),k("totalReward"),Pe("perShareReward"),k("lastSlot"),k("perSlotReward")]),Di=Z([k("state"),k("nonce"),E("lpVault"),E("rewardVaultA"),k("totalRewardA"),Pe("perShareRewardA"),k("perSlotRewardA"),$("option"),E("rewardVaultB"),Fe(7),k("totalRewardB"),Pe("perShareRewardB"),k("perSlotRewardB"),k("lastSlot"),E()]),Oi=Z([k(),k("state"),k("nonce"),k("validRewardTokenNum"),Pe("rewardMultiplier"),k("rewardPeriodMax"),k("rewardPeriodMin"),k("rewardPeriodExtend"),E("lpMint"),E("lpVault"),J(vi,5,"rewardInfos"),E("creator"),E(),J(k(),32,"padding")]),Wi=new Proxy(_i,{get(e,t,r){return t==="decode"?(...n)=>{let o=e.decode(...n);return te(j({},o),{version:3,rewardInfos:[{rewardVault:o.rewardVault,totalReward:o.totalReward,perSlotReward:o.perSlotReward,perShareReward:o.perShareReward}]})}:Reflect.get(e,t,r)}}),Ui=new Proxy(Di,{get(e,t,r){return t==="decode"?(...n)=>{let o=e.decode(...n);return te(j({},o),{version:5,rewardInfos:[{rewardVault:o.rewardVaultA,totalReward:o.totalRewardA,perSlotReward:o.perSlotRewardA,perShareReward:o.perShareRewardA},{rewardVault:o.rewardVaultB,totalReward:o.totalRewardB,perSlotReward:o.perSlotRewardB,perShareReward:o.perShareRewardB}]})}:Reflect.get(e,t,r)}}),Rt=new Proxy(Oi,{get(e,t,r){return t==="decode"?(...n)=>{let o=e.decode(...n);return te(j({},o),{version:6,rewardInfos:o.rewardInfos.map(i=>{var s;return te(j({},i),{rewardType:((s=Object.entries(Re).find(a=>String(a[1])===i.rewardType.toString()))!=null?s:["Standard SPL"])[0]})})})}:Reflect.get(e,t,r)}}),qi=Z([k("isSet"),k("rewardPerSecond"),k("rewardOpenTime"),k("rewardEndTime"),k("rewardType")]),cr=Z([$("instruction"),k("nonce"),J(qi,5,"rewardTimeInfo")]),lr=Z([$("instruction"),k("rewardReopenTime"),k("rewardEndTime"),k("rewardPerSecond")]),dr=Z([$("instruction"),k("isSet"),k("rewardPerSecond"),k("rewardOpenTime"),k("rewardEndTime"),k("rewardType")]),Ld=Z([k("state"),E("id"),E("owner"),k("deposited"),J(k(),1,"rewardDebts")]),fr=Z([k("state"),E("id"),E("owner"),k("deposited"),J(Pe(),1,"rewardDebts"),k(""),k("voteLockedBalance"),J(k(),15)]),Bd=Z([k("state"),E("id"),E("owner"),k("deposited"),J(k(),2,"rewardDebts")]),xn=Z([k("state"),E("id"),E("owner"),k("deposited"),J(Pe(),2,"rewardDebts"),J(k(),17)]),Pn=Z([k(),k("state"),E("id"),E("owner"),k("deposited"),J(Pe(),5,"rewardDebts"),J(k(),16)]),ue=Z([$("instruction"),k("amount")]),Gi=Z([E("mint"),E("grantAuthority"),k("baselineVoteWeightScaledFactor"),k("maxExtraLockupVoteWeightScaledFactor"),k("lockupSaturationSecs"),wn("digitShift"),J($(),7,"reserved1"),J(k(),7,"reserved2")]),Hi=Z([Fe(8),E("governanceProgramId"),E("realm"),E("realmGoverningTokenMint"),E("realmAuthority"),J($(),32,"reserved1"),J(Gi,4,"votingMints"),St("timeOffset"),$("bump"),J($(),7,"reserved2"),J(k(),11,"reserved3")]),ji=Z([St("startTime"),St("endTime"),$("kind"),J($(),15,"reserved")]),zi=Z([J(ji,1,"lockup"),k("amountDeposited_native"),k("amountInitiallyLockedNative"),Lt("isUsed"),Lt("allowClawback"),$("votingMintConfigIdx"),J($(),29,"reserved")]),Yi=Z([Fe(8),E("voterAuthority"),E("registrar"),J(zi,32,"deposits"),$("voterBump"),$("voterWweightRecordBump"),J($(),94,"reserved")]);var Md=Q("Raydium_farm_config"),kn=new Tn("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),An=new Tn("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1");var In={3:fr,5:xn,6:Pn},pr=e=>[3,5,6].indexOf(e)!==-1,mr=e=>{var s;let{version:t,rewardInfos:r,rewardTokenAccountsPublicKeys:n}=e,o=`rewardInfo:${JSON.stringify(r)}, rewardAccount:${JSON.stringify(n)}`,i={3:()=>{if(r.length!==1||n.length!==1)return`rewardInfos or rewardTokenAccounts lengths not equal 1: ${o}`},5:()=>{if(r.length!==n.length)return`rewardInfos and rewardTokenAccounts lengths not equal: ${o}`},6:()=>{if(!n.length||r.length!==n.length)return`no rewardTokenAccounts or rewardInfos and rewardTokenAccounts lengths not equal: ${o}`}};return(s=i[t])==null?void 0:s.call(i)},Re={"Standard SPL":0,"Option tokens":1},Te={[sn.toString()]:3,[an.toString()]:5,[Ye.toString()]:6};import{PublicKey as _,SystemProgram as Bn,SYSVAR_CLOCK_PUBKEY as Kt,SYSVAR_RENT_PUBKEY as Ji,TransactionInstruction as fe}from"@solana/web3.js";import Rn from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as yf,createAssociatedTokenAccountInstruction as hf,TOKEN_PROGRAM_ID as Ke}from"@solana/spl-token";import Zi from"bn.js";var Xi=Q("Raydium.farm.util");function nt({programId:e,poolId:t,mint:r,type:n}){let{publicKey:o}=Ve([t.toBuffer(),r.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],e);return o}function me({programId:e,poolId:t,owner:r,version:n}){let{publicKey:o}=Ve([t.toBuffer(),r.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],e);return o}var Sn=({programId:e,poolId:t})=>Ve([t.toBuffer()],e);function Ln(e){return{isSet:new Zi(1),rewardPerSecond:V(e.perSecond),rewardOpenTime:V(e.openTime),rewardEndTime:V(e.endTime),rewardType:V(Re[e.rewardType])}}function gr(e){return V(e.endTime).sub(V(e.openTime)).mul(V(e.perSecond))}function yr(e){let t=In[e];return t||Xi.logWithError("invalid version",e),t}var Qi=Q("Raydium_farm_instruction"),Bf={voterStakeRegistryCreateVoter:Buffer.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:Buffer.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:Buffer.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:Buffer.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:Buffer.from([45,185,3,36,109,190,115,169])};function hr(e){let{version:t,id:r,ledger:n,programId:o,owner:i}=e,s={3:9,5:10}[t];s||Qi.logWithError(`invalid farm pool version: ${t}`);let a=Buffer.alloc(ar.span);ar.encode({instruction:s},a);let c=[h({pubkey:r}),h({pubkey:n}),h({pubkey:i,isWritable:!1}),h({pubkey:Bn.programId,isWritable:!1}),h({pubkey:Ji,isWritable:!1})];return{instruction:new fe({programId:o,keys:c,data:a}),instructionType:z.FarmV3CreateLedger}}function Kn(e){var n;let t=Buffer.alloc(cr.span);cr.encode({instruction:0,nonce:new Rn(e.nonce),rewardTimeInfo:e.rewardInfoConfig},t);let r=[...qt,h({pubkey:e.farmId}),h({pubkey:e.farmAuthority,isWritable:!1}),h({pubkey:e.lpVault}),h({pubkey:e.lpMint,isWritable:!1}),h({pubkey:e.lockVault}),h({pubkey:e.lockMint,isWritable:!1}),h({pubkey:(n=e.lockUserAccount)!=null?n:ne}),h({pubkey:e.owner,isWritable:!1,isSigner:!0})];for(let o of e.rewardInfo)r.push(h({pubkey:o.rewardMint,isWritable:!1}),h({pubkey:o.rewardVault}),h({pubkey:o.userRewardToken}));return{instruction:new fe({programId:e.programId,keys:r,data:t}),instructionType:z.FarmV6Create}}function Cn(e){let t=Buffer.alloc(ur.span);ur.encode({instruction:5},t);let r=[h({pubkey:Ke,isWritable:!1}),h({pubkey:e.id}),h({pubkey:e.authority,isWritable:!1}),h({pubkey:e.lpVault,isWritable:!1}),h({pubkey:e.rewardVault}),h({pubkey:e.userRewardToken}),h({pubkey:e.owner,isWritable:!1,isSigner:!0})];return{instruction:new fe({programId:e.programId,keys:r,data:t}),instructionType:z.FarmV6CreatorWithdraw}}function br({payer:e,rewardVault:t,userRewardTokenPub:r,farmKeys:n,rewardInfo:o}){let i=Buffer.alloc(lr.span);lr.encode({instruction:3,rewardReopenTime:V(o.openTime),rewardEndTime:V(o.endTime),rewardPerSecond:V(o.perSecond)},i);let s=[h({pubkey:Ke,isWritable:!1}),h({pubkey:n.id}),h({pubkey:n.lpVault,isWritable:!1}),h({pubkey:t}),h({pubkey:r}),h({pubkey:e,isWritable:!1,isSigner:!0})];return new fe({programId:n.programId,keys:s,data:i})}function wr({payer:e,userRewardTokenPub:t,farmKeys:r,rewardVault:n,rewardInfo:o}){let i=Buffer.alloc(dr.span);dr.encode({instruction:4,isSet:new Rn(1),rewardPerSecond:V(o.perSecond),rewardOpenTime:V(o.openTime),rewardEndTime:V(o.endTime),rewardType:V(Re[o.rewardType])},i);let s=[...qt,h({pubkey:r.id}),h({pubkey:r.authority,isWritable:!1}),h({pubkey:o.mint,isWritable:!1}),h({pubkey:n}),h({pubkey:t}),h({pubkey:e,isWritable:!1,isSigner:!0})];return new fe({programId:r.programId,keys:s,data:i})}function xr(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s}=e,[a,c]=[new _(t.programId),new _(t.id)],u=me({programId:a,poolId:c,owner:i,version:6}),l=Buffer.alloc(ue.span);ue.encode({instruction:2,amount:V(s)},l);let d=[h({pubkey:Ke,isWritable:!1}),h({pubkey:c}),h({pubkey:new _(r.authority),isWritable:!1}),h({pubkey:new _(r.lpVault)}),h({pubkey:u}),h({pubkey:i,isWritable:!1,isSigner:!0}),h({pubkey:n})];for(let f=0;f<r.rewardInfos.length;f++)d.push(h({pubkey:new _(r.rewardInfos[f].vault)})),d.push(h({pubkey:o[f]}));return new fe({programId:a,keys:d,data:l})}function Pr(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=e,[c,u]=[new _(t.programId),new _(t.id)],l=me({programId:c,poolId:u,owner:i,version:5}),d=Buffer.alloc(ue.span);ue.encode({instruction:12,amount:V(s)},d);let f=[h({pubkey:u}),h({pubkey:new _(r.authority),isWritable:!1}),h({pubkey:l}),h({pubkey:i,isWritable:!1,isSigner:!0}),h({pubkey:n}),h({pubkey:new _(r.lpVault)}),h({pubkey:o[0]}),h({pubkey:new _(r.rewardInfos[0].vault)}),h({pubkey:Kt,isWritable:!1}),h({pubkey:Ke,isWritable:!1})];for(let p=1;p<r.rewardInfos.length;p++)f.push(h({pubkey:o[p]})),f.push(h({pubkey:new _(r.rewardInfos[p].vault)}));if(a)for(let p of a)f.push(h({pubkey:p}));return new fe({programId:c,keys:f,data:d})}function Tr(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=e,[c,u]=[new _(t.programId),new _(t.id)],l=me({programId:c,poolId:u,owner:i,version:3}),d=Buffer.alloc(ue.span);ue.encode({instruction:11,amount:V(s)},d);let f=[h({pubkey:u}),h({pubkey:new _(r.authority),isWritable:!1}),h({pubkey:l}),h({pubkey:i,isWritable:!1,isSigner:!0}),h({pubkey:n}),h({pubkey:new _(r.lpVault)}),h({pubkey:o[0]}),h({pubkey:new _(r.rewardInfos[0].vault)}),h({pubkey:Kt,isWritable:!1}),h({pubkey:Ke,isWritable:!1})];if(a)for(let p of a)f.push(h({pubkey:p}));return new fe({programId:c,keys:f,data:d})}function Vn(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=e,[c,u]=[new _(t.programId),new _(t.id)],l=me({programId:c,poolId:u,owner:i,version:3}),d=Buffer.alloc(ue.span);ue.encode({instruction:10,amount:V(s)},d);let f=[h({pubkey:u}),h({pubkey:new _(r.authority),isWritable:!1}),h({pubkey:l}),h({pubkey:i,isWritable:!1,isSigner:!0}),h({pubkey:n}),h({pubkey:new _(r.lpVault)}),h({pubkey:o[0]}),h({pubkey:new _(r.rewardInfos[0].vault)}),h({pubkey:Kt,isWritable:!1}),h({pubkey:Ke,isWritable:!1})];if(a)for(let p of a)f.push(h({pubkey:p}));return new fe({programId:c,keys:f,data:d})}function En(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s,userAuxiliaryLedgers:a}=e,[c,u]=[new _(t.programId),new _(t.id)],l=me({programId:c,poolId:u,owner:i,version:5}),d=Buffer.alloc(ue.span);ue.encode({instruction:11,amount:V(s)},d);let f=[h({pubkey:u}),h({pubkey:new _(r.authority),isWritable:!1}),h({pubkey:l}),h({pubkey:i,isWritable:!1,isSigner:!0}),h({pubkey:n}),h({pubkey:new _(r.lpVault)}),h({pubkey:o[0]}),h({pubkey:new _(r.rewardInfos[0].vault)}),h({pubkey:Kt,isWritable:!1}),h({pubkey:Ke,isWritable:!1})];for(let p=1;p<r.rewardInfos.length;p++)f.push(h({pubkey:o[p]})),f.push(h({pubkey:new _(r.rewardInfos[p].vault)}));if(a)for(let p of a)f.push(h({pubkey:p}));return new fe({programId:c,keys:f,data:d})}function Fn(e){let{farmInfo:t,farmKeys:r,lpAccount:n,rewardAccounts:o,owner:i,amount:s}=e,[a,c]=[new _(t.programId),new _(t.id)],u=me({programId:a,poolId:c,owner:i,version:6}),l=Buffer.alloc(ue.span);ue.encode({instruction:1,amount:V(s)},l);let d=[h({pubkey:Ke,isWritable:!1}),h({pubkey:Bn.programId,isWritable:!1}),h({pubkey:c}),h({pubkey:new _(r.authority),isWritable:!1}),h({pubkey:new _(r.lpVault)}),h({pubkey:u}),h({pubkey:i,isWritable:!1,isSigner:!0}),h({pubkey:n})];for(let f=0;f<r.rewardInfos.length;f++)d.push(h({pubkey:new _(r.rewardInfos[f].vault)})),d.push(h({pubkey:o[f]}));return new fe({programId:a,keys:d,data:l})}var kr=class extends rt{async _getUserRewardInfo({payer:t,rewardInfo:r}){if(r.mint.equals(ne)){let n=await ir({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:t,amount:gr(te(j({},r),{openTime:r.openTime.toString(),endTime:r.endTime.toString()}))});return{rewardPubKey:n.addresses.newAccount,newInstruction:n}}return{rewardPubKey:await this.scope.account.getCreatedTokenAccount({mint:r.mint,associatedOnly:!1})}}async create({poolInfo:t,rewardInfos:r,payer:n,programId:o=Ye,txVersion:i}){this.checkDisabled(),this.scope.checkOwner();let a={lpMint:new U(t.lpMint.address),lockInfo:{lockMint:kn,lockVault:An},version:6,rewardInfos:r,programId:o},c=this.createTxBuilder(),u=n!=null?n:this.scope.ownerPubKey,l=Bt({fromPublicKey:u,programId:a.programId}),d=await this.scope.connection.getMinimumBalanceForRentExemption(Rt.span);c.addInstruction({instructions:[$i.createAccountWithSeed({fromPubkey:u,basePubkey:u,seed:l.seed,newAccountPubkey:l.publicKey,lamports:d,space:Rt.span,programId:a.programId})]});let{publicKey:f,nonce:p}=Sn({programId:new U(a.programId),poolId:l.publicKey}),m=nt({programId:a.programId,poolId:l.publicKey,mint:a.lpMint,type:"lpVault"}),g=[],T=[];for(let B of a.rewardInfos){B.openTime>=B.endTime&&this.logAndCreateError("start time error","rewardInfo.rewardOpenTime",B.openTime.toString()),isNaN(Re[B.rewardType])&&this.logAndCreateError("rewardType error",B.rewardType),Number(B.perSecond)<=0&&this.logAndCreateError("rewardPerSecond error",B.perSecond),g.push(Ln(B));let{rewardPubKey:A,newInstruction:W}=await this._getUserRewardInfo({rewardInfo:B,payer:u});W&&c.addInstruction(W),A||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let M=B.mint.equals(ne)?new U(se.address):B.mint;T.push({rewardMint:M,rewardVault:nt({programId:a.programId,poolId:l.publicKey,mint:M,type:"rewardVault"}),userRewardToken:A})}let{account:P,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({mint:new U(a.lockInfo.lockMint),owner:this.scope.ownerPubKey,skipCloseAccount:!1,createInfo:{payer:this.scope.ownerPubKey,amount:0},associatedOnly:!1});x&&c.addInstruction(x),P||this.logAndCreateError("cannot found lock vault","tokenAccounts",this.scope.account.tokenAccounts);let{instruction:b,instructionType:w}=Kn({farmId:l.publicKey,owner:this.scope.ownerPubKey,farmAuthority:f,lpVault:m,lpMint:a.lpMint,lockVault:a.lockInfo.lockVault,lockMint:a.lockInfo.lockMint,lockUserAccount:P,programId:a.programId,rewardInfo:T,rewardInfoConfig:g,nonce:p});return c.addInstruction({instructions:[b],instructionTypes:[w]}).versionBuild({txVersion:i,extInfo:{farmId:l.publicKey,farmAuthority:f,lpVault:m,lockUserAccount:P,nonce:p}})}async restartReward({farmInfo:t,payer:r,newRewardInfo:n,txVersion:o}){var T;let i=Te[t.programId];i!==6&&this.logAndCreateError("invalid farm version ",i);let s=we((await this.scope.api.fetchFarmKeysById({ids:t.id}))[0]),a={id:s.id,rewardInfos:t.rewardInfos,lpVault:s.lpVault,programId:s.programId};n.openTime>=n.endTime&&this.logAndCreateError("start time error","newRewardInfo",n);let c=r||this.scope.ownerPubKey,u=n.mint.equals(ne)?new U(se.address):n.mint,l=a.rewardInfos.findIndex(P=>new U(P.mint.address).equals(u)),d=s.rewardInfos[l];d||this.logAndCreateError("configuration does not exist","rewardMint",u);let f=(T=d.vault)!=null?T:ne,p=this.createTxBuilder(),{rewardPubKey:m,newInstruction:g}=await this._getUserRewardInfo({rewardInfo:n,payer:c});return g&&p.addInstruction(g),m||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts),p.addInstruction({instructions:[br({payer:this.scope.ownerPubKey,rewardVault:f,userRewardTokenPub:m,farmKeys:a,rewardInfo:n})],instructionTypes:[z.FarmV6Restart]}).versionBuild({txVersion:o})}async restartRewards({farmInfo:t,payer:r,newRewardInfos:n,txVersion:o}){var l;let i=Te[t.programId];i!==6&&this.logAndCreateError("invalid farm version ",i);let s=we((await this.scope.api.fetchFarmKeysById({ids:t.id}))[0]),a={id:s.id,rewardInfos:t.rewardInfos,lpVault:s.lpVault,programId:s.programId};n.forEach(d=>{d.openTime>=d.endTime&&this.logAndCreateError("start time error","newRewardInfo",d)});let c=r||this.scope.ownerPubKey,u=this.createTxBuilder();for(let d of n){let f=d.mint.equals(ne)?new U(se.address):d.mint,p=a.rewardInfos.findIndex(b=>new U(b.mint.address).equals(f)),m=s.rewardInfos[p];m||this.logAndCreateError("configuration does not exist","rewardMint",f);let g=(l=m.vault)!=null?l:ne,{rewardPubKey:T,newInstruction:P}=await this._getUserRewardInfo({rewardInfo:d,payer:c});P&&u.addInstruction(P),T||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let x=br({payer:this.scope.ownerPubKey,rewardVault:g,userRewardTokenPub:T,farmKeys:a,rewardInfo:d});u.addInstruction({instructions:[x],instructionTypes:[z.FarmV6Restart]})}return u.versionBuild({txVersion:o})}async addNewRewardToken(t){let{txVersion:r,farmInfo:n,newRewardInfo:o,payer:i}=t,s=Te[n.programId];s!==6&&this.logAndCreateError("invalid farm version ",s);let a=we((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),c=i!=null?i:this.scope.ownerPubKey,u=this.createTxBuilder(),l=o.mint.equals(ne)?new U(se.address):o.mint,d=nt({programId:new U(n.programId),poolId:new U(n.id),mint:l,type:"rewardVault"}),{rewardPubKey:f,newInstruction:p}=await this._getUserRewardInfo({rewardInfo:o,payer:c});return p&&u.addInstruction(p),f||this.logAndCreateError("annot found target token accounts",this.scope.account.tokenAccounts),o.mint=l,u.addInstruction({instructions:[wr({payer:this.scope.ownerPubKey,userRewardTokenPub:f,farmKeys:a,rewardVault:d,rewardInfo:o})],instructionTypes:[z.FarmV6CreatorAddReward]}).versionBuild({txVersion:r})}async addNewRewardsToken(t){let{txVersion:r,farmInfo:n,newRewardInfos:o,payer:i}=t,s=Te[n.programId];s!==6&&this.logAndCreateError("invalid farm version ",s);let a=we((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),c=i!=null?i:this.scope.ownerPubKey,u=this.createTxBuilder();for(let l of o){let d=l.mint.equals(ne)?new U(se.address):l.mint,f=nt({programId:new U(n.programId),poolId:new U(n.id),mint:d,type:"rewardVault"}),{rewardPubKey:p,newInstruction:m}=await this._getUserRewardInfo({rewardInfo:l,payer:c});m&&u.addInstruction(m),p||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let g=wr({payer:this.scope.ownerPubKey,userRewardTokenPub:p,farmKeys:a,rewardVault:f,rewardInfo:te(j({},l),{mint:d})});u.addInstruction({instructions:[g],instructionTypes:[z.FarmV6CreatorAddReward]})}return u.versionBuild({txVersion:r})}async deposit(t){let{txVersion:r,farmInfo:n,amount:o,feePayer:i,useSOLBalance:s,associatedOnly:a=!0,checkCreateATAOwner:c=!1,userAuxiliaryLedgers:u,computeBudgetConfig:l}=t;this.scope.availability.addFarm===!1&&this.logAndCreateError("farm deposit feature disabled in your region");let{rewardInfos:d,programId:f}=n,p=Te[f];pr(p)||this.logAndCreateError("invalid farm program:",n.programId);let[m,g]=[new U(n.programId),new U(n.id)],T=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],P=me({programId:m,poolId:g,owner:this.scope.ownerPubKey,version:p}),x=this.createTxBuilder();x.addCustomComputeBudget(l);let b={};for(let F of this.scope.account.tokenAccounts)if(a){let ee=De(this.scope.ownerPubKey,F.mint,F.programId).publicKey;F.publicKey&&ee.equals(F.publicKey)&&(b[F.mint.toString()]=F.publicKey)}else b[F.mint.toString()]=F.publicKey;let w=T.lpMint,B=b[w.address];B||this.logAndCreateError("you don't have any lp","lp zero",b);let A=[];for(let F of d){let ee=s&&F.mint.address===ge.toString(),Y=b[F.mint.address];if(!Y){let{account:D,instructionParams:Ar}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:F.mint.programId,mint:new U(F.mint.address),notUseTokenAccount:ee,createInfo:{payer:i||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!ee,associatedOnly:ee?!1:a,checkCreateATAOwner:c});Y=D,Ar&&x.addInstruction(Ar)}b[F.mint.address]=Y,A.push(Y)}let W,M=await this.scope.connection.getAccountInfo(P);if(M&&(W=yr(p).decode(M.data)),n.programId!==Ye.toString()&&!W){let{instruction:F,instructionType:ee}=hr({id:g,programId:m,version:p,ledger:P,owner:this.scope.ownerPubKey});x.addInstruction({instructions:[F],instructionTypes:[ee]})}let L=mr({version:p,rewardInfos:d,rewardTokenAccountsPublicKeys:A});L&&this.logAndCreateError(L);let v={amount:V(o),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:T,lpAccount:B,rewardAccounts:A,userAuxiliaryLedgers:u==null?void 0:u.map(F=>new U(F))},q=p===6?Fn(v):p===5?En(v):Vn(v),H={3:z.FarmV3Deposit,5:z.FarmV5Deposit,6:z.FarmV6Deposit};return x.addInstruction({instructions:[q],instructionTypes:[H[p]]}).versionBuild({txVersion:r})}async withdraw(t){let{txVersion:r,farmInfo:n,amount:o,deposited:i,useSOLBalance:s,feePayer:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,userAuxiliaryLedgers:l,computeBudgetConfig:d}=t,{rewardInfos:f}=n;this.scope.availability.removeFarm===!1&&this.logAndCreateError("farm withdraw feature disabled in your region");let p=Te[n.programId];pr(p)||this.logAndCreateError("invalid farm program:",n.programId);let m=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],g=this.createTxBuilder();g.addCustomComputeBudget(d);let T={};for(let L of this.scope.account.tokenAccounts)if(c){let v=De(this.scope.ownerPubKey,L.mint).publicKey;L.publicKey&&v.equals(L.publicKey)&&(T[L.mint.toString()]=L.publicKey)}else T[L.mint.toString()]=L.publicKey;if(i)i.isZero()&&this.logAndCreateError("no deposited lp",{farmId:n.id});else{let L=me({programId:new U(n.programId),poolId:new U(n.id),owner:this.scope.ownerPubKey,version:p}),v=await this.scope.connection.getAccountInfo(L);if(v)yr(p).decode(v.data).deposited.isZero()&&this.logAndCreateError("no deposited lp",{farmId:n.id});else if(p!==6&&(l||[]).length>0){let{instruction:q,instructionType:H}=hr({id:new U(m.id),programId:new U(m.programId),version:p,ledger:L,owner:this.scope.ownerPubKey});g.addInstruction({instructions:[q],instructionTypes:[H]})}else this.logAndCreateError("no lp data",{farmId:n.id,version:p,ledgerData:v})}let P=m.lpMint.address,x=s&&P===ge.toString(),b=T[P.toString()];if(!b){let{account:L,instructionParams:v}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:m.lpMint.programId,mint:new U(P),notUseTokenAccount:x,createInfo:{payer:a||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:x?!1:c,checkCreateATAOwner:u});b=L,v&&g.addInstruction(v)}T[P.toString()]=b;let w=[];for(let L of f){let v=s&&L.mint.address===ge.toString(),q=T[L.mint.address];if(!q){let{account:H,instructionParams:F}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:L.mint.programId,mint:new U(L.mint.address),notUseTokenAccount:v,createInfo:{payer:a||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!v,associatedOnly:v?!1:c,checkCreateATAOwner:u});q=H,F&&g.addInstruction(F)}T[L.mint.address]=q,w.push(q)}let B=mr({version:p,rewardInfos:f,rewardTokenAccountsPublicKeys:w});B&&this.logAndCreateError(B);let A={amount:V(o),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:m,lpAccount:b,rewardAccounts:w,userAuxiliaryLedgers:l==null?void 0:l.map(L=>new U(L))},W=p===6?xr(A):p===5?Pr(A):Tr(A),M={3:z.FarmV3Withdraw,5:z.FarmV5Withdraw,6:z.FarmV6Withdraw};return g.addInstruction({instructions:[W],instructionTypes:[M[p]]}).versionBuild({txVersion:r})}async withdrawFarmReward({farmInfo:t,withdrawMint:r,txVersion:n}){var p;this.scope.checkOwner();let o=we((await this.scope.api.fetchFarmKeysById({ids:t.id}))[0]),i=Te[t.programId];i!==6&&this.logAndCreateError("invalid farm version",i);let s=t.rewardInfos.findIndex(m=>m.mint.address===ne.toString()?new U(se.address):r),a=o.rewardInfos[s];a||this.logAndCreateError("withdraw mint error","rewardInfos",t);let c=(p=a==null?void 0:a.vault)!=null?p:ne,u=this.createTxBuilder(),l;if(r.equals(ne)){let m=await ir({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:gr(te(j({},a),{openTime:a.openTime,endTime:a.endTime,perSecond:new Ot(a.perSecond).mul(10**a.mint.decimals).toString()}))});l=m.addresses.newAccount,u.addInstruction(m)}else{let m=await this.scope.account.getCreatedTokenAccount({mint:r});m===null?(l=await this.scope.account.getAssociatedTokenAccount(r),u.addInstruction({instructions:[es(this.scope.ownerPubKey,l,this.scope.ownerPubKey,r)],instructionTypes:[z.CreateATA]})):l=m}let{instruction:d,instructionType:f}=Cn({programId:o.programId,id:o.id,authority:o.authority,lpVault:o.lpVault,rewardVault:c,userRewardToken:l,owner:this.scope.ownerPubKey});return u.addInstruction({instructions:[d],instructionTypes:[f]}).versionBuild({txVersion:n})}async harvestAllRewards(t){let{farmInfoList:r,useSOLBalance:n,feePayer:o,associatedOnly:i=!0,checkCreateATAOwner:s=!1,userAuxiliaryLedgers:a,txVersion:c,computeBudgetConfig:u}=t,l=this.createTxBuilder(),d={};for(let m of this.scope.account.tokenAccounts)if(i){let g=De(this.scope.ownerPubKey,m.mint).publicKey;m.publicKey&&g.equals(m.publicKey)&&(d[m.mint.toString()]=m.publicKey)}else d[m.mint.toString()]=m.publicKey;let p=(await this.scope.api.fetchFarmKeysById({ids:Object.values(r).map(m=>m.id).join(",")})).reduce((m,g)=>te(j({},m),{[g.id]:g}),{});for(let m of Object.values(r)){let{programId:g,lpMint:T,rewardInfos:P,id:x}=m,b=Te[g],w=T.address,B=n&&w===ge.toString(),A=d[w];if(!A){let{account:H,instructionParams:F}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:T.programId,mint:new U(w),notUseTokenAccount:B,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:B?!1:i,checkCreateATAOwner:s});A=H,F&&l.addInstruction(F)}d[w.toString()]=A;let W=[];for(let H of P){let F=n&&H.mint.address===ge.toString(),ee=d[H.mint.address];if(!ee){let{account:Y,instructionParams:D}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:H.mint.programId,mint:new U(H.mint.address),notUseTokenAccount:F,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!F,associatedOnly:F?!1:i,checkCreateATAOwner:s});ee=Y,D&&l.addInstruction(D)}d[H.mint.address]=ee,W.push(ee)}let M=p[x],L={amount:Zt,owner:this.scope.ownerPubKey,farmInfo:m,farmKeys:M,lpAccount:A,rewardAccounts:W,userAuxiliaryLedgers:a==null?void 0:a.map(H=>new U(H))},v=b===6?xr(L):b===5?Pr(L):Tr(L),q={3:z.FarmV3Withdraw,5:z.FarmV5Withdraw,6:z.FarmV6Withdraw};l.addInstruction({instructions:[v],instructionTypes:[q[b]]})}return c===1?l.sizeCheckBuild({computeBudgetConfig:u}):l.sizeCheckBuildV0({computeBudgetConfig:u})}};export{kr as default};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=farm.mjs.map