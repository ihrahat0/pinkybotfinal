var gr=Object.defineProperty,br=Object.defineProperties;var yr=Object.getOwnPropertyDescriptors;var Xt=Object.getOwnPropertySymbols;var ii=Object.prototype.hasOwnProperty,ri=Object.prototype.propertyIsEnumerable;var ni=(i,e,t)=>e in i?gr(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,N=(i,e)=>{for(var t in e||(e={}))ii.call(e,t)&&ni(i,t,e[t]);if(Xt)for(var t of Xt(e))ri.call(e,t)&&ni(i,t,e[t]);return i},U=(i,e)=>br(i,yr(e));var gt=(i,e)=>{var t={};for(var n in i)ii.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&Xt)for(var n of Xt(i))e.indexOf(n)<0&&ri.call(i,n)&&(t[n]=i[n]);return t};import{PublicKey as _}from"@solana/web3.js";import Ke from"bn.js";var bt=9e15,rt=1e9,hn="0123456789abcdef",Ht="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Zt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",An={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-bt,maxE:bt,crypto:!1},ci,je,v=!0,Yt="[DecimalError] ",it=Yt+"Invalid argument: ",ui=Yt+"Precision limit exceeded",li=Yt+"crypto unavailable",mi="[object Decimal]",ke=Math.floor,ge=Math.pow,wr=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,hr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Ar=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,di=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,De=1e7,O=7,Pr=9007199254740991,Tr=Ht.length-1,Pn=Zt.length-1,k={toStringTag:mi};k.absoluteValue=k.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),L(i)};k.ceil=function(){return L(new this.constructor(this),this.e+1,2)};k.clampedTo=k.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(it+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};k.comparedTo=k.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,c=o.s,u=i.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==i.e)return o.e>i.e^c<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return n===r?0:n>r^c<0?1:-1};k.cosine=k.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+O,n.rounding=1,t=kr(n,yi(n,t)),n.precision=i,n.rounding=e,L(je==2||je==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};k.cubeRoot=k.cbrt=function(){var i,e,t,n,r,o,s,a,c,u,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(v=!1,o=l.s*ge(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=he(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=ge(t,1/3),i=ke((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(i=m.precision)+3;;)if(a=n,c=a.times(a).times(a),u=c.plus(l),n=$(u.plus(l).times(a),u.plus(c),s+2,1),he(a.d).slice(0,s)===(t=he(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(L(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(L(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return v=!0,L(n,i,m.rounding,e)};k.decimalPlaces=k.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-ke(this.e/O))*O,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};k.dividedBy=k.div=function(i){return $(this,new this.constructor(i))};k.dividedToIntegerBy=k.divToInt=function(i){var e=this,t=e.constructor;return L($(e,new t(i),0,1,1),t.precision,t.rounding)};k.equals=k.eq=function(i){return this.cmp(i)===0};k.floor=function(){return L(new this.constructor(this),this.e+1,3)};k.greaterThan=k.gt=function(i){return this.cmp(i)>0};k.greaterThanOrEqualTo=k.gte=function(i){var e=this.cmp(i);return e==1||e===0};k.hyperbolicCosine=k.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/Jt(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=yt(s,1,o.times(e),new s(1),!0);for(var c,u=i,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return L(o,s.precision=t,s.rounding=n,!0)};k.hyperbolicSine=k.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=yt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/Jt(5,i)),r=yt(o,2,r,r,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=t,L(r,e,t,!0)};k.hyperbolicTangent=k.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,$(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};k.inverseCosine=k.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Fe(t,r,o):new t(0):new t(NaN):e.isZero()?Fe(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=Fe(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};k.inverseHyperbolicCosine=k.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,v=!1,t=t.times(t).minus(1).sqrt().plus(t),v=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};k.inverseHyperbolicSine=k.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,v=!1,t=t.times(t).plus(1).sqrt().plus(t),v=!0,n.precision=i,n.rounding=e,t.ln())};k.inverseHyperbolicTangent=k.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?L(new o(r),i,e,!0):(o.precision=t=n-r.e,r=$(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};k.inverseSine=k.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=Fe(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};k.inverseTangent=k.atan=function(){var i,e,t,n,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&m+4<=Pn)return s=Fe(l,m+4,d).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(m+4<=Pn)return s=Fe(l,m+4,d).times(.5),s.s=u.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/O+2|0),i=t;i;--i)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(v=!1,e=Math.ceil(a/O),n=1,c=u.times(u),s=new l(u),r=u;i!==-1;)if(r=r.times(c),o=s.minus(r.div(n+=2)),r=r.times(c),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),v=!0,L(s,l.precision=m,l.rounding=d,!0)};k.isFinite=function(){return!!this.d};k.isInteger=k.isInt=function(){return!!this.d&&ke(this.e/O)>this.d.length-2};k.isNaN=function(){return!this.s};k.isNegative=k.isNeg=function(){return this.s<0};k.isPositive=k.isPos=function(){return this.s>0};k.isZero=function(){return!!this.d&&this.d[0]===0};k.lessThan=k.lt=function(i){return this.cmp(i)<0};k.lessThanOrEqualTo=k.lte=function(i){return this.cmp(i)<1};k.logarithm=k.log=function(i){var e,t,n,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding,f=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new l(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(v=!1,a=m+f,s=nt(u,a),n=e?jt(l,a+10):nt(i,a),c=$(s,n,a,1),kt(c.d,r=m,d))do if(a+=10,s=nt(u,a),n=e?jt(l,a+10):nt(i,a),c=$(s,n,a,1),!o){+he(c.d).slice(r+1,r+15)+1==1e14&&(c=L(c,m+1,0));break}while(kt(c.d,r+=10,d));return v=!0,L(c,m,d)};k.minus=k.sub=function(i){var e,t,n,r,o,s,a,c,u,l,m,d,f=this,g=f.constructor;if(i=new g(i),!f.d||!i.d)return!f.s||!i.s?i=new g(NaN):f.d?i.s=-i.s:i=new g(i.d||f.s!==i.s?f:NaN),i;if(f.s!=i.s)return i.s=-i.s,f.plus(i);if(u=f.d,d=i.d,a=g.precision,c=g.rounding,!u[0]||!d[0]){if(d[0])i.s=-i.s;else if(u[0])i=new g(f);else return new g(c===3?-0:0);return v?L(i,a,c):i}if(t=ke(i.e/O),l=ke(f.e/O),u=u.slice(),o=l-t,o){for(m=o<0,m?(e=u,o=-o,s=d.length):(e=d,t=l,s=u.length),n=Math.max(Math.ceil(a/O),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=u.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(u[n]!=d[n]){m=u[n]<d[n];break}o=0}for(m&&(e=u,u=d,d=e,i.s=-i.s),s=u.length,n=d.length-s;n>0;--n)u[s++]=0;for(n=d.length;n>o;){if(u[--n]<d[n]){for(r=n;r&&u[--r]===0;)u[r]=De-1;--u[r],u[n]+=De}u[n]-=d[n]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(i.d=u,i.e=Qt(u,t),v?L(i,a,c):i):new g(c===3?-0:0)};k.modulo=k.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?L(new n(t),n.precision,n.rounding):(v=!1,n.modulo==9?(e=$(t,i.abs(),0,3,1),e.s*=i.s):e=$(t,i,0,n.modulo,1),e=e.times(i),v=!0,t.minus(e))};k.naturalExponential=k.exp=function(){return Tn(this)};k.naturalLogarithm=k.ln=function(){return nt(this)};k.negated=k.neg=function(){var i=new this.constructor(this);return i.s=-i.s,L(i)};k.plus=k.add=function(i){var e,t,n,r,o,s,a,c,u,l,m=this,d=m.constructor;if(i=new d(i),!m.d||!i.d)return!m.s||!i.s?i=new d(NaN):m.d||(i=new d(i.d||m.s===i.s?m:NaN)),i;if(m.s!=i.s)return i.s=-i.s,m.minus(i);if(u=m.d,l=i.d,a=d.precision,c=d.rounding,!u[0]||!l[0])return l[0]||(i=new d(m)),v?L(i,a,c):i;if(o=ke(m.e/O),n=ke(i.e/O),u=u.slice(),r=o-n,r){for(r<0?(t=u,r=-r,s=l.length):(t=l,n=o,s=u.length),o=Math.ceil(a/O),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=u.length,r=l.length,s-r<0&&(r=s,t=l,l=u,u=t),e=0;r;)e=(u[--r]=u[r]+l[r]+e)/De|0,u[r]%=De;for(e&&(u.unshift(e),++n),s=u.length;u[--s]==0;)u.pop();return i.d=u,i.e=Qt(u,n),v?L(i,a,c):i};k.precision=k.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(it+i);return t.d?(e=fi(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};k.round=function(){var i=this,e=i.constructor;return L(new e(i),i.e+1,e.rounding)};k.sine=k.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+O,n.rounding=1,t=Br(n,yi(n,t)),n.precision=i,n.rounding=e,L(je>2?t.neg():t,i,e,!0)):new n(NaN)};k.squareRoot=k.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(v=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=he(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=ke((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),n=new l(e)):n=new l(u.toString()),t=(c=l.precision)+3;;)if(o=n,n=o.plus($(s,o,t+2,1)).times(.5),he(o.d).slice(0,t)===(e=he(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(L(o,c+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(L(n,c+1,1),i=!n.times(n).eq(s));break}return v=!0,L(n,c,l.rounding,i)};k.tangent=k.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=$(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,L(je==2||je==4?t.neg():t,i,e,!0)):new n(NaN)};k.times=k.mul=function(i){var e,t,n,r,o,s,a,c,u,l=this,m=l.constructor,d=l.d,f=(i=new m(i)).d;if(i.s*=l.s,!d||!d[0]||!f||!f[0])return new m(!i.s||d&&!d[0]&&!f||f&&!f[0]&&!d?NaN:!d||!f?i.s/0:i.s*0);for(t=ke(l.e/O)+ke(i.e/O),c=d.length,u=f.length,c<u&&(o=d,d=f,f=o,s=c,c=u,u=s),o=[],s=c+u,n=s;n--;)o.push(0);for(n=u;--n>=0;){for(e=0,r=c+n;r>n;)a=o[r]+f[n]*d[r-n-1]+e,o[r--]=a%De|0,e=a/De|0;o[r]=(o[r]+e)%De|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=Qt(o,t),v?L(i,m.precision,m.rounding):i};k.toBinary=function(i,e){return xn(this,2,i,e)};k.toDecimalPlaces=k.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Ie(i,0,rt),e===void 0?e=n.rounding:Ie(e,0,8),L(t,i+t.e+1,e))};k.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Ve(n,!0):(Ie(i,0,rt),e===void 0?e=r.rounding:Ie(e,0,8),n=L(new r(n),i+1,e),t=Ve(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};k.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=Ve(r):(Ie(i,0,rt),e===void 0?e=o.rounding:Ie(e,0,8),n=L(new o(r),i+r.e+1,e),t=Ve(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};k.toFraction=function(i){var e,t,n,r,o,s,a,c,u,l,m,d,f=this,g=f.d,p=f.constructor;if(!g)return new p(f);if(u=t=new p(1),n=c=new p(0),e=new p(n),o=e.e=fi(g)-f.e-1,s=o%O,e.d[0]=ge(10,s<0?O+s:s),i==null)i=o>0?e:u;else{if(a=new p(i),!a.isInt()||a.lt(u))throw Error(it+a);i=a.gt(e)?o>0?e:u:a}for(v=!1,a=new p(he(g)),l=p.precision,p.precision=o=g.length*O*2;m=$(a,e,0,1,1),r=t.plus(m.times(n)),r.cmp(i)!=1;)t=n,n=r,r=u,u=c.plus(m.times(r)),c=r,r=e,e=a.minus(m.times(r)),a=r;return r=$(i.minus(t),n,0,1,1),c=c.plus(r.times(u)),t=t.plus(r.times(n)),c.s=u.s=f.s,d=$(u,n,o,1).minus(f).abs().cmp($(c,t,o,1).minus(f).abs())<1?[u,n]:[c,t],p.precision=l,v=!0,d};k.toHexadecimal=k.toHex=function(i,e){return xn(this,16,i,e)};k.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Ie(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(v=!1,t=$(t,i,0,e,1).times(i),v=!0,L(t)):(i.s=t.s,t=i),t};k.toNumber=function(){return+this};k.toOctal=function(i,e){return xn(this,8,i,e)};k.toPower=k.pow=function(i){var e,t,n,r,o,s,a=this,c=a.constructor,u=+(i=new c(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new c(ge(+a,u));if(a=new c(a),a.eq(1))return a;if(n=c.precision,o=c.rounding,i.eq(1))return L(a,n,o);if(e=ke(i.e/O),e>=i.d.length-1&&(t=u<0?-u:u)<=Pr)return r=pi(c,a,t,n),i.s<0?new c(1).div(r):L(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new c(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=ge(+a,u),e=t==0||!isFinite(t)?ke(u*(Math.log("0."+he(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(v=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),r=Tn(i.times(nt(a,n+t)),n),r.d&&(r=L(r,n+5,1),kt(r.d,n,o)&&(e=n+10,r=L(Tn(i.times(nt(a,e+t)),e),e+5,1),+he(r.d).slice(n+1,n+15)+1==1e14&&(r=L(r,n+1,0)))),r.s=s,v=!0,c.rounding=o,L(r,n,o))};k.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Ve(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Ie(i,1,rt),e===void 0?e=r.rounding:Ie(e,0,8),n=L(new r(n),i,e),t=Ve(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};k.toSignificantDigits=k.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Ie(i,1,rt),e===void 0?e=n.rounding:Ie(e,0,8)),L(new n(t),i,e)};k.toString=function(){var i=this,e=i.constructor,t=Ve(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};k.truncated=k.trunc=function(){return L(new this.constructor(this),this.e+1,1)};k.valueOf=k.toJSON=function(){var i=this,e=i.constructor,t=Ve(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function he(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=O-n.length,t&&(o+=tt(t)),o+=n;s=i[e],n=s+"",t=O-n.length,t&&(o+=tt(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Ie(i,e,t){if(i!==~~i||i<e||i>t)throw Error(it+i)}function kt(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=O,r=0):(r=Math.ceil((e+1)/O),e%=O),o=ge(10,O-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==ge(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==ge(10,e-3)-1,s}function zt(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=hn.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function kr(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/Jt(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=yt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var $=function(){function i(n,r,o){var s,a=0,c=n.length;for(n=n.slice();c--;)s=n[c]*r+a,n[c]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(n[a]!=r[a]){c=n[a]>r[a]?1:-1;break}return c}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,c){var u,l,m,d,f,g,p,y,b,h,w,A,T,P,x,B,C,M,R,J,te=n.constructor,de=n.s==r.s?1:-1,ne=n.d,Q=r.d;if(!ne||!ne[0]||!Q||!Q[0])return new te(!n.s||!r.s||(ne?Q&&ne[0]==Q[0]:!Q)?NaN:ne&&ne[0]==0||!Q?de*0:de/0);for(c?(f=1,l=n.e-r.e):(c=De,f=O,l=ke(n.e/f)-ke(r.e/f)),R=Q.length,C=ne.length,b=new te(de),h=b.d=[],m=0;Q[m]==(ne[m]||0);m++);if(Q[m]>(ne[m]||0)&&l--,o==null?(P=o=te.precision,s=te.rounding):a?P=o+(n.e-r.e)+1:P=o,P<0)h.push(1),g=!0;else{if(P=P/f+2|0,m=0,R==1){for(d=0,Q=Q[0],P++;(m<C||d)&&P--;m++)x=d*c+(ne[m]||0),h[m]=x/Q|0,d=x%Q|0;g=d||m<C}else{for(d=c/(Q[0]+1)|0,d>1&&(Q=i(Q,d,c),ne=i(ne,d,c),R=Q.length,C=ne.length),B=R,w=ne.slice(0,R),A=w.length;A<R;)w[A++]=0;J=Q.slice(),J.unshift(0),M=Q[0],Q[1]>=c/2&&++M;do d=0,u=e(Q,w,R,A),u<0?(T=w[0],R!=A&&(T=T*c+(w[1]||0)),d=T/M|0,d>1?(d>=c&&(d=c-1),p=i(Q,d,c),y=p.length,A=w.length,u=e(p,w,y,A),u==1&&(d--,t(p,R<y?J:Q,y,c))):(d==0&&(u=d=1),p=Q.slice()),y=p.length,y<A&&p.unshift(0),t(w,p,A,c),u==-1&&(A=w.length,u=e(Q,w,R,A),u<1&&(d++,t(w,R<A?J:Q,A,c))),A=w.length):u===0&&(d++,w=[0]),h[m++]=d,u&&w[0]?w[A++]=ne[B]||0:(w=[ne[B]],A=1);while((B++<C||w[0]!==void 0)&&P--);g=w[0]!==void 0}h[0]||h.shift()}if(f==1)b.e=l,ci=g;else{for(m=1,d=h[0];d>=10;d/=10)m++;b.e=m+l*f-1,L(b,a?o+b.e+1:o,s,g)}return b}}();function L(i,e,t,n){var r,o,s,a,c,u,l,m,d,f=i.constructor;e:if(e!=null){if(m=i.d,!m)return i;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=O,s=e,l=m[d=0],c=l/ge(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/O),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=c=0,r=1,o%=O,s=o-O+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=O,s=o-O+r,c=s<0?0:l/ge(10,r-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%ge(10,r-s-1)),u=t<4?(c||n)&&(t==0||t==(i.s<0?3:2)):c>5||c==5&&(t==4||n||t==6&&(o>0?s>0?l/ge(10,r-s):0:m[d-1])%10&1||t==(i.s<0?8:7)),e<1||!m[0])return m.length=0,u?(e-=i.e+1,m[0]=ge(10,(O-e%O)%O),i.e=-e||0):m[0]=i.e=0,i;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=ge(10,O-o),m[d]=s>0?(l/ge(10,r-s)%ge(10,s)|0)*a:0),u)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,m[0]==De&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=De)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return v&&(i.e>f.maxE?(i.d=null,i.e=NaN):i.e<f.minE&&(i.e=0,i.d=[0])),i}function Ve(i,e,t){if(!i.isFinite())return bi(i);var n,r=i.e,o=he(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+tt(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+tt(-r-1)+o,t&&(n=t-s)>0&&(o+=tt(n))):r>=s?(o+=tt(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+tt(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=tt(n))),o}function Qt(i,e){var t=i[0];for(e*=O;t>=10;t/=10)e++;return e}function jt(i,e,t){if(e>Tr)throw v=!0,t&&(i.precision=t),Error(ui);return L(new i(Ht),e,1,!0)}function Fe(i,e,t){if(e>Pn)throw Error(ui);return L(new i(Zt),e,t,!0)}function fi(i){var e=i.length-1,t=e*O+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function tt(i){for(var e="";i--;)e+="0";return e}function pi(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/O+4);for(v=!1;;){if(t%2&&(o=o.times(e),si(o.d,s)&&(r=!0)),t=ke(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),si(e.d,s)}return v=!0,o}function oi(i){return i.d[i.d.length-1]&1}function gi(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function Tn(i,e){var t,n,r,o,s,a,c,u=0,l=0,m=0,d=i.constructor,f=d.rounding,g=d.precision;if(!i.d||!i.d[0]||i.e>17)return new d(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(v=!1,c=g):c=e,a=new d(.03125);i.e>-2;)i=i.times(a),m+=5;for(n=Math.log(ge(2,m))/Math.LN10*2+5|0,c+=n,t=o=s=new d(1),d.precision=c;;){if(o=L(o.times(i),c,1),t=t.times(++l),a=s.plus($(o,t,c,1)),he(a.d).slice(0,c)===he(s.d).slice(0,c)){for(r=m;r--;)s=L(s.times(s),c,1);if(e==null)if(u<3&&kt(s.d,c-n,f,u))d.precision=c+=10,t=o=a=new d(1),l=0,u++;else return L(s,d.precision=g,f,v=!0);else return d.precision=g,s}s=a}}function nt(i,e){var t,n,r,o,s,a,c,u,l,m,d,f=1,g=10,p=i,y=p.d,b=p.constructor,h=b.rounding,w=b.precision;if(p.s<0||!y||!y[0]||!p.e&&y[0]==1&&y.length==1)return new b(y&&!y[0]?-1/0:p.s!=1?NaN:y?0:p);if(e==null?(v=!1,l=w):l=e,b.precision=l+=g,t=he(y),n=t.charAt(0),Math.abs(o=p.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)p=p.times(i),t=he(p.d),n=t.charAt(0),f++;o=p.e,n>1?(p=new b("0."+t),o++):p=new b(n+"."+t.slice(1))}else return u=jt(b,l+2,w).times(o+""),p=nt(new b(n+"."+t.slice(1)),l-g).plus(u),b.precision=w,e==null?L(p,w,h,v=!0):p;for(m=p,c=s=p=$(p.minus(1),p.plus(1),l,1),d=L(p.times(p),l,1),r=3;;){if(s=L(s.times(d),l,1),u=c.plus($(s,new b(r),l,1)),he(u.d).slice(0,l)===he(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(jt(b,l+2,w).times(o+""))),c=$(c,new b(f),l,1),e==null)if(kt(c.d,l-g,h,a))b.precision=l+=g,u=s=p=$(m.minus(1),m.plus(1),l,1),d=L(p.times(p),l,1),r=a=1;else return L(c,b.precision=w,h,v=!0);else return b.precision=w,c;c=u,r+=2}}function bi(i){return String(i.s*i.s/0)}function kn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%O,t<0&&(n+=O),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=O;n<r;)i.d.push(+e.slice(n,n+=O));e=e.slice(n),n=O-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),v&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function xr(i,e){var t,n,r,o,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),di.test(e))return kn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(hr.test(e))t=16,e=e.toLowerCase();else if(wr.test(e))t=2;else if(Ar.test(e))t=8;else throw Error(it+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=pi(n,new n(t),o,o*2)),u=zt(e,t,De),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new n(i.s*0):(i.e=Qt(u,l),i.d=u,v=!1,s&&(i=$(i,r,a*4)),c&&(i=i.times(Math.abs(c)<54?ge(2,c):xt.pow(2,c))),v=!0,i)}function Br(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:yt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/Jt(5,t)),e=yt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function yt(i,e,t,n,r){var o,s,a,c,u=1,l=i.precision,m=Math.ceil(l/O);for(v=!1,c=t.times(t),a=new i(n);;){if(s=$(a.times(c),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=$(s.times(c),new i(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,u++}return v=!0,s.d.length=m+1,s}function Jt(i,e){for(var t=i;--e;)t*=i;return t}function yi(i,e){var t,n=e.s<0,r=Fe(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return je=n?4:1,e;if(t=e.divToInt(r),t.isZero())je=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return je=oi(t)?n?2:3:n?4:1,e;je=oi(t)?n?1:4:n?3:2}return e.minus(r).abs()}function xn(i,e,t,n){var r,o,s,a,c,u,l,m,d,f=i.constructor,g=t!==void 0;if(g?(Ie(t,1,rt),n===void 0?n=f.rounding:Ie(n,0,8)):(t=f.precision,n=f.rounding),!i.isFinite())l=bi(i);else{for(l=Ve(i),s=l.indexOf("."),g?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new f(1),d.e=l.length-s,d.d=zt(Ve(d),10,r),d.e=d.d.length),m=zt(l,10,r),o=c=m.length;m[--c]==0;)m.pop();if(!m[0])l=g?"0p+0":"0";else{if(s<0?o--:(i=new f(i),i.d=m,i.e=o,i=$(i,d,t,n,0,r),m=i.d,o=i.e,u=ci),s=m[t],a=r/2,u=u||m[t+1]!==void 0,u=n<4?(s!==void 0||u)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||u||n===6&&m[t-1]&1||n===(i.s<0?8:7)),m.length=t,u)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(c=m.length;!m[c-1];--c);for(s=0,l="";s<c;s++)l+=hn.charAt(m[s]);if(g){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(m=zt(l,r,e),c=m.length;!m[c-1];--c);for(s=1,l="1.";s<c;s++)l+=hn.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function si(i,e){if(i.length>e)return i.length=e,!0}function Ir(i){return new this(i).abs()}function Sr(i){return new this(i).acos()}function Cr(i){return new this(i).acosh()}function Kr(i,e){return new this(i).plus(e)}function Nr(i){return new this(i).asin()}function Lr(i){return new this(i).asinh()}function Rr(i){return new this(i).atan()}function Mr(i){return new this(i).atanh()}function Or(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=Fe(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?Fe(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=Fe(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan($(i,e,o,1)),e=Fe(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan($(i,e,o,1)),t}function Er(i){return new this(i).cbrt()}function Fr(i){return L(i=new this(i),i.e+1,2)}function Dr(i,e,t){return new this(i).clamp(e,t)}function _r(i){if(!i||typeof i!="object")throw Error(Yt+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,rt,"rounding",0,8,"toExpNeg",-bt,0,"toExpPos",0,bt,"maxE",0,bt,"minE",-bt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=An[t]),(n=i[t])!==void 0)if(ke(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(it+t+": "+n);if(t="crypto",r&&(this[t]=An[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(li);else this[t]=!1;else throw Error(it+t+": "+n);return this}function vr(i){return new this(i).cos()}function qr(i){return new this(i).cosh()}function wi(i){var e,t,n;function r(o){var s,a,c,u=this;if(!(u instanceof r))return new r(o);if(u.constructor=r,ai(o)){u.s=o.s,v?!o.d||o.e>r.maxE?(u.e=NaN,u.d=null):o.e<r.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;v?s>r.maxE?(u.e=NaN,u.d=null):s<r.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return kn(u,o.toString())}else if(c!=="string")throw Error(it+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),di.test(o)?kn(u,o):xr(u,o)}if(r.prototype=k,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=_r,r.clone=wi,r.isDecimal=ai,r.abs=Ir,r.acos=Sr,r.acosh=Cr,r.add=Kr,r.asin=Nr,r.asinh=Lr,r.atan=Rr,r.atanh=Mr,r.atan2=Or,r.cbrt=Er,r.ceil=Fr,r.clamp=Dr,r.cos=vr,r.cosh=qr,r.div=Wr,r.exp=Vr,r.floor=Ur,r.hypot=Gr,r.ln=Xr,r.log=zr,r.log10=Zr,r.log2=Hr,r.max=jr,r.min=Yr,r.mod=Qr,r.mul=Jr,r.pow=$r,r.random=eo,r.round=to,r.sign=no,r.sin=io,r.sinh=ro,r.sqrt=oo,r.sub=so,r.sum=ao,r.tan=co,r.tanh=uo,r.trunc=lo,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function Wr(i,e){return new this(i).div(e)}function Vr(i){return new this(i).exp()}function Ur(i){return L(i=new this(i),i.e+1,3)}function Gr(){var i,e,t=new this(0);for(v=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return v=!0,new this(1/0);t=e}return v=!0,t.sqrt()}function ai(i){return i instanceof xt||i&&i.toStringTag===mi||!1}function Xr(i){return new this(i).ln()}function zr(i,e){return new this(i).log(e)}function Hr(i){return new this(i).log(2)}function Zr(i){return new this(i).log(10)}function jr(){return gi(this,arguments,"lt")}function Yr(){return gi(this,arguments,"gt")}function Qr(i,e){return new this(i).mod(e)}function Jr(i,e){return new this(i).mul(e)}function $r(i,e){return new this(i).pow(e)}function eo(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Ie(i,1,rt),n=Math.ceil(i/O),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(li);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=O,n&&i&&(r=ge(10,O-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=O)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<O&&(t-=O-n)}return s.e=t,s.d=a,s}function to(i){return L(i=new this(i),i.e+1,this.rounding)}function no(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function io(i){return new this(i).sin()}function ro(i){return new this(i).sinh()}function oo(i){return new this(i).sqrt()}function so(i,e){return new this(i).sub(e)}function ao(){var i=0,e=arguments,t=new this(e[i]);for(v=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return v=!0,L(t,this.precision,this.rounding)}function co(i){return new this(i).tan()}function uo(i){return new this(i).tanh()}function lo(i){return L(i=new this(i),i.e+1,1)}k[Symbol.for("nodejs.util.inspect.custom")]=k.toString;k[Symbol.toStringTag]="Decimal";var xt=k.constructor=wi(An);Ht=new xt(Ht);Zt=new xt(Zt);var S=xt;import{PublicKey as Pi}from"@solana/web3.js";import{get as hi,set as mo}from"lodash";var Bn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Ai={},fo={};function Ae(i){let e=hi(Ai,i);if(!e){let t=hi(fo,i);e=new Bn({name:i,logLevel:t}),mo(Ai,i,e)}return e}import{MINT_SIZE as po,TOKEN_PROGRAM_ID as go,getTransferFeeConfig as bo,unpackMint as yo}from"@solana/spl-token";var In=Ae("Raydium_accountInfo_util");async function Ye(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}=N({batchRequest:!1},t),s=Sn(e,o),a=new Array(s.length).fill([]);if(n){let c=s.map(m=>{let d=i._buildArgs([m.map(f=>f.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),u=Sn(c,10);a=(await(await Promise.all(u.map(async m=>await i._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&In.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:f,executable:g,lamports:p,owner:y,rentEpoch:b}=d;return f.length!==2&&f[1]!=="base64"&&In.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(f[0],"base64"),executable:g,lamports:p,owner:new Pi(y),rentEpoch:b}}return null})))}else try{a=await Promise.all(s.map(c=>i.getMultipleAccountsInfo(c,r)))}catch(c){c instanceof Error&&In.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function ot(i,e,t){let n=await Ye(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>U(N({},r),{accountInfo:n[o]}))}async function Ti({connection:i,mints:e,config:t}){var o,s,a;if(e.length===0)return{};let n=await ot(i,e.map(c=>({pubkey:lt(c)})),t),r={};for(let c of n){if(!c.accountInfo||c.accountInfo.data.length<po){console.log("invalid mint account",c.pubkey.toBase58());continue}let u=yo(c.pubkey,c.accountInfo,(o=c.accountInfo)==null?void 0:o.owner);r[c.pubkey.toString()]=U(N({},u),{programId:((s=c.accountInfo)==null?void 0:s.owner)||go,feeConfig:(a=bo(u))!=null?a:void 0})}return r[Pi.default.toBase58()]=r[Z.toBase58()],r}import Qe from"bn.js";import Bo from"big.js";import tn from"bn.js";import wo from"toformat";var ho=wo,Bt=ho;import en from"big.js";import Po from"bn.js";import To from"decimal.js-light";import It from"bn.js";var ki=9007199254740991;function ye(i){let e=Ae("Raydium_parseBigNumberish");if(i instanceof It)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new It(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=ki||i<=-ki)&&e.logWithError(`BigNumberish number overflow: ${i}`),new It(String(i))):typeof i=="bigint"?new It(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new It(0))}var $t=Ae("module/fraction"),Cn=Bt(en),St=Bt(To),ko={[0]:St.ROUND_DOWN,[1]:St.ROUND_HALF_UP,[2]:St.ROUND_UP},xo={[0]:en.roundDown,[1]:en.roundHalfUp,[2]:en.roundUp},j=class{constructor(e,t=new Po(1)){this.numerator=ye(e),this.denominator=ye(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new j(this.denominator,this.numerator)}add(e){let t=e instanceof j?e:new j(ye(e));return this.denominator.eq(t.denominator)?new j(this.numerator.add(t.numerator),this.denominator):new j(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof j?e:new j(ye(e));return this.denominator.eq(t.denominator)?new j(this.numerator.sub(t.numerator),this.denominator):new j(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof j?e:new j(ye(e));return new j(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof j?e:new j(ye(e));return new j(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||$t.logWithError(`${e} is not an integer.`),e<=0&&$t.logWithError(`${e} is not positive.`),St.set({precision:e+1,rounding:ko[n]});let r=new St(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||$t.logWithError(`${e} is not an integer.`),e<0&&$t.logWithError(`${e} is negative.`),Cn.DP=e,Cn.RM=xo[n]||1,new Cn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Io=Ae("Raydium_amount"),xi=Bt(Bo);function So(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):Io.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var Pe=class extends j{constructor(t,n,r=!0,o){let s=new tn(0),a=Kn.pow(new tn(t.decimals));if(r)s=ye(n);else{let c=new tn(0),u=new tn(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=So(n.toString(),t.decimals);c=ye(l),u=ye(m)}c=c.mul(a),s=c.add(u)}super(s,a);this.logger=Ae(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new Pe(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new Pe(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return xi.DP=this.token.decimals,new xi(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as Co}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Bi}from"@solana/spl-token";var Nn={chainId:101,address:Co.default.toBase58(),programId:Bi.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},st={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Bi.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Mn}from"@solana/web3.js";import{PublicKey as re,SystemProgram as Ii,SYSVAR_RENT_PUBKEY as Ko}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as No}from"@solana/spl-token";function Ln({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var ua=[Ln({pubkey:No,isWritable:!1}),Ln({pubkey:Ii.programId,isWritable:!1}),Ln({pubkey:Ko,isWritable:!1})];function Rn({publicKey:i,transformSol:e}){let t=Si(i.toString());if(t instanceof re)return e&&t.equals(Ct)?Z:t;if(e&&t.toString()===Ct.toBase58())return Z;if(typeof t=="string"){if(t===re.default.toBase58())return re.default;try{return new re(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Si(i){try{return new re(i)}catch{return i}}var nn=new re("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ci=new re("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Kt=new re("SysvarRent111111111111111111111111111111111"),la=new re("SysvarC1ock11111111111111111111111111111111"),wt=new re("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ma=new re("Sysvar1nstructions1111111111111111111111111"),da=Ii.programId,fa=new re("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),pa=new re("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),ga=new re("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ba=new re("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),ya=new re("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),wa=new re("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ha=new re("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Aa=new re("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Pa=new re("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ta=new re("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),ka=new re("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Z=new re("So11111111111111111111111111111111111111112"),Ct=re.default;function lt(i){return Rn({publicKey:i,transformSol:!0})}var On=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===Ct.toBase58()||e instanceof Mn&&Ct.equals(e)){this.decimals=st.decimals,this.symbol=st.symbol,this.name=st.name,this.mint=new Mn(st.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?Mn.default:Rn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ue=On;Ue.WSOL=new On(U(N({},st),{mint:st.address}));var En=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},rn=En;rn.SOL=new En(Nn);import Lo from"bn.js";var Ki=new j(new Lo(100)),at=class extends j{toSignificant(e=5,t,n){return this.mul(Ki).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Ki).toFixed(e,t,n)}};var Ro=Ae("Raydium_price"),_e=class extends j{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new j(Fn(n.decimals),Fn(r.decimals))}get raw(){return new j(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new _e({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Ro.logWithError("mul token not equals");let n=super.mul(t);return new _e({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};import{PublicKey as tc}from"@solana/web3.js";import ic from"bn.js";var Mo=new Qe(0),Pc=new Qe(1),Tc=new Qe(2),kc=new Qe(3),xc=new Qe(5),Kn=new Qe(10),Bc=new Qe(100),Ic=new Qe(1e3),Sc=new Qe(1e4);function Fn(i){return Kn.pow(ye(i))}function Sn(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as qo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Wo}from"@solana/spl-token";import{ComputeBudgetProgram as Ni,Keypair as Ri,PublicKey as Oo,Transaction as Mi,TransactionMessage as Eo,VersionedTransaction as Oi}from"@solana/web3.js";var oe={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{TOKEN_PROGRAM_ID as Fo}from"@solana/spl-token";var Li=Ae("Raydium_txUtil"),Ei=1644;function on(i){let e=[],t=[];return i.microLamports&&(e.push(Ni.setComputeUnitPrice({microLamports:i.microLamports})),t.push(oe.SetComputeUnitPrice)),i.units&&(e.push(Ni.setComputeUnitLimit({units:i.units})),t.push(oe.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function ht(i,e){var n,r;let t=e!=null?e:"confirmed";return(r=await((n=i.getLatestBlockhash)==null?void 0:n.call(i,{commitment:t})))==null?void 0:r.blockhash}async function sn(i,e){return i.getSignatureStatuses([e]),new Promise((t,n)=>{let r=setTimeout(n,6e4);i.onSignature(e,o=>{if(clearTimeout(r),!o.err){t("");return}n(o.err.toString())},"confirmed")})}function Do(i,e){i.length<1&&Li.logWithError(`no instructions provided: ${i.toString()}`),e.length<1&&Li.logWithError(`no signers provided:, ${e.toString()}`);let t=new Mi;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...i);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Ei}catch{return!1}}function Se(i,e){let[t,n]=Oo.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function Nt({instructions:i,payer:e,signers:t}){return Do(i,[e,...t])}function Lt({instructions:i,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=Ri.generate().publicKey.toString()}){let o=new Eo({payerKey:e,recentBlockhash:n,instructions:i}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Oi(o).serialize()).toString("base64").length<Ei}catch{return!1}}var _o=i=>Buffer.isBuffer(i)?i:i instanceof Uint8Array?Buffer.from(i.buffer,i.byteOffset,i.byteLength):Buffer.from(i),vo=i=>{let e=i.serialize({requireAllSignatures:!1,verifySignatures:!1});i instanceof Oi&&(e=_o(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function mt(i){let e=[];return i.forEach(t=>{t instanceof Mi&&(t.recentBlockhash||(t.recentBlockhash=Fo.toBase58()),t.feePayer||(t.feePayer=Ri.generate().publicKey)),e.push(vo(t))}),console.log("simulate tx string:",e),e}function Re(i,e,t){return Se([i.toBuffer(),(t!=null?t:Wo).toBuffer(),e.toBuffer()],new qo("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as G}from"@solana/web3.js";var Zc=new G("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),jc=new G("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Yc=new G("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Qc=new G("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Jc=new G("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),$c=new G("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),eu=new G("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),tu=new G("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),nu=new G("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Fi=new G("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),an=new G("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),cn=new G("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),iu=new G("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),ru=new G("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),ou=new G("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),su=new G("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),au=new G("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),cu=new G("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),uu=new G("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),lu=new G("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),mu=new G("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Vo=new G("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Uo=new G("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Go=new G("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");var du={SERUM_MARKET:G.default,OPENBOOK_MARKET:new G("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:G.default,FarmV3:new G("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new G("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new G("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new G("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new G("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new G("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new G("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new G("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new G("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Vo,CREATE_CPMM_POOL_AUTH:Uo,CREATE_CPMM_POOL_FEE_ACC:Go,FEE_DESTINATION_ID:new G("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import ve from"bn.js";var Rt=1e4;function ue(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=U(N({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new ve(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Rt){let c=new ve(o.maximumFee.toString());return{amount:i.add(c),fee:c,expirationTime:a}}else{let c=Dn(i.mul(new ve(Rt)),new ve(Rt-o.transferFeeBasisPoints)),u=new ve(o.maximumFee.toString()),l=c.sub(i).gt(u)?i.add(u):c,m=Dn(l.mul(new ve(o.transferFeeBasisPoints)),new ve(Rt)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let c=Dn(i.mul(new ve(o.transferFeeBasisPoints)),new ve(Rt)),u=c.gt(s)?s:c;return{amount:i,fee:u,expirationTime:a}}}function ct(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function Dn(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new ve(0))?t.add(new ve(1)):t}import{PublicKey as Di,AddressLookupTableAccount as un}from"@solana/web3.js";async function _n({connection:i,address:e}){let t=await Ye(i,[...new Set(e.map(r=>r.toString()))].map(r=>new Di(r))),n={};for(let r=0;r<e.length;r++){let o=t[r],s=e[r];if(!o)continue;let a=new un({key:s,state:un.deserialize(o.data)});n[s.toString()]=a,ln[s.toString()]=a}return n}var ln={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new un({key:new Di("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:un.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as Mt,sendAndConfirmTransaction as vn,Transaction as Ot,TransactionMessage as Et,VersionedTransaction as Ft}from"@solana/web3.js";import zo from"axios";var mn=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.api=e.api}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await zo.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=on(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Mt.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(N({},t||{})):this.build(t)}build(e){var n;let t=new Ot;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(r=>r.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{var u;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a}=r||{},c=o!=null?o:await ht(this.connection,this.blockhashCommitment);if(t.recentBlockhash=c,this.signers.length&&t.sign(...this.signers),mt([t]),(u=this.owner)!=null&&u.isKeyPair)return{txId:a?await vn(this.connection,t,this.signers.find(m=>m.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let l=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:r}=this.build(n),o=t.filter(l=>l.transaction.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async l=>{var y;let{sequentially:m,onTxUpdate:d,recentBlockHash:f,skipPreflight:g=!0}=l||{},p=f!=null?f:await ht(this.connection,this.blockhashCommitment);if((y=this.owner)!=null&&y.isKeyPair){if(m){let b=[];for(let h of s){let w=await vn(this.connection,h,this.signers.find(A=>A.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g});b.push(w)}return{txIds:b,signedTxs:s}}return{txIds:await await Promise.all(s.map(async b=>(b.recentBlockhash=p,await this.connection.sendRawTransaction(b.serialize(),{skipPreflight:g})))),signedTxs:s}}if(this.signAllTransactions){let b=s.map((w,A)=>(w.recentBlockhash=p,a[A].length&&w.sign(...a[A]),w));mt(b);let h=await this.signAllTransactions(b);if(m){let w=0,A=[],T=async()=>{if(!h[w])return;let P=await this.connection.sendRawTransaction(h[w].serialize(),{skipPreflight:g});A.push({txId:P,status:"sent",signedTx:h[w]}),d==null||d([...A]),w++,this.connection.onSignature(P,x=>{let B=A.findIndex(C=>C.txId===P);B>-1&&(A[B].status=x.err?"error":"success"),d==null||d([...A]),x.err||T()},"processed"),this.connection.getSignatureStatus(P)};return await T(),{txIds:A.map(P=>P.txId),signedTxs:h}}else{let w=[];for(let A=0;A<h.length;A+=1){let T=await this.connection.sendRawTransaction(h[A].serialize(),{skipPreflight:g});w.push(T)}return{txIds:w,signedTxs:h}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var p;let g=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:r,recentBlockhash:o}=g,s=gt(g,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=N(N({},this.cluster==="devnet"?{}:ln),t),c=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let y of c)a[y]===void 0&&u.push(new Mt(y));let l=await _n({connection:this.connection,address:u});for(let[y,b]of Object.entries(l))a[y]=b;let m=r?Mt.default.toBase58():o!=null?o:await ht(this.connection,this.blockhashCommitment),d=new Et({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((p=this.owner)==null?void 0:p.signer)&&!this.signers.some(y=>y.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let f=new Ft(d);return f.sign(this.signers),{builder:this,transaction:f,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async y=>{var w;let{skipPreflight:b=!0,sendAndConfirm:h}=y||{};if(mt([f]),(w=this.owner)!=null&&w.isKeyPair){let A=await this.connection.sendTransaction(f,{skipPreflight:b});return h&&await sn(this.connection,A),{txId:A,signedTx:f}}if(this.signAllTransactions){let A=await this.signAllTransactions([f]);return{txId:await this.connection.sendTransaction(A[0],{skipPreflight:b}),signedTx:A[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:r}=await this.buildV0(n),o=t.filter(l=>l.builder.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,m)=>{l.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async l=>{var p;let{sequentially:m,onTxUpdate:d,recentBlockHash:f,skipPreflight:g=!0}=l||{};if(f&&s.forEach(y=>y.message.recentBlockhash=f),mt(s),(p=this.owner)!=null&&p.isKeyPair){if(m){let y=[];for(let b of s){let h=await this.connection.sendTransaction(b,{skipPreflight:g});await sn(this.connection,h),y.push(h)}return{txIds:y,signedTxs:s}}return{txIds:await Promise.all(s.map(async y=>await this.connection.sendTransaction(y,{skipPreflight:g}))),signedTxs:s}}if(this.signAllTransactions){let y=await this.signAllTransactions(s);if(m){let b=0,h=[],w=async()=>{if(!y[b])return;let A=await this.connection.sendTransaction(y[b],{skipPreflight:g});h.push({txId:A,status:"sent",signedTx:y[b]}),d==null||d([...h]),b++,this.connection.onSignature(A,T=>{let P=h.findIndex(x=>x.txId===A);P>-1&&(h[P].status=T.err?"error":"success"),d==null||d([...h]),T.err||w()},"processed"),this.connection.getSignatureStatus(A)};return w(),{txIds:[],signedTxs:y}}else{let b=[];for(let h=0;h<y.length;h+=1){let w=await this.connection.sendTransaction(y[h],{skipPreflight:g});b.push(w)}return{txIds:b,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var l;let u=e||{},{computeBudgetConfig:t}=u,n=gt(u,["computeBudgetConfig"]),r=t?on(t):{instructions:[],instructionTypes:[]},o=this.signers.reduce((m,d)=>U(N({},m),{[d.publicKey.toBase58()]:d}),{}),s=[],a=[],c=[];if(this.allInstructions.forEach(m=>{let d=[...c,m],f=t?[...r.instructions,...d]:d,p=[...new Set(d.map(y=>y.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat()).values()].map(y=>new Mt(y));if(c.length<12&&Nt({instructions:f,payer:this.feePayer,signers:p})||Nt({instructions:d,payer:this.feePayer,signers:p}))c.push(m);else{if(c.length===0)throw Error("item ins too big");Nt({instructions:t?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:p})?s.push(new Ot().add(...r.instructions,...c)):s.push(new Ot().add(...c)),a.push(Array.from(new Set(c.map(y=>y.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat())).map(y=>o[y]).filter(y=>y!==void 0)),c=[m]}}),c.length>0){let d=[...new Set(c.map(f=>f.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(f=>o[f]).filter(f=>f!==void 0);Nt({instructions:t?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:d.map(f=>f.publicKey)})?s.push(new Ot().add(...r.instructions,...c)):s.push(new Ot().add(...c)),a.push(d)}return s.forEach(m=>m.feePayer=this.feePayer),(l=this.owner)!=null&&l.signer&&a.forEach(m=>{m.some(d=>d.publicKey.equals(this.owner.publicKey))||m.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async m=>{var b;let{sequentially:d,onTxUpdate:f,recentBlockHash:g,skipPreflight:p=!0}=m||{},y=g!=null?g:await ht(this.connection,this.blockhashCommitment);if(s.forEach(async(h,w)=>{h.recentBlockhash=y,a[w].length&&h.sign(...a[w])}),mt(s),(b=this.owner)!=null&&b.isKeyPair){if(d){let h=[];for(let w of s){let A=await vn(this.connection,w,this.signers.find(T=>T.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:p});h.push(A)}return{txIds:h,signedTxs:s}}return{txIds:await Promise.all(s.map(async h=>await this.connection.sendRawTransaction(h.serialize(),{skipPreflight:p}))),signedTxs:s}}if(this.signAllTransactions){let h=await this.signAllTransactions(s);if(d){let w=0,A=[],T=async()=>{if(!h[w])return;let P=await this.connection.sendRawTransaction(h[w].serialize(),{skipPreflight:p});A.push({txId:P,status:"sent",signedTx:h[w]}),f==null||f([...A]),w++,this.connection.onSignature(P,x=>{let B=A.findIndex(C=>C.txId===P);B>-1&&(A[B].status=x.err?"error":"success"),f==null||f([...A]),x.err||T()},"processed"),this.connection.getSignatureStatus(P)};return await T(),{txIds:A.map(P=>P.txId),signedTxs:h}}else{let w=[];for(let A=0;A<h.length;A+=1){let T=await this.connection.sendRawTransaction(h[A].serialize(),{skipPreflight:p});w.push(T)}return{txIds:w,signedTxs:h}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuildV0(e){var b;let y=e||{},{computeBudgetConfig:t,lookupTableCache:n={},lookupTableAddress:r=[]}=y,o=gt(y,["computeBudgetConfig","lookupTableCache","lookupTableAddress"]),s=N(N({},this.cluster==="devnet"?{}:ln),n),a=Array.from(new Set([...this.lookupTableAddress,...r])),c=[];for(let h of a)s[h]===void 0&&c.push(new Mt(h));let u=await _n({connection:this.connection,address:c});for(let[h,w]of Object.entries(u))s[h]=w;let l=t?on(t):{instructions:[],instructionTypes:[]},m=await ht(this.connection,this.blockhashCommitment),d=this.signers.reduce((h,w)=>U(N({},h),{[w.publicKey.toBase58()]:w}),{}),f=[],g=[],p=[];if(this.allInstructions.forEach(h=>{let w=[...p,h],A=t?[...l.instructions,...w]:w;if(p.length<12&&Lt({instructions:A,payer:this.feePayer,lookupTableAddressAccount:s})||Lt({instructions:w,payer:this.feePayer,lookupTableAddressAccount:s}))p.push(h);else{if(p.length===0)throw Error("item ins too big");let T={};for(let P of[...new Set(a)])s[P]!==void 0&&(T[P]=s[P]);if(t&&Lt({instructions:[...l.instructions,...p],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let P=new Et({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...p]}).compileToV0Message(Object.values(s));f.push(new Ft(P))}else{let P=new Et({payerKey:this.feePayer,recentBlockhash:m,instructions:[...p]}).compileToV0Message(Object.values(s));f.push(new Ft(P))}g.push(Array.from(new Set(p.map(P=>P.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat())).map(P=>d[P]).filter(P=>P!==void 0)),p=[h]}}),p.length>0){let w=[...new Set(p.map(A=>A.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat()).values()].map(A=>d[A]).filter(A=>A!==void 0);if(t&&Lt({instructions:[...l.instructions,...p],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let A=new Et({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...p]}).compileToV0Message(Object.values(s));f.push(new Ft(A))}else{let A=new Et({payerKey:this.feePayer,recentBlockhash:m,instructions:[...p]}).compileToV0Message(Object.values(s));f.push(new Ft(A))}g.push(w)}return(b=this.owner)!=null&&b.signer&&g.forEach(h=>{h.some(w=>w.publicKey.equals(this.owner.publicKey))||h.push(this.owner.signer)}),{builder:this,transactions:f,buildProps:e,signers:g,instructionTypes:this.instructionTypes,execute:async h=>{var x;let{sequentially:w,onTxUpdate:A,recentBlockHash:T,skipPreflight:P=!0}=h||{};if(f.map(async(B,C)=>{g[C].length&&B.sign(g[C]),T&&(B.message.recentBlockhash=T)}),mt(f),(x=this.owner)!=null&&x.isKeyPair){if(w){let B=[];for(let C of f){let M=await this.connection.sendTransaction(C,{skipPreflight:P});await sn(this.connection,M),B.push(M)}return{txIds:B,signedTxs:f}}return{txIds:await Promise.all(f.map(async B=>await this.connection.sendTransaction(B,{skipPreflight:P}))),signedTxs:f}}if(this.signAllTransactions){let B=await this.signAllTransactions(f);if(w){let C=0,M=[],R=async()=>{if(!B[C])return;let J=await this.connection.sendTransaction(B[C],{skipPreflight:P});M.push({txId:J,status:"sent",signedTx:B[C]}),A==null||A([...M]),C++,this.connection.onSignature(J,te=>{let de=M.findIndex(ne=>ne.txId===J);de>-1&&(M[de].status=te.err?"error":"success"),A==null||A([...M]),te.err||R()},"processed"),this.connection.getSignatureStatus(J)};return R(),{txIds:[],signedTxs:B}}else{let C=[];for(let M=0;M<B.length;M+=1){let R=await this.connection.sendTransaction(B[M],{skipPreflight:P});C.push(R)}return{txIds:C,signedTxs:B}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}};import{AccountLayout as dr,TOKEN_PROGRAM_ID as fr}from"@solana/spl-token";import{PublicKey as Qu}from"@solana/web3.js";import{MintLayout as $u,TOKEN_PROGRAM_ID as tl}from"@solana/spl-token";var qn=r=>{var o=r,{address:i,programId:e,decimals:t}=o,n=gt(o,["address","programId","decimals"]);return N({chainId:101,address:lt(i).toBase58(),programId:e,logoURI:"",symbol:"",name:"",decimals:t,tags:[],extensions:n.extensions||{}},n)},Wn=i=>i?U(N({},i),{transferFeeConfigAuthority:i.transferFeeConfigAuthority.toBase58(),withdrawWithheldAuthority:i.withdrawWithheldAuthority.toBase58(),withheldAmount:i.withheldAmount.toString(),olderTransferFee:U(N({},i.olderTransferFee),{epoch:i.olderTransferFee.epoch.toString(),maximumFee:i.olderTransferFee.maximumFee.toString()}),newerTransferFee:U(N({},i.newerTransferFee),{epoch:i.newerTransferFee.epoch.toString(),maximumFee:i.newerTransferFee.maximumFee.toString()})}):void 0;var Vn=(...i)=>i.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Dt=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=Ae(t)}createTxBuilder(e){return this.scope.checkOwner(),new mn({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Vn(e))}logInfo(...e){this.logger.info(Vn(e))}logAndCreateError(...e){let t=Vn(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{Keypair as ei,PublicKey as I,SystemProgram as Tt,TransactionInstruction as Le}from"@solana/web3.js";import ur from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as lr,TOKEN_2022_PROGRAM_ID as et,TOKEN_PROGRAM_ID as me}from"@solana/spl-token";import{PublicKey as ts}from"@solana/web3.js";import Wi,{isBN as Vi}from"bn.js";import{bits as dl,BitStructure as fl,blob as Ho,Blob as pl,cstr as gl,f32 as bl,f32be as yl,f64 as wl,f64be as hl,greedy as Al,Layout as Zo,ns64 as Pl,ns64be as Tl,nu64 as kl,nu64be as xl,offset as Bl,s16 as Il,s16be as Sl,s24 as Cl,s24be as Kl,s32 as jo,s32be as Nl,s40 as Ll,s40be as Rl,s48 as Ml,s48be as Ol,s8 as El,seq as Yo,struct as Fl,Structure as Qo,u16 as Jo,u16be as Dl,u24 as _l,u24be as vl,u32 as ql,u32be as Wl,u40 as Vl,u40be as Ul,u48 as Gl,u48be as Xl,u8 as $o,UInt as es,union as zl,Union as Hl,unionLayoutDiscriminator as Zl,utf8 as jl}from"@solana/buffer-layout";var Un=Zo,_i=Qo;var Gn=es;var vi=$o,_t=Jo;var Te=jo;var qi=Yo;var Me=Ho;var At=class extends Un{constructor(t,n,r){super(t,r);this.blob=Me(t),this.signed=n}decode(t,n=0){let r=new Wi(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new Wi(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function fe(i){return new Gn(1,i)}function Pt(i){return new Gn(4,i)}function E(i){return new At(8,!1,i)}function z(i){return new At(16,!1,i)}function Ui(i){return new At(8,!0,i)}function Gi(i){return new At(16,!0,i)}var dn=class extends Un{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function se(i){return new dn(Me(32),e=>new ts(e),e=>e.toBuffer(),i)}function Ge(i){return new dn(vi(),ns,is,i)}function ns(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function is(i){return i?1:0}var Xn=class extends _i{decode(e,t){return super.decode(e,t)}};function ee(i,e,t){return new Xn(i,e,t)}function ae(i,e,t){let n,r=typeof e=="number"?e:Vi(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=Vi(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return qi(i,r,t)}import ps from"bn.js";import Oe from"bn.js";var le=new Oe(0),Xe=new Oe(1),Je=new Oe(-1),Ne=new Oe(1).shln(64),fn=new Oe(1).shln(128),zn=Ne.sub(Xe),vt=64,Xi=fn.subn(1),xe=-443636,Be=-xe,ze=new Oe("4295048016"),He=new Oe("79226673521066979257578248091"),um=new Oe("4295048017"),lm=new Oe("79226673521066979257578248090"),zi=16,Hi="59543866431248",Zi="184467440737095516",ji="15793534762490258745",pn=new Oe(10).pow(new Oe(6));var Yi={tvl:0,volumeQuote:0,mintAmountA:0,mintAmountB:0,rewardDefaultInfos:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,day:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},week:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},month:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},pooltype:[]},mm=new Oe("18446744073700000000");import V from"bn.js";function gn(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function Hn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Zn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function qt(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function Qi(i,e){return qt(i,e)?null:Hn(i,e)}function Ji(i,e){return qt(i,e)?null:Zn(i,e)}var ym=Buffer.from("amm_config","utf8"),rs=Buffer.from("pool","utf8"),os=Buffer.from("pool_vault","utf8"),ss=Buffer.from("pool_reward_vault","utf8"),$i=Buffer.from("position","utf8"),as=Buffer.from("tick_array","utf8"),cs=Buffer.from("operation","utf8"),us=Buffer.from("pool_tick_array_bitmap_extension","utf8"),ls=Buffer.from("observation","utf8");function er(i,e,t,n){return Se([rs,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function jn(i,e,t){return Se([os,e.toBuffer(),t.toBuffer()],i)}function tr(i,e,t){return Se([ss,e.toBuffer(),t.toBuffer()],i)}function Y(i,e,t){return Se([as,e.toBuffer(),gn(t)],i)}function ut(i,e,t,n){return Se([$i,e.toBuffer(),gn(t),gn(n)],i)}function Ce(i,e){return Se([$i,e.toBuffer()],i)}function bn(i){return Se([Buffer.from("metadata","utf8"),wt.toBuffer(),i.toBuffer()],wt)}function Wt(i){return Se([cs],i)}function Ee(i,e){return Se([us,e.toBuffer()],i)}function nr(i,e){return Se([ls,e.toBuffer()],i)}var ms=Buffer.from("locked_position","utf8");function Yn(i,e){return Se([ms,e.toBuffer()],i)}import{PublicKey as qe}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as ir}from"@solana/spl-token";import ie from"bn.js";import Ze from"bn.js";var Vt=class{static getfeeGrowthInside(e,t,n){let r=new Ze(0),o=new Ze(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new Ze(0),a=new Ze(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let c=D.wrappingSubU128(D.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),u=D.wrappingSubU128(D.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:c,feeGrowthInsideBX64:u}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=D.mulDivFloor(D.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ne),c=t.tokenFeesOwedA.add(a),u=D.mulDivFloor(D.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ne),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=D.mulDivFloor(D.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ne),c=t.tokenFeesOwedA.add(a),u=D.mulDivFloor(D.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ne),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=D.wrappingSubU128(c,u.growthInsideLastX64),m=D.mulDivFloor(l,t.liquidity,Ne),d=u.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=D.wrappingSubU128(c,u.growthInsideLastX64),m=D.mulDivFloor(l,t.liquidity,Ne),d=u.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new Ze(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new Ze(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(D.wrappingSubU128(D.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new Ze(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new Ze(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(D.wrappingSubU128(D.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var y,b,h,w;let a=F.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),c=F.getSqrtPriceX64FromTick(t.tickLower),u=F.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,m=H.getAmountsFromLiquidity(a,c,u,n,o),[d,f]=[ue(m.amountA,(y=e.mintA.extensions)==null?void 0:y.feeConfig,s,!0),ue(m.amountB,(b=e.mintB.extensions)==null?void 0:b.feeConfig,s,!0)],[g,p]=[ue(new Ze(new S(m.amountA.toString()).mul(l).toFixed(0)),(h=e.mintA.extensions)==null?void 0:h.feeConfig,s,!0),ue(new Ze(new S(m.amountB.toString()).mul(l).toFixed(0)),(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:f,amountSlippageA:g,amountSlippageB:p,expirationTime:ct(d.expirationTime,f.expirationTime)}}};var ds=15,X=class{static async getTickArrays(e,t,n,r,o,s,a){let c=[],u=K.getTickArrayStartIndexByTick(r,o),l=K.getInitializedTickArrayInRange(s,a,o,u,Math.floor(ds/2));for(let f=0;f<l.length;f++){let{publicKey:g}=Y(t,n,l[f]);c.push(g)}let m=(await Ye(e,c)).map(f=>f!==null?Ut.decode(f.data):null),d={};for(let f=0;f<c.length;f++){let g=m[f];g!==null&&(d[g.startTickIndex]=U(N({},g),{address:c[f]}))}return d}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(u=K.getNextTickArrayStartIndex(u,o,s),this.checkIsValidStartIndex(u,o))throw new Error("No enough initialized tickArray");let l=n[u];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:f}=this.firstInitializedTickInOneArray(e,t,l,s);[a,c,u]=[m,d,f]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/X.tickCount(t)),a=n?K.searchLowBitFromStart(r,o,s-1,1,t):K.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=be-1;for(;a>=0;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a-1}}else{let a=0;for(;a<be;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a+1}}let{publicKey:s}=Y(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=K.getTickArrayStartIndexByTick(r,o),c=Math.floor((r-a)/o),u=n[a];if(u==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;c>=0;){let d=u.ticks[c];if(d.liquidityGross.gtn(0)){l=d;break}c=c-1}else for(c=c+1;c<be;){let d=u.ticks[c];if(d.liquidityGross.gtn(0)){l=d;break}c=c+1}let{publicKey:m}=Y(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:u.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(K.checkIsOutOfBoundary(e)){if(e>Be)return!1;let n=K.getTickArrayStartIndexByTick(xe,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return be*e}};var Qn=14,$e=class{static maxTickInTickarrayBitmap(e){return e*be*dt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!X.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-X.tickCount(n):t+X.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*be,c=s/a+512;s<0&&s%a!=0&&c--;let u=Math.abs(c);if(r){let l=e.shln(1024-u-1),m=Qi(1024,l);if(m!==null){let d=(u-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(u),m=Ji(1024,l);if(m!==null){let d=(u+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-X.tickCount(n)}}}},Gt=class{static getBitmapOffset(e,t){if(!X.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=$e.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=$e.maxTickInTickarrayBitmap(e),n=-t;if(Be<=t)throw Error(`extensionTickBoundary check error: ${Be}, ${t}`);if(n<=xe)throw Error(`extensionTickBoundary check error: ${n}, ${xe}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:K.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=X.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=$e.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let c=K.mergeTickArrayBitmap(e).shln(dt-1-a),u=qt(512,c)?null:Hn(512,c);if(u!==null){let l=t-u*X.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let c=K.mergeTickArrayBitmap(e).shrn(a),u=qt(512,c)?null:Zn(512,c);if(u!==null){let l=t+u*X.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-X.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%$e.maxTickInTickarrayBitmap(t),r=Math.floor(n/X.tickCount(t));return e<0&&n!=0&&(r=dt-r),r}};var pe=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,s=!1){let a=n.toBase58()===e.mintA.address,c=[],{isExist:u,startIndex:l,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,a);if(!u||l===void 0||!m)throw new Error("Invalid tick array");c.push(m);let{allTrade:d,amountCalculated:f,accounts:g,sqrtPriceX64:p,feeAmount:y}=ft.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,o,s);return c.push(...g),{allTrade:d,expectedAmountOut:f.mul(Je),remainingAccounts:c,executionPrice:p,feeAmount:y}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:c,startIndex:u,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!c||u===void 0||!l)throw new Error("Invalid tick array");try{let p=this.preInitializedTickArrayStartIndex(e,s);if(p.isExist){let{publicKey:y}=Y(e.programId,e.id,p.nextStartIndex);a.push(y)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:f,feeAmount:g}=ft.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(Je),u,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:f,feeAmount:g}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=pe.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Gt.checkTickArrayIsInit(X.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):K.checkTickArrayIsInitialized(K.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=Y(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,X.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=Y(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/X.tickCount(e.tickSpacing)),r=t?K.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):K.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=X.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=$e.nextInitializedTickArrayStartIndex(K.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Gt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<xe||t>Be)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,c,u;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(u=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?u:(c=await e.getAccountInfo(m.tokenMint))==null?void 0:c.owner;if(d===void 0)throw Error("get new reward mint info error");let f=U(N({},m),{perSecond:D.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new qe(d)});if(f.tokenMint.equals(qe.default))continue;if(n<=f.openTime.toNumber()||r.eq(le)){s.push(f);continue}let g=new ie(Math.min(f.endTime.toNumber(),n)),p=g.sub(f.lastUpdateTime),y=D.mulDivFloor(p,f.emissionsPerSecondX64,r),b=f.rewardGrowthGlobalX64.add(y),h=D.mulDivFloor(p,f.emissionsPerSecondX64,Ne),w=f.rewardTotalEmissioned.add(h);s.push(U(N({},f),{rewardGrowthGlobalX64:b,rewardTotalEmissioned:w,lastUpdateTime:g}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=K.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=$e.maxTickInTickarrayBitmap(e),n=-t;return t>Be&&(t=X.getArrayStartIndex(Be,e)+X.tickCount(e)),n<xe&&(n=X.getArrayStartIndex(xe,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!X.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/X.tickCount(t)*dt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await ot(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=or.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let c of t){let u=K.getTickArrayStartIndexByTick(c.tickCurrent,c.tickSpacing),l=K.getInitializedTickArrayInRange(c.tickArrayBitmap,c.exBitmapInfo,c.tickSpacing,u,7);for(let m of l){let{publicKey:d}=Y(c.programId,c.id,m);o.push({pubkey:d}),r[d.toString()]=c.id}}let s=await ot(e,o,{batchRequest:n}),a={};for(let c of s){if(!c.accountInfo)continue;let u=r[c.pubkey.toString()];if(!u)continue;a[u.toString()]===void 0&&(a[u.toString()]={});let l=Ut.decode(c.accountInfo.data);a[u.toString()][l.startTickIndex]=U(N({},l),{address:c.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let c=0;c<e.length;c++){let u=e[c];u!==null&&(s.find(l=>l.equals(u.state.programId))||s.push(u.state.programId))}if(n){let c=n.tokenAccounts.map(d=>d.accountInfo.mint),u=[];for(let d of c)for(let f of s)u.push(Ce(f,d).publicKey);let l=await Ye(t,u,{batchRequest:r}),m={};for(let d of l){if(d===null)continue;let f=wn.decode(d.data),g=f.poolId.toString(),p=e.find(B=>B.state.id.toBase58()===g);if(p===void 0)continue;let y=p.state,b=K._getTickPriceLegacy({poolInfo:y,tick:f.tickLower,baseIn:!0}),h=K._getTickPriceLegacy({poolInfo:y,tick:f.tickUpper,baseIn:!0}),{amountA:w,amountB:A}=H.getAmountsFromLiquidity(y.sqrtPriceX64,b.tickSqrtPriceX64,h.tickSqrtPriceX64,f.liquidity,!1),T=1/(1-Math.sqrt(Math.sqrt(b.price.div(h.price).toNumber())));p.positionAccount=[...(a=p.positionAccount)!=null?a:[],{poolId:f.poolId,nftMint:f.nftMint,priceLower:b.price,priceUpper:h.price,amountA:w,amountB:A,tickLower:f.tickLower,tickUpper:f.tickUpper,liquidity:f.liquidity,feeGrowthInsideLastX64A:f.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:f.feeGrowthInsideLastX64B,tokenFeesOwedA:f.tokenFeesOwedA,tokenFeesOwedB:f.tokenFeesOwedB,rewardInfos:f.rewardInfos.map(B=>U(N({},B),{pendingReward:new ie(0)})),leverage:T,tokenFeeAmountA:new ie(0),tokenFeeAmountB:new ie(0)}];let P=await K.getTickArrayAddressByTick(p.state.programId,f.poolId,f.tickLower,p.state.tickSpacing),x=await K.getTickArrayAddressByTick(p.state.programId,f.poolId,f.tickUpper,p.state.tickSpacing);m[`${p.state.programId.toString()}-${f.poolId.toString()}-${f.tickLower}`]=P,m[`${p.state.programId.toString()}-${f.poolId.toString()}-${f.tickUpper}`]=x}if(o){let d=Object.values(m),f=await Ye(t,d,{batchRequest:r}),g={};for(let p=0;p<d.length;p++){let y=f[p];if(y===null)continue;let b=d[p].toString();g[b]=Ut.decode(y.data)}for(let{state:p,positionAccount:y}of e)if(!!y)for(let b of y){let h=`${p.programId.toString()}-${p.id.toString()}-${b.tickLower}`,w=`${p.programId.toString()}-${p.id.toString()}-${b.tickUpper}`,A=g[m[h].toString()],T=g[m[w].toString()],P=A.ticks[K.getTickOffsetInArray(b.tickLower,p.tickSpacing)],x=T.ticks[K.getTickOffsetInArray(b.tickUpper,p.tickSpacing)],{tokenFeeAmountA:B,tokenFeeAmountB:C}=await Vt.GetPositionFees(p,b,P,x),M=await Vt.GetPositionRewards(p,b,P,x);b.tokenFeeAmountA=B.gte(new ie(0))?B:new ie(0),b.tokenFeeAmountB=C.gte(new ie(0))?C:new ie(0);for(let R=0;R<M.length;R++)b.rewardInfos[R].pendingReward=M[R].gte(new ie(0))?M[R]:new ie(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new S(0),catchLiquidityInsufficient:c=!1}){var J;let u,l=n.toBase58()===e.mintA.address,[m,d]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new S(0))?u=l?ze.add(new ie(1)):He.sub(new ie(1)):u=F.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let f=ue(o,m,r,!1),{allTrade:g,expectedAmountOut:p,remainingAccounts:y,executionPrice:b,feeAmount:h}=pe.getOutputAmountAndRemainAccounts(e,t,n,f.amount.sub((J=f.fee)!=null?J:le),u,c),w=ue(p,d,r,!1),A=F.sqrtPriceX64ToPrice(b,e.mintA.decimals,e.mintB.decimals),T=l?A:new S(1).div(A),P=p.mul(new ie(Math.floor((1-s)*1e10))).div(new ie(1e10)),x=ue(P,d,r,!1),B=l?e.currentPrice:new S(1).div(e.currentPrice),C=new S(T).sub(B).abs(),M=B,R=new at(new S(C).mul(10**15).toFixed(0),new S(M).mul(10**15).toFixed(0));return{allTrade:g,realAmountIn:f,amountOut:w,minAmountOut:x,expirationTime:ct(f.expirationTime,w.expirationTime),currentPrice:e.currentPrice,executionPrice:T,priceImpact:R,fee:h,remainingAccounts:y,executionPriceX64:b}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let c=r.address===e.mintB.address,[u,l]=c?[e.mintA,e.mintB]:[e.mintB,e.mintA],[m,d]=[new Ue(U(N({},u),{mint:u.address,isToken2022:u.programId===ir.toBase58()})),new Ue(U(N({},l),{mint:l.address,isToken2022:l.programId===ir.toBase58()}))],{allTrade:f,realAmountIn:g,amountOut:p,minAmountOut:y,expirationTime:b,currentPrice:h,executionPrice:w,priceImpact:A,fee:T,remainingAccounts:P,executionPriceX64:x}=pe.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new qe(u.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),B=U(N({},g),{amount:new Pe(m,g.amount),fee:g.fee===void 0?void 0:new Pe(m,g.fee)}),C=U(N({},p),{amount:new Pe(d,p.amount),fee:p.fee===void 0?void 0:new Pe(d,p.fee)}),M=U(N({},y),{amount:new Pe(d,y.amount),fee:y.fee===void 0?void 0:new Pe(d,y.fee)}),R=new _e({baseToken:m,denominator:new ie(10).pow(new ie(20+m.decimals)),quoteToken:d,numerator:h.mul(new S(10**(20+d.decimals))).toFixed(0)}),J=new _e({baseToken:m,denominator:new ie(10).pow(new ie(20+m.decimals)),quoteToken:d,numerator:w.mul(new S(10**(20+d.decimals))).toFixed(0)}),te=new Pe(m,T);return{allTrade:f,realAmountIn:B,amountOut:C,minAmountOut:M,expirationTime:b,currentPrice:R,executionPrice:J,priceImpact:A,fee:te,remainingAccounts:P,executionPriceX64:x}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:o,slippage:s,priceLimit:a=new S(0)}){var M;let c=n.toBase58()===e.mintA.address,u={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;a.equals(new S(0))?l=c?He.sub(new ie(1)):ze.add(new ie(1)):l=F.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let m=ue(o,u[n.toString()],r,!0),{expectedAmountIn:d,remainingAccounts:f,executionPrice:g,feeAmount:p}=pe.getInputAmountAndRemainAccounts(e,t,n,m.amount.sub((M=m.fee)!=null?M:le),l),y=c?e.mintB.address:e.mintA.address,b=ue(d,u[y],r,!1),h=F.sqrtPriceX64ToPrice(g,e.mintA.decimals,e.mintB.decimals),w=c?h:new S(1).div(h),A=d.mul(new ie(Math.floor((1+s)*1e10))).div(new ie(1e10)),T=ue(A,u[y],r,!0),P=c?e.currentPrice:new S(1).div(e.currentPrice),x=new S(w).sub(P).abs(),B=P,C=new at(new S(x).mul(10**15).toFixed(0),new S(B).mul(10**15).toFixed(0));return{amountIn:b,maxAmountIn:T,realAmountOut:m,expirationTime:ct(b.expirationTime,m.expirationTime),currentPrice:e.currentPrice,executionPrice:w,priceImpact:C,fee:p,remainingAccounts:f}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var g,p,y;let o=e[t],s=K.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=K.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),c=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-c,m=a-s,d=o.priceMax-o.priceMin,f;return l<=0?f=0:m===l?f=d/l:d===l?f=l/m:f=l/d*(l/m),{feeApr:o.feeApr*f,rewardsApr:[((g=o.rewardApr[0])!=null?g:0)*f,((p=o.rewardApr[1])!=null?p:0)*f,((y=o.rewardApr[2])!=null?y:0)*f],apr:o.apr*f}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:c}){let u=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=r[lt(e.mintA.address).toString()],d=r[lt(e.mintB.address).toString()],f=e.mintA.decimals,g=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let p=F.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),y=F.getSqrtPriceX64FromTick(s),b=F.getSqrtPriceX64FromTick(a),{amountSlippageA:h,amountSlippageB:w}=H.getAmountsFromLiquidityWithSlippage(p,y,b,t,!1,!1,0),{amountSlippageA:A,amountSlippageB:T}=H.getAmountsFromLiquidityWithSlippage(p,y,b,o,!1,!1,0),P=new S(h.toString()).div(new S(10).pow(f)).mul(m.value).add(new S(w.toString()).div(new S(10).pow(g)).mul(d.value)),x=new S(A.toString()).div(new S(10).pow(f)).mul(m.value).add(new S(T.toString()).div(new S(10).pow(g)).mul(d.value)),B=new S(1).div(P.add(x)),M=new S(l.volumeFee).mul(365).div(u).mul(B).mul(100).toNumber(),R=3600*24*365,J=e.rewardDefaultInfos.map(te=>{var Q,ti;let de=te.mint.decimals,ne=r[te.mint.address];return c<((Q=te.startTime)!=null?Q:0)||c>((ti=te.endTime)!=null?ti:0)||!te.perSecond||!ne||de===void 0?0:new S(ne.value).mul(new S(te.perSecond).mul(R)).div(new S(10).pow(de)).mul(B).mul(100).toNumber()});return{feeApr:M,rewardsApr:J,apr:M+J.reduce((te,de)=>te+de,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:c,amountHasFee:u}){var b,h;let l=F.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),m=F.getSqrtPriceX64FromTick(n),d=F.getSqrtPriceX64FromTick(r),f=a?1-s:1+s,g=ue(o,(b=e[t?"mintA":"mintB"].extensions)==null?void 0:b.feeConfig,c,!u),p=new ie(new S(g.amount.sub((h=g.fee)!=null?h:le).toString()).mul(f).toFixed(0)),y;if(l.lte(m))y=t?H.getLiquidityFromTokenAmountA(m,d,p,!a):new ie(0);else if(l.lte(d)){let w=H.getLiquidityFromTokenAmountA(l,d,p,!a),A=H.getLiquidityFromTokenAmountB(m,l,p);y=t?w:A}else y=t?new ie(0):H.getLiquidityFromTokenAmountB(m,d,p);return pe.getAmountsFromLiquidity({epochInfo:c,poolInfo:e,tickLower:n,tickUpper:r,liquidity:y,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var y,b,h,w;let c=F.getSqrtPriceX64FromTick(n),u=F.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,m=H.getAmountsFromLiquidity(F.priceToSqrtPriceX64(new S(t.price),t.mintA.decimals,t.mintB.decimals),c,u,o,a),[d,f]=[ue(m.amountA,(y=t.mintA.extensions)==null?void 0:y.feeConfig,e,!0),ue(m.amountB,(b=t.mintB.extensions)==null?void 0:b.feeConfig,e,!0)],[g,p]=[ue(m.amountA.muln(l),(h=t.mintA.extensions)==null?void 0:h.feeConfig,e,!0),ue(m.amountB.muln(l),(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:f,amountSlippageA:g,amountSlippageB:p,expirationTime:ct(d.expirationTime,f.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(c=>!n[c.id]).map(c=>new qe(c.id));(await Ye(e,r)).forEach((c,u)=>{!c||(n[r[u].toBase58()]=yn.decode(c.data))});let s=t.map(c=>Ee(new qe(c.programId),new qe(c.id)).publicKey),a=await pe.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((c,u)=>U(N({},c),{[u.id]:U(N({},n[u.id]),{id:new qe(u.id),version:6,programId:new qe(u.programId),mintA:u.mintA,mintB:u.mintB,ammConfig:U(N({},u.config),{id:new qe(u.config.id),fundOwner:""}),currentPrice:new S(u.price),exBitmapInfo:a[Ee(new qe(u.programId),new qe(u.id)).publicKey.toBase58()],startTime:n[u.id].startTime.toNumber()})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var Jn={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]};function rr(i){return U(N({},i),{type:"Concentrated",programId:i.programId.toString(),id:i.id.toString(),rewardDefaultInfos:[],rewardDefaultPoolInfos:"Clmm",price:i.currentPrice.toNumber(),mintAmountA:0,mintAmountB:0,feeRate:i.ammConfig.tradeFeeRate,openTime:i.startTime.toString(),tvl:0,day:Jn,week:Jn,month:Jn,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,burnPercent:0,config:U(N({},i.ammConfig),{id:i.ammConfig.id.toString(),defaultRange:0,defaultRangePoint:[]})})}var D=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(le)||(o=o.add(Xe)),o}static mulDivFloor(e,t,n){if(n.eq(le))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(le))throw new Error("division by 0");return e.mul(t).add(n.sub(Xe)).div(n)}static x64ToDecimal(e,t){return new S(e.toString()).div(S.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new V(e.mul(S.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(fn).sub(t).mod(fn)}};function we(i,e){return $n(i.mul(e),64,256)}function fs(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function $n(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var F=class{static sqrtPriceX64ToPrice(e,t,n){return D.x64ToDecimal(e).pow(2).mul(S.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return D.decimalToX64(e.mul(S.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(le))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(le))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(le))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(le))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(le))return e;let o=t.shln(vt);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?D.mulDivCeil(s,e,a):D.mulDivRoundingUp(s,Xe,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return D.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(vt);if(r)return e.add(o.div(t));{let s=D.mulDivRoundingUp(o,Xe,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<xe||e>Be)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new V("18445821805675395072"):new V("18446744073709551616");return(t&2)!=0&&(n=we(n,new V("18444899583751176192"))),(t&4)!=0&&(n=we(n,new V("18443055278223355904"))),(t&8)!=0&&(n=we(n,new V("18439367220385607680"))),(t&16)!=0&&(n=we(n,new V("18431993317065453568"))),(t&32)!=0&&(n=we(n,new V("18417254355718170624"))),(t&64)!=0&&(n=we(n,new V("18387811781193609216"))),(t&128)!=0&&(n=we(n,new V("18329067761203558400"))),(t&256)!=0&&(n=we(n,new V("18212142134806163456"))),(t&512)!=0&&(n=we(n,new V("17980523815641700352"))),(t&1024)!=0&&(n=we(n,new V("17526086738831433728"))),(t&2048)!=0&&(n=we(n,new V("16651378430235570176"))),(t&4096)!=0&&(n=we(n,new V("15030750278694412288"))),(t&8192)!=0&&(n=we(n,new V("12247334978884435968"))),(t&16384)!=0&&(n=we(n,new V("8131365268886854656"))),(t&32768)!=0&&(n=we(n,new V("3584323654725218816"))),(t&65536)!=0&&(n=we(n,new V("696457651848324352"))),(t&131072)!=0&&(n=we(n,new V("26294789957507116"))),(t&262144)!=0&&(n=we(n,new V("37481735321082"))),e>0&&(n=Xi.div(n)),n}static getTickFromPrice(e,t,n){return F.getTickFromSqrtPriceX64(F.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(He)||e.lt(ze))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new V(t-64),r=fs(n,32,128),o=new V("8000000000000000","hex"),s=0,a=new V(0),c=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new V(0))&&s<zi;){c=c.mul(c);let g=c.shrn(127);c=c.shrn(63+g.toNumber()),a=a.add(o.mul(g)),o=o.shrn(1),s+=1}let u=a.shrn(32),m=r.add(u).mul(new V(Hi)),d=$n(m.sub(new V(Zi)),64,128).toNumber(),f=$n(m.add(new V(ji)),64,128).toNumber();return d==f?d:F.getSqrtPriceX64FromTick(f).lte(e)?f:d}},pt=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=F.getTickFromSqrtPriceX64(F.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=pt.getTickWithPriceAndTickspacing(e,t,n,r),s=F.getSqrtPriceX64FromTick(o);return F.sqrtPriceX64ToPrice(s,n,r)}},H=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(le))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(vt),s=t.sub(e);return r?D.mulDivRoundingUp(D.mulDivCeil(o,s,t),Xe,e):D.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(le))throw new Error("sqrtPriceX64A must greater than 0");return r?D.mulDivCeil(n,t.sub(e),Ne):D.mulDivFloor(n,t.sub(e),Ne)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?D.mulDivRoundingUp(a,Xe,zn):a.shrn(vt)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),D.mulDivFloor(n,zn,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return H.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=H.getLiquidityFromTokenAmountA(e,n,r,!1),a=H.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return H.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:H.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new V(0)};if(e.lt(n)){let s=H.getTokenAmountAFromLiquidity(e,n,r,o),a=H.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new V(0),amountB:H.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:c,amountB:u}=H.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,m=new V(new S(c.toString()).mul(l).toFixed(0)),d=new V(new S(u.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:c}){var h,w,A,T;let u=F.priceToSqrtPriceX64(new S(e.price),e.mintA.decimals,e.mintB.decimals),l=F.getSqrtPriceX64FromTick(t),m=F.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,f=H.getAmountsFromLiquidity(u,l,m,r,s),[g,p]=[ue(f.amountA,(h=e.mintA.extensions)==null?void 0:h.feeConfig,a,c),ue(f.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,a,c)],[y,b]=[ue(new V(new S(f.amountA.toString()).mul(d).toFixed(0)),(A=e.mintA.extensions)==null?void 0:A.feeConfig,a,c),ue(new V(new S(f.amountB.toString()).mul(d).toFixed(0)),(T=e.mintB.extensions)==null?void 0:T.feeConfig,a,c)];return{liquidity:r,amountA:g,amountB:p,amountSlippageA:y,amountSlippageB:b,expirationTime:ct(g.expirationTime,p.expirationTime)}}},ft=class{static swapCompute(e,t,n,r,o,s,a,c,u,l,m,d,f,g,p=!1){if(d.eq(le))throw new Error("amountSpecified must not be 0");if(g||(g=s?ze.add(Xe):He.sub(Xe)),s){if(g.lt(ze))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(g.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(g.gt(He))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(g.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let y=d.gt(le),b={amountSpecifiedRemaining:d,amountCalculated:le,sqrtPriceX64:m,tick:u>f?Math.min(f+X.tickCount(l)-1,u):f,accounts:[],liquidity:c,feeAmount:new V(0)},h=f,w=n[f],A=0,T=!s&&w.startTickIndex===b.tick;for(;!b.amountSpecifiedRemaining.eq(le)&&!b.sqrtPriceX64.eq(g);){A>10;let P={};P.sqrtPriceStartX64=b.sqrtPriceX64;let x=K.nextInitTick(w,b.tick,l,s,T),B=x||null,C=null;if(!(B!=null&&B.liquidityGross.gtn(0))){let R=pe.nextInitializedTickArrayStartIndex({tickCurrent:b.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},h,s);if(!R.isExist){if(p)return{allTrade:!1,amountSpecifiedRemaining:b.amountSpecifiedRemaining,amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts};throw Error("swapCompute LiquidityInsufficient")}h=R.nextStartIndex;let{publicKey:J}=Y(e,t,h);C=J,w=n[h];try{B=K.firstInitializedTick(w,s)}catch{throw Error("not found next tick info")}}P.tickNext=B.tick,P.initialized=B.liquidityGross.gtn(0),f!==h&&C&&(b.accounts.push(C),f=h),P.tickNext<xe?P.tickNext=xe:P.tickNext>Be&&(P.tickNext=Be),P.sqrtPriceNextX64=F.getSqrtPriceX64FromTick(P.tickNext);let M;if(s&&P.sqrtPriceNextX64.lt(g)||!s&&P.sqrtPriceNextX64.gt(g)?M=g:M=P.sqrtPriceNextX64,[b.sqrtPriceX64,P.amountIn,P.amountOut,P.feeAmount]=ft.swapStepCompute(b.sqrtPriceX64,M,b.liquidity,b.amountSpecifiedRemaining,a),b.feeAmount=b.feeAmount.add(P.feeAmount),y?(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.sub(P.amountIn.add(P.feeAmount)),b.amountCalculated=b.amountCalculated.sub(P.amountOut)):(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.add(P.amountOut),b.amountCalculated=b.amountCalculated.add(P.amountIn.add(P.feeAmount))),b.sqrtPriceX64.eq(P.sqrtPriceNextX64)){if(P.initialized){let R=B.liquidityNet;s&&(R=R.mul(Je)),b.liquidity=H.addDelta(b.liquidity,R)}T=P.tickNext!=b.tick&&!s&&w.startTickIndex===P.tickNext,b.tick=s?P.tickNext-1:P.tickNext}else if(b.sqrtPriceX64!=P.sqrtPriceStartX64){let R=F.getTickFromSqrtPriceX64(b.sqrtPriceX64);T=R!=b.tick&&!s&&w.startTickIndex===R,b.tick=R}++A}try{let{nextStartIndex:P,isExist:x}=X.nextInitializedTickArray(b.tick,l,s,r,o);x&&f!==P&&(b.accounts.push(Y(e,t,P).publicKey),f=P)}catch{}return{allTrade:!0,amountSpecifiedRemaining:le,amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new V(0),amountIn:new V(0),amountOut:new V(0),feeAmount:new V(0)},a=e.gte(t),c=r.gte(le);if(c){let l=D.mulDivFloor(r,pn.sub(new V(o.toString())),pn);s.amountIn=a?H.getTokenAmountAFromLiquidity(t,e,n,!0):H.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=F.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?H.getTokenAmountBFromLiquidity(t,e,n,!1):H.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(Je).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=F.getNextSqrtPriceX64FromOutput(e,n,r.mul(Je),a);let u=t.eq(s.sqrtPriceX64Next);return a?(u&&c||(s.amountIn=H.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),u&&!c||(s.amountOut=H.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=u&&c?s.amountIn:H.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=u&&!c?s.amountOut:H.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!c&&s.amountOut.gt(r.mul(Je))&&(s.amountOut=r.mul(Je)),c&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=D.mulDivCeil(s.amountIn,new V(o),pn.sub(new V(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var be=60,dt=512,K=class{static getTickArrayAddressByTick(e,t,n,r){let o=K.getTickArrayStartIndexByTick(n,r),{publicKey:s}=Y(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=K.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=be)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=X.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*X.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*be,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*be,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*be:e+t*be}static mergeTickArrayBitmap(e){let t=new ps(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*be));return[...K.searchLowBitFromStart(e,t,s-1,o,n),...K.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return K.searchHightBitFromStart(e,t,0,dt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=K.getAllInitializedTickArrayStartIndex(n,r,o);for(let c of a){let{publicKey:u}=Y(e,t,c);s.push({tickArrayStartIndex:c,tickArrayAddress:u})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>K.mergeTickArrayBitmap(u)),a=[];for(;n>=-7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n--,a.length===r)break}let c=X.tickCount(o);return a.map(u=>u*c)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>K.mergeTickArrayBitmap(u)),a=[];for(;n<7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n++,a.length===r)break}let c=X.tickCount(o);return a.map(u=>u*c)}static checkIsOutOfBoundary(e){return e<xe||e>Be}static nextInitTick(e,t,n,r,o){if(X.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<be;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=be-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<be;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=F.getSqrtPriceX64FromTick(t),o=F.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new S(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new S(1).div(t),o=pt.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=F.getSqrtPriceX64FromTick(o),a=F.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new S(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=F.getSqrtPriceX64FromTick(t),o=F.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new S(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new S(1).div(t),o=pt.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=F.getSqrtPriceX64FromTick(o),a=F.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new S(1).div(a)}}};var sr=ee([Me(8),fe("bump"),_t("index"),se(""),Pt("protocolFeeRate"),Pt("tradeFeeRate"),_t("tickSpacing"),ae(E(),8,"")]),gs=ee([Pt("blockTimestamp"),Ui("tickCumulative"),ae(E(),4)]),ar=ee([Me(8),Ge("initialized"),E("recentEpoch"),_t("observationIndex"),se("poolId"),ae(gs,100,"observations"),ae(E(),4)]),bs=ee([fe("rewardState"),E("openTime"),E("endTime"),E("lastUpdateTime"),z("emissionsPerSecondX64"),E("rewardTotalEmissioned"),E("rewardClaimed"),se("tokenMint"),se("tokenVault"),se("creator"),z("rewardGrowthGlobalX64")]),yn=ee([Me(8),fe("bump"),se("ammConfig"),se("creator"),se("mintA"),se("mintB"),se("vaultA"),se("vaultB"),se("observationId"),fe("mintDecimalsA"),fe("mintDecimalsB"),_t("tickSpacing"),z("liquidity"),z("sqrtPriceX64"),Te("tickCurrent"),Pt(),z("feeGrowthGlobalX64A"),z("feeGrowthGlobalX64B"),E("protocolFeesTokenA"),E("protocolFeesTokenB"),z("swapInAmountTokenA"),z("swapOutAmountTokenB"),z("swapInAmountTokenB"),z("swapOutAmountTokenA"),fe("status"),ae(fe(),7,""),ae(bs,3,"rewardInfos"),ae(E(),16,"tickArrayBitmap"),E("totalFeesTokenA"),E("totalFeesClaimedTokenA"),E("totalFeesTokenB"),E("totalFeesClaimedTokenB"),E("fundFeesTokenA"),E("fundFeesTokenB"),E("startTime"),ae(E(),15*4-3,"padding")]),ys=ee([z("growthInsideLastX64"),E("rewardAmountOwed")]),wn=ee([Me(8),fe("bump"),se("nftMint"),se("poolId"),Te("tickLower"),Te("tickUpper"),z("liquidity"),z("feeGrowthInsideLastX64A"),z("feeGrowthInsideLastX64B"),E("tokenFeesOwedA"),E("tokenFeesOwedB"),ae(ys,3,"rewardInfos"),ae(E(),8,"")]),Bd=ee([Me(8),fe("bump"),se("poolId"),Te("tickLowerIndex"),Te("tickUpperIndex"),z("liquidity"),z("feeGrowthInsideLastX64A"),z("feeGrowthInsideLastX64B"),E("tokenFeesOwedA"),E("tokenFeesOwedB"),ae(z(),3,"rewardGrowthInside"),ae(E(),8,"")]),ws=ee([Te("tick"),Gi("liquidityNet"),z("liquidityGross"),z("feeGrowthOutsideX64A"),z("feeGrowthOutsideX64B"),ae(z(),3,"rewardGrowthsOutsideX64"),ae(Pt(),13,"")]),Ut=ee([Me(8),se("poolId"),Te("startTickIndex"),ae(ws,be,"ticks"),fe("initializedTickCount"),ae(fe(),115,"")]),cr=ee([Me(329),ae(se(),100,"whitelistMints")]),or=ee([Me(8),se("poolId"),ae(ae(E(),8),Qn,"positiveTickArrayBitmap"),ae(ae(E(),8),Qn,"negativeTickArrayBitmap")]),Id=ee([E(),fe("bump"),se("owner"),se("poolId"),se("positionId"),se("nftAccount"),ae(E(),8)]);ar.span;var mr=Ae("Raydium_Clmm"),We={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},hs=[188,37,179,131,82,150,84,73],As=[16,72,250,198,14,162,212,19],ce=class{static createPoolInstruction(e,t,n,r,o,s,a,c,u,l,m,d,f,g){let p=ee([z("sqrtPriceX64"),E("startTime")]),y=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:Tt.programId,isSigner:!1,isWritable:!1},{pubkey:Kt,isSigner:!1,isWritable:!1}],b=Buffer.alloc(p.span);p.encode({sqrtPriceX64:f,startTime:g},b);let h=Buffer.from([...We.createPool,...b]);return new Le({keys:y,programId:e,data:h})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:o,ammConfigId:s,initialPriceX64:a,startTime:c}=e,[u,l]=[new I(r.address),new I(o.address)],{publicKey:m}=er(t,s,u,l),{publicKey:d}=nr(t,m),{publicKey:f}=jn(t,m,u),{publicKey:g}=jn(t,m,l),p=[this.createPoolInstruction(t,m,n,s,d,u,f,new I(r.programId||me),l,g,new I(o.programId||me),Ee(t,m).publicKey,a,c)];return{signers:[],instructions:p,instructionTypes:[oe.CreateAccount,oe.ClmmCreatePool],address:{poolId:m,observationId:d,mintAVault:f,mintBVault:g},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,m,d,f,g,p,y,b,h,w,A,T,P,x,B,C,M){let R=ee([Te("tickLowerIndex"),Te("tickUpperIndex"),Te("tickArrayLowerStartIndex"),Te("tickArrayUpperStartIndex"),z("liquidity"),E("amountMaxA"),E("amountMaxB"),Ge("withMetadata"),fe("optionBaseFlag"),Ge("baseFlag")]),J=[...M?[{pubkey:M,isSigner:!1,isWritable:!0}]:[]],te=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:Kt,isSigner:!1,isWritable:!1},{pubkey:Tt.programId,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:lr,isSigner:!1,isWritable:!1},{pubkey:wt,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...J],de=Buffer.alloc(R.span);R.encode({tickLowerIndex:h,tickUpperIndex:w,tickArrayLowerStartIndex:A,tickArrayUpperStartIndex:T,liquidity:P,amountMaxA:x,amountMaxB:B,withMetadata:C==="create",baseFlag:!1,optionBaseFlag:0},de);let ne=Buffer.from([...We.openPosition,...de]);return new Le({keys:te,programId:e,data:ne})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l}){let m=[],[d,f]=[new I(e.programId),new I(e.id)],g;if(l)g=new I((await l(1))[0]);else{let B=ei.generate();m.push(B),g=B.publicKey}let p=K.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=K.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=Y(d,f,p),{publicKey:h}=Y(d,f,y),{publicKey:w}=Re(n.wallet,g,me),{publicKey:A}=bn(g),{publicKey:T}=Ce(d,g),{publicKey:P}=ut(d,f,r,o),x=this.openPositionFromLiquidityInstruction(d,n.feePayer,f,n.wallet,g,w,A,P,b,h,T,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),r,o,p,y,s,a,c,u);return{signers:m,instructions:[x],instructionTypes:[oe.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:g,tickArrayLower:b,tickArrayUpper:h,positionNftAccount:w,metadataAccount:A,personalPosition:T,protocolPosition:P}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:u,getEphemeralSigners:l}){let m=[],[d,f]=[new I(e.programId),new I(e.id)],g;if(l)g=new I((await l(1))[0]);else{let B=ei.generate();m.push(B),g=B.publicKey}let p=K.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=K.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=Y(d,f,p),{publicKey:h}=Y(d,f,y),{publicKey:w}=Re(n.wallet,g,me),{publicKey:A}=bn(g),{publicKey:T}=Ce(d,g),{publicKey:P}=ut(d,f,r,o),x=this.openPositionFromBaseInstruction(d,n.feePayer,f,n.wallet,g,w,A,P,b,h,T,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),r,o,p,y,u,s,a,c,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,y])?Ee(d,f).publicKey:void 0);return{address:{nftMint:g,tickArrayLower:b,tickArrayUpper:h,positionNftAccount:w,metadataAccount:A,personalPosition:T,protocolPosition:P},instructions:[x],signers:m,instructionTypes:[oe.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,l,m,d,f,g,p,y,b,h,w,A,T,P,x,B,C,M){let R=ee([Te("tickLowerIndex"),Te("tickUpperIndex"),Te("tickArrayLowerStartIndex"),Te("tickArrayUpperStartIndex"),z("liquidity"),E("amountMaxA"),E("amountMaxB"),Ge("withMetadata"),fe("optionBaseFlag"),Ge("baseFlag")]),J=[...M?[{pubkey:M,isSigner:!1,isWritable:!0}]:[]],te=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:Kt,isSigner:!1,isWritable:!1},{pubkey:Tt.programId,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:lr,isSigner:!1,isWritable:!1},{pubkey:wt,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...J],de=Buffer.alloc(R.span);R.encode({tickLowerIndex:h,tickUpperIndex:w,tickArrayLowerStartIndex:A,tickArrayUpperStartIndex:T,liquidity:new ur(0),amountMaxA:x==="MintA"?B:C,amountMaxB:x==="MintA"?C:B,withMetadata:P==="create",baseFlag:x==="MintA",optionBaseFlag:1},de);let ne=Buffer.from([...We.openPosition,...de]);return new Le({keys:te,programId:e,data:ne})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l}){let m,d=[];if(l)m=new I((await l(1))[0]);else{let B=ei.generate();d.push(B),m=B.publicKey}let[f,g]=[new I(e.programId),new I(e.id)],p=K.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=K.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=Y(f,g,p),{publicKey:h}=Y(f,g,y),{publicKey:w}=Re(n.wallet,m,me),{publicKey:A}=bn(m),{publicKey:T}=Ce(f,m),{publicKey:P}=ut(f,g,r,o),x=this.openPositionFromLiquidityInstruction(f,n.wallet,g,n.wallet,m,w,A,P,b,h,T,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(t.mintA.address),new I(t.mintB.address),r,o,p,y,s,a,c,u,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,y])?Ee(f,g).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:b,tickArrayUpper:h,positionNftAccount:w,metadataAccount:A,personalPosition:T,protocolPosition:P},instructions:[x],signers:d,instructionTypes:[oe.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=ee([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:Tt.programId,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);s.encode({},c);let u=Buffer.from([...We.closePosition,...c]);return new Le({keys:a,programId:e,data:u})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new I(e.programId),{publicKey:s}=Re(n.wallet,r.nftMint,me),{publicKey:a}=Ce(o,r.nftMint),c=[];return c.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:c,instructionTypes:[oe.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,m,d,f,g,p,y,b,h){let w=ee([z("liquidity"),E("amountMaxA"),E("amountMaxB"),fe("optionBaseFlag"),Ge("baseFlag")]),A=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...A],P=Buffer.alloc(w.span);w.encode({liquidity:p,amountMaxA:y,amountMaxB:b,optionBaseFlag:0,baseFlag:!1},P);let x=Buffer.from([...We.increaseLiquidity,...P]);return new Le({keys:T,programId:e,data:x})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[c,u]=[new I(e.programId),new I(e.id)],l=K.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=K.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=Y(c,u,l),{publicKey:f}=Y(c,u,m),{publicKey:g}=Re(r.wallet,n.nftMint,me),{publicKey:p}=Ce(c,n.nftMint),{publicKey:y}=ut(c,u,n.tickLower,n.tickUpper),b=this.increasePositionFromLiquidityInstruction(c,r.wallet,g,p,u,y,d,f,r.tokenAccountA,r.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),o,s,a,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Ee(c,u).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:f,positionNftAccount:g,personalPosition:p,protocolPosition:y},signers:[],instructions:[b],instructionTypes:[oe.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[c,u]=[new I(e.programId),new I(e.id)],l=K.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=K.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=Y(c,u,l),{publicKey:f}=Y(c,u,m),{publicKey:g}=Re(r.wallet,n.nftMint,me),{publicKey:p}=Ce(c,n.nftMint),{publicKey:y}=ut(c,u,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:f,positionNftAccount:g,personalPosition:p,protocolPosition:y},instructions:[this.increasePositionFromBaseInstruction(c,r.wallet,g,p,u,y,d,f,r.tokenAccountA,r.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),o,s,a,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Ee(c,u).publicKey:void 0)],signers:[],instructionTypes:[oe.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,l,m,d,f,g,p,y,b,h){let w=ee([z("liquidity"),E("amountMaxA"),E("amountMaxB"),fe("optionBaseFlag"),Ge("baseFlag")]),A=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...A],P=Buffer.alloc(w.span);w.encode({liquidity:new ur(0),amountMaxA:p==="MintA"?y:b,amountMaxB:p==="MintA"?b:y,baseFlag:p==="MintA",optionBaseFlag:1},P);let x=Buffer.from([...We.increaseLiquidity,...P]);return new Le({keys:T,programId:e,data:x})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,m,d,f,g,p,y,b,h,w){let A=ee([z("liquidity"),E("amountMinA"),E("amountMinB")]),T=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...p.map(C=>[{pubkey:C.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:C.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:C.rewardMint,isSigner:!1,isWritable:!1}]).flat()],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:nn,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...T],x=Buffer.alloc(A.span);A.encode({liquidity:y,amountMinA:b,amountMinB:h},x);let B=Buffer.from([...We.decreaseLiquidity,...x]);return new Le({keys:P,programId:e,data:B})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:c}){let[u,l]=[new I(e.programId),new I(e.id)],m=K.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=K.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:f}=Y(u,l,m),{publicKey:g}=Y(u,l,d),{publicKey:p}=Re(r.wallet,n.nftMint,c),{publicKey:y}=Ce(u,n.nftMint),{publicKey:b}=ut(u,l,n.tickLower,n.tickUpper),h=[];for(let T=0;T<e.rewardDefaultInfos.length;T++)h.push({poolRewardVault:new I(t.rewardInfos[T].vault),ownerRewardVault:r.rewardAccounts[T],rewardMint:new I(e.rewardDefaultInfos[T].mint.address)});let w=[],A=this.decreaseLiquidityInstruction(u,r.wallet,p,y,l,b,f,g,r.tokenAccountA,r.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),h,o,s,a,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?Ee(u,l).publicKey:void 0);return w.push(A),{address:{tickArrayLower:f,tickArrayUpper:g,positionNftAccount:p,personalPosition:y,protocolPosition:b},signers:[],instructions:w,instructionTypes:[oe.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,c,u,l,m,d,f,g,p,y,b){let h=ee([E("amount"),E("otherAmountThreshold"),z("sqrtPriceLimitX64"),Ge("isBaseInput")]),w=[...b?[{pubkey:b,isSigner:!1,isWritable:!0}]:[],...m.map(x=>({pubkey:x,isSigner:!1,isWritable:!0}))],A=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:nn,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...w],T=Buffer.alloc(h.span);h.encode({amount:f,otherAmountThreshold:g,sqrtPriceLimitX64:p,isBaseInput:y},T);let P=Buffer.from([...We.swap,...T]);return new Le({keys:A,programId:e,data:P})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[l,m]=[new I(e.programId),new I(e.id)],[d,f]=[new I(t.vault.A),new I(t.vault.B)],[g,p]=[new I(e.mintA.address),new I(e.mintB.address)],y=e.mintA.address===o.toString(),b=[this.swapInstruction(l,r.wallet,m,new I(e.config.id),y?r.tokenAccountA:r.tokenAccountB,y?r.tokenAccountB:r.tokenAccountA,y?d:f,y?f:d,y?g:p,y?p:g,u,n,s,a,c,!0,Ee(l,m).publicKey)];return{signers:[],instructions:b,instructionTypes:[oe.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:o,amountOut:s,amountInMax:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[l,m]=[new I(e.programId),new I(e.id)],[d,f]=[new I(t.vault.A),new I(t.vault.B)],[g,p]=[new I(e.mintA.address),new I(e.mintB.address)],y=e.mintA.address===o.toBase58(),b=[this.swapInstruction(l,r.wallet,m,new I(e.config.id),y?r.tokenAccountB:r.tokenAccountA,y?r.tokenAccountA:r.tokenAccountB,y?f:d,y?d:f,y?p:g,y?g:p,u,n,s,a,c,!1,Ee(l,m).publicKey)];return{signers:[],instructions:b,instructionTypes:[oe.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,c,u,l,m,d){let f=ee([E("openTime"),E("endTime"),z("emissionsPerSecondX64")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Tt.programId,isSigner:!1,isWritable:!1},{pubkey:Kt,isSigner:!1,isWritable:!1}],p=Buffer.alloc(f.span);f.encode({openTime:ye(l),endTime:ye(m),emissionsPerSecondX64:d},p);let y=Buffer.from([...We.initReward,...p]);return new Le({keys:g,programId:e,data:y})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new I(e.programId),new I(e.id)],a=tr(o,s,r.mint).publicKey,c=Wt(o).publicKey,u=[this.initRewardInstruction(o,n.wallet,s,c,new I(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:c},signers:[],instructions:u,instructionTypes:[oe.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,c,u,l,m,d){let f=ee([fe("rewardIndex"),z("emissionsPerSecondX64"),E("openTime"),E("endTime")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0}],p=Buffer.alloc(f.span);f.encode({rewardIndex:u,emissionsPerSecondX64:d,openTime:ye(l),endTime:ye(m)},p);let y=Buffer.from([...We.setRewardEmissions,...p]);return new Le({keys:g,programId:e,data:y})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new I(e.programId),new I(e.id)],a,c,u;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===r.mint.toString()&&(a=d,c=new I(t.rewardInfos[d].vault),u=new I(t.rewardInfos[d].mint.address));(a===void 0||c===void 0)&&mr.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=Wt(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new I(e.config.id),n.tokenAccount,c,u,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:c,operationId:l},signers:[],instructions:m,instructionTypes:[oe.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let c=ee([fe("rewardIndex")]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:nn,isSigner:!1,isWritable:!1}],l=Buffer.alloc(c.span);c.encode({rewardIndex:a},l);let m=Buffer.from([...We.collectReward,...l]);return new Le({keys:u,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new I(e.programId),new I(e.id)],a,c;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,c=new I(t.rewardInfos[l].vault));(a===void 0||c===void 0)&&mr.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let u=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,c,r,a)];return{address:{rewardVault:c},signers:[],instructions:u,instructionTypes:[oe.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:r,positionNft:o}){let{publicKey:s}=Re(r,o,me),{publicKey:a}=Ce(n,o),c=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Yn(e,a).publicKey,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:Tt.programId,isSigner:!1,isWritable:!1}];return new Le({keys:c,programId:e,data:Buffer.from(hs)})}static harvestLockPositionInstruction(e){let[t,n]=[new I(e.poolKeys.programId),new I(e.poolKeys.id)],r=K.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),o=K.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:s}=Y(t,n,r),{publicKey:a}=Y(t,n,o),{publicKey:c}=Re(e.owner,e.ownerPosition.nftMint,me),{publicKey:u}=Ce(t,e.ownerPosition.nftMint),{publicKey:l}=ut(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),m=[];for(let g=0;g<e.poolKeys.rewardInfos.length;g++)m.push({poolRewardVault:new I(e.poolKeys.rewardInfos[g].vault),ownerRewardVault:e.ownerRewardAccounts[g],rewardMint:new I(e.poolKeys.rewardInfos[g].mint.address)});let d=[...m.map(g=>[{pubkey:g.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:g.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:g.rewardMint,isSigner:!1,isWritable:!1}]).flat()],f=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:Yn(e.programId,u).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:new I(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new I(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:Ci,isSigner:!1,isWritable:!1},{pubkey:new I(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new I(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...d];return new Le({keys:f,programId:e.programId,data:Buffer.from(As)})}};var pr=class extends Dt{constructor(e){super(e)}async getClmmPoolKeys(e){return(await this.scope.api.fetchPoolKeysById({idList:[e]}))[0]}async createPool(e){var w;let{programId:t,owner:n=((w=this.scope.owner)==null?void 0:w.publicKey)||_.default,mint1:r,mint2:o,ammConfig:s,initialPrice:a,startTime:c,computeBudgetConfig:u,forerunCreate:l,getObserveState:m,txVersion:d}=e,f=this.createTxBuilder(),[g,p,y]=new Ke(new _(r.address).toBuffer()).gt(new Ke(new _(o.address).toBuffer()))?[o,r,new S(1).div(a)]:[r,o,a],b=F.priceToSqrtPriceX64(y,g.decimals,p.decimals),h=await ce.createPoolInstructions({connection:this.scope.connection,programId:t,owner:n,mintA:g,mintB:p,ammConfigId:s.id,initialPriceX64:b,startTime:c,forerunCreate:!m&&l});return f.addInstruction(h),f.addCustomComputeBudget(u),f.versionBuild({txVersion:d,extInfo:{address:U(N({},h.address),{programId:t.toString(),id:h.address.poolId.toString(),mintA:g,mintB:p,openTime:c.toString(),vault:{A:h.address.mintAVault.toString(),B:h.address.mintBVault.toString()},rewardInfos:[],config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}}),mockPoolInfo:N({type:"Concentrated",rewardDefaultPoolInfos:"Clmm",id:h.address.poolId.toString(),mintA:g,mintB:p,feeRate:s.tradeFeeRate,openTime:c.toString(),programId:t.toString(),price:y.toNumber(),config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]},burnPercent:0},Yi),forerunCreate:l}})}async openPositionFromBase({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",getEphemeralSigners:d,computeBudgetConfig:f,txVersion:g}){this.scope.availability.addConcentratedPosition===!1&&this.logAndCreateError("add position feature disabled in your region"),this.scope.checkOwner();let p=this.createTxBuilder(),y=null,b=null,h=n.useSOLBalance&&e.mintA.address===Z.toString(),w=n.useSOLBalance&&e.mintB.address===Z.toString(),[A,T]=s==="MintA"?[a,c]:[c,a],{account:P,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new _(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:h||A.isZero()?{payer:this.scope.ownerPubKey,amount:A}:void 0,skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:h?!1:u,checkCreateATAOwner:l});P&&(y=P),p.addInstruction(x||{});let{account:B,instructionParams:C}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new _(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:w||T.isZero()?{payer:this.scope.ownerPubKey,amount:T}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:u,checkCreateATAOwner:l});B&&(b=B),p.addInstruction(C||{}),(!y||!b)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",{ownerTokenAccountA:y==null?void 0:y.toBase58(),ownerTokenAccountB:b==null?void 0:b.toBase58()});let M=t||await this.getClmmPoolKeys(e.id),R=await ce.openPositionFromBaseInstructions({poolInfo:e,poolKeys:M,ownerInfo:U(N({},n),{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:y,tokenAccountB:b}),tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:m,getEphemeralSigners:d});return p.addInstruction(R),p.addCustomComputeBudget(f),p.versionBuild({txVersion:g,extInfo:N({},R.address)})}async openPositionFromLiquidity({poolInfo:e,poolKeys:t,ownerInfo:n,amountMaxA:r,amountMaxB:o,tickLower:s,tickUpper:a,liquidity:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",txVersion:d,computeBudgetConfig:f,getEphemeralSigners:g}){this.scope.availability.createConcentratedPosition===!1&&this.logAndCreateError("open position feature disabled in your region");let p=this.createTxBuilder(),y=null,b=null,h=n.useSOLBalance&&e.mintA.address===Z.toBase58(),w=n.useSOLBalance&&e.mintB.address===Z.toBase58(),{account:A,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new _(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:h||r.isZero()?{payer:this.scope.ownerPubKey,amount:r}:void 0,skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:h?!1:u,checkCreateATAOwner:l});A&&(y=A),p.addInstruction(T||{});let{account:P,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new _(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:w||o.isZero()?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:u,checkCreateATAOwner:l});P&&(b=P),p.addInstruction(x||{}),(y===void 0||b===void 0)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let B=t||await this.getClmmPoolKeys(e.id),C=await ce.openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:B,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:y,tokenAccountB:b},tickLower:s,tickUpper:a,liquidity:c,amountMaxA:r,amountMaxB:o,withMetadata:m,getEphemeralSigners:g});return p.addInstruction(C),p.addCustomComputeBudget(f),p.versionBuild({txVersion:d,extInfo:{address:C.address}})}async increasePositionFromLiquidity(e){let{poolInfo:t,poolKeys:n,ownerPosition:r,amountMaxA:o,amountMaxB:s,liquidity:a,ownerInfo:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,computeBudgetConfig:m,txVersion:d}=e,f=this.createTxBuilder(),g,p,y=c.useSOLBalance&&t.mintA.address===Z.toString(),b=c.useSOLBalance&&t.mintB.address===Z.toString(),{account:h,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new _(t.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,createInfo:y||o.isZero()?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!y,associatedOnly:y?!1:u,checkCreateATAOwner:l});h&&(g=h),f.addInstruction(w||{});let{account:A,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new _(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:b||s.isZero()?{payer:this.scope.ownerPubKey,amount:s}:void 0,notUseTokenAccount:b,skipCloseAccount:!b,associatedOnly:b?!1:u,checkCreateATAOwner:l});A&&(p=A),f.addInstruction(T||{}),!g&&!p&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let P=n!=null?n:await this.getClmmPoolKeys(t.id),x=ce.increasePositionFromLiquidityInstructions({poolInfo:t,poolKeys:P,ownerPosition:r,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:g,tokenAccountB:p},liquidity:a,amountMaxA:o,amountMaxB:s});return f.addInstruction(x),f.addCustomComputeBudget(m),f.versionBuild({txVersion:d,extInfo:{address:x.address}})}async increasePositionFromBase(e){let{poolInfo:t,ownerPosition:n,base:r,baseAmount:o,otherAmountMax:s,ownerInfo:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:l,txVersion:m}=e,d=this.createTxBuilder(),f,g,p=a.useSOLBalance&&t.mintA.address===Z.toString(),y=a.useSOLBalance&&t.mintB.address===Z.toString(),{account:b,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new _(t.mintA.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,createInfo:p||(r==="MintA"?o:s).isZero()?{payer:this.scope.ownerPubKey,amount:r==="MintA"?o:s}:void 0,skipCloseAccount:!p,associatedOnly:p?!1:c,checkCreateATAOwner:u});b&&(f=b),d.addInstruction(h||{});let{account:w,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new _(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:y||(r==="MintA"?s:o).isZero()?{payer:this.scope.ownerPubKey,amount:r==="MintA"?s:o}:void 0,notUseTokenAccount:y,skipCloseAccount:!y,associatedOnly:y?!1:c,checkCreateATAOwner:u});w&&(g=w),d.addInstruction(A||{}),!f&&!g&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let T=await this.getClmmPoolKeys(t.id),P=ce.increasePositionFromBaseInstructions({poolInfo:t,poolKeys:T,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:g},base:r,baseAmount:o,otherAmountMax:s});return d.addInstruction(P),d.addCustomComputeBudget(l),d.versionBuild({txVersion:m,extInfo:{address:P.address}})}async decreaseLiquidity(e){let{poolInfo:t,poolKeys:n,ownerPosition:r,ownerInfo:o,amountMinA:s,amountMinB:a,liquidity:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,computeBudgetConfig:m,txVersion:d}=e;this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let f=this.createTxBuilder(),g=o.useSOLBalance&&t.mintA.address===Z.toString(),p=o.useSOLBalance&&t.mintB.address===Z.toString(),y,b,{account:h,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new _(t.mintA.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!g,associatedOnly:g?!1:u,checkCreateATAOwner:l});y=h,w&&f.addInstruction(w);let{account:A,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new _(t.mintB.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!p,associatedOnly:p?!1:u,checkCreateATAOwner:l});b=A,T&&f.addInstruction(T);let P=[];for(let M of t.rewardDefaultInfos){let R=o.useSOLBalance&&M.mint.address===Z.toString(),J;if(M.mint.address===t.mintA.address)J=y;else if(M.mint.address===t.mintB.address)J=b;else{let{account:te,instructionParams:de}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new _(M.mint.programId),mint:new _(M.mint.address),notUseTokenAccount:R,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!R,associatedOnly:R?!1:u,checkCreateATAOwner:l});J=te,de&&f.addInstruction(de)}P.push(J)}!y&&!b&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccountRawInfos);let x=n!=null?n:await this.getClmmPoolKeys(t.id),B=await ce.decreaseLiquidityInstructions({poolInfo:t,poolKeys:x,ownerPosition:r,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:y,tokenAccountB:b,rewardAccounts:P},liquidity:c,amountMinA:s,amountMinB:a});f.addInstruction({instructions:B.instructions,instructionTypes:[oe.ClmmDecreasePosition]});let C=N({},B.address);if(o.closePosition){let M=await ce.closePositionInstructions({poolInfo:t,poolKeys:x,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:r});f.addInstruction({endInstructions:M.instructions,endInstructionTypes:M.instructionTypes}),C=N(N({},C),M.address)}return f.addCustomComputeBudget(m),f.versionBuild({txVersion:d,extInfo:{address:C}})}async lockPosition(e){let{programId:t=an,authProgramId:n=cn,poolProgramId:r=Fi,ownerPosition:o,computeBudgetConfig:s,txVersion:a}=e,c=this.createTxBuilder(),u=await ce.lockPositionInstruction({programId:t,authProgramId:n,poolProgramId:r,owner:this.scope.ownerPubKey,positionNft:o.nftMint});return c.addInstruction({instructions:[u],instructionTypes:[oe.ClmmLockPosition]}),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a})}async harvestLockPosition(e){let{programId:t=an,authProgramId:n=cn,ownerPosition:r,ownerInfo:o={useSOLBalance:!0},associatedOnly:s=!0,checkCreateATAOwner:a=!1,computeBudgetConfig:c,txVersion:u}=e,l=await this.getClmmPoolKeys(r.poolId.toString()),m=this.createTxBuilder(),d=o.useSOLBalance&&l.mintA.address===Z.toString(),f=o.useSOLBalance&&l.mintB.address===Z.toString(),g,p,{account:y,instructionParams:b}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:l.mintA.programId,mint:new _(l.mintA.address),notUseTokenAccount:d,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!d,associatedOnly:d?!1:s,checkCreateATAOwner:a});g=y,b&&m.addInstruction(b);let{account:h,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:l.mintB.programId,mint:new _(l.mintB.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!f,associatedOnly:f?!1:s,checkCreateATAOwner:a});p=h,w&&m.addInstruction(w);let A={},T=[];for(let x of l.rewardInfos){let B=o.useSOLBalance&&x.mint.address===Z.toString(),C=A[x.mint.address];if(!C){let{account:M,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new _(x.mint.programId),mint:new _(x.mint.address),notUseTokenAccount:B,owner:this.scope.ownerPubKey,skipCloseAccount:!B,createInfo:{payer:this.scope.ownerPubKey,amount:0},associatedOnly:B?!1:s});C=M,R&&m.addInstruction(R)}A[x.mint.address]=C,T.push(C)}let P=await ce.harvestLockPositionInstruction({programId:t,authProgramId:n,poolKeys:l,ownerPosition:r,owner:this.scope.ownerPubKey,ownerRewardAccounts:T,userVaultA:g,userVaultB:p});return m.addInstruction({instructions:[P],instructionTypes:[oe.ClmmHarvestLockPosition]}),m.addCustomComputeBudget(c),m.versionBuild({txVersion:u})}async closePosition({poolInfo:e,poolKeys:t,ownerPosition:n,txVersion:r}){this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let o=this.createTxBuilder(),s=t!=null?t:await this.getClmmPoolKeys(e.id),a=ce.closePositionInstructions({poolInfo:e,poolKeys:s,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:n});return o.addInstruction(a).versionBuild({txVersion:r,extInfo:{address:a.address}})}async initReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let c=this.createTxBuilder(),u=t.useSOLBalance&&n.mint.address.toString()===Z.toString(),l=n.perSecond.mul(n.endTime-n.openTime),{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new _(n.mint.address),mint:new _(n.mint.address),notUseTokenAccount:!!u,skipCloseAccount:!u,owner:this.scope.ownerPubKey,createInfo:u?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Ke(new S(l.toFixed(0)).gte(l)?l.toFixed(0):l.add(1).toFixed(0))}:void 0,associatedOnly:u?!1:r,checkCreateATAOwner:o});d&&c.addInstruction(d),m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let f=await this.getClmmPoolKeys(e.id),g=ce.initRewardInstructions({poolInfo:e,poolKeys:f,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardInfo:{programId:new _(n.mint.programId),mint:new _(n.mint.address),openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:D.decimalToX64(n.perSecond)}});return c.addInstruction(g),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:g.address}})}async initRewards({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfos:r,associatedOnly:o=!0,checkCreateATAOwner:s=!1,computeBudgetConfig:a,txVersion:c}){for(let m of r)m.endTime<=m.openTime&&this.logAndCreateError("reward time error","rewardInfo",m);let u=this.createTxBuilder(),l={};for(let m of r){let d=n.useSOLBalance&&m.mint.address===Z.toString(),f=m.perSecond.mul(m.endTime-m.openTime),{account:g,instructionParams:p}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new _(m.mint.programId),mint:new _(m.mint.address),notUseTokenAccount:!!d,skipCloseAccount:!d,owner:this.scope.ownerPubKey,createInfo:d?{payer:n.feePayer||this.scope.ownerPubKey,amount:new Ke(new S(f.toFixed(0)).gte(f)?f.toFixed(0):f.add(1).toFixed(0))}:void 0,associatedOnly:d?!1:o,checkCreateATAOwner:s});p&&u.addInstruction(p),g||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let y=t!=null?t:await this.getClmmPoolKeys(e.id),b=ce.initRewardInstructions({poolInfo:e,poolKeys:y,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:g},rewardInfo:{programId:new _(m.mint.programId),mint:new _(m.mint.address),openTime:m.openTime,endTime:m.endTime,emissionsPerSecondX64:D.decimalToX64(m.perSecond)}});l=N(N({},l),b.address),u.addInstruction(b)}return u.addCustomComputeBudget(a),u.versionBuild({txVersion:c,extInfo:{address:l}})}async setReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let c=this.createTxBuilder(),u=t.useSOLBalance&&n.mint.equals(Z),{account:l,instructionParams:m}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n.programId,mint:n.mint,notUseTokenAccount:u,owner:this.scope.ownerPubKey,createInfo:u?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Ke(new S(n.perSecond.sub(n.endTime-n.openTime).toFixed(0)).gte(n.perSecond.sub(n.endTime-n.openTime))?n.perSecond.sub(n.endTime-n.openTime).toFixed(0):n.perSecond.sub(n.endTime-n.openTime).add(1).toFixed(0))}:void 0,associatedOnly:u?!1:r,checkCreateATAOwner:o});m&&c.addInstruction(m),l||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let d=await this.getClmmPoolKeys(e.id),f=ce.setRewardInstructions({poolInfo:e,poolKeys:d,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:l},rewardInfo:{mint:n.mint,openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:D.decimalToX64(n.perSecond)}});return c.addInstruction(f),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:f.address}})}async setRewards({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfos:r,associatedOnly:o=!0,checkCreateATAOwner:s=!1,computeBudgetConfig:a,txVersion:c}){let u=this.createTxBuilder(),l={};for(let m of r){m.endTime<=m.openTime&&this.logAndCreateError("reward time error","rewardInfo",m);let d=n.useSOLBalance&&m.mint.address===Z.toString(),{account:f,instructionParams:g}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new _(m.mint.programId),mint:new _(m.mint.address),notUseTokenAccount:d,owner:this.scope.ownerPubKey,createInfo:d?{payer:n.feePayer||this.scope.ownerPubKey,amount:new Ke(new S(m.perSecond.sub(m.endTime-m.openTime).toFixed(0)).gte(m.perSecond.sub(m.endTime-m.openTime))?m.perSecond.sub(m.endTime-m.openTime).toFixed(0):m.perSecond.sub(m.endTime-m.openTime).add(1).toFixed(0))}:void 0,associatedOnly:d?!1:o,checkCreateATAOwner:s});g&&u.addInstruction(g),f||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let p=t!=null?t:await this.getClmmPoolKeys(e.id),y=ce.setRewardInstructions({poolInfo:e,poolKeys:p,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:f},rewardInfo:{mint:new _(m.mint.address),openTime:m.openTime,endTime:m.endTime,emissionsPerSecondX64:D.decimalToX64(m.perSecond)}});u.addInstruction(y),l=N(N({},l),y.address)}return u.addCustomComputeBudget(a),u.versionBuild({txVersion:c,extInfo:{address:l}})}async collectReward({poolInfo:e,ownerInfo:t,rewardMint:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1}){let s=e.rewardDefaultInfos.find(f=>f.mint.address===n.toString());s||this.logAndCreateError("reward mint error","not found reward mint",n);let a=this.createTxBuilder(),c=t.useSOLBalance&&n.equals(Z),{account:u,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new _(s.mint.programId),mint:n,notUseTokenAccount:c,owner:this.scope.ownerPubKey,skipCloseAccount:!c,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:c?!1:r,checkCreateATAOwner:o});l&&a.addInstruction(l),u||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let m=await this.getClmmPoolKeys(e.id),d=ce.collectRewardInstructions({poolInfo:e,poolKeys:m,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:u},rewardMint:n});return a.addInstruction(d),a.build({address:d.address})}async collectRewards({poolInfo:e,ownerInfo:t,rewardMints:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1}){let s=this.createTxBuilder(),a={};for(let c of n){let u=e.rewardDefaultInfos.find(p=>p.mint.address===c.toString());if(!u){this.logAndCreateError("reward mint error","not found reward mint",c);continue}let l=t.useSOLBalance&&c.equals(Z),{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new _(u.mint.programId),mint:c,notUseTokenAccount:l,owner:this.scope.ownerPubKey,skipCloseAccount:!l,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:l?!1:r,checkCreateATAOwner:o});m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos),d&&s.addInstruction(d);let f=await this.getClmmPoolKeys(e.id),g=ce.collectRewardInstructions({poolInfo:e,poolKeys:f,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardMint:c});s.addInstruction(g),a=N(N({},a),g.address)}return s.build({address:a})}async swap({poolInfo:e,poolKeys:t,inputMint:n,amountIn:r,amountOutMin:o,priceLimit:s,observationId:a,ownerInfo:c,remainingAccounts:u,associatedOnly:l=!0,checkCreateATAOwner:m=!1,txVersion:d,computeBudgetConfig:f}){let g=this.createTxBuilder(),p=n.toString()===e.mintA.address,y=c.useSOLBalance&&e.mintA.address===Z.toBase58(),b=c.useSOLBalance&&e.mintB.address===Z.toBase58(),h;!s||s.equals(new S(0))?h=p?ze.add(new Ke(1)):He.sub(new Ke(1)):h=F.priceToSqrtPriceX64(s,e.mintA.decimals,e.mintB.decimals);let w;if(!w){let{account:P,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new _(e.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,skipCloseAccount:!y,createInfo:y||!p?{payer:c.feePayer||this.scope.ownerPubKey,amount:p?r:0}:void 0,associatedOnly:y?!1:l,checkCreateATAOwner:m});w=P,x&&g.addInstruction(x)}let A;if(!A){let{account:P,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new _(e.mintB.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,skipCloseAccount:!b,createInfo:b||p?{payer:c.feePayer||this.scope.ownerPubKey,amount:p?0:r}:void 0,associatedOnly:b?!1:l,checkCreateATAOwner:m});A=P,x&&g.addInstruction(x)}(!w||!A)&&this.logAndCreateError("user do not have token account",{tokenA:e.mintA.symbol||e.mintA.address,tokenB:e.mintB.symbol||e.mintB.address,ownerTokenAccountA:w,ownerTokenAccountB:A,mintAUseSOLBalance:y,mintBUseSOLBalance:b,associatedOnly:l});let T=t!=null?t:await this.getClmmPoolKeys(e.id);return g.addInstruction(ce.makeSwapBaseInInstructions({poolInfo:e,poolKeys:T,observationId:a,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:w,tokenAccountB:A},inputMint:new _(n),amountIn:r,amountOutMin:o,sqrtPriceLimitX64:h,remainingAccounts:u})),g.addCustomComputeBudget(f),g.versionBuild({txVersion:d})}async swapBaseOut({poolInfo:e,poolKeys:t,outputMint:n,amountOut:r,amountInMax:o,priceLimit:s,observationId:a,ownerInfo:c,remainingAccounts:u,associatedOnly:l=!0,checkCreateATAOwner:m=!1,txVersion:d,computeBudgetConfig:f}){let g=this.createTxBuilder(),p=n.toString()===e.mintB.address,y=c.useSOLBalance&&e.mintA.address===Z.toBase58(),b=c.useSOLBalance&&e.mintB.address===Z.toBase58(),h;!s||s.equals(new S(0))?h=n.toString()===e.mintB.address?ze.add(new Ke(1)):He.sub(new Ke(1)):h=F.priceToSqrtPriceX64(s,e.mintA.decimals,e.mintB.decimals);let w;if(!w){let{account:P,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new _(e.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,skipCloseAccount:!y,createInfo:y||!p?{payer:c.feePayer||this.scope.ownerPubKey,amount:p?o:0}:void 0,associatedOnly:y?!1:l,checkCreateATAOwner:m});w=P,x&&g.addInstruction(x)}let A;if(!A){let{account:P,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new _(e.mintB.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,skipCloseAccount:!b,createInfo:b||p?{payer:c.feePayer||this.scope.ownerPubKey,amount:p?0:o}:void 0,associatedOnly:b?!1:l,checkCreateATAOwner:m});A=P,x&&g.addInstruction(x)}(!w||!A)&&this.logAndCreateError("user do not have token account",{tokenA:e.mintA.symbol||e.mintA.address,tokenB:e.mintB.symbol||e.mintB.address,ownerTokenAccountA:w,ownerTokenAccountB:A,mintAUseSOLBalance:y,mintBUseSOLBalance:b,associatedOnly:l});let T=t!=null?t:await this.getClmmPoolKeys(e.id);return g.addInstruction(ce.makeSwapBaseOutInstructions({poolInfo:e,poolKeys:T,observationId:a,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:w,tokenAccountB:A},outputMint:new _(n),amountOut:r,amountInMax:o,sqrtPriceLimitX64:h,remainingAccounts:u})),g.addCustomComputeBudget(f),g.versionBuild({txVersion:d})}async harvestAllRewards({allPoolInfo:e,allPositions:t,lockInfo:n,ownerInfo:r,associatedOnly:o=!0,checkCreateATAOwner:s=!1,programId:a,txVersion:c,computeBudgetConfig:u}){let l={};for(let d of this.scope.account.tokenAccountRawInfos)o?Re(this.scope.ownerPubKey,d.accountInfo.mint,a).publicKey.equals(d.pubkey)&&(l[d.accountInfo.mint.toString()]=d.pubkey):l[d.accountInfo.mint.toString()]=d.pubkey;let m=this.createTxBuilder();for(let d of Object.values(e)){if(t[d.id]===void 0||!t[d.id].find(A=>!A.liquidity.isZero()||A.rewardInfos.find(T=>!T.rewardAmountOwed.isZero())))continue;let f=d,g=r.useSOLBalance&&f.mintA.address===Z.toString(),p=r.useSOLBalance&&f.mintB.address===Z.toString(),y=l[f.mintA.address];if(!y){let{account:A,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:f.mintA.programId,mint:new _(f.mintA.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,skipCloseAccount:!g,createInfo:{payer:r.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:g?!1:o,checkCreateATAOwner:s});y=A,T&&m.addInstruction(T)}let b=l[f.mintB.address];if(!b){let{account:A,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:f.mintB.programId,mint:new _(f.mintB.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,skipCloseAccount:!p,createInfo:{payer:r.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:p?!1:o,checkCreateATAOwner:s});b=A,T&&m.addInstruction(T)}l[f.mintA.address]=y,l[f.mintB.address]=b;let h=[];for(let A of f.rewardDefaultInfos){let T=r.useSOLBalance&&A.mint.address===Z.toString(),P=l[A.mint.address];if(!P){let{account:x,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new _(A.mint.programId),mint:new _(A.mint.address),notUseTokenAccount:T,owner:this.scope.ownerPubKey,skipCloseAccount:!T,createInfo:{payer:r.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:T?!1:o});P=x,B&&m.addInstruction(B)}l[A.mint.address]=P,h.push(P)}let w=await this.getClmmPoolKeys(f.id);for(let A of t[d.id])if(n&&n[d.id]&&n[d.id][A.nftMint.toBase58()]){let T=ce.harvestLockPositionInstruction({poolKeys:w,owner:this.scope.ownerPubKey,ownerPosition:A,ownerRewardAccounts:h,programId:an,authProgramId:cn,userVaultA:y,userVaultB:b});m.addInstruction({instructions:[T],instructionTypes:[oe.ClmmHarvestLockPosition],lookupTableAddress:w.lookupTableAccount?[w.lookupTableAccount]:[]})}else{let T=ce.decreaseLiquidityInstructions({poolInfo:f,poolKeys:w,ownerPosition:A,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:y,tokenAccountB:b,rewardAccounts:h},liquidity:new Ke(0),amountMinA:new Ke(0),amountMinB:new Ke(0)});m.addInstruction(T)}}return c===0?m.sizeCheckBuildV0({computeBudgetConfig:u}):m.sizeCheckBuild({computeBudgetConfig:u})}async getWhiteListMint({programId:e}){let t=await this.scope.connection.getAccountInfo(Wt(e).publicKey);return t?cr.decode(t.data).whitelistMints.filter(r=>!r.equals(_.default)):[]}async getOwnerPositionInfo({programId:e}){await this.scope.account.fetchWalletTokenAccounts();let n=this.scope.account.tokenAccountRawInfos.filter(s=>s.accountInfo.amount.eq(new Ke(1))).map(s=>Ce(new _(e),s.accountInfo.mint).publicKey),r=await this.scope.connection.getMultipleAccountsInfo(n),o=[];return r.forEach(s=>{if(!s)return;let a=wn.decode(s.data);o.push(a)}),o}async getRpcClmmPoolInfo({poolId:e}){return(await this.getRpcClmmPoolInfos({poolIds:[e]}))[String(e)]}async getRpcClmmPoolInfos({poolIds:e,config:t}){let n=await ot(this.scope.connection,e.map(o=>({pubkey:new _(o)})),t),r={};for(let o=0;o<e.length;o++){let s=n[o];if(s===null||!s.accountInfo)throw Error("fetch pool info error: "+String(e[o]));let a=yn.decode(s.accountInfo.data),c=F.sqrtPriceX64ToPrice(a.sqrtPriceX64,a.mintDecimalsA,a.mintDecimalsB).toNumber();r[String(e[o])]=U(N({},a),{currentPrice:c,programId:s.accountInfo.owner})}return r}async getComputeClmmPoolInfos({clmmPoolsRpcInfo:e,mintInfos:t}){let n=new Set(Object.keys(e).map(c=>e[c].ammConfig.toBase58())),r=await ot(this.scope.connection,Array.from(n).map(c=>({pubkey:new _(c)}))),o={};r.forEach(c=>{!c.accountInfo||(o[c.pubkey.toBase58()]=sr.decode(c.accountInfo.data))});let s=await pe.fetchComputeMultipleClmmInfo({connection:this.scope.connection,rpcDataMap:e,poolList:Object.keys(e).map(c=>{var m,d,f,g;let[u,l]=[e[c].mintA.toBase58(),e[c].mintB.toBase58()];return{id:c,programId:e[c].programId.toBase58(),mintA:qn({address:u,decimals:e[c].mintDecimalsA,programId:t[u].programId.toBase58()||fr.toBase58(),extensions:{feeConfig:(m=t[u])!=null&&m.feeConfig?Wn((d=t[u])==null?void 0:d.feeConfig):void 0}}),mintB:qn({address:l,decimals:e[c].mintDecimalsB,programId:t[l].programId.toBase58()||fr.toBase58(),extensions:{feeConfig:(f=t[l])!=null&&f.feeConfig?Wn((g=t[l])==null?void 0:g.feeConfig):void 0}}),price:e[c].currentPrice,config:U(N({},o[e[c].ammConfig.toBase58()]),{id:e[c].ammConfig.toBase58(),fundFeeRate:0,description:"",defaultRange:0,defaultRangePoint:[]})}})}),a=await pe.fetchMultiplePoolTickArrays({connection:this.scope.connection,poolKeys:Object.values(s)});return{computeClmmPoolInfo:s,computePoolTickData:a}}async getPoolInfoFromRpc(e){var l;let t=await this.getRpcClmmPoolInfo({poolId:e}),n=new Set([t.mintA.toBase58(),t.mintB.toBase58()]),r=await Ti({connection:this.scope.connection,mints:Array.from(n).map(m=>new _(m))}),{computeClmmPoolInfo:o,computePoolTickData:s}=await this.scope.clmm.getComputeClmmPoolInfos({clmmPoolsRpcInfo:{[e]:t},mintInfos:r}),a=await ot(this.scope.connection,[{pubkey:t.vaultA},{pubkey:t.vaultB}]),c=rr(o[e]);if(!a[0].accountInfo||!a[1].accountInfo)throw new Error("pool vault data not found");c.mintAmountA=Number(dr.decode(a[0].accountInfo.data).amount.toString()),c.mintAmountB=Number(dr.decode((l=a[1].accountInfo)==null?void 0:l.data).amount.toString());let u=U(N({},o[e]),{id:e,programId:t.programId.toBase58(),openTime:t.startTime.toString(),vault:{A:t.vaultA.toBase58(),B:t.vaultB.toBase58()},rewardInfos:[],config:c.config});return{poolInfo:c,poolKeys:u,computePoolInfo:o[e],tickData:s}}};export{pr as Clmm};
//# sourceMappingURL=clmm.mjs.map