var br=Object.defineProperty,yr=Object.defineProperties;var wr=Object.getOwnPropertyDescriptors;var Xt=Object.getOwnPropertySymbols;var ri=Object.prototype.hasOwnProperty,oi=Object.prototype.propertyIsEnumerable;var ii=(i,e,t)=>e in i?br(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,N=(i,e)=>{for(var t in e||(e={}))ri.call(e,t)&&ii(i,t,e[t]);if(Xt)for(var t of Xt(e))oi.call(e,t)&&ii(i,t,e[t]);return i},G=(i,e)=>yr(i,wr(e));var gt=(i,e)=>{var t={};for(var n in i)ri.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&Xt)for(var n of Xt(i))e.indexOf(n)<0&&oi.call(i,n)&&(t[n]=i[n]);return t};import{PublicKey as v}from"@solana/web3.js";import Ke from"bn.js";var bt=9e15,rt=1e9,An="0123456789abcdef",Ht="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Yt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Pn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-bt,maxE:bt,crypto:!1},ui,Ze,_=!0,jt="[DecimalError] ",it=jt+"Invalid argument: ",li=jt+"Precision limit exceeded",mi=jt+"crypto unavailable",di="[object Decimal]",ke=Math.floor,ge=Math.pow,Ar=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Pr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,hr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,pi=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,De=1e7,F=7,Tr=9007199254740991,kr=Ht.length-1,hn=Yt.length-1,k={toStringTag:di};k.absoluteValue=k.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),R(i)};k.ceil=function(){return R(new this.constructor(this),this.e+1,2)};k.clampedTo=k.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(it+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};k.comparedTo=k.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,c=o.s,u=i.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==i.e)return o.e>i.e^c<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return n===r?0:n>r^c<0?1:-1};k.cosine=k.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+F,n.rounding=1,t=xr(n,wi(n,t)),n.precision=i,n.rounding=e,R(Ze==2||Ze==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};k.cubeRoot=k.cbrt=function(){var i,e,t,n,r,o,s,a,c,u,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(_=!1,o=l.s*ge(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=Ae(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=ge(t,1/3),i=ke((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(i=m.precision)+3;;)if(a=n,c=a.times(a).times(a),u=c.plus(l),n=ee(u.plus(l).times(a),u.plus(c),s+2,1),Ae(a.d).slice(0,s)===(t=Ae(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(R(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(R(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return _=!0,R(n,i,m.rounding,e)};k.decimalPlaces=k.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-ke(this.e/F))*F,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};k.dividedBy=k.div=function(i){return ee(this,new this.constructor(i))};k.dividedToIntegerBy=k.divToInt=function(i){var e=this,t=e.constructor;return R(ee(e,new t(i),0,1,1),t.precision,t.rounding)};k.equals=k.eq=function(i){return this.cmp(i)===0};k.floor=function(){return R(new this.constructor(this),this.e+1,3)};k.greaterThan=k.gt=function(i){return this.cmp(i)>0};k.greaterThanOrEqualTo=k.gte=function(i){var e=this.cmp(i);return e==1||e===0};k.hyperbolicCosine=k.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/Jt(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=yt(s,1,o.times(e),new s(1),!0);for(var c,u=i,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return R(o,s.precision=t,s.rounding=n,!0)};k.hyperbolicSine=k.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=yt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/Jt(5,i)),r=yt(o,2,r,r,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=t,R(r,e,t,!0)};k.hyperbolicTangent=k.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,ee(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};k.inverseCosine=k.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Ee(t,r,o):new t(0):new t(NaN):e.isZero()?Ee(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=Ee(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};k.inverseHyperbolicCosine=k.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,_=!1,t=t.times(t).minus(1).sqrt().plus(t),_=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};k.inverseHyperbolicSine=k.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,_=!1,t=t.times(t).plus(1).sqrt().plus(t),_=!0,n.precision=i,n.rounding=e,t.ln())};k.inverseHyperbolicTangent=k.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?R(new o(r),i,e,!0):(o.precision=t=n-r.e,r=ee(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};k.inverseSine=k.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=Ee(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};k.inverseTangent=k.atan=function(){var i,e,t,n,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&m+4<=hn)return s=Ee(l,m+4,d).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(m+4<=hn)return s=Ee(l,m+4,d).times(.5),s.s=u.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/F+2|0),i=t;i;--i)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(_=!1,e=Math.ceil(a/F),n=1,c=u.times(u),s=new l(u),r=u;i!==-1;)if(r=r.times(c),o=s.minus(r.div(n+=2)),r=r.times(c),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),_=!0,R(s,l.precision=m,l.rounding=d,!0)};k.isFinite=function(){return!!this.d};k.isInteger=k.isInt=function(){return!!this.d&&ke(this.e/F)>this.d.length-2};k.isNaN=function(){return!this.s};k.isNegative=k.isNeg=function(){return this.s<0};k.isPositive=k.isPos=function(){return this.s>0};k.isZero=function(){return!!this.d&&this.d[0]===0};k.lessThan=k.lt=function(i){return this.cmp(i)<0};k.lessThanOrEqualTo=k.lte=function(i){return this.cmp(i)<1};k.logarithm=k.log=function(i){var e,t,n,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding,p=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new l(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(_=!1,a=m+p,s=nt(u,a),n=e?Zt(l,a+10):nt(i,a),c=ee(s,n,a,1),kt(c.d,r=m,d))do if(a+=10,s=nt(u,a),n=e?Zt(l,a+10):nt(i,a),c=ee(s,n,a,1),!o){+Ae(c.d).slice(r+1,r+15)+1==1e14&&(c=R(c,m+1,0));break}while(kt(c.d,r+=10,d));return _=!0,R(c,m,d)};k.minus=k.sub=function(i){var e,t,n,r,o,s,a,c,u,l,m,d,p=this,g=p.constructor;if(i=new g(i),!p.d||!i.d)return!p.s||!i.s?i=new g(NaN):p.d?i.s=-i.s:i=new g(i.d||p.s!==i.s?p:NaN),i;if(p.s!=i.s)return i.s=-i.s,p.plus(i);if(u=p.d,d=i.d,a=g.precision,c=g.rounding,!u[0]||!d[0]){if(d[0])i.s=-i.s;else if(u[0])i=new g(p);else return new g(c===3?-0:0);return _?R(i,a,c):i}if(t=ke(i.e/F),l=ke(p.e/F),u=u.slice(),o=l-t,o){for(m=o<0,m?(e=u,o=-o,s=d.length):(e=d,t=l,s=u.length),n=Math.max(Math.ceil(a/F),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=u.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(u[n]!=d[n]){m=u[n]<d[n];break}o=0}for(m&&(e=u,u=d,d=e,i.s=-i.s),s=u.length,n=d.length-s;n>0;--n)u[s++]=0;for(n=d.length;n>o;){if(u[--n]<d[n]){for(r=n;r&&u[--r]===0;)u[r]=De-1;--u[r],u[n]+=De}u[n]-=d[n]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(i.d=u,i.e=Qt(u,t),_?R(i,a,c):i):new g(c===3?-0:0)};k.modulo=k.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?R(new n(t),n.precision,n.rounding):(_=!1,n.modulo==9?(e=ee(t,i.abs(),0,3,1),e.s*=i.s):e=ee(t,i,0,n.modulo,1),e=e.times(i),_=!0,t.minus(e))};k.naturalExponential=k.exp=function(){return Tn(this)};k.naturalLogarithm=k.ln=function(){return nt(this)};k.negated=k.neg=function(){var i=new this.constructor(this);return i.s=-i.s,R(i)};k.plus=k.add=function(i){var e,t,n,r,o,s,a,c,u,l,m=this,d=m.constructor;if(i=new d(i),!m.d||!i.d)return!m.s||!i.s?i=new d(NaN):m.d||(i=new d(i.d||m.s===i.s?m:NaN)),i;if(m.s!=i.s)return i.s=-i.s,m.minus(i);if(u=m.d,l=i.d,a=d.precision,c=d.rounding,!u[0]||!l[0])return l[0]||(i=new d(m)),_?R(i,a,c):i;if(o=ke(m.e/F),n=ke(i.e/F),u=u.slice(),r=o-n,r){for(r<0?(t=u,r=-r,s=l.length):(t=l,n=o,s=u.length),o=Math.ceil(a/F),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=u.length,r=l.length,s-r<0&&(r=s,t=l,l=u,u=t),e=0;r;)e=(u[--r]=u[r]+l[r]+e)/De|0,u[r]%=De;for(e&&(u.unshift(e),++n),s=u.length;u[--s]==0;)u.pop();return i.d=u,i.e=Qt(u,n),_?R(i,a,c):i};k.precision=k.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(it+i);return t.d?(e=fi(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};k.round=function(){var i=this,e=i.constructor;return R(new e(i),i.e+1,e.rounding)};k.sine=k.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+F,n.rounding=1,t=Ir(n,wi(n,t)),n.precision=i,n.rounding=e,R(Ze>2?t.neg():t,i,e,!0)):new n(NaN)};k.squareRoot=k.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(_=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=Ae(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=ke((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),n=new l(e)):n=new l(u.toString()),t=(c=l.precision)+3;;)if(o=n,n=o.plus(ee(s,o,t+2,1)).times(.5),Ae(o.d).slice(0,t)===(e=Ae(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(R(o,c+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(R(n,c+1,1),i=!n.times(n).eq(s));break}return _=!0,R(n,c,l.rounding,i)};k.tangent=k.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=ee(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,R(Ze==2||Ze==4?t.neg():t,i,e,!0)):new n(NaN)};k.times=k.mul=function(i){var e,t,n,r,o,s,a,c,u,l=this,m=l.constructor,d=l.d,p=(i=new m(i)).d;if(i.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!i.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?i.s/0:i.s*0);for(t=ke(l.e/F)+ke(i.e/F),c=d.length,u=p.length,c<u&&(o=d,d=p,p=o,s=c,c=u,u=s),o=[],s=c+u,n=s;n--;)o.push(0);for(n=u;--n>=0;){for(e=0,r=c+n;r>n;)a=o[r]+p[n]*d[r-n-1]+e,o[r--]=a%De|0,e=a/De|0;o[r]=(o[r]+e)%De|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=Qt(o,t),_?R(i,m.precision,m.rounding):i};k.toBinary=function(i,e){return xn(this,2,i,e)};k.toDecimalPlaces=k.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Ce(i,0,rt),e===void 0?e=n.rounding:Ce(e,0,8),R(t,i+t.e+1,e))};k.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=We(n,!0):(Ce(i,0,rt),e===void 0?e=r.rounding:Ce(e,0,8),n=R(new r(n),i+1,e),t=We(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};k.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=We(r):(Ce(i,0,rt),e===void 0?e=o.rounding:Ce(e,0,8),n=R(new o(r),i+r.e+1,e),t=We(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};k.toFraction=function(i){var e,t,n,r,o,s,a,c,u,l,m,d,p=this,g=p.d,f=p.constructor;if(!g)return new f(p);if(u=t=new f(1),n=c=new f(0),e=new f(n),o=e.e=fi(g)-p.e-1,s=o%F,e.d[0]=ge(10,s<0?F+s:s),i==null)i=o>0?e:u;else{if(a=new f(i),!a.isInt()||a.lt(u))throw Error(it+a);i=a.gt(e)?o>0?e:u:a}for(_=!1,a=new f(Ae(g)),l=f.precision,f.precision=o=g.length*F*2;m=ee(a,e,0,1,1),r=t.plus(m.times(n)),r.cmp(i)!=1;)t=n,n=r,r=u,u=c.plus(m.times(r)),c=r,r=e,e=a.minus(m.times(r)),a=r;return r=ee(i.minus(t),n,0,1,1),c=c.plus(r.times(u)),t=t.plus(r.times(n)),c.s=u.s=p.s,d=ee(u,n,o,1).minus(p).abs().cmp(ee(c,t,o,1).minus(p).abs())<1?[u,n]:[c,t],f.precision=l,_=!0,d};k.toHexadecimal=k.toHex=function(i,e){return xn(this,16,i,e)};k.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Ce(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(_=!1,t=ee(t,i,0,e,1).times(i),_=!0,R(t)):(i.s=t.s,t=i),t};k.toNumber=function(){return+this};k.toOctal=function(i,e){return xn(this,8,i,e)};k.toPower=k.pow=function(i){var e,t,n,r,o,s,a=this,c=a.constructor,u=+(i=new c(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new c(ge(+a,u));if(a=new c(a),a.eq(1))return a;if(n=c.precision,o=c.rounding,i.eq(1))return R(a,n,o);if(e=ke(i.e/F),e>=i.d.length-1&&(t=u<0?-u:u)<=Tr)return r=gi(c,a,t,n),i.s<0?new c(1).div(r):R(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new c(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=ge(+a,u),e=t==0||!isFinite(t)?ke(u*(Math.log("0."+Ae(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(_=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),r=Tn(i.times(nt(a,n+t)),n),r.d&&(r=R(r,n+5,1),kt(r.d,n,o)&&(e=n+10,r=R(Tn(i.times(nt(a,e+t)),e),e+5,1),+Ae(r.d).slice(n+1,n+15)+1==1e14&&(r=R(r,n+1,0)))),r.s=s,_=!0,c.rounding=o,R(r,n,o))};k.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=We(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Ce(i,1,rt),e===void 0?e=r.rounding:Ce(e,0,8),n=R(new r(n),i,e),t=We(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};k.toSignificantDigits=k.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Ce(i,1,rt),e===void 0?e=n.rounding:Ce(e,0,8)),R(new n(t),i,e)};k.toString=function(){var i=this,e=i.constructor,t=We(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};k.truncated=k.trunc=function(){return R(new this.constructor(this),this.e+1,1)};k.valueOf=k.toJSON=function(){var i=this,e=i.constructor,t=We(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function Ae(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=F-n.length,t&&(o+=tt(t)),o+=n;s=i[e],n=s+"",t=F-n.length,t&&(o+=tt(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Ce(i,e,t){if(i!==~~i||i<e||i>t)throw Error(it+i)}function kt(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=F,r=0):(r=Math.ceil((e+1)/F),e%=F),o=ge(10,F-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==ge(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==ge(10,e-3)-1,s}function zt(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=An.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function xr(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/Jt(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=yt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var ee=function(){function i(n,r,o){var s,a=0,c=n.length;for(n=n.slice();c--;)s=n[c]*r+a,n[c]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(n[a]!=r[a]){c=n[a]>r[a]?1:-1;break}return c}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,c){var u,l,m,d,p,g,f,y,b,A,w,P,T,h,x,B,S,M,L,$,ne=n.constructor,de=n.s==r.s?1:-1,ie=n.d,J=r.d;if(!ie||!ie[0]||!J||!J[0])return new ne(!n.s||!r.s||(ie?J&&ie[0]==J[0]:!J)?NaN:ie&&ie[0]==0||!J?de*0:de/0);for(c?(p=1,l=n.e-r.e):(c=De,p=F,l=ke(n.e/p)-ke(r.e/p)),L=J.length,S=ie.length,b=new ne(de),A=b.d=[],m=0;J[m]==(ie[m]||0);m++);if(J[m]>(ie[m]||0)&&l--,o==null?(h=o=ne.precision,s=ne.rounding):a?h=o+(n.e-r.e)+1:h=o,h<0)A.push(1),g=!0;else{if(h=h/p+2|0,m=0,L==1){for(d=0,J=J[0],h++;(m<S||d)&&h--;m++)x=d*c+(ie[m]||0),A[m]=x/J|0,d=x%J|0;g=d||m<S}else{for(d=c/(J[0]+1)|0,d>1&&(J=i(J,d,c),ie=i(ie,d,c),L=J.length,S=ie.length),B=L,w=ie.slice(0,L),P=w.length;P<L;)w[P++]=0;$=J.slice(),$.unshift(0),M=J[0],J[1]>=c/2&&++M;do d=0,u=e(J,w,L,P),u<0?(T=w[0],L!=P&&(T=T*c+(w[1]||0)),d=T/M|0,d>1?(d>=c&&(d=c-1),f=i(J,d,c),y=f.length,P=w.length,u=e(f,w,y,P),u==1&&(d--,t(f,L<y?$:J,y,c))):(d==0&&(u=d=1),f=J.slice()),y=f.length,y<P&&f.unshift(0),t(w,f,P,c),u==-1&&(P=w.length,u=e(J,w,L,P),u<1&&(d++,t(w,L<P?$:J,P,c))),P=w.length):u===0&&(d++,w=[0]),A[m++]=d,u&&w[0]?w[P++]=ie[B]||0:(w=[ie[B]],P=1);while((B++<S||w[0]!==void 0)&&h--);g=w[0]!==void 0}A[0]||A.shift()}if(p==1)b.e=l,ui=g;else{for(m=1,d=A[0];d>=10;d/=10)m++;b.e=m+l*p-1,R(b,a?o+b.e+1:o,s,g)}return b}}();function R(i,e,t,n){var r,o,s,a,c,u,l,m,d,p=i.constructor;e:if(e!=null){if(m=i.d,!m)return i;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=F,s=e,l=m[d=0],c=l/ge(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/F),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=c=0,r=1,o%=F,s=o-F+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=F,s=o-F+r,c=s<0?0:l/ge(10,r-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%ge(10,r-s-1)),u=t<4?(c||n)&&(t==0||t==(i.s<0?3:2)):c>5||c==5&&(t==4||n||t==6&&(o>0?s>0?l/ge(10,r-s):0:m[d-1])%10&1||t==(i.s<0?8:7)),e<1||!m[0])return m.length=0,u?(e-=i.e+1,m[0]=ge(10,(F-e%F)%F),i.e=-e||0):m[0]=i.e=0,i;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=ge(10,F-o),m[d]=s>0?(l/ge(10,r-s)%ge(10,s)|0)*a:0),u)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,m[0]==De&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=De)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return _&&(i.e>p.maxE?(i.d=null,i.e=NaN):i.e<p.minE&&(i.e=0,i.d=[0])),i}function We(i,e,t){if(!i.isFinite())return yi(i);var n,r=i.e,o=Ae(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+tt(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+tt(-r-1)+o,t&&(n=t-s)>0&&(o+=tt(n))):r>=s?(o+=tt(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+tt(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=tt(n))),o}function Qt(i,e){var t=i[0];for(e*=F;t>=10;t/=10)e++;return e}function Zt(i,e,t){if(e>kr)throw _=!0,t&&(i.precision=t),Error(li);return R(new i(Ht),e,1,!0)}function Ee(i,e,t){if(e>hn)throw Error(li);return R(new i(Yt),e,t,!0)}function fi(i){var e=i.length-1,t=e*F+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function tt(i){for(var e="";i--;)e+="0";return e}function gi(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/F+4);for(_=!1;;){if(t%2&&(o=o.times(e),ai(o.d,s)&&(r=!0)),t=ke(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),ai(e.d,s)}return _=!0,o}function si(i){return i.d[i.d.length-1]&1}function bi(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function Tn(i,e){var t,n,r,o,s,a,c,u=0,l=0,m=0,d=i.constructor,p=d.rounding,g=d.precision;if(!i.d||!i.d[0]||i.e>17)return new d(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(_=!1,c=g):c=e,a=new d(.03125);i.e>-2;)i=i.times(a),m+=5;for(n=Math.log(ge(2,m))/Math.LN10*2+5|0,c+=n,t=o=s=new d(1),d.precision=c;;){if(o=R(o.times(i),c,1),t=t.times(++l),a=s.plus(ee(o,t,c,1)),Ae(a.d).slice(0,c)===Ae(s.d).slice(0,c)){for(r=m;r--;)s=R(s.times(s),c,1);if(e==null)if(u<3&&kt(s.d,c-n,p,u))d.precision=c+=10,t=o=a=new d(1),l=0,u++;else return R(s,d.precision=g,p,_=!0);else return d.precision=g,s}s=a}}function nt(i,e){var t,n,r,o,s,a,c,u,l,m,d,p=1,g=10,f=i,y=f.d,b=f.constructor,A=b.rounding,w=b.precision;if(f.s<0||!y||!y[0]||!f.e&&y[0]==1&&y.length==1)return new b(y&&!y[0]?-1/0:f.s!=1?NaN:y?0:f);if(e==null?(_=!1,l=w):l=e,b.precision=l+=g,t=Ae(y),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(i),t=Ae(f.d),n=t.charAt(0),p++;o=f.e,n>1?(f=new b("0."+t),o++):f=new b(n+"."+t.slice(1))}else return u=Zt(b,l+2,w).times(o+""),f=nt(new b(n+"."+t.slice(1)),l-g).plus(u),b.precision=w,e==null?R(f,w,A,_=!0):f;for(m=f,c=s=f=ee(f.minus(1),f.plus(1),l,1),d=R(f.times(f),l,1),r=3;;){if(s=R(s.times(d),l,1),u=c.plus(ee(s,new b(r),l,1)),Ae(u.d).slice(0,l)===Ae(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(Zt(b,l+2,w).times(o+""))),c=ee(c,new b(p),l,1),e==null)if(kt(c.d,l-g,A,a))b.precision=l+=g,u=s=f=ee(m.minus(1),m.plus(1),l,1),d=R(f.times(f),l,1),r=a=1;else return R(c,b.precision=w,A,_=!0);else return b.precision=w,c;c=u,r+=2}}function yi(i){return String(i.s*i.s/0)}function kn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%F,t<0&&(n+=F),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=F;n<r;)i.d.push(+e.slice(n,n+=F));e=e.slice(n),n=F-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),_&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function Br(i,e){var t,n,r,o,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),pi.test(e))return kn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(Pr.test(e))t=16,e=e.toLowerCase();else if(Ar.test(e))t=2;else if(hr.test(e))t=8;else throw Error(it+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=gi(n,new n(t),o,o*2)),u=zt(e,t,De),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new n(i.s*0):(i.e=Qt(u,l),i.d=u,_=!1,s&&(i=ee(i,r,a*4)),c&&(i=i.times(Math.abs(c)<54?ge(2,c):xt.pow(2,c))),_=!0,i)}function Ir(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:yt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/Jt(5,t)),e=yt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function yt(i,e,t,n,r){var o,s,a,c,u=1,l=i.precision,m=Math.ceil(l/F);for(_=!1,c=t.times(t),a=new i(n);;){if(s=ee(a.times(c),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=ee(s.times(c),new i(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,u++}return _=!0,s.d.length=m+1,s}function Jt(i,e){for(var t=i;--e;)t*=i;return t}function wi(i,e){var t,n=e.s<0,r=Ee(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Ze=n?4:1,e;if(t=e.divToInt(r),t.isZero())Ze=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Ze=si(t)?n?2:3:n?4:1,e;Ze=si(t)?n?1:4:n?3:2}return e.minus(r).abs()}function xn(i,e,t,n){var r,o,s,a,c,u,l,m,d,p=i.constructor,g=t!==void 0;if(g?(Ce(t,1,rt),n===void 0?n=p.rounding:Ce(n,0,8)):(t=p.precision,n=p.rounding),!i.isFinite())l=yi(i);else{for(l=We(i),s=l.indexOf("."),g?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=zt(We(d),10,r),d.e=d.d.length),m=zt(l,10,r),o=c=m.length;m[--c]==0;)m.pop();if(!m[0])l=g?"0p+0":"0";else{if(s<0?o--:(i=new p(i),i.d=m,i.e=o,i=ee(i,d,t,n,0,r),m=i.d,o=i.e,u=ui),s=m[t],a=r/2,u=u||m[t+1]!==void 0,u=n<4?(s!==void 0||u)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||u||n===6&&m[t-1]&1||n===(i.s<0?8:7)),m.length=t,u)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(c=m.length;!m[c-1];--c);for(s=0,l="";s<c;s++)l+=An.charAt(m[s]);if(g){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(m=zt(l,r,e),c=m.length;!m[c-1];--c);for(s=1,l="1.";s<c;s++)l+=An.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function ai(i,e){if(i.length>e)return i.length=e,!0}function Cr(i){return new this(i).abs()}function Sr(i){return new this(i).acos()}function Kr(i){return new this(i).acosh()}function Nr(i,e){return new this(i).plus(e)}function Rr(i){return new this(i).asin()}function Lr(i){return new this(i).asinh()}function Mr(i){return new this(i).atan()}function Or(i){return new this(i).atanh()}function Fr(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=Ee(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?Ee(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=Ee(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(ee(i,e,o,1)),e=Ee(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(ee(i,e,o,1)),t}function Er(i){return new this(i).cbrt()}function Dr(i){return R(i=new this(i),i.e+1,2)}function vr(i,e,t){return new this(i).clamp(e,t)}function _r(i){if(!i||typeof i!="object")throw Error(jt+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,rt,"rounding",0,8,"toExpNeg",-bt,0,"toExpPos",0,bt,"maxE",0,bt,"minE",-bt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=Pn[t]),(n=i[t])!==void 0)if(ke(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(it+t+": "+n);if(t="crypto",r&&(this[t]=Pn[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(mi);else this[t]=!1;else throw Error(it+t+": "+n);return this}function Vr(i){return new this(i).cos()}function qr(i){return new this(i).cosh()}function Ai(i){var e,t,n;function r(o){var s,a,c,u=this;if(!(u instanceof r))return new r(o);if(u.constructor=r,ci(o)){u.s=o.s,_?!o.d||o.e>r.maxE?(u.e=NaN,u.d=null):o.e<r.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;_?s>r.maxE?(u.e=NaN,u.d=null):s<r.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return kn(u,o.toString())}else if(c!=="string")throw Error(it+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),pi.test(o)?kn(u,o):Br(u,o)}if(r.prototype=k,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=_r,r.clone=Ai,r.isDecimal=ci,r.abs=Cr,r.acos=Sr,r.acosh=Kr,r.add=Nr,r.asin=Rr,r.asinh=Lr,r.atan=Mr,r.atanh=Or,r.atan2=Fr,r.cbrt=Er,r.ceil=Dr,r.clamp=vr,r.cos=Vr,r.cosh=qr,r.div=Wr,r.exp=Gr,r.floor=Ur,r.hypot=Xr,r.ln=zr,r.log=Hr,r.log10=Zr,r.log2=Yr,r.max=jr,r.min=Qr,r.mod=Jr,r.mul=$r,r.pow=eo,r.random=to,r.round=no,r.sign=io,r.sin=ro,r.sinh=oo,r.sqrt=so,r.sub=ao,r.sum=co,r.tan=uo,r.tanh=lo,r.trunc=mo,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function Wr(i,e){return new this(i).div(e)}function Gr(i){return new this(i).exp()}function Ur(i){return R(i=new this(i),i.e+1,3)}function Xr(){var i,e,t=new this(0);for(_=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return _=!0,new this(1/0);t=e}return _=!0,t.sqrt()}function ci(i){return i instanceof xt||i&&i.toStringTag===di||!1}function zr(i){return new this(i).ln()}function Hr(i,e){return new this(i).log(e)}function Yr(i){return new this(i).log(2)}function Zr(i){return new this(i).log(10)}function jr(){return bi(this,arguments,"lt")}function Qr(){return bi(this,arguments,"gt")}function Jr(i,e){return new this(i).mod(e)}function $r(i,e){return new this(i).mul(e)}function eo(i,e){return new this(i).pow(e)}function to(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Ce(i,1,rt),n=Math.ceil(i/F),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(mi);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=F,n&&i&&(r=ge(10,F-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=F)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<F&&(t-=F-n)}return s.e=t,s.d=a,s}function no(i){return R(i=new this(i),i.e+1,this.rounding)}function io(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function ro(i){return new this(i).sin()}function oo(i){return new this(i).sinh()}function so(i){return new this(i).sqrt()}function ao(i,e){return new this(i).sub(e)}function co(){var i=0,e=arguments,t=new this(e[i]);for(_=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return _=!0,R(t,this.precision,this.rounding)}function uo(i){return new this(i).tan()}function lo(i){return new this(i).tanh()}function mo(i){return R(i=new this(i),i.e+1,1)}k[Symbol.for("nodejs.util.inspect.custom")]=k.toString;k[Symbol.toStringTag]="Decimal";var xt=k.constructor=Ai(Pn);Ht=new xt(Ht);Yt=new xt(Yt);var C=xt;import{PublicKey as Ti}from"@solana/web3.js";import{get as Pi,set as po}from"lodash";var Bn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},hi={},fo={};function Pe(i){let e=Pi(hi,i);if(!e){let t=Pi(fo,i);e=new Bn({name:i,logLevel:t}),po(hi,i,e)}return e}import{MINT_SIZE as go,TOKEN_PROGRAM_ID as bo,getTransferFeeConfig as yo,unpackMint as wo}from"@solana/spl-token";var In=Pe("Raydium_accountInfo_util");async function je(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}=N({batchRequest:!1},t),s=Cn(e,o),a=new Array(s.length).fill([]);if(n){let c=s.map(m=>{let d=i._buildArgs([m.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),u=Cn(c,10);a=(await(await Promise.all(u.map(async m=>await i._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&In.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:p,executable:g,lamports:f,owner:y,rentEpoch:b}=d;return p.length!==2&&p[1]!=="base64"&&In.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:g,lamports:f,owner:new Ti(y),rentEpoch:b}}return null})))}else try{a=await Promise.all(s.map(c=>i.getMultipleAccountsInfo(c,r)))}catch(c){c instanceof Error&&In.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function ot(i,e,t){let n=await je(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>G(N({},r),{accountInfo:n[o]}))}async function ki({connection:i,mints:e,config:t}){var o,s,a;if(e.length===0)return{};let n=await ot(i,e.map(c=>({pubkey:lt(c)})),t),r={};for(let c of n){if(!c.accountInfo||c.accountInfo.data.length<go){console.log("invalid mint account",c.pubkey.toBase58());continue}let u=wo(c.pubkey,c.accountInfo,(o=c.accountInfo)==null?void 0:o.owner);r[c.pubkey.toString()]=G(N({},u),{programId:((s=c.accountInfo)==null?void 0:s.owner)||bo,feeConfig:(a=yo(u))!=null?a:void 0})}return r[Ti.default.toBase58()]=r[Z.toBase58()],r}import Qe from"bn.js";import Io from"big.js";import tn from"bn.js";import Ao from"toformat";var Po=Ao,Bt=Po;import en from"big.js";import To from"bn.js";import ko from"decimal.js-light";import It from"bn.js";var xi=9007199254740991;function ye(i){let e=Pe("Raydium_parseBigNumberish");if(i instanceof It)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new It(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=xi||i<=-xi)&&e.logWithError(`BigNumberish number overflow: ${i}`),new It(String(i))):typeof i=="bigint"?new It(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new It(0))}var $t=Pe("module/fraction"),Sn=Bt(en),Ct=Bt(ko),xo={[0]:Ct.ROUND_DOWN,[1]:Ct.ROUND_HALF_UP,[2]:Ct.ROUND_UP},Bo={[0]:en.roundDown,[1]:en.roundHalfUp,[2]:en.roundUp},j=class{constructor(e,t=new To(1)){this.numerator=ye(e),this.denominator=ye(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new j(this.denominator,this.numerator)}add(e){let t=e instanceof j?e:new j(ye(e));return this.denominator.eq(t.denominator)?new j(this.numerator.add(t.numerator),this.denominator):new j(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof j?e:new j(ye(e));return this.denominator.eq(t.denominator)?new j(this.numerator.sub(t.numerator),this.denominator):new j(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof j?e:new j(ye(e));return new j(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof j?e:new j(ye(e));return new j(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||$t.logWithError(`${e} is not an integer.`),e<=0&&$t.logWithError(`${e} is not positive.`),Ct.set({precision:e+1,rounding:xo[n]});let r=new Ct(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||$t.logWithError(`${e} is not an integer.`),e<0&&$t.logWithError(`${e} is negative.`),Sn.DP=e,Sn.RM=Bo[n]||1,new Sn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Co=Pe("Raydium_amount"),Bi=Bt(Io);function So(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):Co.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var he=class extends j{constructor(t,n,r=!0,o){let s=new tn(0),a=Kn.pow(new tn(t.decimals));if(r)s=ye(n);else{let c=new tn(0),u=new tn(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=So(n.toString(),t.decimals);c=ye(l),u=ye(m)}c=c.mul(a),s=c.add(u)}super(s,a);this.logger=Pe(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new he(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new he(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return Bi.DP=this.token.decimals,new Bi(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as Ko}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ii}from"@solana/spl-token";var Nn={chainId:101,address:Ko.default.toBase58(),programId:Ii.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},st={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Ii.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Mn}from"@solana/web3.js";import{PublicKey as oe,SystemProgram as Ci,SYSVAR_RENT_PUBKEY as No}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ro}from"@solana/spl-token";function Rn({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var da=[Rn({pubkey:Ro,isWritable:!1}),Rn({pubkey:Ci.programId,isWritable:!1}),Rn({pubkey:No,isWritable:!1})];function Ln({publicKey:i,transformSol:e}){let t=Si(i.toString());if(t instanceof oe)return e&&t.equals(St)?Z:t;if(e&&t.toString()===St.toBase58())return Z;if(typeof t=="string"){if(t===oe.default.toBase58())return oe.default;try{return new oe(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Si(i){try{return new oe(i)}catch{return i}}var nn=new oe("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ki=new oe("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Kt=new oe("SysvarRent111111111111111111111111111111111"),pa=new oe("SysvarC1ock11111111111111111111111111111111"),wt=new oe("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),fa=new oe("Sysvar1nstructions1111111111111111111111111"),ga=Ci.programId,ba=new oe("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),ya=new oe("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),wa=new oe("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Aa=new oe("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Pa=new oe("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),ha=new oe("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Ta=new oe("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),ka=new oe("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),xa=new oe("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ba=new oe("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ia=new oe("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Z=new oe("So11111111111111111111111111111111111111112"),St=oe.default;function lt(i){return Ln({publicKey:i,transformSol:!0})}var On=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===St.toBase58()||e instanceof Mn&&St.equals(e)){this.decimals=st.decimals,this.symbol=st.symbol,this.name=st.name,this.mint=new Mn(st.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?Mn.default:Ln({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ge=On;Ge.WSOL=new On(G(N({},st),{mint:st.address}));var Fn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},rn=Fn;rn.SOL=new Fn(Nn);import Lo from"bn.js";var Ni=new j(new Lo(100)),at=class extends j{toSignificant(e=5,t,n){return this.mul(Ni).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Ni).toFixed(e,t,n)}};var Mo=Pe("Raydium_price"),ve=class extends j{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new j(En(n.decimals),En(r.decimals))}get raw(){return new j(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new ve({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Mo.logWithError("mul token not equals");let n=super.mul(t);return new ve({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};import{PublicKey as rc}from"@solana/web3.js";import sc from"bn.js";var Oo=new Qe(0),xc=new Qe(1),Bc=new Qe(2),Ic=new Qe(3),Cc=new Qe(5),Kn=new Qe(10),Sc=new Qe(100),Kc=new Qe(1e3),Nc=new Qe(1e4);function En(i){return Kn.pow(ye(i))}function Cn(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as qo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Wo}from"@solana/spl-token";import{ComputeBudgetProgram as Ri,Keypair as Mi,PublicKey as Fo,Transaction as Oi,TransactionMessage as Eo,VersionedTransaction as Fi}from"@solana/web3.js";var ae={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{TOKEN_PROGRAM_ID as Do}from"@solana/spl-token";var Li=Pe("Raydium_txUtil"),Ei=1644;function on(i){let e=[],t=[];return i.microLamports&&(e.push(Ri.setComputeUnitPrice({microLamports:i.microLamports})),t.push(ae.SetComputeUnitPrice)),i.units&&(e.push(Ri.setComputeUnitLimit({units:i.units})),t.push(ae.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function At(i,e){var n,r;let t=e!=null?e:"confirmed";return(r=await((n=i.getLatestBlockhash)==null?void 0:n.call(i,{commitment:t})))==null?void 0:r.blockhash}async function sn(i,e){return i.getSignatureStatuses([e]),new Promise((t,n)=>{let r=setTimeout(n,6e4);i.onSignature(e,o=>{if(clearTimeout(r),!o.err){t("");return}n(o.err.toString())},"confirmed")})}function vo(i,e){i.length<1&&Li.logWithError(`no instructions provided: ${i.toString()}`),e.length<1&&Li.logWithError(`no signers provided:, ${e.toString()}`);let t=new Oi;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...i);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Ei}catch{return!1}}function Be(i,e){let[t,n]=Fo.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function Nt({instructions:i,payer:e,signers:t}){return vo(i,[e,...t])}function Rt({instructions:i,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=Mi.generate().publicKey.toString()}){let o=new Eo({payerKey:e,recentBlockhash:n,instructions:i}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Fi(o).serialize()).toString("base64").length<Ei}catch{return!1}}var _o=i=>Buffer.isBuffer(i)?i:i instanceof Uint8Array?Buffer.from(i.buffer,i.byteOffset,i.byteLength):Buffer.from(i),Vo=i=>{let e=i.serialize({requireAllSignatures:!1,verifySignatures:!1});i instanceof Fi&&(e=_o(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function mt(i){let e=[];return i.forEach(t=>{t instanceof Oi&&(t.recentBlockhash||(t.recentBlockhash=Do.toBase58()),t.feePayer||(t.feePayer=Mi.generate().publicKey)),e.push(Vo(t))}),console.log("simulate tx string:",e),e}function Le(i,e,t){return Be([i.toBuffer(),(t!=null?t:Wo).toBuffer(),e.toBuffer()],new qo("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as U}from"@solana/web3.js";var Qc=new U("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Jc=new U("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),$c=new U("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),eu=new U("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),tu=new U("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),nu=new U("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),iu=new U("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),ru=new U("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),ou=new U("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Di=new U("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),an=new U("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),cn=new U("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),su=new U("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),au=new U("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),cu=new U("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),uu=new U("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),lu=new U("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),mu=new U("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),du=new U("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),pu=new U("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),fu=new U("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Go=new U("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Uo=new U("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Xo=new U("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");var gu={SERUM_MARKET:U.default,OPENBOOK_MARKET:new U("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:U.default,FarmV3:new U("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new U("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new U("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new U("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new U("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new U("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new U("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new U("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new U("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Go,CREATE_CPMM_POOL_AUTH:Uo,CREATE_CPMM_POOL_FEE_ACC:Xo,FEE_DESTINATION_ID:new U("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import _e from"bn.js";var Lt=1e4;function se(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=G(N({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new _e(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Lt){let c=new _e(o.maximumFee.toString());return{amount:i.add(c),fee:c,expirationTime:a}}else{let c=Dn(i.mul(new _e(Lt)),new _e(Lt-o.transferFeeBasisPoints)),u=new _e(o.maximumFee.toString()),l=c.sub(i).gt(u)?i.add(u):c,m=Dn(l.mul(new _e(o.transferFeeBasisPoints)),new _e(Lt)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let c=Dn(i.mul(new _e(o.transferFeeBasisPoints)),new _e(Lt)),u=c.gt(s)?s:c;return{amount:i,fee:u,expirationTime:a}}}function ct(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function Dn(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new _e(0))?t.add(new _e(1)):t}import{PublicKey as vi,AddressLookupTableAccount as un}from"@solana/web3.js";async function vn({connection:i,address:e}){let t=await je(i,[...new Set(e.map(r=>r.toString()))].map(r=>new vi(r))),n={};for(let r=0;r<e.length;r++){let o=t[r],s=e[r];if(!o)continue;let a=new un({key:s,state:un.deserialize(o.data)});n[s.toString()]=a,ln[s.toString()]=a}return n}var ln={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new un({key:new vi("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:un.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as Mt,sendAndConfirmTransaction as _n,Transaction as Ot,TransactionMessage as Ft,VersionedTransaction as Et}from"@solana/web3.js";import Ho from"axios";var mn=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.api=e.api}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Ho.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=on(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Mt.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(N({},t||{})):this.build(t)}build(e){var n;let t=new Ot;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(r=>r.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{var u;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a}=r||{},c=o!=null?o:await At(this.connection,this.blockhashCommitment);if(t.recentBlockhash=c,this.signers.length&&t.sign(...this.signers),mt([t]),(u=this.owner)!=null&&u.isKeyPair)return{txId:a?await _n(this.connection,t,this.signers.find(m=>m.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let l=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:r}=this.build(n),o=t.filter(l=>l.transaction.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async l=>{var y;let{sequentially:m,onTxUpdate:d,recentBlockHash:p,skipPreflight:g=!0}=l||{},f=p!=null?p:await At(this.connection,this.blockhashCommitment);if((y=this.owner)!=null&&y.isKeyPair){if(m){let b=[];for(let A of s){let w=await _n(this.connection,A,this.signers.find(P=>P.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g});b.push(w)}return{txIds:b,signedTxs:s}}return{txIds:await await Promise.all(s.map(async b=>(b.recentBlockhash=f,await this.connection.sendRawTransaction(b.serialize(),{skipPreflight:g})))),signedTxs:s}}if(this.signAllTransactions){let b=s.map((w,P)=>(w.recentBlockhash=f,a[P].length&&w.sign(...a[P]),w));mt(b);let A=await this.signAllTransactions(b);if(m){let w=0,P=[],T=async()=>{if(!A[w])return;let h=await this.connection.sendRawTransaction(A[w].serialize(),{skipPreflight:g});P.push({txId:h,status:"sent",signedTx:A[w]}),d==null||d([...P]),w++,this.connection.onSignature(h,x=>{let B=P.findIndex(S=>S.txId===h);B>-1&&(P[B].status=x.err?"error":"success"),d==null||d([...P]),x.err||T()},"processed"),this.connection.getSignatureStatus(h)};return await T(),{txIds:P.map(h=>h.txId),signedTxs:A}}else{let w=[];for(let P=0;P<A.length;P+=1){let T=await this.connection.sendRawTransaction(A[P].serialize(),{skipPreflight:g});w.push(T)}return{txIds:w,signedTxs:A}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var f;let g=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:r,recentBlockhash:o}=g,s=gt(g,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=N(N({},this.cluster==="devnet"?{}:ln),t),c=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let y of c)a[y]===void 0&&u.push(new Mt(y));let l=await vn({connection:this.connection,address:u});for(let[y,b]of Object.entries(l))a[y]=b;let m=r?Mt.default.toBase58():o!=null?o:await At(this.connection,this.blockhashCommitment),d=new Ft({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((f=this.owner)==null?void 0:f.signer)&&!this.signers.some(y=>y.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let p=new Et(d);return p.sign(this.signers),{builder:this,transaction:p,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async y=>{var w;let{skipPreflight:b=!0,sendAndConfirm:A}=y||{};if(mt([p]),(w=this.owner)!=null&&w.isKeyPair){let P=await this.connection.sendTransaction(p,{skipPreflight:b});return A&&await sn(this.connection,P),{txId:P,signedTx:p}}if(this.signAllTransactions){let P=await this.signAllTransactions([p]);return{txId:await this.connection.sendTransaction(P[0],{skipPreflight:b}),signedTx:P[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:r}=await this.buildV0(n),o=t.filter(l=>l.builder.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,m)=>{l.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async l=>{var f;let{sequentially:m,onTxUpdate:d,recentBlockHash:p,skipPreflight:g=!0}=l||{};if(p&&s.forEach(y=>y.message.recentBlockhash=p),mt(s),(f=this.owner)!=null&&f.isKeyPair){if(m){let y=[];for(let b of s){let A=await this.connection.sendTransaction(b,{skipPreflight:g});await sn(this.connection,A),y.push(A)}return{txIds:y,signedTxs:s}}return{txIds:await Promise.all(s.map(async y=>await this.connection.sendTransaction(y,{skipPreflight:g}))),signedTxs:s}}if(this.signAllTransactions){let y=await this.signAllTransactions(s);if(m){let b=0,A=[],w=async()=>{if(!y[b])return;let P=await this.connection.sendTransaction(y[b],{skipPreflight:g});A.push({txId:P,status:"sent",signedTx:y[b]}),d==null||d([...A]),b++,this.connection.onSignature(P,T=>{let h=A.findIndex(x=>x.txId===P);h>-1&&(A[h].status=T.err?"error":"success"),d==null||d([...A]),T.err||w()},"processed"),this.connection.getSignatureStatus(P)};return w(),{txIds:[],signedTxs:y}}else{let b=[];for(let A=0;A<y.length;A+=1){let w=await this.connection.sendTransaction(y[A],{skipPreflight:g});b.push(w)}return{txIds:b,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var l;let u=e||{},{computeBudgetConfig:t}=u,n=gt(u,["computeBudgetConfig"]),r=t?on(t):{instructions:[],instructionTypes:[]},o=this.signers.reduce((m,d)=>G(N({},m),{[d.publicKey.toBase58()]:d}),{}),s=[],a=[],c=[];if(this.allInstructions.forEach(m=>{let d=[...c,m],p=t?[...r.instructions,...d]:d,f=[...new Set(d.map(y=>y.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat()).values()].map(y=>new Mt(y));if(c.length<12&&Nt({instructions:p,payer:this.feePayer,signers:f})||Nt({instructions:d,payer:this.feePayer,signers:f}))c.push(m);else{if(c.length===0)throw Error("item ins too big");Nt({instructions:t?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:f})?s.push(new Ot().add(...r.instructions,...c)):s.push(new Ot().add(...c)),a.push(Array.from(new Set(c.map(y=>y.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat())).map(y=>o[y]).filter(y=>y!==void 0)),c=[m]}}),c.length>0){let d=[...new Set(c.map(p=>p.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(p=>o[p]).filter(p=>p!==void 0);Nt({instructions:t?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:d.map(p=>p.publicKey)})?s.push(new Ot().add(...r.instructions,...c)):s.push(new Ot().add(...c)),a.push(d)}return s.forEach(m=>m.feePayer=this.feePayer),(l=this.owner)!=null&&l.signer&&a.forEach(m=>{m.some(d=>d.publicKey.equals(this.owner.publicKey))||m.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async m=>{var b;let{sequentially:d,onTxUpdate:p,recentBlockHash:g,skipPreflight:f=!0}=m||{},y=g!=null?g:await At(this.connection,this.blockhashCommitment);if(s.forEach(async(A,w)=>{A.recentBlockhash=y,a[w].length&&A.sign(...a[w])}),mt(s),(b=this.owner)!=null&&b.isKeyPair){if(d){let A=[];for(let w of s){let P=await _n(this.connection,w,this.signers.find(T=>T.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f});A.push(P)}return{txIds:A,signedTxs:s}}return{txIds:await Promise.all(s.map(async A=>await this.connection.sendRawTransaction(A.serialize(),{skipPreflight:f}))),signedTxs:s}}if(this.signAllTransactions){let A=await this.signAllTransactions(s);if(d){let w=0,P=[],T=async()=>{if(!A[w])return;let h=await this.connection.sendRawTransaction(A[w].serialize(),{skipPreflight:f});P.push({txId:h,status:"sent",signedTx:A[w]}),p==null||p([...P]),w++,this.connection.onSignature(h,x=>{let B=P.findIndex(S=>S.txId===h);B>-1&&(P[B].status=x.err?"error":"success"),p==null||p([...P]),x.err||T()},"processed"),this.connection.getSignatureStatus(h)};return await T(),{txIds:P.map(h=>h.txId),signedTxs:A}}else{let w=[];for(let P=0;P<A.length;P+=1){let T=await this.connection.sendRawTransaction(A[P].serialize(),{skipPreflight:f});w.push(T)}return{txIds:w,signedTxs:A}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuildV0(e){var b;let y=e||{},{computeBudgetConfig:t,lookupTableCache:n={},lookupTableAddress:r=[]}=y,o=gt(y,["computeBudgetConfig","lookupTableCache","lookupTableAddress"]),s=N(N({},this.cluster==="devnet"?{}:ln),n),a=Array.from(new Set([...this.lookupTableAddress,...r])),c=[];for(let A of a)s[A]===void 0&&c.push(new Mt(A));let u=await vn({connection:this.connection,address:c});for(let[A,w]of Object.entries(u))s[A]=w;let l=t?on(t):{instructions:[],instructionTypes:[]},m=await At(this.connection,this.blockhashCommitment),d=this.signers.reduce((A,w)=>G(N({},A),{[w.publicKey.toBase58()]:w}),{}),p=[],g=[],f=[];if(this.allInstructions.forEach(A=>{let w=[...f,A],P=t?[...l.instructions,...w]:w;if(f.length<12&&Rt({instructions:P,payer:this.feePayer,lookupTableAddressAccount:s})||Rt({instructions:w,payer:this.feePayer,lookupTableAddressAccount:s}))f.push(A);else{if(f.length===0)throw Error("item ins too big");let T={};for(let h of[...new Set(a)])s[h]!==void 0&&(T[h]=s[h]);if(t&&Rt({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let h=new Ft({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new Et(h))}else{let h=new Ft({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new Et(h))}g.push(Array.from(new Set(f.map(h=>h.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat())).map(h=>d[h]).filter(h=>h!==void 0)),f=[A]}}),f.length>0){let w=[...new Set(f.map(P=>P.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat()).values()].map(P=>d[P]).filter(P=>P!==void 0);if(t&&Rt({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let P=new Ft({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new Et(P))}else{let P=new Ft({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new Et(P))}g.push(w)}return(b=this.owner)!=null&&b.signer&&g.forEach(A=>{A.some(w=>w.publicKey.equals(this.owner.publicKey))||A.push(this.owner.signer)}),{builder:this,transactions:p,buildProps:e,signers:g,instructionTypes:this.instructionTypes,execute:async A=>{var x;let{sequentially:w,onTxUpdate:P,recentBlockHash:T,skipPreflight:h=!0}=A||{};if(p.map(async(B,S)=>{g[S].length&&B.sign(g[S]),T&&(B.message.recentBlockhash=T)}),mt(p),(x=this.owner)!=null&&x.isKeyPair){if(w){let B=[];for(let S of p){let M=await this.connection.sendTransaction(S,{skipPreflight:h});await sn(this.connection,M),B.push(M)}return{txIds:B,signedTxs:p}}return{txIds:await Promise.all(p.map(async B=>await this.connection.sendTransaction(B,{skipPreflight:h}))),signedTxs:p}}if(this.signAllTransactions){let B=await this.signAllTransactions(p);if(w){let S=0,M=[],L=async()=>{if(!B[S])return;let $=await this.connection.sendTransaction(B[S],{skipPreflight:h});M.push({txId:$,status:"sent",signedTx:B[S]}),P==null||P([...M]),S++,this.connection.onSignature($,ne=>{let de=M.findIndex(ie=>ie.txId===$);de>-1&&(M[de].status=ne.err?"error":"success"),P==null||P([...M]),ne.err||L()},"processed"),this.connection.getSignatureStatus($)};return L(),{txIds:[],signedTxs:B}}else{let S=[];for(let M=0;M<B.length;M+=1){let L=await this.connection.sendTransaction(B[M],{skipPreflight:h});S.push(L)}return{txIds:S,signedTxs:B}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}};import{AccountLayout as fr,TOKEN_PROGRAM_ID as gr}from"@solana/spl-token";import{PublicKey as el}from"@solana/web3.js";import{MintLayout as nl,TOKEN_PROGRAM_ID as rl}from"@solana/spl-token";var Vn=r=>{var o=r,{address:i,programId:e,decimals:t}=o,n=gt(o,["address","programId","decimals"]);return N({chainId:101,address:lt(i).toBase58(),programId:e,logoURI:"",symbol:"",name:"",decimals:t,tags:[],extensions:n.extensions||{}},n)},qn=i=>i?G(N({},i),{transferFeeConfigAuthority:i.transferFeeConfigAuthority.toBase58(),withdrawWithheldAuthority:i.withdrawWithheldAuthority.toBase58(),withheldAmount:i.withheldAmount.toString(),olderTransferFee:G(N({},i.olderTransferFee),{epoch:i.olderTransferFee.epoch.toString(),maximumFee:i.olderTransferFee.maximumFee.toString()}),newerTransferFee:G(N({},i.newerTransferFee),{epoch:i.newerTransferFee.epoch.toString(),maximumFee:i.newerTransferFee.maximumFee.toString()})}):void 0;var Wn=(...i)=>i.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Dt=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=Pe(t)}createTxBuilder(e){return this.scope.checkOwner(),new mn({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Wn(e))}logInfo(...e){this.logger.info(Wn(e))}logAndCreateError(...e){let t=Wn(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{Keypair as ei,PublicKey as I,SystemProgram as Tt,TransactionInstruction as Re}from"@solana/web3.js";import mr from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as dr,TOKEN_2022_PROGRAM_ID as et,TOKEN_PROGRAM_ID as me}from"@solana/spl-token";import{PublicKey as ns}from"@solana/web3.js";import Wi,{isBN as Gi}from"bn.js";import{bits as gl,BitStructure as bl,blob as Yo,Blob as yl,cstr as wl,f32 as Al,f32be as Pl,f64 as hl,f64be as Tl,greedy as kl,Layout as Zo,ns64 as xl,ns64be as Bl,nu64 as Il,nu64be as Cl,offset as Sl,s16 as Kl,s16be as Nl,s24 as Rl,s24be as Ll,s32 as jo,s32be as Ml,s40 as Ol,s40be as Fl,s48 as El,s48be as Dl,s8 as vl,seq as Qo,struct as _l,Structure as Jo,u16 as $o,u16be as Vl,u24 as ql,u24be as Wl,u32 as Gl,u32be as Ul,u40 as Xl,u40be as zl,u48 as Hl,u48be as Yl,u8 as es,UInt as ts,union as Zl,Union as jl,unionLayoutDiscriminator as Ql,utf8 as Jl}from"@solana/buffer-layout";var Gn=Zo,_i=Jo;var Un=ts;var Vi=es,vt=$o;var Te=jo;var qi=Qo;var Me=Yo;var Pt=class extends Gn{constructor(t,n,r){super(t,r);this.blob=Me(t),this.signed=n}decode(t,n=0){let r=new Wi(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new Wi(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function pe(i){return new Un(1,i)}function ht(i){return new Un(4,i)}function E(i){return new Pt(8,!1,i)}function H(i){return new Pt(16,!1,i)}function Ui(i){return new Pt(8,!0,i)}function Xi(i){return new Pt(16,!0,i)}var dn=class extends Gn{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function ce(i){return new dn(Me(32),e=>new ns(e),e=>e.toBuffer(),i)}function Ue(i){return new dn(Vi(),is,rs,i)}function is(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function rs(i){return i?1:0}var Xn=class extends _i{decode(e,t){return super.decode(e,t)}};function te(i,e,t){return new Xn(i,e,t)}function ue(i,e,t){let n,r=typeof e=="number"?e:Gi(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=Gi(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return qi(i,r,t)}import ys from"bn.js";import Oe from"bn.js";var Y=new Oe(0),Xe=new Oe(1),Je=new Oe(-1),Ne=new Oe(1).shln(64),pn=new Oe(1).shln(128),zn=Ne.sub(Xe),_t=64,zi=pn.subn(1),xe=-443636,Ie=-xe,ze=new Oe("4295048016"),He=new Oe("79226673521066979257578248091"),dm=new Oe("4295048017"),pm=new Oe("79226673521066979257578248090"),Hi=16,Yi="59543866431248",Zi="184467440737095516",ji="15793534762490258745",fn=new Oe(10).pow(new Oe(6)),os=(n=>(n[n.rate_500=500]="rate_500",n[n.rate_3000=3e3]="rate_3000",n[n.rate_10000=1e4]="rate_10000",n))(os||{}),fm={[500]:10,[3e3]:60,[1e4]:200},gm={version:6,liquidity:Y,tickCurrent:0,feeGrowthGlobalX64A:Y,feeGrowthGlobalX64B:Y,protocolFeesTokenA:Y,protocolFeesTokenB:Y,swapInAmountTokenA:Y,swapOutAmountTokenB:Y,swapInAmountTokenB:Y,swapOutAmountTokenA:Y,tickArrayBitmap:[],rewardInfos:[],day:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},week:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},month:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},tvl:0},Qi={tvl:0,volumeQuote:0,mintAmountA:0,mintAmountB:0,rewardDefaultInfos:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,day:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},week:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},month:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},pooltype:[]},bm=new Oe("18446744073700000000");import W from"bn.js";function Ji(i){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,i,!1),new Uint8Array(e)}function wm(i){let e=new ArrayBuffer(2);return new DataView(e).setInt16(0,i,!1),new Uint8Array(e)}function Am(i){let e=new ArrayBuffer(4);return new DataView(e).setUint32(0,i,!1),new Uint8Array(e)}function gn(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function Hn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Yn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function Vt(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function $i(i,e){return Vt(i,e)?null:Hn(i,e)}function er(i,e){return Vt(i,e)?null:Yn(i,e)}var ss=Buffer.from("amm_config","utf8"),as=Buffer.from("pool","utf8"),cs=Buffer.from("pool_vault","utf8"),us=Buffer.from("pool_reward_vault","utf8"),tr=Buffer.from("position","utf8"),ls=Buffer.from("tick_array","utf8"),ms=Buffer.from("operation","utf8"),ds=Buffer.from("pool_tick_array_bitmap_extension","utf8"),ps=Buffer.from("observation","utf8");function km(i,e){return Be([ss,Ji(e)],i)}function nr(i,e,t,n){return Be([as,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function Zn(i,e,t){return Be([cs,e.toBuffer(),t.toBuffer()],i)}function ir(i,e,t){return Be([us,e.toBuffer(),t.toBuffer()],i)}function Q(i,e,t){return Be([ls,e.toBuffer(),gn(t)],i)}function ut(i,e,t,n){return Be([tr,e.toBuffer(),gn(t),gn(n)],i)}function Se(i,e){return Be([tr,e.toBuffer()],i)}function bn(i){return Be([Buffer.from("metadata","utf8"),wt.toBuffer(),i.toBuffer()],wt)}function qt(i){return Be([ms],i)}function Fe(i,e){return Be([ds,e.toBuffer()],i)}function rr(i,e){return Be([ps,e.toBuffer()],i)}var fs=Buffer.from("locked_position","utf8");function jn(i,e){return Be([fs,e.toBuffer()],i)}import{PublicKey as Ve}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as or}from"@solana/spl-token";import re from"bn.js";import Ye from"bn.js";var Wt=class{static getfeeGrowthInside(e,t,n){let r=new Ye(0),o=new Ye(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new Ye(0),a=new Ye(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let c=D.wrappingSubU128(D.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),u=D.wrappingSubU128(D.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:c,feeGrowthInsideBX64:u}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=D.mulDivFloor(D.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ne),c=t.tokenFeesOwedA.add(a),u=D.mulDivFloor(D.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ne),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=D.mulDivFloor(D.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ne),c=t.tokenFeesOwedA.add(a),u=D.mulDivFloor(D.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ne),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=D.wrappingSubU128(c,u.growthInsideLastX64),m=D.mulDivFloor(l,t.liquidity,Ne),d=u.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=D.wrappingSubU128(c,u.growthInsideLastX64),m=D.mulDivFloor(l,t.liquidity,Ne),d=u.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new Ye(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new Ye(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(D.wrappingSubU128(D.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new Ye(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new Ye(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(D.wrappingSubU128(D.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var y,b,A,w;let a=O.priceToSqrtPriceX64(new C(e.price),e.mintA.decimals,e.mintB.decimals),c=O.getSqrtPriceX64FromTick(t.tickLower),u=O.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,m=X.getAmountsFromLiquidity(a,c,u,n,o),[d,p]=[se(m.amountA,(y=e.mintA.extensions)==null?void 0:y.feeConfig,s,!0),se(m.amountB,(b=e.mintB.extensions)==null?void 0:b.feeConfig,s,!0)],[g,f]=[se(new Ye(new C(m.amountA.toString()).mul(l).toFixed(0)),(A=e.mintA.extensions)==null?void 0:A.feeConfig,s,!0),se(new Ye(new C(m.amountB.toString()).mul(l).toFixed(0)),(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:p,amountSlippageA:g,amountSlippageB:f,expirationTime:ct(d.expirationTime,p.expirationTime)}}};var gs=15,z=class{static async getTickArrays(e,t,n,r,o,s,a){let c=[],u=K.getTickArrayStartIndexByTick(r,o),l=K.getInitializedTickArrayInRange(s,a,o,u,Math.floor(gs/2));for(let p=0;p<l.length;p++){let{publicKey:g}=Q(t,n,l[p]);c.push(g)}let m=(await je(e,c)).map(p=>p!==null?Gt.decode(p.data):null),d={};for(let p=0;p<c.length;p++){let g=m[p];g!==null&&(d[g.startTickIndex]=G(N({},g),{address:c[p]}))}return d}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(u=K.getNextTickArrayStartIndex(u,o,s),this.checkIsValidStartIndex(u,o))throw new Error("No enough initialized tickArray");let l=n[u];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:p}=this.firstInitializedTickInOneArray(e,t,l,s);[a,c,u]=[m,d,p]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/z.tickCount(t)),a=n?K.searchLowBitFromStart(r,o,s-1,1,t):K.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=be-1;for(;a>=0;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a-1}}else{let a=0;for(;a<be;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a+1}}let{publicKey:s}=Q(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=K.getTickArrayStartIndexByTick(r,o),c=Math.floor((r-a)/o),u=n[a];if(u==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;c>=0;){let d=u.ticks[c];if(d.liquidityGross.gtn(0)){l=d;break}c=c-1}else for(c=c+1;c<be;){let d=u.ticks[c];if(d.liquidityGross.gtn(0)){l=d;break}c=c+1}let{publicKey:m}=Q(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:u.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(K.checkIsOutOfBoundary(e)){if(e>Ie)return!1;let n=K.getTickArrayStartIndexByTick(xe,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return be*e}};var Qn=14,$e=class{static maxTickInTickarrayBitmap(e){return e*be*dt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!z.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-z.tickCount(n):t+z.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*be,c=s/a+512;s<0&&s%a!=0&&c--;let u=Math.abs(c);if(r){let l=e.shln(1024-u-1),m=$i(1024,l);if(m!==null){let d=(u-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(u),m=er(1024,l);if(m!==null){let d=(u+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-z.tickCount(n)}}}},Ut=class{static getBitmapOffset(e,t){if(!z.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=$e.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=$e.maxTickInTickarrayBitmap(e),n=-t;if(Ie<=t)throw Error(`extensionTickBoundary check error: ${Ie}, ${t}`);if(n<=xe)throw Error(`extensionTickBoundary check error: ${n}, ${xe}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:K.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=z.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=$e.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let c=K.mergeTickArrayBitmap(e).shln(dt-1-a),u=Vt(512,c)?null:Hn(512,c);if(u!==null){let l=t-u*z.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let c=K.mergeTickArrayBitmap(e).shrn(a),u=Vt(512,c)?null:Yn(512,c);if(u!==null){let l=t+u*z.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-z.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%$e.maxTickInTickarrayBitmap(t),r=Math.floor(n/z.tickCount(t));return e<0&&n!=0&&(r=dt-r),r}};var fe=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,s=!1){let a=n.toBase58()===e.mintA.address,c=[],{isExist:u,startIndex:l,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,a);if(!u||l===void 0||!m)throw new Error("Invalid tick array");c.push(m);let{allTrade:d,amountCalculated:p,accounts:g,sqrtPriceX64:f,feeAmount:y}=pt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,o,s);return c.push(...g),{allTrade:d,expectedAmountOut:p.mul(Je),remainingAccounts:c,executionPrice:f,feeAmount:y}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:c,startIndex:u,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!c||u===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:y}=Q(e.programId,e.id,f.nextStartIndex);a.push(y)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:g}=pt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(Je),u,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:p,feeAmount:g}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=fe.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Ut.checkTickArrayIsInit(z.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):K.checkTickArrayIsInitialized(K.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=Q(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,z.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=Q(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/z.tickCount(e.tickSpacing)),r=t?K.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):K.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=z.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=$e.nextInitializedTickArrayStartIndex(K.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Ut.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<xe||t>Ie)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,c,u;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(u=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?u:(c=await e.getAccountInfo(m.tokenMint))==null?void 0:c.owner;if(d===void 0)throw Error("get new reward mint info error");let p=G(N({},m),{perSecond:D.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Ve(d)});if(p.tokenMint.equals(Ve.default))continue;if(n<=p.openTime.toNumber()||r.eq(Y)){s.push(p);continue}let g=new re(Math.min(p.endTime.toNumber(),n)),f=g.sub(p.lastUpdateTime),y=D.mulDivFloor(f,p.emissionsPerSecondX64,r),b=p.rewardGrowthGlobalX64.add(y),A=D.mulDivFloor(f,p.emissionsPerSecondX64,Ne),w=p.rewardTotalEmissioned.add(A);s.push(G(N({},p),{rewardGrowthGlobalX64:b,rewardTotalEmissioned:w,lastUpdateTime:g}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=K.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=$e.maxTickInTickarrayBitmap(e),n=-t;return t>Ie&&(t=z.getArrayStartIndex(Ie,e)+z.tickCount(e)),n<xe&&(n=z.getArrayStartIndex(xe,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!z.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/z.tickCount(t)*dt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await ot(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=ar.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let c of t){let u=K.getTickArrayStartIndexByTick(c.tickCurrent,c.tickSpacing),l=K.getInitializedTickArrayInRange(c.tickArrayBitmap,c.exBitmapInfo,c.tickSpacing,u,7);for(let m of l){let{publicKey:d}=Q(c.programId,c.id,m);o.push({pubkey:d}),r[d.toString()]=c.id}}let s=await ot(e,o,{batchRequest:n}),a={};for(let c of s){if(!c.accountInfo)continue;let u=r[c.pubkey.toString()];if(!u)continue;a[u.toString()]===void 0&&(a[u.toString()]={});let l=Gt.decode(c.accountInfo.data);a[u.toString()][l.startTickIndex]=G(N({},l),{address:c.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let c=0;c<e.length;c++){let u=e[c];u!==null&&(s.find(l=>l.equals(u.state.programId))||s.push(u.state.programId))}if(n){let c=n.tokenAccounts.map(d=>d.accountInfo.mint),u=[];for(let d of c)for(let p of s)u.push(Se(p,d).publicKey);let l=await je(t,u,{batchRequest:r}),m={};for(let d of l){if(d===null)continue;let p=wn.decode(d.data),g=p.poolId.toString(),f=e.find(B=>B.state.id.toBase58()===g);if(f===void 0)continue;let y=f.state,b=K._getTickPriceLegacy({poolInfo:y,tick:p.tickLower,baseIn:!0}),A=K._getTickPriceLegacy({poolInfo:y,tick:p.tickUpper,baseIn:!0}),{amountA:w,amountB:P}=X.getAmountsFromLiquidity(y.sqrtPriceX64,b.tickSqrtPriceX64,A.tickSqrtPriceX64,p.liquidity,!1),T=1/(1-Math.sqrt(Math.sqrt(b.price.div(A.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:p.poolId,nftMint:p.nftMint,priceLower:b.price,priceUpper:A.price,amountA:w,amountB:P,tickLower:p.tickLower,tickUpper:p.tickUpper,liquidity:p.liquidity,feeGrowthInsideLastX64A:p.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:p.feeGrowthInsideLastX64B,tokenFeesOwedA:p.tokenFeesOwedA,tokenFeesOwedB:p.tokenFeesOwedB,rewardInfos:p.rewardInfos.map(B=>G(N({},B),{pendingReward:new re(0)})),leverage:T,tokenFeeAmountA:new re(0),tokenFeeAmountB:new re(0)}];let h=await K.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickLower,f.state.tickSpacing),x=await K.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickUpper,f.state.tickSpacing);m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickLower}`]=h,m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickUpper}`]=x}if(o){let d=Object.values(m),p=await je(t,d,{batchRequest:r}),g={};for(let f=0;f<d.length;f++){let y=p[f];if(y===null)continue;let b=d[f].toString();g[b]=Gt.decode(y.data)}for(let{state:f,positionAccount:y}of e)if(!!y)for(let b of y){let A=`${f.programId.toString()}-${f.id.toString()}-${b.tickLower}`,w=`${f.programId.toString()}-${f.id.toString()}-${b.tickUpper}`,P=g[m[A].toString()],T=g[m[w].toString()],h=P.ticks[K.getTickOffsetInArray(b.tickLower,f.tickSpacing)],x=T.ticks[K.getTickOffsetInArray(b.tickUpper,f.tickSpacing)],{tokenFeeAmountA:B,tokenFeeAmountB:S}=await Wt.GetPositionFees(f,b,h,x),M=await Wt.GetPositionRewards(f,b,h,x);b.tokenFeeAmountA=B.gte(new re(0))?B:new re(0),b.tokenFeeAmountB=S.gte(new re(0))?S:new re(0);for(let L=0;L<M.length;L++)b.rewardInfos[L].pendingReward=M[L].gte(new re(0))?M[L]:new re(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new C(0),catchLiquidityInsufficient:c=!1}){var $;let u,l=n.toBase58()===e.mintA.address,[m,d]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new C(0))?u=l?ze.add(new re(1)):He.sub(new re(1)):u=O.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let p=se(o,m,r,!1),{allTrade:g,expectedAmountOut:f,remainingAccounts:y,executionPrice:b,feeAmount:A}=fe.getOutputAmountAndRemainAccounts(e,t,n,p.amount.sub(($=p.fee)!=null?$:Y),u,c),w=se(f,d,r,!1),P=O.sqrtPriceX64ToPrice(b,e.mintA.decimals,e.mintB.decimals),T=l?P:new C(1).div(P),h=f.mul(new re(Math.floor((1-s)*1e10))).div(new re(1e10)),x=se(h,d,r,!1),B=l?e.currentPrice:new C(1).div(e.currentPrice),S=new C(T).sub(B).abs(),M=B,L=new at(new C(S).mul(10**15).toFixed(0),new C(M).mul(10**15).toFixed(0));return{allTrade:g,realAmountIn:p,amountOut:w,minAmountOut:x,expirationTime:ct(p.expirationTime,w.expirationTime),currentPrice:e.currentPrice,executionPrice:T,priceImpact:L,fee:A,remainingAccounts:y,executionPriceX64:b}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let c=r.address===e.mintB.address,[u,l]=c?[e.mintA,e.mintB]:[e.mintB,e.mintA],[m,d]=[new Ge(G(N({},u),{mint:u.address,isToken2022:u.programId===or.toBase58()})),new Ge(G(N({},l),{mint:l.address,isToken2022:l.programId===or.toBase58()}))],{allTrade:p,realAmountIn:g,amountOut:f,minAmountOut:y,expirationTime:b,currentPrice:A,executionPrice:w,priceImpact:P,fee:T,remainingAccounts:h,executionPriceX64:x}=fe.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Ve(u.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),B=G(N({},g),{amount:new he(m,g.amount),fee:g.fee===void 0?void 0:new he(m,g.fee)}),S=G(N({},f),{amount:new he(d,f.amount),fee:f.fee===void 0?void 0:new he(d,f.fee)}),M=G(N({},y),{amount:new he(d,y.amount),fee:y.fee===void 0?void 0:new he(d,y.fee)}),L=new ve({baseToken:m,denominator:new re(10).pow(new re(20+m.decimals)),quoteToken:d,numerator:A.mul(new C(10**(20+d.decimals))).toFixed(0)}),$=new ve({baseToken:m,denominator:new re(10).pow(new re(20+m.decimals)),quoteToken:d,numerator:w.mul(new C(10**(20+d.decimals))).toFixed(0)}),ne=new he(m,T);return{allTrade:p,realAmountIn:B,amountOut:S,minAmountOut:M,expirationTime:b,currentPrice:L,executionPrice:$,priceImpact:P,fee:ne,remainingAccounts:h,executionPriceX64:x}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:o,slippage:s,priceLimit:a=new C(0)}){var M;let c=n.toBase58()===e.mintA.address,u={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;a.equals(new C(0))?l=c?He.sub(new re(1)):ze.add(new re(1)):l=O.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let m=se(o,u[n.toString()],r,!0),{expectedAmountIn:d,remainingAccounts:p,executionPrice:g,feeAmount:f}=fe.getInputAmountAndRemainAccounts(e,t,n,m.amount.sub((M=m.fee)!=null?M:Y),l),y=c?e.mintB.address:e.mintA.address,b=se(d,u[y],r,!1),A=O.sqrtPriceX64ToPrice(g,e.mintA.decimals,e.mintB.decimals),w=c?A:new C(1).div(A),P=d.mul(new re(Math.floor((1+s)*1e10))).div(new re(1e10)),T=se(P,u[y],r,!0),h=c?e.currentPrice:new C(1).div(e.currentPrice),x=new C(w).sub(h).abs(),B=h,S=new at(new C(x).mul(10**15).toFixed(0),new C(B).mul(10**15).toFixed(0));return{amountIn:b,maxAmountIn:T,realAmountOut:m,expirationTime:ct(b.expirationTime,m.expirationTime),currentPrice:e.currentPrice,executionPrice:w,priceImpact:S,fee:f,remainingAccounts:p}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var g,f,y;let o=e[t],s=K.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=K.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),c=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-c,m=a-s,d=o.priceMax-o.priceMin,p;return l<=0?p=0:m===l?p=d/l:d===l?p=l/m:p=l/d*(l/m),{feeApr:o.feeApr*p,rewardsApr:[((g=o.rewardApr[0])!=null?g:0)*p,((f=o.rewardApr[1])!=null?f:0)*p,((y=o.rewardApr[2])!=null?y:0)*p],apr:o.apr*p}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:c}){let u=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=r[lt(e.mintA.address).toString()],d=r[lt(e.mintB.address).toString()],p=e.mintA.decimals,g=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=O.priceToSqrtPriceX64(new C(e.price),e.mintA.decimals,e.mintB.decimals),y=O.getSqrtPriceX64FromTick(s),b=O.getSqrtPriceX64FromTick(a),{amountSlippageA:A,amountSlippageB:w}=X.getAmountsFromLiquidityWithSlippage(f,y,b,t,!1,!1,0),{amountSlippageA:P,amountSlippageB:T}=X.getAmountsFromLiquidityWithSlippage(f,y,b,o,!1,!1,0),h=new C(A.toString()).div(new C(10).pow(p)).mul(m.value).add(new C(w.toString()).div(new C(10).pow(g)).mul(d.value)),x=new C(P.toString()).div(new C(10).pow(p)).mul(m.value).add(new C(T.toString()).div(new C(10).pow(g)).mul(d.value)),B=new C(1).div(h.add(x)),M=new C(l.volumeFee).mul(365).div(u).mul(B).mul(100).toNumber(),L=3600*24*365,$=e.rewardDefaultInfos.map(ne=>{var J,ni;let de=ne.mint.decimals,ie=r[ne.mint.address];return c<((J=ne.startTime)!=null?J:0)||c>((ni=ne.endTime)!=null?ni:0)||!ne.perSecond||!ie||de===void 0?0:new C(ie.value).mul(new C(ne.perSecond).mul(L)).div(new C(10).pow(de)).mul(B).mul(100).toNumber()});return{feeApr:M,rewardsApr:$,apr:M+$.reduce((ne,de)=>ne+de,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:c,amountHasFee:u}){var b,A;let l=O.priceToSqrtPriceX64(new C(e.price),e.mintA.decimals,e.mintB.decimals),m=O.getSqrtPriceX64FromTick(n),d=O.getSqrtPriceX64FromTick(r),p=a?1-s:1+s,g=se(o,(b=e[t?"mintA":"mintB"].extensions)==null?void 0:b.feeConfig,c,!u),f=new re(new C(g.amount.sub((A=g.fee)!=null?A:Y).toString()).mul(p).toFixed(0)),y;if(l.lte(m))y=t?X.getLiquidityFromTokenAmountA(m,d,f,!a):new re(0);else if(l.lte(d)){let w=X.getLiquidityFromTokenAmountA(l,d,f,!a),P=X.getLiquidityFromTokenAmountB(m,l,f);y=t?w:P}else y=t?new re(0):X.getLiquidityFromTokenAmountB(m,d,f);return fe.getAmountsFromLiquidity({epochInfo:c,poolInfo:e,tickLower:n,tickUpper:r,liquidity:y,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var y,b,A,w;let c=O.getSqrtPriceX64FromTick(n),u=O.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,m=X.getAmountsFromLiquidity(O.priceToSqrtPriceX64(new C(t.price),t.mintA.decimals,t.mintB.decimals),c,u,o,a),[d,p]=[se(m.amountA,(y=t.mintA.extensions)==null?void 0:y.feeConfig,e,!0),se(m.amountB,(b=t.mintB.extensions)==null?void 0:b.feeConfig,e,!0)],[g,f]=[se(m.amountA.muln(l),(A=t.mintA.extensions)==null?void 0:A.feeConfig,e,!0),se(m.amountB.muln(l),(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:p,amountSlippageA:g,amountSlippageB:f,expirationTime:ct(d.expirationTime,p.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(c=>!n[c.id]).map(c=>new Ve(c.id));(await je(e,r)).forEach((c,u)=>{!c||(n[r[u].toBase58()]=yn.decode(c.data))});let s=t.map(c=>Fe(new Ve(c.programId),new Ve(c.id)).publicKey),a=await fe.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((c,u)=>G(N({},c),{[u.id]:G(N({},n[u.id]),{id:new Ve(u.id),version:6,programId:new Ve(u.programId),mintA:u.mintA,mintB:u.mintB,ammConfig:G(N({},u.config),{id:new Ve(u.config.id),fundOwner:""}),currentPrice:new C(u.price),exBitmapInfo:a[Fe(new Ve(u.programId),new Ve(u.id)).publicKey.toBase58()],startTime:n[u.id].startTime.toNumber()})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};function cd({poolInfo:i,tickLower:e,tickUpper:t,amountA:n,amountB:r,slippage:o,add:s,epochInfo:a,amountHasFee:c}){var w,P,T,h;let[u,l,m,d]=e<t?[e,t,n,r]:[t,e,r,n],p=O.priceToSqrtPriceX64(new C(i.price),i.mintA.decimals,i.mintB.decimals),g=O.getSqrtPriceX64FromTick(u),f=O.getSqrtPriceX64FromTick(l),[y,b]=[se(m,(w=i.mintA.extensions)==null?void 0:w.feeConfig,a,!c),se(d,(P=i.mintB.extensions)==null?void 0:P.feeConfig,a,!c)],A=X.getLiquidityFromTokenAmounts(p,g,f,y.amount.sub((T=y.fee)!=null?T:Y),b.amount.sub((h=b.fee)!=null?h:Y));return X.getAmountsOutFromLiquidity({poolInfo:i,tickLower:e,tickUpper:t,liquidity:A,slippage:o,add:s,epochInfo:a,amountAddFee:!c})}var Jn={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]};function sr(i){return G(N({},i),{type:"Concentrated",programId:i.programId.toString(),id:i.id.toString(),rewardDefaultInfos:[],rewardDefaultPoolInfos:"Clmm",price:i.currentPrice.toNumber(),mintAmountA:0,mintAmountB:0,feeRate:i.ammConfig.tradeFeeRate,openTime:i.startTime.toString(),tvl:0,day:Jn,week:Jn,month:Jn,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,burnPercent:0,config:G(N({},i.ammConfig),{id:i.ammConfig.id.toString(),defaultRange:0,defaultRangePoint:[]})})}var D=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(Y)||(o=o.add(Xe)),o}static mulDivFloor(e,t,n){if(n.eq(Y))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(Y))throw new Error("division by 0");return e.mul(t).add(n.sub(Xe)).div(n)}static x64ToDecimal(e,t){return new C(e.toString()).div(C.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new W(e.mul(C.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(pn).sub(t).mod(pn)}};function we(i,e){return $n(i.mul(e),64,256)}function bs(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function $n(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var O=class{static sqrtPriceX64ToPrice(e,t,n){return D.x64ToDecimal(e).pow(2).mul(C.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return D.decimalToX64(e.mul(C.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(Y))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(Y))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(Y))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(Y))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(Y))return e;let o=t.shln(_t);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?D.mulDivCeil(s,e,a):D.mulDivRoundingUp(s,Xe,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return D.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(_t);if(r)return e.add(o.div(t));{let s=D.mulDivRoundingUp(o,Xe,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<xe||e>Ie)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new W("18445821805675395072"):new W("18446744073709551616");return(t&2)!=0&&(n=we(n,new W("18444899583751176192"))),(t&4)!=0&&(n=we(n,new W("18443055278223355904"))),(t&8)!=0&&(n=we(n,new W("18439367220385607680"))),(t&16)!=0&&(n=we(n,new W("18431993317065453568"))),(t&32)!=0&&(n=we(n,new W("18417254355718170624"))),(t&64)!=0&&(n=we(n,new W("18387811781193609216"))),(t&128)!=0&&(n=we(n,new W("18329067761203558400"))),(t&256)!=0&&(n=we(n,new W("18212142134806163456"))),(t&512)!=0&&(n=we(n,new W("17980523815641700352"))),(t&1024)!=0&&(n=we(n,new W("17526086738831433728"))),(t&2048)!=0&&(n=we(n,new W("16651378430235570176"))),(t&4096)!=0&&(n=we(n,new W("15030750278694412288"))),(t&8192)!=0&&(n=we(n,new W("12247334978884435968"))),(t&16384)!=0&&(n=we(n,new W("8131365268886854656"))),(t&32768)!=0&&(n=we(n,new W("3584323654725218816"))),(t&65536)!=0&&(n=we(n,new W("696457651848324352"))),(t&131072)!=0&&(n=we(n,new W("26294789957507116"))),(t&262144)!=0&&(n=we(n,new W("37481735321082"))),e>0&&(n=zi.div(n)),n}static getTickFromPrice(e,t,n){return O.getTickFromSqrtPriceX64(O.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(He)||e.lt(ze))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new W(t-64),r=bs(n,32,128),o=new W("8000000000000000","hex"),s=0,a=new W(0),c=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new W(0))&&s<Hi;){c=c.mul(c);let g=c.shrn(127);c=c.shrn(63+g.toNumber()),a=a.add(o.mul(g)),o=o.shrn(1),s+=1}let u=a.shrn(32),m=r.add(u).mul(new W(Yi)),d=$n(m.sub(new W(Zi)),64,128).toNumber(),p=$n(m.add(new W(ji)),64,128).toNumber();return d==p?d:O.getSqrtPriceX64FromTick(p).lte(e)?p:d}},ft=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=O.getTickFromSqrtPriceX64(O.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=ft.getTickWithPriceAndTickspacing(e,t,n,r),s=O.getSqrtPriceX64FromTick(o);return O.sqrtPriceX64ToPrice(s,n,r)}},X=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(Y))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(_t),s=t.sub(e);return r?D.mulDivRoundingUp(D.mulDivCeil(o,s,t),Xe,e):D.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(Y))throw new Error("sqrtPriceX64A must greater than 0");return r?D.mulDivCeil(n,t.sub(e),Ne):D.mulDivFloor(n,t.sub(e),Ne)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?D.mulDivRoundingUp(a,Xe,zn):a.shrn(_t)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),D.mulDivFloor(n,zn,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return X.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=X.getLiquidityFromTokenAmountA(e,n,r,!1),a=X.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return X.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:X.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new W(0)};if(e.lt(n)){let s=X.getTokenAmountAFromLiquidity(e,n,r,o),a=X.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new W(0),amountB:X.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:c,amountB:u}=X.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,m=new W(new C(c.toString()).mul(l).toFixed(0)),d=new W(new C(u.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:c}){var A,w,P,T;let u=O.priceToSqrtPriceX64(new C(e.price),e.mintA.decimals,e.mintB.decimals),l=O.getSqrtPriceX64FromTick(t),m=O.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,p=X.getAmountsFromLiquidity(u,l,m,r,s),[g,f]=[se(p.amountA,(A=e.mintA.extensions)==null?void 0:A.feeConfig,a,c),se(p.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,a,c)],[y,b]=[se(new W(new C(p.amountA.toString()).mul(d).toFixed(0)),(P=e.mintA.extensions)==null?void 0:P.feeConfig,a,c),se(new W(new C(p.amountB.toString()).mul(d).toFixed(0)),(T=e.mintB.extensions)==null?void 0:T.feeConfig,a,c)];return{liquidity:r,amountA:g,amountB:f,amountSlippageA:y,amountSlippageB:b,expirationTime:ct(g.expirationTime,f.expirationTime)}}},pt=class{static swapCompute(e,t,n,r,o,s,a,c,u,l,m,d,p,g,f=!1){if(d.eq(Y))throw new Error("amountSpecified must not be 0");if(g||(g=s?ze.add(Xe):He.sub(Xe)),s){if(g.lt(ze))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(g.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(g.gt(He))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(g.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let y=d.gt(Y),b={amountSpecifiedRemaining:d,amountCalculated:Y,sqrtPriceX64:m,tick:u>p?Math.min(p+z.tickCount(l)-1,u):p,accounts:[],liquidity:c,feeAmount:new W(0)},A=p,w=n[p],P=0,T=!s&&w.startTickIndex===b.tick;for(;!b.amountSpecifiedRemaining.eq(Y)&&!b.sqrtPriceX64.eq(g);){P>10;let h={};h.sqrtPriceStartX64=b.sqrtPriceX64;let x=K.nextInitTick(w,b.tick,l,s,T),B=x||null,S=null;if(!(B!=null&&B.liquidityGross.gtn(0))){let L=fe.nextInitializedTickArrayStartIndex({tickCurrent:b.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},A,s);if(!L.isExist){if(f)return{allTrade:!1,amountSpecifiedRemaining:b.amountSpecifiedRemaining,amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts};throw Error("swapCompute LiquidityInsufficient")}A=L.nextStartIndex;let{publicKey:$}=Q(e,t,A);S=$,w=n[A];try{B=K.firstInitializedTick(w,s)}catch{throw Error("not found next tick info")}}h.tickNext=B.tick,h.initialized=B.liquidityGross.gtn(0),p!==A&&S&&(b.accounts.push(S),p=A),h.tickNext<xe?h.tickNext=xe:h.tickNext>Ie&&(h.tickNext=Ie),h.sqrtPriceNextX64=O.getSqrtPriceX64FromTick(h.tickNext);let M;if(s&&h.sqrtPriceNextX64.lt(g)||!s&&h.sqrtPriceNextX64.gt(g)?M=g:M=h.sqrtPriceNextX64,[b.sqrtPriceX64,h.amountIn,h.amountOut,h.feeAmount]=pt.swapStepCompute(b.sqrtPriceX64,M,b.liquidity,b.amountSpecifiedRemaining,a),b.feeAmount=b.feeAmount.add(h.feeAmount),y?(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.sub(h.amountIn.add(h.feeAmount)),b.amountCalculated=b.amountCalculated.sub(h.amountOut)):(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.add(h.amountOut),b.amountCalculated=b.amountCalculated.add(h.amountIn.add(h.feeAmount))),b.sqrtPriceX64.eq(h.sqrtPriceNextX64)){if(h.initialized){let L=B.liquidityNet;s&&(L=L.mul(Je)),b.liquidity=X.addDelta(b.liquidity,L)}T=h.tickNext!=b.tick&&!s&&w.startTickIndex===h.tickNext,b.tick=s?h.tickNext-1:h.tickNext}else if(b.sqrtPriceX64!=h.sqrtPriceStartX64){let L=O.getTickFromSqrtPriceX64(b.sqrtPriceX64);T=L!=b.tick&&!s&&w.startTickIndex===L,b.tick=L}++P}try{let{nextStartIndex:h,isExist:x}=z.nextInitializedTickArray(b.tick,l,s,r,o);x&&p!==h&&(b.accounts.push(Q(e,t,h).publicKey),p=h)}catch{}return{allTrade:!0,amountSpecifiedRemaining:Y,amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new W(0),amountIn:new W(0),amountOut:new W(0),feeAmount:new W(0)},a=e.gte(t),c=r.gte(Y);if(c){let l=D.mulDivFloor(r,fn.sub(new W(o.toString())),fn);s.amountIn=a?X.getTokenAmountAFromLiquidity(t,e,n,!0):X.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=O.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?X.getTokenAmountBFromLiquidity(t,e,n,!1):X.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(Je).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=O.getNextSqrtPriceX64FromOutput(e,n,r.mul(Je),a);let u=t.eq(s.sqrtPriceX64Next);return a?(u&&c||(s.amountIn=X.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),u&&!c||(s.amountOut=X.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=u&&c?s.amountIn:X.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=u&&!c?s.amountOut:X.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!c&&s.amountOut.gt(r.mul(Je))&&(s.amountOut=r.mul(Je)),c&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=D.mulDivCeil(s.amountIn,new W(o),fn.sub(new W(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var be=60,dt=512,K=class{static getTickArrayAddressByTick(e,t,n,r){let o=K.getTickArrayStartIndexByTick(n,r),{publicKey:s}=Q(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=K.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=be)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=z.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*z.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*be,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*be,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*be:e+t*be}static mergeTickArrayBitmap(e){let t=new ys(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*be));return[...K.searchLowBitFromStart(e,t,s-1,o,n),...K.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return K.searchHightBitFromStart(e,t,0,dt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=K.getAllInitializedTickArrayStartIndex(n,r,o);for(let c of a){let{publicKey:u}=Q(e,t,c);s.push({tickArrayStartIndex:c,tickArrayAddress:u})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>K.mergeTickArrayBitmap(u)),a=[];for(;n>=-7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n--,a.length===r)break}let c=z.tickCount(o);return a.map(u=>u*c)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>K.mergeTickArrayBitmap(u)),a=[];for(;n<7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n++,a.length===r)break}let c=z.tickCount(o);return a.map(u=>u*c)}static checkIsOutOfBoundary(e){return e<xe||e>Ie}static nextInitTick(e,t,n,r,o){if(z.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<be;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=be-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<be;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=O.getSqrtPriceX64FromTick(t),o=O.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new C(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new C(1).div(t),o=ft.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=O.getSqrtPriceX64FromTick(o),a=O.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new C(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=O.getSqrtPriceX64FromTick(t),o=O.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new C(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new C(1).div(t),o=ft.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=O.getSqrtPriceX64FromTick(o),a=O.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new C(1).div(a)}}};var cr=te([Me(8),pe("bump"),vt("index"),ce(""),ht("protocolFeeRate"),ht("tradeFeeRate"),vt("tickSpacing"),ue(E(),8,"")]),ws=te([ht("blockTimestamp"),Ui("tickCumulative"),ue(E(),4)]),ur=te([Me(8),Ue("initialized"),E("recentEpoch"),vt("observationIndex"),ce("poolId"),ue(ws,100,"observations"),ue(E(),4)]),As=te([pe("rewardState"),E("openTime"),E("endTime"),E("lastUpdateTime"),H("emissionsPerSecondX64"),E("rewardTotalEmissioned"),E("rewardClaimed"),ce("tokenMint"),ce("tokenVault"),ce("creator"),H("rewardGrowthGlobalX64")]),yn=te([Me(8),pe("bump"),ce("ammConfig"),ce("creator"),ce("mintA"),ce("mintB"),ce("vaultA"),ce("vaultB"),ce("observationId"),pe("mintDecimalsA"),pe("mintDecimalsB"),vt("tickSpacing"),H("liquidity"),H("sqrtPriceX64"),Te("tickCurrent"),ht(),H("feeGrowthGlobalX64A"),H("feeGrowthGlobalX64B"),E("protocolFeesTokenA"),E("protocolFeesTokenB"),H("swapInAmountTokenA"),H("swapOutAmountTokenB"),H("swapInAmountTokenB"),H("swapOutAmountTokenA"),pe("status"),ue(pe(),7,""),ue(As,3,"rewardInfos"),ue(E(),16,"tickArrayBitmap"),E("totalFeesTokenA"),E("totalFeesClaimedTokenA"),E("totalFeesTokenB"),E("totalFeesClaimedTokenB"),E("fundFeesTokenA"),E("fundFeesTokenB"),E("startTime"),ue(E(),15*4-3,"padding")]),Ps=te([H("growthInsideLastX64"),E("rewardAmountOwed")]),wn=te([Me(8),pe("bump"),ce("nftMint"),ce("poolId"),Te("tickLower"),Te("tickUpper"),H("liquidity"),H("feeGrowthInsideLastX64A"),H("feeGrowthInsideLastX64B"),E("tokenFeesOwedA"),E("tokenFeesOwedB"),ue(Ps,3,"rewardInfos"),ue(E(),8,"")]),Ld=te([Me(8),pe("bump"),ce("poolId"),Te("tickLowerIndex"),Te("tickUpperIndex"),H("liquidity"),H("feeGrowthInsideLastX64A"),H("feeGrowthInsideLastX64B"),E("tokenFeesOwedA"),E("tokenFeesOwedB"),ue(H(),3,"rewardGrowthInside"),ue(E(),8,"")]),hs=te([Te("tick"),Xi("liquidityNet"),H("liquidityGross"),H("feeGrowthOutsideX64A"),H("feeGrowthOutsideX64B"),ue(H(),3,"rewardGrowthsOutsideX64"),ue(ht(),13,"")]),Gt=te([Me(8),ce("poolId"),Te("startTickIndex"),ue(hs,be,"ticks"),pe("initializedTickCount"),ue(pe(),115,"")]),lr=te([Me(329),ue(ce(),100,"whitelistMints")]),ar=te([Me(8),ce("poolId"),ue(ue(E(),8),Qn,"positiveTickArrayBitmap"),ue(ue(E(),8),Qn,"negativeTickArrayBitmap")]),Md=te([E(),pe("bump"),ce("owner"),ce("poolId"),ce("positionId"),ce("nftAccount"),ue(E(),8)]);ur.span;var pr=Pe("Raydium_Clmm"),qe={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Ts=[188,37,179,131,82,150,84,73],ks=[16,72,250,198,14,162,212,19],le=class{static createPoolInstruction(e,t,n,r,o,s,a,c,u,l,m,d,p,g){let f=te([H("sqrtPriceX64"),E("startTime")]),y=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:Tt.programId,isSigner:!1,isWritable:!1},{pubkey:Kt,isSigner:!1,isWritable:!1}],b=Buffer.alloc(f.span);f.encode({sqrtPriceX64:p,startTime:g},b);let A=Buffer.from([...qe.createPool,...b]);return new Re({keys:y,programId:e,data:A})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:o,ammConfigId:s,initialPriceX64:a,startTime:c}=e,[u,l]=[new I(r.address),new I(o.address)],{publicKey:m}=nr(t,s,u,l),{publicKey:d}=rr(t,m),{publicKey:p}=Zn(t,m,u),{publicKey:g}=Zn(t,m,l),f=[this.createPoolInstruction(t,m,n,s,d,u,p,new I(r.programId||me),l,g,new I(o.programId||me),Fe(t,m).publicKey,a,c)];return{signers:[],instructions:f,instructionTypes:[ae.CreateAccount,ae.ClmmCreatePool],address:{poolId:m,observationId:d,mintAVault:p,mintBVault:g},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,m,d,p,g,f,y,b,A,w,P,T,h,x,B,S,M){let L=te([Te("tickLowerIndex"),Te("tickUpperIndex"),Te("tickArrayLowerStartIndex"),Te("tickArrayUpperStartIndex"),H("liquidity"),E("amountMaxA"),E("amountMaxB"),Ue("withMetadata"),pe("optionBaseFlag"),Ue("baseFlag")]),$=[...M?[{pubkey:M,isSigner:!1,isWritable:!0}]:[]],ne=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:Kt,isSigner:!1,isWritable:!1},{pubkey:Tt.programId,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:dr,isSigner:!1,isWritable:!1},{pubkey:wt,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...$],de=Buffer.alloc(L.span);L.encode({tickLowerIndex:A,tickUpperIndex:w,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:T,liquidity:h,amountMaxA:x,amountMaxB:B,withMetadata:S==="create",baseFlag:!1,optionBaseFlag:0},de);let ie=Buffer.from([...qe.openPosition,...de]);return new Re({keys:ne,programId:e,data:ie})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l}){let m=[],[d,p]=[new I(e.programId),new I(e.id)],g;if(l)g=new I((await l(1))[0]);else{let B=ei.generate();m.push(B),g=B.publicKey}let f=K.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=K.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=Q(d,p,f),{publicKey:A}=Q(d,p,y),{publicKey:w}=Le(n.wallet,g,me),{publicKey:P}=bn(g),{publicKey:T}=Se(d,g),{publicKey:h}=ut(d,p,r,o),x=this.openPositionFromLiquidityInstruction(d,n.feePayer,p,n.wallet,g,w,P,h,b,A,T,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),r,o,f,y,s,a,c,u);return{signers:m,instructions:[x],instructionTypes:[ae.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:g,tickArrayLower:b,tickArrayUpper:A,positionNftAccount:w,metadataAccount:P,personalPosition:T,protocolPosition:h}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:u,getEphemeralSigners:l}){let m=[],[d,p]=[new I(e.programId),new I(e.id)],g;if(l)g=new I((await l(1))[0]);else{let B=ei.generate();m.push(B),g=B.publicKey}let f=K.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=K.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=Q(d,p,f),{publicKey:A}=Q(d,p,y),{publicKey:w}=Le(n.wallet,g,me),{publicKey:P}=bn(g),{publicKey:T}=Se(d,g),{publicKey:h}=ut(d,p,r,o),x=this.openPositionFromBaseInstruction(d,n.feePayer,p,n.wallet,g,w,P,h,b,A,T,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),r,o,f,y,u,s,a,c,fe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,y])?Fe(d,p).publicKey:void 0);return{address:{nftMint:g,tickArrayLower:b,tickArrayUpper:A,positionNftAccount:w,metadataAccount:P,personalPosition:T,protocolPosition:h},instructions:[x],signers:m,instructionTypes:[ae.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,l,m,d,p,g,f,y,b,A,w,P,T,h,x,B,S,M){let L=te([Te("tickLowerIndex"),Te("tickUpperIndex"),Te("tickArrayLowerStartIndex"),Te("tickArrayUpperStartIndex"),H("liquidity"),E("amountMaxA"),E("amountMaxB"),Ue("withMetadata"),pe("optionBaseFlag"),Ue("baseFlag")]),$=[...M?[{pubkey:M,isSigner:!1,isWritable:!0}]:[]],ne=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:Kt,isSigner:!1,isWritable:!1},{pubkey:Tt.programId,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:dr,isSigner:!1,isWritable:!1},{pubkey:wt,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...$],de=Buffer.alloc(L.span);L.encode({tickLowerIndex:A,tickUpperIndex:w,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:T,liquidity:new mr(0),amountMaxA:x==="MintA"?B:S,amountMaxB:x==="MintA"?S:B,withMetadata:h==="create",baseFlag:x==="MintA",optionBaseFlag:1},de);let ie=Buffer.from([...qe.openPosition,...de]);return new Re({keys:ne,programId:e,data:ie})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l}){let m,d=[];if(l)m=new I((await l(1))[0]);else{let B=ei.generate();d.push(B),m=B.publicKey}let[p,g]=[new I(e.programId),new I(e.id)],f=K.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=K.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=Q(p,g,f),{publicKey:A}=Q(p,g,y),{publicKey:w}=Le(n.wallet,m,me),{publicKey:P}=bn(m),{publicKey:T}=Se(p,m),{publicKey:h}=ut(p,g,r,o),x=this.openPositionFromLiquidityInstruction(p,n.wallet,g,n.wallet,m,w,P,h,b,A,T,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(t.mintA.address),new I(t.mintB.address),r,o,f,y,s,a,c,u,fe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,y])?Fe(p,g).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:b,tickArrayUpper:A,positionNftAccount:w,metadataAccount:P,personalPosition:T,protocolPosition:h},instructions:[x],signers:d,instructionTypes:[ae.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=te([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:Tt.programId,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);s.encode({},c);let u=Buffer.from([...qe.closePosition,...c]);return new Re({keys:a,programId:e,data:u})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new I(e.programId),{publicKey:s}=Le(n.wallet,r.nftMint,me),{publicKey:a}=Se(o,r.nftMint),c=[];return c.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:c,instructionTypes:[ae.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,m,d,p,g,f,y,b,A){let w=te([H("liquidity"),E("amountMaxA"),E("amountMaxB"),pe("optionBaseFlag"),Ue("baseFlag")]),P=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...P],h=Buffer.alloc(w.span);w.encode({liquidity:f,amountMaxA:y,amountMaxB:b,optionBaseFlag:0,baseFlag:!1},h);let x=Buffer.from([...qe.increaseLiquidity,...h]);return new Re({keys:T,programId:e,data:x})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[c,u]=[new I(e.programId),new I(e.id)],l=K.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=K.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=Q(c,u,l),{publicKey:p}=Q(c,u,m),{publicKey:g}=Le(r.wallet,n.nftMint,me),{publicKey:f}=Se(c,n.nftMint),{publicKey:y}=ut(c,u,n.tickLower,n.tickUpper),b=this.increasePositionFromLiquidityInstruction(c,r.wallet,g,f,u,y,d,p,r.tokenAccountA,r.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),o,s,a,fe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Fe(c,u).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:g,personalPosition:f,protocolPosition:y},signers:[],instructions:[b],instructionTypes:[ae.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[c,u]=[new I(e.programId),new I(e.id)],l=K.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=K.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=Q(c,u,l),{publicKey:p}=Q(c,u,m),{publicKey:g}=Le(r.wallet,n.nftMint,me),{publicKey:f}=Se(c,n.nftMint),{publicKey:y}=ut(c,u,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:g,personalPosition:f,protocolPosition:y},instructions:[this.increasePositionFromBaseInstruction(c,r.wallet,g,f,u,y,d,p,r.tokenAccountA,r.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),o,s,a,fe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Fe(c,u).publicKey:void 0)],signers:[],instructionTypes:[ae.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,l,m,d,p,g,f,y,b,A){let w=te([H("liquidity"),E("amountMaxA"),E("amountMaxB"),pe("optionBaseFlag"),Ue("baseFlag")]),P=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...P],h=Buffer.alloc(w.span);w.encode({liquidity:new mr(0),amountMaxA:f==="MintA"?y:b,amountMaxB:f==="MintA"?b:y,baseFlag:f==="MintA",optionBaseFlag:1},h);let x=Buffer.from([...qe.increaseLiquidity,...h]);return new Re({keys:T,programId:e,data:x})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,m,d,p,g,f,y,b,A,w){let P=te([H("liquidity"),E("amountMinA"),E("amountMinB")]),T=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...f.map(S=>[{pubkey:S.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:S.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:S.rewardMint,isSigner:!1,isWritable:!1}]).flat()],h=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:nn,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...T],x=Buffer.alloc(P.span);P.encode({liquidity:y,amountMinA:b,amountMinB:A},x);let B=Buffer.from([...qe.decreaseLiquidity,...x]);return new Re({keys:h,programId:e,data:B})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:c}){let[u,l]=[new I(e.programId),new I(e.id)],m=K.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=K.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=Q(u,l,m),{publicKey:g}=Q(u,l,d),{publicKey:f}=Le(r.wallet,n.nftMint,c),{publicKey:y}=Se(u,n.nftMint),{publicKey:b}=ut(u,l,n.tickLower,n.tickUpper),A=[];for(let T=0;T<e.rewardDefaultInfos.length;T++)A.push({poolRewardVault:new I(t.rewardInfos[T].vault),ownerRewardVault:r.rewardAccounts[T],rewardMint:new I(e.rewardDefaultInfos[T].mint.address)});let w=[],P=this.decreaseLiquidityInstruction(u,r.wallet,f,y,l,b,p,g,r.tokenAccountA,r.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),A,o,s,a,fe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?Fe(u,l).publicKey:void 0);return w.push(P),{address:{tickArrayLower:p,tickArrayUpper:g,positionNftAccount:f,personalPosition:y,protocolPosition:b},signers:[],instructions:w,instructionTypes:[ae.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,c,u,l,m,d,p,g,f,y,b){let A=te([E("amount"),E("otherAmountThreshold"),H("sqrtPriceLimitX64"),Ue("isBaseInput")]),w=[...b?[{pubkey:b,isSigner:!1,isWritable:!0}]:[],...m.map(x=>({pubkey:x,isSigner:!1,isWritable:!0}))],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:nn,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...w],T=Buffer.alloc(A.span);A.encode({amount:p,otherAmountThreshold:g,sqrtPriceLimitX64:f,isBaseInput:y},T);let h=Buffer.from([...qe.swap,...T]);return new Re({keys:P,programId:e,data:h})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[l,m]=[new I(e.programId),new I(e.id)],[d,p]=[new I(t.vault.A),new I(t.vault.B)],[g,f]=[new I(e.mintA.address),new I(e.mintB.address)],y=e.mintA.address===o.toString(),b=[this.swapInstruction(l,r.wallet,m,new I(e.config.id),y?r.tokenAccountA:r.tokenAccountB,y?r.tokenAccountB:r.tokenAccountA,y?d:p,y?p:d,y?g:f,y?f:g,u,n,s,a,c,!0,Fe(l,m).publicKey)];return{signers:[],instructions:b,instructionTypes:[ae.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:o,amountOut:s,amountInMax:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[l,m]=[new I(e.programId),new I(e.id)],[d,p]=[new I(t.vault.A),new I(t.vault.B)],[g,f]=[new I(e.mintA.address),new I(e.mintB.address)],y=e.mintA.address===o.toBase58(),b=[this.swapInstruction(l,r.wallet,m,new I(e.config.id),y?r.tokenAccountB:r.tokenAccountA,y?r.tokenAccountA:r.tokenAccountB,y?p:d,y?d:p,y?f:g,y?g:f,u,n,s,a,c,!1,Fe(l,m).publicKey)];return{signers:[],instructions:b,instructionTypes:[ae.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,c,u,l,m,d){let p=te([E("openTime"),E("endTime"),H("emissionsPerSecondX64")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Tt.programId,isSigner:!1,isWritable:!1},{pubkey:Kt,isSigner:!1,isWritable:!1}],f=Buffer.alloc(p.span);p.encode({openTime:ye(l),endTime:ye(m),emissionsPerSecondX64:d},f);let y=Buffer.from([...qe.initReward,...f]);return new Re({keys:g,programId:e,data:y})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new I(e.programId),new I(e.id)],a=ir(o,s,r.mint).publicKey,c=qt(o).publicKey,u=[this.initRewardInstruction(o,n.wallet,s,c,new I(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:c},signers:[],instructions:u,instructionTypes:[ae.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,c,u,l,m,d){let p=te([pe("rewardIndex"),H("emissionsPerSecondX64"),E("openTime"),E("endTime")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0}],f=Buffer.alloc(p.span);p.encode({rewardIndex:u,emissionsPerSecondX64:d,openTime:ye(l),endTime:ye(m)},f);let y=Buffer.from([...qe.setRewardEmissions,...f]);return new Re({keys:g,programId:e,data:y})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new I(e.programId),new I(e.id)],a,c,u;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===r.mint.toString()&&(a=d,c=new I(t.rewardInfos[d].vault),u=new I(t.rewardInfos[d].mint.address));(a===void 0||c===void 0)&&pr.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=qt(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new I(e.config.id),n.tokenAccount,c,u,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:c,operationId:l},signers:[],instructions:m,instructionTypes:[ae.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let c=te([pe("rewardIndex")]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:nn,isSigner:!1,isWritable:!1}],l=Buffer.alloc(c.span);c.encode({rewardIndex:a},l);let m=Buffer.from([...qe.collectReward,...l]);return new Re({keys:u,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new I(e.programId),new I(e.id)],a,c;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,c=new I(t.rewardInfos[l].vault));(a===void 0||c===void 0)&&pr.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let u=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,c,r,a)];return{address:{rewardVault:c},signers:[],instructions:u,instructionTypes:[ae.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:r,positionNft:o}){let{publicKey:s}=Le(r,o,me),{publicKey:a}=Se(n,o),c=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:jn(e,a).publicKey,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:Tt.programId,isSigner:!1,isWritable:!1}];return new Re({keys:c,programId:e,data:Buffer.from(Ts)})}static harvestLockPositionInstruction(e){let[t,n]=[new I(e.poolKeys.programId),new I(e.poolKeys.id)],r=K.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),o=K.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:s}=Q(t,n,r),{publicKey:a}=Q(t,n,o),{publicKey:c}=Le(e.owner,e.ownerPosition.nftMint,me),{publicKey:u}=Se(t,e.ownerPosition.nftMint),{publicKey:l}=ut(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),m=[];for(let g=0;g<e.poolKeys.rewardInfos.length;g++)m.push({poolRewardVault:new I(e.poolKeys.rewardInfos[g].vault),ownerRewardVault:e.ownerRewardAccounts[g],rewardMint:new I(e.poolKeys.rewardInfos[g].mint.address)});let d=[...m.map(g=>[{pubkey:g.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:g.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:g.rewardMint,isSigner:!1,isWritable:!1}]).flat()],p=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:jn(e.programId,u).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:new I(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new I(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:Ki,isSigner:!1,isWritable:!1},{pubkey:new I(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new I(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...d];return new Re({keys:p,programId:e.programId,data:Buffer.from(ks)})}};var ti=class extends Dt{constructor(e){super(e)}async getClmmPoolKeys(e){return(await this.scope.api.fetchPoolKeysById({idList:[e]}))[0]}async createPool(e){var w;let{programId:t,owner:n=((w=this.scope.owner)==null?void 0:w.publicKey)||v.default,mint1:r,mint2:o,ammConfig:s,initialPrice:a,startTime:c,computeBudgetConfig:u,forerunCreate:l,getObserveState:m,txVersion:d}=e,p=this.createTxBuilder(),[g,f,y]=new Ke(new v(r.address).toBuffer()).gt(new Ke(new v(o.address).toBuffer()))?[o,r,new C(1).div(a)]:[r,o,a],b=O.priceToSqrtPriceX64(y,g.decimals,f.decimals),A=await le.createPoolInstructions({connection:this.scope.connection,programId:t,owner:n,mintA:g,mintB:f,ammConfigId:s.id,initialPriceX64:b,startTime:c,forerunCreate:!m&&l});return p.addInstruction(A),p.addCustomComputeBudget(u),p.versionBuild({txVersion:d,extInfo:{address:G(N({},A.address),{programId:t.toString(),id:A.address.poolId.toString(),mintA:g,mintB:f,openTime:c.toString(),vault:{A:A.address.mintAVault.toString(),B:A.address.mintBVault.toString()},rewardInfos:[],config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}}),mockPoolInfo:N({type:"Concentrated",rewardDefaultPoolInfos:"Clmm",id:A.address.poolId.toString(),mintA:g,mintB:f,feeRate:s.tradeFeeRate,openTime:c.toString(),programId:t.toString(),price:y.toNumber(),config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]},burnPercent:0},Qi),forerunCreate:l}})}async openPositionFromBase({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",getEphemeralSigners:d,computeBudgetConfig:p,txVersion:g}){this.scope.availability.addConcentratedPosition===!1&&this.logAndCreateError("add position feature disabled in your region"),this.scope.checkOwner();let f=this.createTxBuilder(),y=null,b=null,A=n.useSOLBalance&&e.mintA.address===Z.toString(),w=n.useSOLBalance&&e.mintB.address===Z.toString(),[P,T]=s==="MintA"?[a,c]:[c,a],{account:h,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new v(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:A||P.isZero()?{payer:this.scope.ownerPubKey,amount:P}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:A?!1:u,checkCreateATAOwner:l});h&&(y=h),f.addInstruction(x||{});let{account:B,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new v(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:w||T.isZero()?{payer:this.scope.ownerPubKey,amount:T}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:u,checkCreateATAOwner:l});B&&(b=B),f.addInstruction(S||{}),(!y||!b)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",{ownerTokenAccountA:y==null?void 0:y.toBase58(),ownerTokenAccountB:b==null?void 0:b.toBase58()});let M=t||await this.getClmmPoolKeys(e.id),L=await le.openPositionFromBaseInstructions({poolInfo:e,poolKeys:M,ownerInfo:G(N({},n),{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:y,tokenAccountB:b}),tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:m,getEphemeralSigners:d});return f.addInstruction(L),f.addCustomComputeBudget(p),f.versionBuild({txVersion:g,extInfo:N({},L.address)})}async openPositionFromLiquidity({poolInfo:e,poolKeys:t,ownerInfo:n,amountMaxA:r,amountMaxB:o,tickLower:s,tickUpper:a,liquidity:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",txVersion:d,computeBudgetConfig:p,getEphemeralSigners:g}){this.scope.availability.createConcentratedPosition===!1&&this.logAndCreateError("open position feature disabled in your region");let f=this.createTxBuilder(),y=null,b=null,A=n.useSOLBalance&&e.mintA.address===Z.toBase58(),w=n.useSOLBalance&&e.mintB.address===Z.toBase58(),{account:P,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new v(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:A||r.isZero()?{payer:this.scope.ownerPubKey,amount:r}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:A?!1:u,checkCreateATAOwner:l});P&&(y=P),f.addInstruction(T||{});let{account:h,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new v(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:w||o.isZero()?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:u,checkCreateATAOwner:l});h&&(b=h),f.addInstruction(x||{}),(y===void 0||b===void 0)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let B=t||await this.getClmmPoolKeys(e.id),S=await le.openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:B,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:y,tokenAccountB:b},tickLower:s,tickUpper:a,liquidity:c,amountMaxA:r,amountMaxB:o,withMetadata:m,getEphemeralSigners:g});return f.addInstruction(S),f.addCustomComputeBudget(p),f.versionBuild({txVersion:d,extInfo:{address:S.address}})}async increasePositionFromLiquidity(e){let{poolInfo:t,poolKeys:n,ownerPosition:r,amountMaxA:o,amountMaxB:s,liquidity:a,ownerInfo:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,computeBudgetConfig:m,txVersion:d}=e,p=this.createTxBuilder(),g,f,y=c.useSOLBalance&&t.mintA.address===Z.toString(),b=c.useSOLBalance&&t.mintB.address===Z.toString(),{account:A,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new v(t.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,createInfo:y||o.isZero()?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!y,associatedOnly:y?!1:u,checkCreateATAOwner:l});A&&(g=A),p.addInstruction(w||{});let{account:P,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new v(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:b||s.isZero()?{payer:this.scope.ownerPubKey,amount:s}:void 0,notUseTokenAccount:b,skipCloseAccount:!b,associatedOnly:b?!1:u,checkCreateATAOwner:l});P&&(f=P),p.addInstruction(T||{}),!g&&!f&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let h=n!=null?n:await this.getClmmPoolKeys(t.id),x=le.increasePositionFromLiquidityInstructions({poolInfo:t,poolKeys:h,ownerPosition:r,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:g,tokenAccountB:f},liquidity:a,amountMaxA:o,amountMaxB:s});return p.addInstruction(x),p.addCustomComputeBudget(m),p.versionBuild({txVersion:d,extInfo:{address:x.address}})}async increasePositionFromBase(e){let{poolInfo:t,ownerPosition:n,base:r,baseAmount:o,otherAmountMax:s,ownerInfo:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:l,txVersion:m}=e,d=this.createTxBuilder(),p,g,f=a.useSOLBalance&&t.mintA.address===Z.toString(),y=a.useSOLBalance&&t.mintB.address===Z.toString(),{account:b,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new v(t.mintA.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,createInfo:f||(r==="MintA"?o:s).isZero()?{payer:this.scope.ownerPubKey,amount:r==="MintA"?o:s}:void 0,skipCloseAccount:!f,associatedOnly:f?!1:c,checkCreateATAOwner:u});b&&(p=b),d.addInstruction(A||{});let{account:w,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new v(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:y||(r==="MintA"?s:o).isZero()?{payer:this.scope.ownerPubKey,amount:r==="MintA"?s:o}:void 0,notUseTokenAccount:y,skipCloseAccount:!y,associatedOnly:y?!1:c,checkCreateATAOwner:u});w&&(g=w),d.addInstruction(P||{}),!p&&!g&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let T=await this.getClmmPoolKeys(t.id),h=le.increasePositionFromBaseInstructions({poolInfo:t,poolKeys:T,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:g},base:r,baseAmount:o,otherAmountMax:s});return d.addInstruction(h),d.addCustomComputeBudget(l),d.versionBuild({txVersion:m,extInfo:{address:h.address}})}async decreaseLiquidity(e){let{poolInfo:t,poolKeys:n,ownerPosition:r,ownerInfo:o,amountMinA:s,amountMinB:a,liquidity:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,computeBudgetConfig:m,txVersion:d}=e;this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let p=this.createTxBuilder(),g=o.useSOLBalance&&t.mintA.address===Z.toString(),f=o.useSOLBalance&&t.mintB.address===Z.toString(),y,b,{account:A,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new v(t.mintA.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!g,associatedOnly:g?!1:u,checkCreateATAOwner:l});y=A,w&&p.addInstruction(w);let{account:P,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new v(t.mintB.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!f,associatedOnly:f?!1:u,checkCreateATAOwner:l});b=P,T&&p.addInstruction(T);let h=[];for(let M of t.rewardDefaultInfos){let L=o.useSOLBalance&&M.mint.address===Z.toString(),$;if(M.mint.address===t.mintA.address)$=y;else if(M.mint.address===t.mintB.address)$=b;else{let{account:ne,instructionParams:de}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new v(M.mint.programId),mint:new v(M.mint.address),notUseTokenAccount:L,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!L,associatedOnly:L?!1:u,checkCreateATAOwner:l});$=ne,de&&p.addInstruction(de)}h.push($)}!y&&!b&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccountRawInfos);let x=n!=null?n:await this.getClmmPoolKeys(t.id),B=await le.decreaseLiquidityInstructions({poolInfo:t,poolKeys:x,ownerPosition:r,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:y,tokenAccountB:b,rewardAccounts:h},liquidity:c,amountMinA:s,amountMinB:a});p.addInstruction({instructions:B.instructions,instructionTypes:[ae.ClmmDecreasePosition]});let S=N({},B.address);if(o.closePosition){let M=await le.closePositionInstructions({poolInfo:t,poolKeys:x,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:r});p.addInstruction({endInstructions:M.instructions,endInstructionTypes:M.instructionTypes}),S=N(N({},S),M.address)}return p.addCustomComputeBudget(m),p.versionBuild({txVersion:d,extInfo:{address:S}})}async lockPosition(e){let{programId:t=an,authProgramId:n=cn,poolProgramId:r=Di,ownerPosition:o,computeBudgetConfig:s,txVersion:a}=e,c=this.createTxBuilder(),u=await le.lockPositionInstruction({programId:t,authProgramId:n,poolProgramId:r,owner:this.scope.ownerPubKey,positionNft:o.nftMint});return c.addInstruction({instructions:[u],instructionTypes:[ae.ClmmLockPosition]}),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a})}async harvestLockPosition(e){let{programId:t=an,authProgramId:n=cn,ownerPosition:r,ownerInfo:o={useSOLBalance:!0},associatedOnly:s=!0,checkCreateATAOwner:a=!1,computeBudgetConfig:c,txVersion:u}=e,l=await this.getClmmPoolKeys(r.poolId.toString()),m=this.createTxBuilder(),d=o.useSOLBalance&&l.mintA.address===Z.toString(),p=o.useSOLBalance&&l.mintB.address===Z.toString(),g,f,{account:y,instructionParams:b}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:l.mintA.programId,mint:new v(l.mintA.address),notUseTokenAccount:d,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!d,associatedOnly:d?!1:s,checkCreateATAOwner:a});g=y,b&&m.addInstruction(b);let{account:A,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:l.mintB.programId,mint:new v(l.mintB.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!p,associatedOnly:p?!1:s,checkCreateATAOwner:a});f=A,w&&m.addInstruction(w);let P={},T=[];for(let x of l.rewardInfos){let B=o.useSOLBalance&&x.mint.address===Z.toString(),S=P[x.mint.address];if(!S){let{account:M,instructionParams:L}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new v(x.mint.programId),mint:new v(x.mint.address),notUseTokenAccount:B,owner:this.scope.ownerPubKey,skipCloseAccount:!B,createInfo:{payer:this.scope.ownerPubKey,amount:0},associatedOnly:B?!1:s});S=M,L&&m.addInstruction(L)}P[x.mint.address]=S,T.push(S)}let h=await le.harvestLockPositionInstruction({programId:t,authProgramId:n,poolKeys:l,ownerPosition:r,owner:this.scope.ownerPubKey,ownerRewardAccounts:T,userVaultA:g,userVaultB:f});return m.addInstruction({instructions:[h],instructionTypes:[ae.ClmmHarvestLockPosition]}),m.addCustomComputeBudget(c),m.versionBuild({txVersion:u})}async closePosition({poolInfo:e,poolKeys:t,ownerPosition:n,txVersion:r}){this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let o=this.createTxBuilder(),s=t!=null?t:await this.getClmmPoolKeys(e.id),a=le.closePositionInstructions({poolInfo:e,poolKeys:s,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:n});return o.addInstruction(a).versionBuild({txVersion:r,extInfo:{address:a.address}})}async initReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let c=this.createTxBuilder(),u=t.useSOLBalance&&n.mint.address.toString()===Z.toString(),l=n.perSecond.mul(n.endTime-n.openTime),{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new v(n.mint.address),mint:new v(n.mint.address),notUseTokenAccount:!!u,skipCloseAccount:!u,owner:this.scope.ownerPubKey,createInfo:u?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Ke(new C(l.toFixed(0)).gte(l)?l.toFixed(0):l.add(1).toFixed(0))}:void 0,associatedOnly:u?!1:r,checkCreateATAOwner:o});d&&c.addInstruction(d),m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let p=await this.getClmmPoolKeys(e.id),g=le.initRewardInstructions({poolInfo:e,poolKeys:p,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardInfo:{programId:new v(n.mint.programId),mint:new v(n.mint.address),openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:D.decimalToX64(n.perSecond)}});return c.addInstruction(g),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:g.address}})}async initRewards({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfos:r,associatedOnly:o=!0,checkCreateATAOwner:s=!1,computeBudgetConfig:a,txVersion:c}){for(let m of r)m.endTime<=m.openTime&&this.logAndCreateError("reward time error","rewardInfo",m);let u=this.createTxBuilder(),l={};for(let m of r){let d=n.useSOLBalance&&m.mint.address===Z.toString(),p=m.perSecond.mul(m.endTime-m.openTime),{account:g,instructionParams:f}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new v(m.mint.programId),mint:new v(m.mint.address),notUseTokenAccount:!!d,skipCloseAccount:!d,owner:this.scope.ownerPubKey,createInfo:d?{payer:n.feePayer||this.scope.ownerPubKey,amount:new Ke(new C(p.toFixed(0)).gte(p)?p.toFixed(0):p.add(1).toFixed(0))}:void 0,associatedOnly:d?!1:o,checkCreateATAOwner:s});f&&u.addInstruction(f),g||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let y=t!=null?t:await this.getClmmPoolKeys(e.id),b=le.initRewardInstructions({poolInfo:e,poolKeys:y,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:g},rewardInfo:{programId:new v(m.mint.programId),mint:new v(m.mint.address),openTime:m.openTime,endTime:m.endTime,emissionsPerSecondX64:D.decimalToX64(m.perSecond)}});l=N(N({},l),b.address),u.addInstruction(b)}return u.addCustomComputeBudget(a),u.versionBuild({txVersion:c,extInfo:{address:l}})}async setReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let c=this.createTxBuilder(),u=t.useSOLBalance&&n.mint.equals(Z),{account:l,instructionParams:m}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n.programId,mint:n.mint,notUseTokenAccount:u,owner:this.scope.ownerPubKey,createInfo:u?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Ke(new C(n.perSecond.sub(n.endTime-n.openTime).toFixed(0)).gte(n.perSecond.sub(n.endTime-n.openTime))?n.perSecond.sub(n.endTime-n.openTime).toFixed(0):n.perSecond.sub(n.endTime-n.openTime).add(1).toFixed(0))}:void 0,associatedOnly:u?!1:r,checkCreateATAOwner:o});m&&c.addInstruction(m),l||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let d=await this.getClmmPoolKeys(e.id),p=le.setRewardInstructions({poolInfo:e,poolKeys:d,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:l},rewardInfo:{mint:n.mint,openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:D.decimalToX64(n.perSecond)}});return c.addInstruction(p),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:p.address}})}async setRewards({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfos:r,associatedOnly:o=!0,checkCreateATAOwner:s=!1,computeBudgetConfig:a,txVersion:c}){let u=this.createTxBuilder(),l={};for(let m of r){m.endTime<=m.openTime&&this.logAndCreateError("reward time error","rewardInfo",m);let d=n.useSOLBalance&&m.mint.address===Z.toString(),{account:p,instructionParams:g}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new v(m.mint.programId),mint:new v(m.mint.address),notUseTokenAccount:d,owner:this.scope.ownerPubKey,createInfo:d?{payer:n.feePayer||this.scope.ownerPubKey,amount:new Ke(new C(m.perSecond.sub(m.endTime-m.openTime).toFixed(0)).gte(m.perSecond.sub(m.endTime-m.openTime))?m.perSecond.sub(m.endTime-m.openTime).toFixed(0):m.perSecond.sub(m.endTime-m.openTime).add(1).toFixed(0))}:void 0,associatedOnly:d?!1:o,checkCreateATAOwner:s});g&&u.addInstruction(g),p||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let f=t!=null?t:await this.getClmmPoolKeys(e.id),y=le.setRewardInstructions({poolInfo:e,poolKeys:f,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:p},rewardInfo:{mint:new v(m.mint.address),openTime:m.openTime,endTime:m.endTime,emissionsPerSecondX64:D.decimalToX64(m.perSecond)}});u.addInstruction(y),l=N(N({},l),y.address)}return u.addCustomComputeBudget(a),u.versionBuild({txVersion:c,extInfo:{address:l}})}async collectReward({poolInfo:e,ownerInfo:t,rewardMint:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1}){let s=e.rewardDefaultInfos.find(p=>p.mint.address===n.toString());s||this.logAndCreateError("reward mint error","not found reward mint",n);let a=this.createTxBuilder(),c=t.useSOLBalance&&n.equals(Z),{account:u,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new v(s.mint.programId),mint:n,notUseTokenAccount:c,owner:this.scope.ownerPubKey,skipCloseAccount:!c,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:c?!1:r,checkCreateATAOwner:o});l&&a.addInstruction(l),u||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let m=await this.getClmmPoolKeys(e.id),d=le.collectRewardInstructions({poolInfo:e,poolKeys:m,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:u},rewardMint:n});return a.addInstruction(d),a.build({address:d.address})}async collectRewards({poolInfo:e,ownerInfo:t,rewardMints:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1}){let s=this.createTxBuilder(),a={};for(let c of n){let u=e.rewardDefaultInfos.find(f=>f.mint.address===c.toString());if(!u){this.logAndCreateError("reward mint error","not found reward mint",c);continue}let l=t.useSOLBalance&&c.equals(Z),{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new v(u.mint.programId),mint:c,notUseTokenAccount:l,owner:this.scope.ownerPubKey,skipCloseAccount:!l,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:l?!1:r,checkCreateATAOwner:o});m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos),d&&s.addInstruction(d);let p=await this.getClmmPoolKeys(e.id),g=le.collectRewardInstructions({poolInfo:e,poolKeys:p,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardMint:c});s.addInstruction(g),a=N(N({},a),g.address)}return s.build({address:a})}async swap({poolInfo:e,poolKeys:t,inputMint:n,amountIn:r,amountOutMin:o,priceLimit:s,observationId:a,ownerInfo:c,remainingAccounts:u,associatedOnly:l=!0,checkCreateATAOwner:m=!1,txVersion:d,computeBudgetConfig:p}){let g=this.createTxBuilder(),f=n.toString()===e.mintA.address,y=c.useSOLBalance&&e.mintA.address===Z.toBase58(),b=c.useSOLBalance&&e.mintB.address===Z.toBase58(),A;!s||s.equals(new C(0))?A=f?ze.add(new Ke(1)):He.sub(new Ke(1)):A=O.priceToSqrtPriceX64(s,e.mintA.decimals,e.mintB.decimals);let w;if(!w){let{account:h,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new v(e.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,skipCloseAccount:!y,createInfo:y||!f?{payer:c.feePayer||this.scope.ownerPubKey,amount:f?r:0}:void 0,associatedOnly:y?!1:l,checkCreateATAOwner:m});w=h,x&&g.addInstruction(x)}let P;if(!P){let{account:h,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new v(e.mintB.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,skipCloseAccount:!b,createInfo:b||f?{payer:c.feePayer||this.scope.ownerPubKey,amount:f?0:r}:void 0,associatedOnly:b?!1:l,checkCreateATAOwner:m});P=h,x&&g.addInstruction(x)}(!w||!P)&&this.logAndCreateError("user do not have token account",{tokenA:e.mintA.symbol||e.mintA.address,tokenB:e.mintB.symbol||e.mintB.address,ownerTokenAccountA:w,ownerTokenAccountB:P,mintAUseSOLBalance:y,mintBUseSOLBalance:b,associatedOnly:l});let T=t!=null?t:await this.getClmmPoolKeys(e.id);return g.addInstruction(le.makeSwapBaseInInstructions({poolInfo:e,poolKeys:T,observationId:a,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:w,tokenAccountB:P},inputMint:new v(n),amountIn:r,amountOutMin:o,sqrtPriceLimitX64:A,remainingAccounts:u})),g.addCustomComputeBudget(p),g.versionBuild({txVersion:d})}async swapBaseOut({poolInfo:e,poolKeys:t,outputMint:n,amountOut:r,amountInMax:o,priceLimit:s,observationId:a,ownerInfo:c,remainingAccounts:u,associatedOnly:l=!0,checkCreateATAOwner:m=!1,txVersion:d,computeBudgetConfig:p}){let g=this.createTxBuilder(),f=n.toString()===e.mintB.address,y=c.useSOLBalance&&e.mintA.address===Z.toBase58(),b=c.useSOLBalance&&e.mintB.address===Z.toBase58(),A;!s||s.equals(new C(0))?A=n.toString()===e.mintB.address?ze.add(new Ke(1)):He.sub(new Ke(1)):A=O.priceToSqrtPriceX64(s,e.mintA.decimals,e.mintB.decimals);let w;if(!w){let{account:h,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new v(e.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,skipCloseAccount:!y,createInfo:y||!f?{payer:c.feePayer||this.scope.ownerPubKey,amount:f?o:0}:void 0,associatedOnly:y?!1:l,checkCreateATAOwner:m});w=h,x&&g.addInstruction(x)}let P;if(!P){let{account:h,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new v(e.mintB.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,skipCloseAccount:!b,createInfo:b||f?{payer:c.feePayer||this.scope.ownerPubKey,amount:f?0:o}:void 0,associatedOnly:b?!1:l,checkCreateATAOwner:m});P=h,x&&g.addInstruction(x)}(!w||!P)&&this.logAndCreateError("user do not have token account",{tokenA:e.mintA.symbol||e.mintA.address,tokenB:e.mintB.symbol||e.mintB.address,ownerTokenAccountA:w,ownerTokenAccountB:P,mintAUseSOLBalance:y,mintBUseSOLBalance:b,associatedOnly:l});let T=t!=null?t:await this.getClmmPoolKeys(e.id);return g.addInstruction(le.makeSwapBaseOutInstructions({poolInfo:e,poolKeys:T,observationId:a,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:w,tokenAccountB:P},outputMint:new v(n),amountOut:r,amountInMax:o,sqrtPriceLimitX64:A,remainingAccounts:u})),g.addCustomComputeBudget(p),g.versionBuild({txVersion:d})}async harvestAllRewards({allPoolInfo:e,allPositions:t,lockInfo:n,ownerInfo:r,associatedOnly:o=!0,checkCreateATAOwner:s=!1,programId:a,txVersion:c,computeBudgetConfig:u}){let l={};for(let d of this.scope.account.tokenAccountRawInfos)o?Le(this.scope.ownerPubKey,d.accountInfo.mint,a).publicKey.equals(d.pubkey)&&(l[d.accountInfo.mint.toString()]=d.pubkey):l[d.accountInfo.mint.toString()]=d.pubkey;let m=this.createTxBuilder();for(let d of Object.values(e)){if(t[d.id]===void 0||!t[d.id].find(P=>!P.liquidity.isZero()||P.rewardInfos.find(T=>!T.rewardAmountOwed.isZero())))continue;let p=d,g=r.useSOLBalance&&p.mintA.address===Z.toString(),f=r.useSOLBalance&&p.mintB.address===Z.toString(),y=l[p.mintA.address];if(!y){let{account:P,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:p.mintA.programId,mint:new v(p.mintA.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,skipCloseAccount:!g,createInfo:{payer:r.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:g?!1:o,checkCreateATAOwner:s});y=P,T&&m.addInstruction(T)}let b=l[p.mintB.address];if(!b){let{account:P,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:p.mintB.programId,mint:new v(p.mintB.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,skipCloseAccount:!f,createInfo:{payer:r.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:f?!1:o,checkCreateATAOwner:s});b=P,T&&m.addInstruction(T)}l[p.mintA.address]=y,l[p.mintB.address]=b;let A=[];for(let P of p.rewardDefaultInfos){let T=r.useSOLBalance&&P.mint.address===Z.toString(),h=l[P.mint.address];if(!h){let{account:x,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new v(P.mint.programId),mint:new v(P.mint.address),notUseTokenAccount:T,owner:this.scope.ownerPubKey,skipCloseAccount:!T,createInfo:{payer:r.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:T?!1:o});h=x,B&&m.addInstruction(B)}l[P.mint.address]=h,A.push(h)}let w=await this.getClmmPoolKeys(p.id);for(let P of t[d.id])if(n&&n[d.id]&&n[d.id][P.nftMint.toBase58()]){let T=le.harvestLockPositionInstruction({poolKeys:w,owner:this.scope.ownerPubKey,ownerPosition:P,ownerRewardAccounts:A,programId:an,authProgramId:cn,userVaultA:y,userVaultB:b});m.addInstruction({instructions:[T],instructionTypes:[ae.ClmmHarvestLockPosition],lookupTableAddress:w.lookupTableAccount?[w.lookupTableAccount]:[]})}else{let T=le.decreaseLiquidityInstructions({poolInfo:p,poolKeys:w,ownerPosition:P,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:y,tokenAccountB:b,rewardAccounts:A},liquidity:new Ke(0),amountMinA:new Ke(0),amountMinB:new Ke(0)});m.addInstruction(T)}}return c===0?m.sizeCheckBuildV0({computeBudgetConfig:u}):m.sizeCheckBuild({computeBudgetConfig:u})}async getWhiteListMint({programId:e}){let t=await this.scope.connection.getAccountInfo(qt(e).publicKey);return t?lr.decode(t.data).whitelistMints.filter(r=>!r.equals(v.default)):[]}async getOwnerPositionInfo({programId:e}){await this.scope.account.fetchWalletTokenAccounts();let n=this.scope.account.tokenAccountRawInfos.filter(s=>s.accountInfo.amount.eq(new Ke(1))).map(s=>Se(new v(e),s.accountInfo.mint).publicKey),r=await this.scope.connection.getMultipleAccountsInfo(n),o=[];return r.forEach(s=>{if(!s)return;let a=wn.decode(s.data);o.push(a)}),o}async getRpcClmmPoolInfo({poolId:e}){return(await this.getRpcClmmPoolInfos({poolIds:[e]}))[String(e)]}async getRpcClmmPoolInfos({poolIds:e,config:t}){let n=await ot(this.scope.connection,e.map(o=>({pubkey:new v(o)})),t),r={};for(let o=0;o<e.length;o++){let s=n[o];if(s===null||!s.accountInfo)throw Error("fetch pool info error: "+String(e[o]));let a=yn.decode(s.accountInfo.data),c=O.sqrtPriceX64ToPrice(a.sqrtPriceX64,a.mintDecimalsA,a.mintDecimalsB).toNumber();r[String(e[o])]=G(N({},a),{currentPrice:c,programId:s.accountInfo.owner})}return r}async getComputeClmmPoolInfos({clmmPoolsRpcInfo:e,mintInfos:t}){let n=new Set(Object.keys(e).map(c=>e[c].ammConfig.toBase58())),r=await ot(this.scope.connection,Array.from(n).map(c=>({pubkey:new v(c)}))),o={};r.forEach(c=>{!c.accountInfo||(o[c.pubkey.toBase58()]=cr.decode(c.accountInfo.data))});let s=await fe.fetchComputeMultipleClmmInfo({connection:this.scope.connection,rpcDataMap:e,poolList:Object.keys(e).map(c=>{var m,d,p,g;let[u,l]=[e[c].mintA.toBase58(),e[c].mintB.toBase58()];return{id:c,programId:e[c].programId.toBase58(),mintA:Vn({address:u,decimals:e[c].mintDecimalsA,programId:t[u].programId.toBase58()||gr.toBase58(),extensions:{feeConfig:(m=t[u])!=null&&m.feeConfig?qn((d=t[u])==null?void 0:d.feeConfig):void 0}}),mintB:Vn({address:l,decimals:e[c].mintDecimalsB,programId:t[l].programId.toBase58()||gr.toBase58(),extensions:{feeConfig:(p=t[l])!=null&&p.feeConfig?qn((g=t[l])==null?void 0:g.feeConfig):void 0}}),price:e[c].currentPrice,config:G(N({},o[e[c].ammConfig.toBase58()]),{id:e[c].ammConfig.toBase58(),fundFeeRate:0,description:"",defaultRange:0,defaultRangePoint:[]})}})}),a=await fe.fetchMultiplePoolTickArrays({connection:this.scope.connection,poolKeys:Object.values(s)});return{computeClmmPoolInfo:s,computePoolTickData:a}}async getPoolInfoFromRpc(e){var l;let t=await this.getRpcClmmPoolInfo({poolId:e}),n=new Set([t.mintA.toBase58(),t.mintB.toBase58()]),r=await ki({connection:this.scope.connection,mints:Array.from(n).map(m=>new v(m))}),{computeClmmPoolInfo:o,computePoolTickData:s}=await this.scope.clmm.getComputeClmmPoolInfos({clmmPoolsRpcInfo:{[e]:t},mintInfos:r}),a=await ot(this.scope.connection,[{pubkey:t.vaultA},{pubkey:t.vaultB}]),c=sr(o[e]);if(!a[0].accountInfo||!a[1].accountInfo)throw new Error("pool vault data not found");c.mintAmountA=Number(fr.decode(a[0].accountInfo.data).amount.toString()),c.mintAmountB=Number(fr.decode((l=a[1].accountInfo)==null?void 0:l.data).amount.toString());let u=G(N({},o[e]),{id:e,programId:t.programId.toBase58(),openTime:t.startTime.toString(),vault:{A:t.vaultA.toBase58(),B:t.vaultB.toBase58()},rewardInfos:[],config:c.config});return{poolInfo:c,poolKeys:u,computePoolInfo:o[e],tickData:s}}};export{ss as AMM_CONFIG_SEED,Hi as BIT_PRECISION,ti as Clmm,cr as ClmmConfigLayout,le as ClmmInstrument,Qn as EXTENSION_TICKARRAY_BITMAP_SIZE,fn as FEE_RATE_DENOMINATOR,gs as FETCH_TICKARRAY_COUNT,os as Fee,Yi as LOG_B_2_X32,Zi as LOG_B_P_ERR_MARGIN_LOWER_X64,ji as LOG_B_P_ERR_MARGIN_UPPER_X64,X as LiquidityMath,Md as LockPositionLayout,He as MAX_SQRT_PRICE_X64,pm as MAX_SQRT_PRICE_X64_SUB_ONE,Ie as MAX_TICK,ze as MIN_SQRT_PRICE_X64,dm as MIN_SQRT_PRICE_X64_ADD_ONE,xe as MIN_TICK,D as MathUtil,zn as MaxU64,zi as MaxUint128,Je as NEGATIVE_ONE,ps as OBSERVATION_SEED,Xe as ONE,ms as OPERATION_SEED,ur as ObservationInfoLayout,ws as ObservationLayout,lr as OperationLayout,fs as POOL_LOCK_ID_SEED,us as POOL_REWARD_VAULT_SEED,as as POOL_SEED,ds as POOL_TICK_ARRAY_BITMAP_SEED,cs as POOL_VAULT_SEED,tr as POSITION_SEED,yn as PoolInfoLayout,fe as PoolUtils,wn as PositionInfoLayout,Ps as PositionRewardInfoLayout,Wt as PositionUtils,Ld as ProtocolPositionLayout,pn as Q128,Ne as Q64,As as RewardInfo,O as SqrtPriceMath,pt as SwapMath,dt as TICK_ARRAY_BITMAP_SIZE,ls as TICK_ARRAY_SEED,be as TICK_ARRAY_SIZE,fm as TICK_SPACINGS,$e as TickArrayBitmap,ar as TickArrayBitmapExtensionLayout,Ut as TickArrayBitmapExtensionUtils,Gt as TickArrayLayout,hs as TickLayout,ft as TickMath,z as TickQuery,K as TickUtils,_t as U64Resolution,bm as U64_IGNORE_RANGE,Y as ZERO,sr as clmmComputeInfoToApiInfo,cd as getLiquidityFromAmounts,km as getPdaAmmConfigId,Fe as getPdaExBitmapAccount,jn as getPdaLockPositionId,bn as getPdaMetadataKey,rr as getPdaObservationAccount,qt as getPdaOperationAccount,Se as getPdaPersonalPositionAddress,nr as getPdaPoolId,ir as getPdaPoolRewardVaulId,Zn as getPdaPoolVaultId,ut as getPdaProtocolPositionAddress,Q as getPdaTickArrayAddress,wm as i16ToBytes,gn as i32ToBytes,Vt as isZero,Hn as leadingZeros,er as leastSignificantBit,gm as mockCreatePoolInfo,Qi as mockV3CreatePoolInfo,$i as mostSignificantBit,Yn as trailingZeros,Ji as u16ToBytes,Am as u32ToBytes};
//# sourceMappingURL=index.mjs.map