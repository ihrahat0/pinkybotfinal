var Ii=Object.defineProperty,Si=Object.defineProperties;var Ni=Object.getOwnPropertyDescriptors;var In=Object.getOwnPropertySymbols;var Ci=Object.prototype.hasOwnProperty,Ki=Object.prototype.propertyIsEnumerable;var Sn=(i,e,t)=>e in i?Ii(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Y=(i,e)=>{for(var t in e||(e={}))Ci.call(e,t)&&Sn(i,t,e[t]);if(In)for(var t of In(e))Ki.call(e,t)&&Sn(i,t,e[t]);return i},ee=(i,e)=>Si(i,Ni(e));import{Keypair as xn,PublicKey as A,SystemProgram as ft,TransactionInstruction as Ie}from"@solana/web3.js";import Ti from"bn.js";import{PublicKey as Mi}from"@solana/web3.js";import{get as Nn,set as Li}from"lodash";var zt=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Cn={},Ri={};function ke(i){let e=Nn(Cn,i);if(!e){let t=Nn(Ri,i);e=new zt({name:i,logLevel:t}),Li(Cn,i,e)}return e}import{MINT_SIZE as _o,TOKEN_PROGRAM_ID as Oo,getTransferFeeConfig as Do,unpackMint as vo}from"@solana/spl-token";var Ht=ke("Raydium_accountInfo_util");async function Ze(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}=Y({batchRequest:!1},t),s=Zt(e,o),a=new Array(s.length).fill([]);if(n){let u=s.map(m=>{let d=i._buildArgs([m.map(f=>f.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),c=Zt(u,10);a=(await(await Promise.all(c.map(async m=>await i._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&Ht.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:f,executable:p,lamports:g,owner:y,rentEpoch:b}=d;return f.length!==2&&f[1]!=="base64"&&Ht.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(f[0],"base64"),executable:p,lamports:g,owner:new Mi(y),rentEpoch:b}}return null})))}else try{a=await Promise.all(s.map(u=>i.getMultipleAccountsInfo(u,r)))}catch(u){u instanceof Error&&Ht.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}async function jt(i,e,t){let n=await Ze(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>ee(Y({},r),{accountInfo:n[o]}))}import Ue from"bn.js";var ut=9e15,Je=1e9,Qt="0123456789abcdef",Kt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Lt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Jt={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-ut,maxE:ut,crypto:!1},Mn,Ve,K=!0,Mt="[DecimalError] ",Qe=Mt+"Invalid argument: ",En=Mt+"Precision limit exceeded",Fn=Mt+"crypto unavailable",_n="[object Decimal]",be=Math.floor,ue=Math.pow,Ei=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Fi=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,_i=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,On=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Re=1e7,N=7,Oi=9007199254740991,Di=Kt.length-1,$t=Lt.length-1,h={toStringTag:_n};h.absoluteValue=h.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),I(i)};h.ceil=function(){return I(new this.constructor(this),this.e+1,2)};h.clampedTo=h.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(Qe+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};h.comparedTo=h.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,u=o.s,c=i.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==i.e)return o.e>i.e^u<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===r?0:n>r^u<0?1:-1};h.cosine=h.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+N,n.rounding=1,t=vi(n,Vn(n,t)),n.precision=i,n.rounding=e,I(Ve==2||Ve==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};h.cubeRoot=h.cbrt=function(){var i,e,t,n,r,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(K=!1,o=l.s*ue(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=fe(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=ue(t,1/3),i=be((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(i=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=Z(c.plus(l).times(a),c.plus(u),s+2,1),fe(a.d).slice(0,s)===(t=fe(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(I(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(I(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return K=!0,I(n,i,m.rounding,e)};h.decimalPlaces=h.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-be(this.e/N))*N,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};h.dividedBy=h.div=function(i){return Z(this,new this.constructor(i))};h.dividedToIntegerBy=h.divToInt=function(i){var e=this,t=e.constructor;return I(Z(e,new t(i),0,1,1),t.precision,t.rounding)};h.equals=h.eq=function(i){return this.cmp(i)===0};h.floor=function(){return I(new this.constructor(this),this.e+1,3)};h.greaterThan=h.gt=function(i){return this.cmp(i)>0};h.greaterThanOrEqualTo=h.gte=function(i){var e=this.cmp(i);return e==1||e===0};h.hyperbolicCosine=h.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/Ft(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=ct(s,1,o.times(e),new s(1),!0);for(var u,c=i,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return I(o,s.precision=t,s.rounding=n,!0)};h.hyperbolicSine=h.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=ct(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/Ft(5,i)),r=ct(o,2,r,r,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,I(r,e,t,!0)};h.hyperbolicTangent=h.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,Z(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};h.inverseCosine=h.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Le(t,r,o):new t(0):new t(NaN):e.isZero()?Le(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=Le(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};h.inverseHyperbolicCosine=h.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,K=!1,t=t.times(t).minus(1).sqrt().plus(t),K=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};h.inverseHyperbolicSine=h.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,K=!1,t=t.times(t).plus(1).sqrt().plus(t),K=!0,n.precision=i,n.rounding=e,t.ln())};h.inverseHyperbolicTangent=h.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?I(new o(r),i,e,!0):(o.precision=t=n-r.e,r=Z(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};h.inverseSine=h.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=Le(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};h.inverseTangent=h.atan=function(){var i,e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=$t)return s=Le(l,m+4,d).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=$t)return s=Le(l,m+4,d).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/N+2|0),i=t;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(K=!1,e=Math.ceil(a/N),n=1,u=c.times(c),s=new l(c),r=c;i!==-1;)if(r=r.times(u),o=s.minus(r.div(n+=2)),r=r.times(u),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),K=!0,I(s,l.precision=m,l.rounding=d,!0)};h.isFinite=function(){return!!this.d};h.isInteger=h.isInt=function(){return!!this.d&&be(this.e/N)>this.d.length-2};h.isNaN=function(){return!this.s};h.isNegative=h.isNeg=function(){return this.s<0};h.isPositive=h.isPos=function(){return this.s>0};h.isZero=function(){return!!this.d&&this.d[0]===0};h.lessThan=h.lt=function(i){return this.cmp(i)<0};h.lessThanOrEqualTo=h.lte=function(i){return this.cmp(i)<1};h.logarithm=h.log=function(i){var e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding,f=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(K=!1,a=m+f,s=Ye(c,a),n=e?Rt(l,a+10):Ye(i,a),u=Z(s,n,a,1),pt(u.d,r=m,d))do if(a+=10,s=Ye(c,a),n=e?Rt(l,a+10):Ye(i,a),u=Z(s,n,a,1),!o){+fe(u.d).slice(r+1,r+15)+1==1e14&&(u=I(u,m+1,0));break}while(pt(u.d,r+=10,d));return K=!0,I(u,m,d)};h.minus=h.sub=function(i){var e,t,n,r,o,s,a,u,c,l,m,d,f=this,p=f.constructor;if(i=new p(i),!f.d||!i.d)return!f.s||!i.s?i=new p(NaN):f.d?i.s=-i.s:i=new p(i.d||f.s!==i.s?f:NaN),i;if(f.s!=i.s)return i.s=-i.s,f.plus(i);if(c=f.d,d=i.d,a=p.precision,u=p.rounding,!c[0]||!d[0]){if(d[0])i.s=-i.s;else if(c[0])i=new p(f);else return new p(u===3?-0:0);return K?I(i,a,u):i}if(t=be(i.e/N),l=be(f.e/N),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=d.length):(e=d,t=l,s=c.length),n=Math.max(Math.ceil(a/N),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=d[n]){m=c[n]<d[n];break}o=0}for(m&&(e=c,c=d,d=e,i.s=-i.s),s=c.length,n=d.length-s;n>0;--n)c[s++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(r=n;r&&c[--r]===0;)c[r]=Re-1;--c[r],c[n]+=Re}c[n]-=d[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(i.d=c,i.e=Et(c,t),K?I(i,a,u):i):new p(u===3?-0:0)};h.modulo=h.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?I(new n(t),n.precision,n.rounding):(K=!1,n.modulo==9?(e=Z(t,i.abs(),0,3,1),e.s*=i.s):e=Z(t,i,0,n.modulo,1),e=e.times(i),K=!0,t.minus(e))};h.naturalExponential=h.exp=function(){return en(this)};h.naturalLogarithm=h.ln=function(){return Ye(this)};h.negated=h.neg=function(){var i=new this.constructor(this);return i.s=-i.s,I(i)};h.plus=h.add=function(i){var e,t,n,r,o,s,a,u,c,l,m=this,d=m.constructor;if(i=new d(i),!m.d||!i.d)return!m.s||!i.s?i=new d(NaN):m.d||(i=new d(i.d||m.s===i.s?m:NaN)),i;if(m.s!=i.s)return i.s=-i.s,m.minus(i);if(c=m.d,l=i.d,a=d.precision,u=d.rounding,!c[0]||!l[0])return l[0]||(i=new d(m)),K?I(i,a,u):i;if(o=be(m.e/N),n=be(i.e/N),c=c.slice(),r=o-n,r){for(r<0?(t=c,r=-r,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/N),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=c.length,r=l.length,s-r<0&&(r=s,t=l,l=c,c=t),e=0;r;)e=(c[--r]=c[r]+l[r]+e)/Re|0,c[r]%=Re;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return i.d=c,i.e=Et(c,n),K?I(i,a,u):i};h.precision=h.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(Qe+i);return t.d?(e=Dn(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};h.round=function(){var i=this,e=i.constructor;return I(new e(i),i.e+1,e.rounding)};h.sine=h.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+N,n.rounding=1,t=qi(n,Vn(n,t)),n.precision=i,n.rounding=e,I(Ve>2?t.neg():t,i,e,!0)):new n(NaN)};h.squareRoot=h.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(K=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=fe(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=be((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(Z(s,o,t+2,1)).times(.5),fe(o.d).slice(0,t)===(e=fe(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(I(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(I(n,u+1,1),i=!n.times(n).eq(s));break}return K=!0,I(n,u,l.rounding,i)};h.tangent=h.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=Z(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,I(Ve==2||Ve==4?t.neg():t,i,e,!0)):new n(NaN)};h.times=h.mul=function(i){var e,t,n,r,o,s,a,u,c,l=this,m=l.constructor,d=l.d,f=(i=new m(i)).d;if(i.s*=l.s,!d||!d[0]||!f||!f[0])return new m(!i.s||d&&!d[0]&&!f||f&&!f[0]&&!d?NaN:!d||!f?i.s/0:i.s*0);for(t=be(l.e/N)+be(i.e/N),u=d.length,c=f.length,u<c&&(o=d,d=f,f=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,r=u+n;r>n;)a=o[r]+f[n]*d[r-n-1]+e,o[r--]=a%Re|0,e=a/Re|0;o[r]=(o[r]+e)%Re|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=Et(o,t),K?I(i,m.precision,m.rounding):i};h.toBinary=function(i,e){return nn(this,2,i,e)};h.toDecimalPlaces=h.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Pe(i,0,Je),e===void 0?e=n.rounding:Pe(e,0,8),I(t,i+t.e+1,e))};h.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Oe(n,!0):(Pe(i,0,Je),e===void 0?e=r.rounding:Pe(e,0,8),n=I(new r(n),i+1,e),t=Oe(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};h.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=Oe(r):(Pe(i,0,Je),e===void 0?e=o.rounding:Pe(e,0,8),n=I(new o(r),i+r.e+1,e),t=Oe(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};h.toFraction=function(i){var e,t,n,r,o,s,a,u,c,l,m,d,f=this,p=f.d,g=f.constructor;if(!p)return new g(f);if(c=t=new g(1),n=u=new g(0),e=new g(n),o=e.e=Dn(p)-f.e-1,s=o%N,e.d[0]=ue(10,s<0?N+s:s),i==null)i=o>0?e:c;else{if(a=new g(i),!a.isInt()||a.lt(c))throw Error(Qe+a);i=a.gt(e)?o>0?e:c:a}for(K=!1,a=new g(fe(p)),l=g.precision,g.precision=o=p.length*N*2;m=Z(a,e,0,1,1),r=t.plus(m.times(n)),r.cmp(i)!=1;)t=n,n=r,r=c,c=u.plus(m.times(r)),u=r,r=e,e=a.minus(m.times(r)),a=r;return r=Z(i.minus(t),n,0,1,1),u=u.plus(r.times(c)),t=t.plus(r.times(n)),u.s=c.s=f.s,d=Z(c,n,o,1).minus(f).abs().cmp(Z(u,t,o,1).minus(f).abs())<1?[c,n]:[u,t],g.precision=l,K=!0,d};h.toHexadecimal=h.toHex=function(i,e){return nn(this,16,i,e)};h.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Pe(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(K=!1,t=Z(t,i,0,e,1).times(i),K=!0,I(t)):(i.s=t.s,t=i),t};h.toNumber=function(){return+this};h.toOctal=function(i,e){return nn(this,8,i,e)};h.toPower=h.pow=function(i){var e,t,n,r,o,s,a=this,u=a.constructor,c=+(i=new u(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new u(ue(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,i.eq(1))return I(a,n,o);if(e=be(i.e/N),e>=i.d.length-1&&(t=c<0?-c:c)<=Oi)return r=vn(u,a,t,n),i.s<0?new u(1).div(r):I(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new u(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=ue(+a,c),e=t==0||!isFinite(t)?be(c*(Math.log("0."+fe(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(K=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),r=en(i.times(Ye(a,n+t)),n),r.d&&(r=I(r,n+5,1),pt(r.d,n,o)&&(e=n+10,r=I(en(i.times(Ye(a,e+t)),e),e+5,1),+fe(r.d).slice(n+1,n+15)+1==1e14&&(r=I(r,n+1,0)))),r.s=s,K=!0,u.rounding=o,I(r,n,o))};h.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Oe(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Pe(i,1,Je),e===void 0?e=r.rounding:Pe(e,0,8),n=I(new r(n),i,e),t=Oe(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};h.toSignificantDigits=h.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Pe(i,1,Je),e===void 0?e=n.rounding:Pe(e,0,8)),I(new n(t),i,e)};h.toString=function(){var i=this,e=i.constructor,t=Oe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};h.truncated=h.trunc=function(){return I(new this.constructor(this),this.e+1,1)};h.valueOf=h.toJSON=function(){var i=this,e=i.constructor,t=Oe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function fe(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=N-n.length,t&&(o+=je(t)),o+=n;s=i[e],n=s+"",t=N-n.length,t&&(o+=je(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Pe(i,e,t){if(i!==~~i||i<e||i>t)throw Error(Qe+i)}function pt(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=N,r=0):(r=Math.ceil((e+1)/N),e%=N),o=ue(10,N-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==ue(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==ue(10,e-3)-1,s}function Ct(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=Qt.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function vi(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/Ft(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=ct(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var Z=function(){function i(n,r,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*r+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=r[a]){u=n[a]>r[a]?1:-1;break}return u}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,u){var c,l,m,d,f,p,g,y,b,T,w,P,S,k,M,L,z,H,_,le,se=n.constructor,Te=n.s==r.s?1:-1,$=n.d,X=r.d;if(!$||!$[0]||!X||!X[0])return new se(!n.s||!r.s||($?X&&$[0]==X[0]:!X)?NaN:$&&$[0]==0||!X?Te*0:Te/0);for(u?(f=1,l=n.e-r.e):(u=Re,f=N,l=be(n.e/f)-be(r.e/f)),_=X.length,z=$.length,b=new se(Te),T=b.d=[],m=0;X[m]==($[m]||0);m++);if(X[m]>($[m]||0)&&l--,o==null?(k=o=se.precision,s=se.rounding):a?k=o+(n.e-r.e)+1:k=o,k<0)T.push(1),p=!0;else{if(k=k/f+2|0,m=0,_==1){for(d=0,X=X[0],k++;(m<z||d)&&k--;m++)M=d*u+($[m]||0),T[m]=M/X|0,d=M%X|0;p=d||m<z}else{for(d=u/(X[0]+1)|0,d>1&&(X=i(X,d,u),$=i($,d,u),_=X.length,z=$.length),L=_,w=$.slice(0,_),P=w.length;P<_;)w[P++]=0;le=X.slice(),le.unshift(0),H=X[0],X[1]>=u/2&&++H;do d=0,c=e(X,w,_,P),c<0?(S=w[0],_!=P&&(S=S*u+(w[1]||0)),d=S/H|0,d>1?(d>=u&&(d=u-1),g=i(X,d,u),y=g.length,P=w.length,c=e(g,w,y,P),c==1&&(d--,t(g,_<y?le:X,y,u))):(d==0&&(c=d=1),g=X.slice()),y=g.length,y<P&&g.unshift(0),t(w,g,P,u),c==-1&&(P=w.length,c=e(X,w,_,P),c<1&&(d++,t(w,_<P?le:X,P,u))),P=w.length):c===0&&(d++,w=[0]),T[m++]=d,c&&w[0]?w[P++]=$[L]||0:(w=[$[L]],P=1);while((L++<z||w[0]!==void 0)&&k--);p=w[0]!==void 0}T[0]||T.shift()}if(f==1)b.e=l,Mn=p;else{for(m=1,d=T[0];d>=10;d/=10)m++;b.e=m+l*f-1,I(b,a?o+b.e+1:o,s,p)}return b}}();function I(i,e,t,n){var r,o,s,a,u,c,l,m,d,f=i.constructor;e:if(e!=null){if(m=i.d,!m)return i;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=N,s=e,l=m[d=0],u=l/ue(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/N),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=u=0,r=1,o%=N,s=o-N+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=N,s=o-N+r,u=s<0?0:l/ue(10,r-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%ue(10,r-s-1)),c=t<4?(u||n)&&(t==0||t==(i.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/ue(10,r-s):0:m[d-1])%10&1||t==(i.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=i.e+1,m[0]=ue(10,(N-e%N)%N),i.e=-e||0):m[0]=i.e=0,i;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=ue(10,N-o),m[d]=s>0?(l/ue(10,r-s)%ue(10,s)|0)*a:0),c)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,m[0]==Re&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=Re)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return K&&(i.e>f.maxE?(i.d=null,i.e=NaN):i.e<f.minE&&(i.e=0,i.d=[0])),i}function Oe(i,e,t){if(!i.isFinite())return qn(i);var n,r=i.e,o=fe(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+je(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+je(-r-1)+o,t&&(n=t-s)>0&&(o+=je(n))):r>=s?(o+=je(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+je(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=je(n))),o}function Et(i,e){var t=i[0];for(e*=N;t>=10;t/=10)e++;return e}function Rt(i,e,t){if(e>Di)throw K=!0,t&&(i.precision=t),Error(En);return I(new i(Kt),e,1,!0)}function Le(i,e,t){if(e>$t)throw Error(En);return I(new i(Lt),e,t,!0)}function Dn(i){var e=i.length-1,t=e*N+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function je(i){for(var e="";i--;)e+="0";return e}function vn(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/N+4);for(K=!1;;){if(t%2&&(o=o.times(e),Ln(o.d,s)&&(r=!0)),t=be(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Ln(e.d,s)}return K=!0,o}function Kn(i){return i.d[i.d.length-1]&1}function Wn(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function en(i,e){var t,n,r,o,s,a,u,c=0,l=0,m=0,d=i.constructor,f=d.rounding,p=d.precision;if(!i.d||!i.d[0]||i.e>17)return new d(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(K=!1,u=p):u=e,a=new d(.03125);i.e>-2;)i=i.times(a),m+=5;for(n=Math.log(ue(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new d(1),d.precision=u;;){if(o=I(o.times(i),u,1),t=t.times(++l),a=s.plus(Z(o,t,u,1)),fe(a.d).slice(0,u)===fe(s.d).slice(0,u)){for(r=m;r--;)s=I(s.times(s),u,1);if(e==null)if(c<3&&pt(s.d,u-n,f,c))d.precision=u+=10,t=o=a=new d(1),l=0,c++;else return I(s,d.precision=p,f,K=!0);else return d.precision=p,s}s=a}}function Ye(i,e){var t,n,r,o,s,a,u,c,l,m,d,f=1,p=10,g=i,y=g.d,b=g.constructor,T=b.rounding,w=b.precision;if(g.s<0||!y||!y[0]||!g.e&&y[0]==1&&y.length==1)return new b(y&&!y[0]?-1/0:g.s!=1?NaN:y?0:g);if(e==null?(K=!1,l=w):l=e,b.precision=l+=p,t=fe(y),n=t.charAt(0),Math.abs(o=g.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)g=g.times(i),t=fe(g.d),n=t.charAt(0),f++;o=g.e,n>1?(g=new b("0."+t),o++):g=new b(n+"."+t.slice(1))}else return c=Rt(b,l+2,w).times(o+""),g=Ye(new b(n+"."+t.slice(1)),l-p).plus(c),b.precision=w,e==null?I(g,w,T,K=!0):g;for(m=g,u=s=g=Z(g.minus(1),g.plus(1),l,1),d=I(g.times(g),l,1),r=3;;){if(s=I(s.times(d),l,1),c=u.plus(Z(s,new b(r),l,1)),fe(c.d).slice(0,l)===fe(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(Rt(b,l+2,w).times(o+""))),u=Z(u,new b(f),l,1),e==null)if(pt(u.d,l-p,T,a))b.precision=l+=p,c=s=g=Z(m.minus(1),m.plus(1),l,1),d=I(g.times(g),l,1),r=a=1;else return I(u,b.precision=w,T,K=!0);else return b.precision=w,u;u=c,r+=2}}function qn(i){return String(i.s*i.s/0)}function tn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%N,t<0&&(n+=N),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=N;n<r;)i.d.push(+e.slice(n,n+=N));e=e.slice(n),n=N-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),K&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function Wi(i,e){var t,n,r,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),On.test(e))return tn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(Fi.test(e))t=16,e=e.toLowerCase();else if(Ei.test(e))t=2;else if(_i.test(e))t=8;else throw Error(Qe+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=vn(n,new n(t),o,o*2)),c=Ct(e,t,Re),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(i.s*0):(i.e=Et(c,l),i.d=c,K=!1,s&&(i=Z(i,r,a*4)),u&&(i=i.times(Math.abs(u)<54?ue(2,u):gt.pow(2,u))),K=!0,i)}function qi(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:ct(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/Ft(5,t)),e=ct(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function ct(i,e,t,n,r){var o,s,a,u,c=1,l=i.precision,m=Math.ceil(l/N);for(K=!1,u=t.times(t),a=new i(n);;){if(s=Z(a.times(u),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=Z(s.times(u),new i(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return K=!0,s.d.length=m+1,s}function Ft(i,e){for(var t=i;--e;)t*=i;return t}function Vn(i,e){var t,n=e.s<0,r=Le(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Ve=n?4:1,e;if(t=e.divToInt(r),t.isZero())Ve=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Ve=Kn(t)?n?2:3:n?4:1,e;Ve=Kn(t)?n?1:4:n?3:2}return e.minus(r).abs()}function nn(i,e,t,n){var r,o,s,a,u,c,l,m,d,f=i.constructor,p=t!==void 0;if(p?(Pe(t,1,Je),n===void 0?n=f.rounding:Pe(n,0,8)):(t=f.precision,n=f.rounding),!i.isFinite())l=qn(i);else{for(l=Oe(i),s=l.indexOf("."),p?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new f(1),d.e=l.length-s,d.d=Ct(Oe(d),10,r),d.e=d.d.length),m=Ct(l,10,r),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=p?"0p+0":"0";else{if(s<0?o--:(i=new f(i),i.d=m,i.e=o,i=Z(i,d,t,n,0,r),m=i.d,o=i.e,c=Mn),s=m[t],a=r/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(i.s<0?8:7)),m.length=t,c)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=Qt.charAt(m[s]);if(p){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=Ct(l,r,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=Qt.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function Ln(i,e){if(i.length>e)return i.length=e,!0}function Vi(i){return new this(i).abs()}function Gi(i){return new this(i).acos()}function Ui(i){return new this(i).acosh()}function Xi(i,e){return new this(i).plus(e)}function zi(i){return new this(i).asin()}function Hi(i){return new this(i).asinh()}function Zi(i){return new this(i).atan()}function ji(i){return new this(i).atanh()}function Yi(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=Le(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?Le(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=Le(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(Z(i,e,o,1)),e=Le(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(Z(i,e,o,1)),t}function Qi(i){return new this(i).cbrt()}function Ji(i){return I(i=new this(i),i.e+1,2)}function $i(i,e,t){return new this(i).clamp(e,t)}function er(i){if(!i||typeof i!="object")throw Error(Mt+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,Je,"rounding",0,8,"toExpNeg",-ut,0,"toExpPos",0,ut,"maxE",0,ut,"minE",-ut,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=Jt[t]),(n=i[t])!==void 0)if(be(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(Qe+t+": "+n);if(t="crypto",r&&(this[t]=Jt[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Fn);else this[t]=!1;else throw Error(Qe+t+": "+n);return this}function tr(i){return new this(i).cos()}function nr(i){return new this(i).cosh()}function Gn(i){var e,t,n;function r(o){var s,a,u,c=this;if(!(c instanceof r))return new r(o);if(c.constructor=r,Rn(o)){c.s=o.s,K?!o.d||o.e>r.maxE?(c.e=NaN,c.d=null):o.e<r.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;K?s>r.maxE?(c.e=NaN,c.d=null):s<r.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return tn(c,o.toString())}else if(u!=="string")throw Error(Qe+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),On.test(o)?tn(c,o):Wi(c,o)}if(r.prototype=h,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=er,r.clone=Gn,r.isDecimal=Rn,r.abs=Vi,r.acos=Gi,r.acosh=Ui,r.add=Xi,r.asin=zi,r.asinh=Hi,r.atan=Zi,r.atanh=ji,r.atan2=Yi,r.cbrt=Qi,r.ceil=Ji,r.clamp=$i,r.cos=tr,r.cosh=nr,r.div=ir,r.exp=rr,r.floor=or,r.hypot=sr,r.ln=ar,r.log=ur,r.log10=lr,r.log2=cr,r.max=mr,r.min=dr,r.mod=fr,r.mul=pr,r.pow=gr,r.random=br,r.round=yr,r.sign=hr,r.sin=wr,r.sinh=kr,r.sqrt=Ar,r.sub=Tr,r.sum=Pr,r.tan=xr,r.tanh=Br,r.trunc=Ir,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function ir(i,e){return new this(i).div(e)}function rr(i){return new this(i).exp()}function or(i){return I(i=new this(i),i.e+1,3)}function sr(){var i,e,t=new this(0);for(K=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return K=!0,new this(1/0);t=e}return K=!0,t.sqrt()}function Rn(i){return i instanceof gt||i&&i.toStringTag===_n||!1}function ar(i){return new this(i).ln()}function ur(i,e){return new this(i).log(e)}function cr(i){return new this(i).log(2)}function lr(i){return new this(i).log(10)}function mr(){return Wn(this,arguments,"lt")}function dr(){return Wn(this,arguments,"gt")}function fr(i,e){return new this(i).mod(e)}function pr(i,e){return new this(i).mul(e)}function gr(i,e){return new this(i).pow(e)}function br(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Pe(i,1,Je),n=Math.ceil(i/N),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(Fn);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=N,n&&i&&(r=ue(10,N-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=N)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<N&&(t-=N-n)}return s.e=t,s.d=a,s}function yr(i){return I(i=new this(i),i.e+1,this.rounding)}function hr(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function wr(i){return new this(i).sin()}function kr(i){return new this(i).sinh()}function Ar(i){return new this(i).sqrt()}function Tr(i,e){return new this(i).sub(e)}function Pr(){var i=0,e=arguments,t=new this(e[i]);for(K=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return K=!0,I(t,this.precision,this.rounding)}function xr(i){return new this(i).tan()}function Br(i){return new this(i).tanh()}function Ir(i){return I(i=new this(i),i.e+1,1)}h[Symbol.for("nodejs.util.inspect.custom")]=h.toString;h[Symbol.toStringTag]="Decimal";var gt=h.constructor=Gn(Jt);Kt=new gt(Kt);Lt=new gt(Lt);var B=gt;import Er from"big.js";import Dt from"bn.js";import Sr from"toformat";var Nr=Sr,bt=Nr;import Ot from"big.js";import Kr from"bn.js";import Lr from"decimal.js-light";import yt from"bn.js";var Un=9007199254740991;function me(i){let e=ke("Raydium_parseBigNumberish");if(i instanceof yt)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new yt(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=Un||i<=-Un)&&e.logWithError(`BigNumberish number overflow: ${i}`),new yt(String(i))):typeof i=="bigint"?new yt(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new yt(0))}var _t=ke("module/fraction"),rn=bt(Ot),ht=bt(Lr),Rr={[0]:ht.ROUND_DOWN,[1]:ht.ROUND_HALF_UP,[2]:ht.ROUND_UP},Mr={[0]:Ot.roundDown,[1]:Ot.roundHalfUp,[2]:Ot.roundUp},G=class{constructor(e,t=new Kr(1)){this.numerator=me(e),this.denominator=me(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new G(this.denominator,this.numerator)}add(e){let t=e instanceof G?e:new G(me(e));return this.denominator.eq(t.denominator)?new G(this.numerator.add(t.numerator),this.denominator):new G(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof G?e:new G(me(e));return this.denominator.eq(t.denominator)?new G(this.numerator.sub(t.numerator),this.denominator):new G(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof G?e:new G(me(e));return new G(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof G?e:new G(me(e));return new G(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||_t.logWithError(`${e} is not an integer.`),e<=0&&_t.logWithError(`${e} is not positive.`),ht.set({precision:e+1,rounding:Rr[n]});let r=new ht(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||_t.logWithError(`${e} is not an integer.`),e<0&&_t.logWithError(`${e} is negative.`),rn.DP=e,rn.RM=Mr[n]||1,new rn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Fr=ke("Raydium_amount"),Xn=bt(Er);function _r(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):Fr.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var ye=class extends G{constructor(t,n,r=!0,o){let s=new Dt(0),a=on.pow(new Dt(t.decimals));if(r)s=me(n);else{let u=new Dt(0),c=new Dt(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=_r(n.toString(),t.decimals);u=me(l),c=me(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=ke(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new ye(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new ye(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return Xn.DP=this.token.decimals,new Xn(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as Or}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as zn}from"@solana/spl-token";var Hn={chainId:101,address:Or.default.toBase58(),programId:zn.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},nt={chainId:101,address:"So11111111111111111111111111111111111111112",programId:zn.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as un}from"@solana/web3.js";import{PublicKey as J,SystemProgram as Zn,SYSVAR_RENT_PUBKEY as Dr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as vr}from"@solana/spl-token";function sn({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var hs=[sn({pubkey:vr,isWritable:!1}),sn({pubkey:Zn.programId,isWritable:!1}),sn({pubkey:Dr,isWritable:!1})];function an({publicKey:i,transformSol:e}){let t=jn(i.toString());if(t instanceof J)return e&&t.equals(wt)?Yt:t;if(e&&t.toString()===wt.toBase58())return Yt;if(typeof t=="string"){if(t===J.default.toBase58())return J.default;try{return new J(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function jn(i){try{return new J(i)}catch{return i}}var vt=new J("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Yn=new J("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),kt=new J("SysvarRent111111111111111111111111111111111"),ws=new J("SysvarC1ock11111111111111111111111111111111"),lt=new J("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ks=new J("Sysvar1nstructions1111111111111111111111111"),As=Zn.programId,Ts=new J("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ps=new J("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),xs=new J("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Bs=new J("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Is=new J("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ss=new J("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Ns=new J("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Cs=new J("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ks=new J("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ls=new J("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Rs=new J("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Yt=new J("So11111111111111111111111111111111111111112"),wt=J.default;function Nt(i){return an({publicKey:i,transformSol:!0})}var cn=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===wt.toBase58()||e instanceof un&&wt.equals(e)){this.decimals=nt.decimals,this.symbol=nt.symbol,this.name=nt.name,this.mint=new un(nt.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?un.default:an({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ge=cn;Ge.WSOL=new cn(ee(Y({},nt),{mint:nt.address}));var ln=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Wt=ln;Wt.SOL=new ln(Hn);import Wr from"bn.js";var Qn=new G(new Wr(100)),$e=class extends G{toSignificant(e=5,t,n){return this.mul(Qn).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Qn).toFixed(e,t,n)}};var qr=ke("Raydium_price"),Me=class extends G{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new G(mn(n.decimals),mn(r.decimals))}get raw(){return new G(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Me({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&qr.logWithError("mul token not equals");let n=super.mul(t);return new Me({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};import{PublicKey as la}from"@solana/web3.js";import da from"bn.js";var Vr=new Ue(0),Ka=new Ue(1),La=new Ue(2),Ra=new Ue(3),Ma=new Ue(5),on=new Ue(10),Ea=new Ue(100),Fa=new Ue(1e3),_a=new Ue(1e4);function mn(i){return on.pow(me(i))}function Zt(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Ur}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Xr}from"@solana/spl-token";import{ComputeBudgetProgram as Ua,Keypair as Ha,PublicKey as Gr,Transaction as ja,TransactionMessage as Qa,VersionedTransaction as Ja}from"@solana/web3.js";var he={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{TOKEN_PROGRAM_ID as nu}from"@solana/spl-token";var iu=ke("Raydium_txUtil");function xe(i,e){let[t,n]=Gr.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function De(i,e,t){return xe([i.toBuffer(),(t!=null?t:Xr).toBuffer(),e.toBuffer()],new Ur("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as v}from"@solana/web3.js";var lu=new v("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),mu=new v("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),du=new v("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),fu=new v("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),pu=new v("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),gu=new v("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),bu=new v("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),yu=new v("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),hu=new v("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),wu=new v("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),ku=new v("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Au=new v("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Tu=new v("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Pu=new v("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),xu=new v("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Bu=new v("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Iu=new v("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Su=new v("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Nu=new v("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Cu=new v("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Ku=new v("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),zr=new v("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Hr=new v("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Zr=new v("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2");var Lu={SERUM_MARKET:v.default,OPENBOOK_MARKET:new v("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:v.default,FarmV3:new v("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new v("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new v("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new v("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new v("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new v("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new v("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new v("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new v("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:zr,CREATE_CPMM_POOL_AUTH:Hr,CREATE_CPMM_POOL_FEE_ACC:Zr,FEE_DESTINATION_ID:new v("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import Ee from"bn.js";var At=1e4;function ie(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=ee(Y({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new Ee(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===At){let u=new Ee(o.maximumFee.toString());return{amount:i.add(u),fee:u,expirationTime:a}}else{let u=dn(i.mul(new Ee(At)),new Ee(At-o.transferFeeBasisPoints)),c=new Ee(o.maximumFee.toString()),l=u.sub(i).gt(c)?i.add(c):u,m=dn(l.mul(new Ee(o.transferFeeBasisPoints)),new Ee(At)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let u=dn(i.mul(new Ee(o.transferFeeBasisPoints)),new Ee(At)),c=u.gt(s)?s:u;return{amount:i,fee:c,expirationTime:a}}}function et(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function dn(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new Ee(0))?t.add(new Ee(1)):t}import{PublicKey as jr,AddressLookupTableAccount as Jn}from"@solana/web3.js";var Yr={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new Jn({key:new jr("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:Jn.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as Qu,sendAndConfirmTransaction as Ju,Transaction as ec,TransactionMessage as nc,VersionedTransaction as ic}from"@solana/web3.js";import oc from"axios";import{ASSOCIATED_TOKEN_PROGRAM_ID as Pi,TOKEN_2022_PROGRAM_ID as He,TOKEN_PROGRAM_ID as oe}from"@solana/spl-token";import{PublicKey as oo}from"@solana/web3.js";import ni,{isBN as ii}from"bn.js";import{bits as Kc,BitStructure as Lc,blob as Qr,Blob as Rc,cstr as Mc,f32 as Ec,f32be as Fc,f64 as _c,f64be as Oc,greedy as Dc,Layout as Jr,ns64 as vc,ns64be as Wc,nu64 as qc,nu64be as Vc,offset as Gc,s16 as Uc,s16be as Xc,s24 as zc,s24be as Hc,s32 as $r,s32be as Zc,s40 as jc,s40be as Yc,s48 as Qc,s48be as Jc,s8 as $c,seq as eo,struct as el,Structure as to,u16 as no,u16be as tl,u24 as nl,u24be as il,u32 as rl,u32be as ol,u40 as sl,u40be as al,u48 as ul,u48be as cl,u8 as io,UInt as ro,union as ll,Union as ml,unionLayoutDiscriminator as dl,utf8 as fl}from"@solana/buffer-layout";var fn=Jr,$n=to;var pn=ro;var ei=io,Tt=no;var pe=$r;var ti=eo;var Se=Qr;var mt=class extends fn{constructor(t,n,r){super(t,r);this.blob=Se(t),this.signed=n}decode(t,n=0){let r=new ni(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new ni(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function ae(i){return new pn(1,i)}function dt(i){return new pn(4,i)}function C(i){return new mt(8,!1,i)}function q(i){return new mt(16,!1,i)}function ri(i){return new mt(8,!0,i)}function oi(i){return new mt(16,!0,i)}var qt=class extends fn{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function te(i){return new qt(Se(32),e=>new oo(e),e=>e.toBuffer(),i)}function ve(i){return new qt(ei(),so,ao,i)}function so(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function ao(i){return i?1:0}var gn=class extends $n{decode(e,t){return super.decode(e,t)}};function j(i,e,t){return new gn(i,e,t)}function ne(i,e,t){let n,r=typeof e=="number"?e:ii(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=ii(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return ti(i,r,t)}import wo from"bn.js";import Ne from"bn.js";var re=new Ne(0),We=new Ne(1),Xe=new Ne(-1),Be=new Ne(1).shln(64),Vt=new Ne(1).shln(128),bn=Be.sub(We),Pt=64,si=Vt.subn(1),we=-443636,Ae=-we,it=new Ne("4295048016"),rt=new Ne("79226673521066979257578248091"),Sl=new Ne("4295048017"),Nl=new Ne("79226673521066979257578248090"),ai=16,ui="59543866431248",ci="184467440737095516",li="15793534762490258745",Gt=new Ne(10).pow(new Ne(6));var Cl=new Ne("18446744073700000000");import F from"bn.js";function Ut(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function yn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function hn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function xt(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function mi(i,e){return xt(i,e)?null:yn(i,e)}function di(i,e){return xt(i,e)?null:hn(i,e)}var Fl=Buffer.from("amm_config","utf8"),uo=Buffer.from("pool","utf8"),co=Buffer.from("pool_vault","utf8"),lo=Buffer.from("pool_reward_vault","utf8"),fi=Buffer.from("position","utf8"),mo=Buffer.from("tick_array","utf8"),fo=Buffer.from("operation","utf8"),po=Buffer.from("pool_tick_array_bitmap_extension","utf8"),go=Buffer.from("observation","utf8");function pi(i,e,t,n){return xe([uo,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function wn(i,e,t){return xe([co,e.toBuffer(),t.toBuffer()],i)}function gi(i,e,t){return xe([lo,e.toBuffer(),t.toBuffer()],i)}function U(i,e,t){return xe([mo,e.toBuffer(),Ut(t)],i)}function tt(i,e,t,n){return xe([fi,e.toBuffer(),Ut(t),Ut(n)],i)}function Ce(i,e){return xe([fi,e.toBuffer()],i)}function Xt(i){return xe([Buffer.from("metadata","utf8"),lt.toBuffer(),i.toBuffer()],lt)}function kn(i){return xe([fo],i)}function Ke(i,e){return xe([po,e.toBuffer()],i)}function bi(i,e){return xe([go,e.toBuffer()],i)}var bo=Buffer.from("locked_position","utf8");function An(i,e){return xe([bo,e.toBuffer()],i)}import{PublicKey as Fe}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as yi}from"@solana/spl-token";import Q from"bn.js";import qe from"bn.js";var Bt=class{static getfeeGrowthInside(e,t,n){let r=new qe(0),o=new qe(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new qe(0),a=new qe(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=E.wrappingSubU128(E.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),c=E.wrappingSubU128(E.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=E.mulDivFloor(E.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Be),u=t.tokenFeesOwedA.add(a),c=E.mulDivFloor(E.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Be),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=E.mulDivFloor(E.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Be),u=t.tokenFeesOwedA.add(a),c=E.mulDivFloor(E.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Be),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=E.wrappingSubU128(u,c.growthInsideLastX64),m=E.mulDivFloor(l,t.liquidity,Be),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=E.wrappingSubU128(u,c.growthInsideLastX64),m=E.mulDivFloor(l,t.liquidity,Be),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new qe(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new qe(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(E.wrappingSubU128(E.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new qe(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new qe(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(E.wrappingSubU128(E.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var y,b,T,w;let a=R.priceToSqrtPriceX64(new B(e.price),e.mintA.decimals,e.mintB.decimals),u=R.getSqrtPriceX64FromTick(t.tickLower),c=R.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,m=V.getAmountsFromLiquidity(a,u,c,n,o),[d,f]=[ie(m.amountA,(y=e.mintA.extensions)==null?void 0:y.feeConfig,s,!0),ie(m.amountB,(b=e.mintB.extensions)==null?void 0:b.feeConfig,s,!0)],[p,g]=[ie(new qe(new B(m.amountA.toString()).mul(l).toFixed(0)),(T=e.mintA.extensions)==null?void 0:T.feeConfig,s,!0),ie(new qe(new B(m.amountB.toString()).mul(l).toFixed(0)),(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:f,amountSlippageA:p,amountSlippageB:g,expirationTime:et(d.expirationTime,f.expirationTime)}}};var yo=15,W=class{static async getTickArrays(e,t,n,r,o,s,a){let u=[],c=x.getTickArrayStartIndexByTick(r,o),l=x.getInitializedTickArrayInRange(s,a,o,c,Math.floor(yo/2));for(let f=0;f<l.length;f++){let{publicKey:p}=U(t,n,l[f]);u.push(p)}let m=(await Ze(e,u)).map(f=>f!==null?It.decode(f.data):null),d={};for(let f=0;f<u.length;f++){let p=m[f];p!==null&&(d[p.startTickIndex]=ee(Y({},p),{address:u[f]}))}return d}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=x.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:f}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,d,f]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/W.tickCount(t)),a=n?x.searchLowBitFromStart(r,o,s-1,1,t):x.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=ce-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<ce;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=U(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=x.getTickArrayStartIndexByTick(r,o),u=Math.floor((r-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u-1}else for(u=u+1;u<ce;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u+1}let{publicKey:m}=U(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(x.checkIsOutOfBoundary(e)){if(e>Ae)return!1;let n=x.getTickArrayStartIndexByTick(we,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return ce*e}};var Tn=14,ze=class{static maxTickInTickarrayBitmap(e){return e*ce*ot}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!W.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-W.tickCount(n):t+W.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*ce,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(r){let l=e.shln(1024-c-1),m=mi(1024,l);if(m!==null){let d=(c-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=di(1024,l);if(m!==null){let d=(c+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-W.tickCount(n)}}}},St=class{static getBitmapOffset(e,t){if(!W.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=ze.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=ze.maxTickInTickarrayBitmap(e),n=-t;if(Ae<=t)throw Error(`extensionTickBoundary check error: ${Ae}, ${t}`);if(n<=we)throw Error(`extensionTickBoundary check error: ${n}, ${we}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:x.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=W.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=ze.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let u=x.mergeTickArrayBitmap(e).shln(ot-1-a),c=xt(512,u)?null:yn(512,u);if(c!==null){let l=t-c*W.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=x.mergeTickArrayBitmap(e).shrn(a),c=xt(512,u)?null:hn(512,u);if(c!==null){let l=t+c*W.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-W.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%ze.maxTickInTickarrayBitmap(t),r=Math.floor(n/W.tickCount(t));return e<0&&n!=0&&(r=ot-r),r}};var ge=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,s=!1){let a=n.toBase58()===e.mintA.address,u=[],{isExist:c,startIndex:l,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,a);if(!c||l===void 0||!m)throw new Error("Invalid tick array");u.push(m);let{allTrade:d,amountCalculated:f,accounts:p,sqrtPriceX64:g,feeAmount:y}=st.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,o,s);return u.push(...p),{allTrade:d,expectedAmountOut:f.mul(Xe),remainingAccounts:u,executionPrice:g,feeAmount:y}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let g=this.preInitializedTickArrayStartIndex(e,s);if(g.isExist){let{publicKey:y}=U(e.programId,e.id,g.nextStartIndex);a.push(y)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:f,feeAmount:p}=st.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(Xe),c,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:f,feeAmount:p}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=ge.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?St.checkTickArrayIsInit(W.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):x.checkTickArrayIsInitialized(x.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=U(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,W.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=U(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/W.tickCount(e.tickSpacing)),r=t?x.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):x.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=W.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=ze.nextInitializedTickArrayStartIndex(x.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=St.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<we||t>Ae)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,u,c;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(c=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(d===void 0)throw Error("get new reward mint info error");let f=ee(Y({},m),{perSecond:E.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Fe(d)});if(f.tokenMint.equals(Fe.default))continue;if(n<=f.openTime.toNumber()||r.eq(re)){s.push(f);continue}let p=new Q(Math.min(f.endTime.toNumber(),n)),g=p.sub(f.lastUpdateTime),y=E.mulDivFloor(g,f.emissionsPerSecondX64,r),b=f.rewardGrowthGlobalX64.add(y),T=E.mulDivFloor(g,f.emissionsPerSecondX64,Be),w=f.rewardTotalEmissioned.add(T);s.push(ee(Y({},f),{rewardGrowthGlobalX64:b,rewardTotalEmissioned:w,lastUpdateTime:p}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=x.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=ze.maxTickInTickarrayBitmap(e),n=-t;return t>Ae&&(t=W.getArrayStartIndex(Ae,e)+W.tickCount(e)),n<we&&(n=W.getArrayStartIndex(we,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!W.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/W.tickCount(t)*ot}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await jt(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=ki.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let u of t){let c=x.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=x.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:d}=U(u.programId,u.id,m);o.push({pubkey:d}),r[d.toString()]=u.id}}let s=await jt(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=r[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=It.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]=ee(Y({},l),{address:u.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(l=>l.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(d=>d.accountInfo.mint),c=[];for(let d of u)for(let f of s)c.push(Ce(f,d).publicKey);let l=await Ze(t,c,{batchRequest:r}),m={};for(let d of l){if(d===null)continue;let f=wi.decode(d.data),p=f.poolId.toString(),g=e.find(L=>L.state.id.toBase58()===p);if(g===void 0)continue;let y=g.state,b=x._getTickPriceLegacy({poolInfo:y,tick:f.tickLower,baseIn:!0}),T=x._getTickPriceLegacy({poolInfo:y,tick:f.tickUpper,baseIn:!0}),{amountA:w,amountB:P}=V.getAmountsFromLiquidity(y.sqrtPriceX64,b.tickSqrtPriceX64,T.tickSqrtPriceX64,f.liquidity,!1),S=1/(1-Math.sqrt(Math.sqrt(b.price.div(T.price).toNumber())));g.positionAccount=[...(a=g.positionAccount)!=null?a:[],{poolId:f.poolId,nftMint:f.nftMint,priceLower:b.price,priceUpper:T.price,amountA:w,amountB:P,tickLower:f.tickLower,tickUpper:f.tickUpper,liquidity:f.liquidity,feeGrowthInsideLastX64A:f.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:f.feeGrowthInsideLastX64B,tokenFeesOwedA:f.tokenFeesOwedA,tokenFeesOwedB:f.tokenFeesOwedB,rewardInfos:f.rewardInfos.map(L=>ee(Y({},L),{pendingReward:new Q(0)})),leverage:S,tokenFeeAmountA:new Q(0),tokenFeeAmountB:new Q(0)}];let k=await x.getTickArrayAddressByTick(g.state.programId,f.poolId,f.tickLower,g.state.tickSpacing),M=await x.getTickArrayAddressByTick(g.state.programId,f.poolId,f.tickUpper,g.state.tickSpacing);m[`${g.state.programId.toString()}-${f.poolId.toString()}-${f.tickLower}`]=k,m[`${g.state.programId.toString()}-${f.poolId.toString()}-${f.tickUpper}`]=M}if(o){let d=Object.values(m),f=await Ze(t,d,{batchRequest:r}),p={};for(let g=0;g<d.length;g++){let y=f[g];if(y===null)continue;let b=d[g].toString();p[b]=It.decode(y.data)}for(let{state:g,positionAccount:y}of e)if(!!y)for(let b of y){let T=`${g.programId.toString()}-${g.id.toString()}-${b.tickLower}`,w=`${g.programId.toString()}-${g.id.toString()}-${b.tickUpper}`,P=p[m[T].toString()],S=p[m[w].toString()],k=P.ticks[x.getTickOffsetInArray(b.tickLower,g.tickSpacing)],M=S.ticks[x.getTickOffsetInArray(b.tickUpper,g.tickSpacing)],{tokenFeeAmountA:L,tokenFeeAmountB:z}=await Bt.GetPositionFees(g,b,k,M),H=await Bt.GetPositionRewards(g,b,k,M);b.tokenFeeAmountA=L.gte(new Q(0))?L:new Q(0),b.tokenFeeAmountB=z.gte(new Q(0))?z:new Q(0);for(let _=0;_<H.length;_++)b.rewardInfos[_].pendingReward=H[_].gte(new Q(0))?H[_]:new Q(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new B(0),catchLiquidityInsufficient:u=!1}){var le;let c,l=n.toBase58()===e.mintA.address,[m,d]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new B(0))?c=l?it.add(new Q(1)):rt.sub(new Q(1)):c=R.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let f=ie(o,m,r,!1),{allTrade:p,expectedAmountOut:g,remainingAccounts:y,executionPrice:b,feeAmount:T}=ge.getOutputAmountAndRemainAccounts(e,t,n,f.amount.sub((le=f.fee)!=null?le:re),c,u),w=ie(g,d,r,!1),P=R.sqrtPriceX64ToPrice(b,e.mintA.decimals,e.mintB.decimals),S=l?P:new B(1).div(P),k=g.mul(new Q(Math.floor((1-s)*1e10))).div(new Q(1e10)),M=ie(k,d,r,!1),L=l?e.currentPrice:new B(1).div(e.currentPrice),z=new B(S).sub(L).abs(),H=L,_=new $e(new B(z).mul(10**15).toFixed(0),new B(H).mul(10**15).toFixed(0));return{allTrade:p,realAmountIn:f,amountOut:w,minAmountOut:M,expirationTime:et(f.expirationTime,w.expirationTime),currentPrice:e.currentPrice,executionPrice:S,priceImpact:_,fee:T,remainingAccounts:y,executionPriceX64:b}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let u=r.address===e.mintB.address,[c,l]=u?[e.mintA,e.mintB]:[e.mintB,e.mintA],[m,d]=[new Ge(ee(Y({},c),{mint:c.address,isToken2022:c.programId===yi.toBase58()})),new Ge(ee(Y({},l),{mint:l.address,isToken2022:l.programId===yi.toBase58()}))],{allTrade:f,realAmountIn:p,amountOut:g,minAmountOut:y,expirationTime:b,currentPrice:T,executionPrice:w,priceImpact:P,fee:S,remainingAccounts:k,executionPriceX64:M}=ge.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Fe(c.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),L=ee(Y({},p),{amount:new ye(m,p.amount),fee:p.fee===void 0?void 0:new ye(m,p.fee)}),z=ee(Y({},g),{amount:new ye(d,g.amount),fee:g.fee===void 0?void 0:new ye(d,g.fee)}),H=ee(Y({},y),{amount:new ye(d,y.amount),fee:y.fee===void 0?void 0:new ye(d,y.fee)}),_=new Me({baseToken:m,denominator:new Q(10).pow(new Q(20+m.decimals)),quoteToken:d,numerator:T.mul(new B(10**(20+d.decimals))).toFixed(0)}),le=new Me({baseToken:m,denominator:new Q(10).pow(new Q(20+m.decimals)),quoteToken:d,numerator:w.mul(new B(10**(20+d.decimals))).toFixed(0)}),se=new ye(m,S);return{allTrade:f,realAmountIn:L,amountOut:z,minAmountOut:H,expirationTime:b,currentPrice:_,executionPrice:le,priceImpact:P,fee:se,remainingAccounts:k,executionPriceX64:M}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:o,slippage:s,priceLimit:a=new B(0)}){var H;let u=n.toBase58()===e.mintA.address,c={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;a.equals(new B(0))?l=u?rt.sub(new Q(1)):it.add(new Q(1)):l=R.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let m=ie(o,c[n.toString()],r,!0),{expectedAmountIn:d,remainingAccounts:f,executionPrice:p,feeAmount:g}=ge.getInputAmountAndRemainAccounts(e,t,n,m.amount.sub((H=m.fee)!=null?H:re),l),y=u?e.mintB.address:e.mintA.address,b=ie(d,c[y],r,!1),T=R.sqrtPriceX64ToPrice(p,e.mintA.decimals,e.mintB.decimals),w=u?T:new B(1).div(T),P=d.mul(new Q(Math.floor((1+s)*1e10))).div(new Q(1e10)),S=ie(P,c[y],r,!0),k=u?e.currentPrice:new B(1).div(e.currentPrice),M=new B(w).sub(k).abs(),L=k,z=new $e(new B(M).mul(10**15).toFixed(0),new B(L).mul(10**15).toFixed(0));return{amountIn:b,maxAmountIn:S,realAmountOut:m,expirationTime:et(b.expirationTime,m.expirationTime),currentPrice:e.currentPrice,executionPrice:w,priceImpact:z,fee:g,remainingAccounts:f}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var p,g,y;let o=e[t],s=x.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=x.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,d=o.priceMax-o.priceMin,f;return l<=0?f=0:m===l?f=d/l:d===l?f=l/m:f=l/d*(l/m),{feeApr:o.feeApr*f,rewardsApr:[((p=o.rewardApr[0])!=null?p:0)*f,((g=o.rewardApr[1])!=null?g:0)*f,((y=o.rewardApr[2])!=null?y:0)*f],apr:o.apr*f}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=r[Nt(e.mintA.address).toString()],d=r[Nt(e.mintB.address).toString()],f=e.mintA.decimals,p=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let g=R.priceToSqrtPriceX64(new B(e.price),e.mintA.decimals,e.mintB.decimals),y=R.getSqrtPriceX64FromTick(s),b=R.getSqrtPriceX64FromTick(a),{amountSlippageA:T,amountSlippageB:w}=V.getAmountsFromLiquidityWithSlippage(g,y,b,t,!1,!1,0),{amountSlippageA:P,amountSlippageB:S}=V.getAmountsFromLiquidityWithSlippage(g,y,b,o,!1,!1,0),k=new B(T.toString()).div(new B(10).pow(f)).mul(m.value).add(new B(w.toString()).div(new B(10).pow(p)).mul(d.value)),M=new B(P.toString()).div(new B(10).pow(f)).mul(m.value).add(new B(S.toString()).div(new B(10).pow(p)).mul(d.value)),L=new B(1).div(k.add(M)),H=new B(l.volumeFee).mul(365).div(c).mul(L).mul(100).toNumber(),_=3600*24*365,le=e.rewardDefaultInfos.map(se=>{var X,Bn;let Te=se.mint.decimals,$=r[se.mint.address];return u<((X=se.startTime)!=null?X:0)||u>((Bn=se.endTime)!=null?Bn:0)||!se.perSecond||!$||Te===void 0?0:new B($.value).mul(new B(se.perSecond).mul(_)).div(new B(10).pow(Te)).mul(L).mul(100).toNumber()});return{feeApr:H,rewardsApr:le,apr:H+le.reduce((se,Te)=>se+Te,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var b,T;let l=R.priceToSqrtPriceX64(new B(e.price),e.mintA.decimals,e.mintB.decimals),m=R.getSqrtPriceX64FromTick(n),d=R.getSqrtPriceX64FromTick(r),f=a?1-s:1+s,p=ie(o,(b=e[t?"mintA":"mintB"].extensions)==null?void 0:b.feeConfig,u,!c),g=new Q(new B(p.amount.sub((T=p.fee)!=null?T:re).toString()).mul(f).toFixed(0)),y;if(l.lte(m))y=t?V.getLiquidityFromTokenAmountA(m,d,g,!a):new Q(0);else if(l.lte(d)){let w=V.getLiquidityFromTokenAmountA(l,d,g,!a),P=V.getLiquidityFromTokenAmountB(m,l,g);y=t?w:P}else y=t?new Q(0):V.getLiquidityFromTokenAmountB(m,d,g);return ge.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:r,liquidity:y,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var y,b,T,w;let u=R.getSqrtPriceX64FromTick(n),c=R.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,m=V.getAmountsFromLiquidity(R.priceToSqrtPriceX64(new B(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[d,f]=[ie(m.amountA,(y=t.mintA.extensions)==null?void 0:y.feeConfig,e,!0),ie(m.amountB,(b=t.mintB.extensions)==null?void 0:b.feeConfig,e,!0)],[p,g]=[ie(m.amountA.muln(l),(T=t.mintA.extensions)==null?void 0:T.feeConfig,e,!0),ie(m.amountB.muln(l),(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:f,amountSlippageA:p,amountSlippageB:g,expirationTime:et(d.expirationTime,f.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(u=>!n[u.id]).map(u=>new Fe(u.id));(await Ze(e,r)).forEach((u,c)=>{!u||(n[r[c].toBase58()]=hi.decode(u.data))});let s=t.map(u=>Ke(new Fe(u.programId),new Fe(u.id)).publicKey),a=await ge.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((u,c)=>ee(Y({},u),{[c.id]:ee(Y({},n[c.id]),{id:new Fe(c.id),version:6,programId:new Fe(c.programId),mintA:c.mintA,mintB:c.mintB,ammConfig:ee(Y({},c.config),{id:new Fe(c.config.id),fundOwner:""}),currentPrice:new B(c.price),exBitmapInfo:a[Ke(new Fe(c.programId),new Fe(c.id)).publicKey.toBase58()],startTime:n[c.id].startTime.toNumber()})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var E=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(re)||(o=o.add(We)),o}static mulDivFloor(e,t,n){if(n.eq(re))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(re))throw new Error("division by 0");return e.mul(t).add(n.sub(We)).div(n)}static x64ToDecimal(e,t){return new B(e.toString()).div(B.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new F(e.mul(B.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Vt).sub(t).mod(Vt)}};function de(i,e){return Pn(i.mul(e),64,256)}function ho(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Pn(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var R=class{static sqrtPriceX64ToPrice(e,t,n){return E.x64ToDecimal(e).pow(2).mul(B.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return E.decimalToX64(e.mul(B.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(re))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(re))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(re))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(re))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(re))return e;let o=t.shln(Pt);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?E.mulDivCeil(s,e,a):E.mulDivRoundingUp(s,We,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return E.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(Pt);if(r)return e.add(o.div(t));{let s=E.mulDivRoundingUp(o,We,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<we||e>Ae)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new F("18445821805675395072"):new F("18446744073709551616");return(t&2)!=0&&(n=de(n,new F("18444899583751176192"))),(t&4)!=0&&(n=de(n,new F("18443055278223355904"))),(t&8)!=0&&(n=de(n,new F("18439367220385607680"))),(t&16)!=0&&(n=de(n,new F("18431993317065453568"))),(t&32)!=0&&(n=de(n,new F("18417254355718170624"))),(t&64)!=0&&(n=de(n,new F("18387811781193609216"))),(t&128)!=0&&(n=de(n,new F("18329067761203558400"))),(t&256)!=0&&(n=de(n,new F("18212142134806163456"))),(t&512)!=0&&(n=de(n,new F("17980523815641700352"))),(t&1024)!=0&&(n=de(n,new F("17526086738831433728"))),(t&2048)!=0&&(n=de(n,new F("16651378430235570176"))),(t&4096)!=0&&(n=de(n,new F("15030750278694412288"))),(t&8192)!=0&&(n=de(n,new F("12247334978884435968"))),(t&16384)!=0&&(n=de(n,new F("8131365268886854656"))),(t&32768)!=0&&(n=de(n,new F("3584323654725218816"))),(t&65536)!=0&&(n=de(n,new F("696457651848324352"))),(t&131072)!=0&&(n=de(n,new F("26294789957507116"))),(t&262144)!=0&&(n=de(n,new F("37481735321082"))),e>0&&(n=si.div(n)),n}static getTickFromPrice(e,t,n){return R.getTickFromSqrtPriceX64(R.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(rt)||e.lt(it))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new F(t-64),r=ho(n,32,128),o=new F("8000000000000000","hex"),s=0,a=new F(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new F(0))&&s<ai;){u=u.mul(u);let p=u.shrn(127);u=u.shrn(63+p.toNumber()),a=a.add(o.mul(p)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=r.add(c).mul(new F(ui)),d=Pn(m.sub(new F(ci)),64,128).toNumber(),f=Pn(m.add(new F(li)),64,128).toNumber();return d==f?d:R.getSqrtPriceX64FromTick(f).lte(e)?f:d}},at=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=R.getTickFromSqrtPriceX64(R.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=at.getTickWithPriceAndTickspacing(e,t,n,r),s=R.getSqrtPriceX64FromTick(o);return R.sqrtPriceX64ToPrice(s,n,r)}},V=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(re))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(Pt),s=t.sub(e);return r?E.mulDivRoundingUp(E.mulDivCeil(o,s,t),We,e):E.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(re))throw new Error("sqrtPriceX64A must greater than 0");return r?E.mulDivCeil(n,t.sub(e),Be):E.mulDivFloor(n,t.sub(e),Be)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?E.mulDivRoundingUp(a,We,bn):a.shrn(Pt)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),E.mulDivFloor(n,bn,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return V.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=V.getLiquidityFromTokenAmountA(e,n,r,!1),a=V.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return V.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:V.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new F(0)};if(e.lt(n)){let s=V.getTokenAmountAFromLiquidity(e,n,r,o),a=V.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new F(0),amountB:V.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:u,amountB:c}=V.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,m=new F(new B(u.toString()).mul(l).toFixed(0)),d=new F(new B(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var T,w,P,S;let c=R.priceToSqrtPriceX64(new B(e.price),e.mintA.decimals,e.mintB.decimals),l=R.getSqrtPriceX64FromTick(t),m=R.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,f=V.getAmountsFromLiquidity(c,l,m,r,s),[p,g]=[ie(f.amountA,(T=e.mintA.extensions)==null?void 0:T.feeConfig,a,u),ie(f.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,a,u)],[y,b]=[ie(new F(new B(f.amountA.toString()).mul(d).toFixed(0)),(P=e.mintA.extensions)==null?void 0:P.feeConfig,a,u),ie(new F(new B(f.amountB.toString()).mul(d).toFixed(0)),(S=e.mintB.extensions)==null?void 0:S.feeConfig,a,u)];return{liquidity:r,amountA:p,amountB:g,amountSlippageA:y,amountSlippageB:b,expirationTime:et(p.expirationTime,g.expirationTime)}}},st=class{static swapCompute(e,t,n,r,o,s,a,u,c,l,m,d,f,p,g=!1){if(d.eq(re))throw new Error("amountSpecified must not be 0");if(p||(p=s?it.add(We):rt.sub(We)),s){if(p.lt(it))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(p.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(p.gt(rt))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(p.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let y=d.gt(re),b={amountSpecifiedRemaining:d,amountCalculated:re,sqrtPriceX64:m,tick:c>f?Math.min(f+W.tickCount(l)-1,c):f,accounts:[],liquidity:u,feeAmount:new F(0)},T=f,w=n[f],P=0,S=!s&&w.startTickIndex===b.tick;for(;!b.amountSpecifiedRemaining.eq(re)&&!b.sqrtPriceX64.eq(p);){P>10;let k={};k.sqrtPriceStartX64=b.sqrtPriceX64;let M=x.nextInitTick(w,b.tick,l,s,S),L=M||null,z=null;if(!(L!=null&&L.liquidityGross.gtn(0))){let _=ge.nextInitializedTickArrayStartIndex({tickCurrent:b.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},T,s);if(!_.isExist){if(g)return{allTrade:!1,amountSpecifiedRemaining:b.amountSpecifiedRemaining,amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts};throw Error("swapCompute LiquidityInsufficient")}T=_.nextStartIndex;let{publicKey:le}=U(e,t,T);z=le,w=n[T];try{L=x.firstInitializedTick(w,s)}catch{throw Error("not found next tick info")}}k.tickNext=L.tick,k.initialized=L.liquidityGross.gtn(0),f!==T&&z&&(b.accounts.push(z),f=T),k.tickNext<we?k.tickNext=we:k.tickNext>Ae&&(k.tickNext=Ae),k.sqrtPriceNextX64=R.getSqrtPriceX64FromTick(k.tickNext);let H;if(s&&k.sqrtPriceNextX64.lt(p)||!s&&k.sqrtPriceNextX64.gt(p)?H=p:H=k.sqrtPriceNextX64,[b.sqrtPriceX64,k.amountIn,k.amountOut,k.feeAmount]=st.swapStepCompute(b.sqrtPriceX64,H,b.liquidity,b.amountSpecifiedRemaining,a),b.feeAmount=b.feeAmount.add(k.feeAmount),y?(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.sub(k.amountIn.add(k.feeAmount)),b.amountCalculated=b.amountCalculated.sub(k.amountOut)):(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.add(k.amountOut),b.amountCalculated=b.amountCalculated.add(k.amountIn.add(k.feeAmount))),b.sqrtPriceX64.eq(k.sqrtPriceNextX64)){if(k.initialized){let _=L.liquidityNet;s&&(_=_.mul(Xe)),b.liquidity=V.addDelta(b.liquidity,_)}S=k.tickNext!=b.tick&&!s&&w.startTickIndex===k.tickNext,b.tick=s?k.tickNext-1:k.tickNext}else if(b.sqrtPriceX64!=k.sqrtPriceStartX64){let _=R.getTickFromSqrtPriceX64(b.sqrtPriceX64);S=_!=b.tick&&!s&&w.startTickIndex===_,b.tick=_}++P}try{let{nextStartIndex:k,isExist:M}=W.nextInitializedTickArray(b.tick,l,s,r,o);M&&f!==k&&(b.accounts.push(U(e,t,k).publicKey),f=k)}catch{}return{allTrade:!0,amountSpecifiedRemaining:re,amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new F(0),amountIn:new F(0),amountOut:new F(0),feeAmount:new F(0)},a=e.gte(t),u=r.gte(re);if(u){let l=E.mulDivFloor(r,Gt.sub(new F(o.toString())),Gt);s.amountIn=a?V.getTokenAmountAFromLiquidity(t,e,n,!0):V.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=R.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?V.getTokenAmountBFromLiquidity(t,e,n,!1):V.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(Xe).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=R.getNextSqrtPriceX64FromOutput(e,n,r.mul(Xe),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=V.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=V.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:V.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:V.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(r.mul(Xe))&&(s.amountOut=r.mul(Xe)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=E.mulDivCeil(s.amountIn,new F(o),Gt.sub(new F(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var ce=60,ot=512,x=class{static getTickArrayAddressByTick(e,t,n,r){let o=x.getTickArrayStartIndexByTick(n,r),{publicKey:s}=U(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=x.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=ce)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=W.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*W.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*ce,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*ce,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*ce:e+t*ce}static mergeTickArrayBitmap(e){let t=new wo(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*ce));return[...x.searchLowBitFromStart(e,t,s-1,o,n),...x.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return x.searchHightBitFromStart(e,t,0,ot,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=x.getAllInitializedTickArrayStartIndex(n,r,o);for(let u of a){let{publicKey:c}=U(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>x.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===r)break}let u=W.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>x.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===r)break}let u=W.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<we||e>Ae}static nextInitTick(e,t,n,r,o){if(W.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<ce;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=ce-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<ce;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=R.getSqrtPriceX64FromTick(t),o=R.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new B(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new B(1).div(t),o=at.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=R.getSqrtPriceX64FromTick(o),a=R.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new B(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=R.getSqrtPriceX64FromTick(t),o=R.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new B(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new B(1).div(t),o=at.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=R.getSqrtPriceX64FromTick(o),a=R.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new B(1).div(a)}}};var Gm=j([Se(8),ae("bump"),Tt("index"),te(""),dt("protocolFeeRate"),dt("tradeFeeRate"),Tt("tickSpacing"),ne(C(),8,"")]),ko=j([dt("blockTimestamp"),ri("tickCumulative"),ne(C(),4)]),Ai=j([Se(8),ve("initialized"),C("recentEpoch"),Tt("observationIndex"),te("poolId"),ne(ko,100,"observations"),ne(C(),4)]),Ao=j([ae("rewardState"),C("openTime"),C("endTime"),C("lastUpdateTime"),q("emissionsPerSecondX64"),C("rewardTotalEmissioned"),C("rewardClaimed"),te("tokenMint"),te("tokenVault"),te("creator"),q("rewardGrowthGlobalX64")]),hi=j([Se(8),ae("bump"),te("ammConfig"),te("creator"),te("mintA"),te("mintB"),te("vaultA"),te("vaultB"),te("observationId"),ae("mintDecimalsA"),ae("mintDecimalsB"),Tt("tickSpacing"),q("liquidity"),q("sqrtPriceX64"),pe("tickCurrent"),dt(),q("feeGrowthGlobalX64A"),q("feeGrowthGlobalX64B"),C("protocolFeesTokenA"),C("protocolFeesTokenB"),q("swapInAmountTokenA"),q("swapOutAmountTokenB"),q("swapInAmountTokenB"),q("swapOutAmountTokenA"),ae("status"),ne(ae(),7,""),ne(Ao,3,"rewardInfos"),ne(C(),16,"tickArrayBitmap"),C("totalFeesTokenA"),C("totalFeesClaimedTokenA"),C("totalFeesTokenB"),C("totalFeesClaimedTokenB"),C("fundFeesTokenA"),C("fundFeesTokenB"),C("startTime"),ne(C(),15*4-3,"padding")]),To=j([q("growthInsideLastX64"),C("rewardAmountOwed")]),wi=j([Se(8),ae("bump"),te("nftMint"),te("poolId"),pe("tickLower"),pe("tickUpper"),q("liquidity"),q("feeGrowthInsideLastX64A"),q("feeGrowthInsideLastX64B"),C("tokenFeesOwedA"),C("tokenFeesOwedB"),ne(To,3,"rewardInfos"),ne(C(),8,"")]),Um=j([Se(8),ae("bump"),te("poolId"),pe("tickLowerIndex"),pe("tickUpperIndex"),q("liquidity"),q("feeGrowthInsideLastX64A"),q("feeGrowthInsideLastX64B"),C("tokenFeesOwedA"),C("tokenFeesOwedB"),ne(q(),3,"rewardGrowthInside"),ne(C(),8,"")]),Po=j([pe("tick"),oi("liquidityNet"),q("liquidityGross"),q("feeGrowthOutsideX64A"),q("feeGrowthOutsideX64B"),ne(q(),3,"rewardGrowthsOutsideX64"),ne(dt(),13,"")]),It=j([Se(8),te("poolId"),pe("startTickIndex"),ne(Po,ce,"ticks"),ae("initializedTickCount"),ne(ae(),115,"")]),Xm=j([Se(329),ne(te(),100,"whitelistMints")]),ki=j([Se(8),te("poolId"),ne(ne(C(),8),Tn,"positiveTickArrayBitmap"),ne(ne(C(),8),Tn,"negativeTickArrayBitmap")]),zm=j([C(),ae("bump"),te("owner"),te("poolId"),te("positionId"),te("nftAccount"),ne(C(),8)]);Ai.span;var xi=ke("Raydium_Clmm"),_e={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},xo=[188,37,179,131,82,150,84,73],Bo=[16,72,250,198,14,162,212,19],Bi=class{static createPoolInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,p){let g=j([q("sqrtPriceX64"),C("startTime")]),y=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:ft.programId,isSigner:!1,isWritable:!1},{pubkey:kt,isSigner:!1,isWritable:!1}],b=Buffer.alloc(g.span);g.encode({sqrtPriceX64:f,startTime:p},b);let T=Buffer.from([..._e.createPool,...b]);return new Ie({keys:y,programId:e,data:T})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:o,ammConfigId:s,initialPriceX64:a,startTime:u}=e,[c,l]=[new A(r.address),new A(o.address)],{publicKey:m}=pi(t,s,c,l),{publicKey:d}=bi(t,m),{publicKey:f}=wn(t,m,c),{publicKey:p}=wn(t,m,l),g=[this.createPoolInstruction(t,m,n,s,d,c,f,new A(r.programId||oe),l,p,new A(o.programId||oe),Ke(t,m).publicKey,a,u)];return{signers:[],instructions:g,instructionTypes:[he.CreateAccount,he.ClmmCreatePool],address:{poolId:m,observationId:d,mintAVault:f,mintBVault:p},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,p,g,y,b,T,w,P,S,k,M,L,z,H){let _=j([pe("tickLowerIndex"),pe("tickUpperIndex"),pe("tickArrayLowerStartIndex"),pe("tickArrayUpperStartIndex"),q("liquidity"),C("amountMaxA"),C("amountMaxB"),ve("withMetadata"),ae("optionBaseFlag"),ve("baseFlag")]),le=[...H?[{pubkey:H,isSigner:!1,isWritable:!0}]:[]],se=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:kt,isSigner:!1,isWritable:!1},{pubkey:ft.programId,isSigner:!1,isWritable:!1},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:Pi,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...le],Te=Buffer.alloc(_.span);_.encode({tickLowerIndex:T,tickUpperIndex:w,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:S,liquidity:k,amountMaxA:M,amountMaxB:L,withMetadata:z==="create",baseFlag:!1,optionBaseFlag:0},Te);let $=Buffer.from([..._e.openPosition,...Te]);return new Ie({keys:se,programId:e,data:$})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,f]=[new A(e.programId),new A(e.id)],p;if(l)p=new A((await l(1))[0]);else{let L=xn.generate();m.push(L),p=L.publicKey}let g=x.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=x.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=U(d,f,g),{publicKey:T}=U(d,f,y),{publicKey:w}=De(n.wallet,p,oe),{publicKey:P}=Xt(p),{publicKey:S}=Ce(d,p),{publicKey:k}=tt(d,f,r,o),M=this.openPositionFromLiquidityInstruction(d,n.feePayer,f,n.wallet,p,w,P,k,b,T,S,n.tokenAccountA,n.tokenAccountB,new A(t.vault.A),new A(t.vault.B),new A(e.mintA.address),new A(e.mintB.address),r,o,g,y,s,a,u,c);return{signers:m,instructions:[M],instructionTypes:[he.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:p,tickArrayLower:b,tickArrayUpper:T,positionNftAccount:w,metadataAccount:P,personalPosition:S,protocolPosition:k}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,f]=[new A(e.programId),new A(e.id)],p;if(l)p=new A((await l(1))[0]);else{let L=xn.generate();m.push(L),p=L.publicKey}let g=x.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=x.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=U(d,f,g),{publicKey:T}=U(d,f,y),{publicKey:w}=De(n.wallet,p,oe),{publicKey:P}=Xt(p),{publicKey:S}=Ce(d,p),{publicKey:k}=tt(d,f,r,o),M=this.openPositionFromBaseInstruction(d,n.feePayer,f,n.wallet,p,w,P,k,b,T,S,n.tokenAccountA,n.tokenAccountB,new A(t.vault.A),new A(t.vault.B),new A(e.mintA.address),new A(e.mintB.address),r,o,g,y,c,s,a,u,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[g,y])?Ke(d,f).publicKey:void 0);return{address:{nftMint:p,tickArrayLower:b,tickArrayUpper:T,positionNftAccount:w,metadataAccount:P,personalPosition:S,protocolPosition:k},instructions:[M],signers:m,instructionTypes:[he.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,p,g,y,b,T,w,P,S,k,M,L,z,H){let _=j([pe("tickLowerIndex"),pe("tickUpperIndex"),pe("tickArrayLowerStartIndex"),pe("tickArrayUpperStartIndex"),q("liquidity"),C("amountMaxA"),C("amountMaxB"),ve("withMetadata"),ae("optionBaseFlag"),ve("baseFlag")]),le=[...H?[{pubkey:H,isSigner:!1,isWritable:!0}]:[]],se=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:kt,isSigner:!1,isWritable:!1},{pubkey:ft.programId,isSigner:!1,isWritable:!1},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:Pi,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...le],Te=Buffer.alloc(_.span);_.encode({tickLowerIndex:T,tickUpperIndex:w,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:S,liquidity:new Ti(0),amountMaxA:M==="MintA"?L:z,amountMaxB:M==="MintA"?z:L,withMetadata:k==="create",baseFlag:M==="MintA",optionBaseFlag:1},Te);let $=Buffer.from([..._e.openPosition,...Te]);return new Ie({keys:se,programId:e,data:$})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m,d=[];if(l)m=new A((await l(1))[0]);else{let L=xn.generate();d.push(L),m=L.publicKey}let[f,p]=[new A(e.programId),new A(e.id)],g=x.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=x.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=U(f,p,g),{publicKey:T}=U(f,p,y),{publicKey:w}=De(n.wallet,m,oe),{publicKey:P}=Xt(m),{publicKey:S}=Ce(f,m),{publicKey:k}=tt(f,p,r,o),M=this.openPositionFromLiquidityInstruction(f,n.wallet,p,n.wallet,m,w,P,k,b,T,S,n.tokenAccountA,n.tokenAccountB,new A(t.vault.A),new A(t.vault.B),new A(t.mintA.address),new A(t.mintB.address),r,o,g,y,s,a,u,c,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[g,y])?Ke(f,p).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:b,tickArrayUpper:T,positionNftAccount:w,metadataAccount:P,personalPosition:S,protocolPosition:k},instructions:[M],signers:d,instructionTypes:[he.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=j([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:ft.programId,isSigner:!1,isWritable:!1},{pubkey:oe,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([..._e.closePosition,...u]);return new Ie({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new A(e.programId),{publicKey:s}=De(n.wallet,r.nftMint,oe),{publicKey:a}=Ce(o,r.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[he.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,p,g,y,b,T){let w=j([q("liquidity"),C("amountMaxA"),C("amountMaxB"),ae("optionBaseFlag"),ve("baseFlag")]),P=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[]],S=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...P],k=Buffer.alloc(w.span);w.encode({liquidity:g,amountMaxA:y,amountMaxB:b,optionBaseFlag:0,baseFlag:!1},k);let M=Buffer.from([..._e.increaseLiquidity,...k]);return new Ie({keys:S,programId:e,data:M})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new A(e.programId),new A(e.id)],l=x.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=x.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=U(u,c,l),{publicKey:f}=U(u,c,m),{publicKey:p}=De(r.wallet,n.nftMint,oe),{publicKey:g}=Ce(u,n.nftMint),{publicKey:y}=tt(u,c,n.tickLower,n.tickUpper),b=this.increasePositionFromLiquidityInstruction(u,r.wallet,p,g,c,y,d,f,r.tokenAccountA,r.tokenAccountB,new A(t.vault.A),new A(t.vault.B),new A(e.mintA.address),new A(e.mintB.address),o,s,a,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Ke(u,c).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:f,positionNftAccount:p,personalPosition:g,protocolPosition:y},signers:[],instructions:[b],instructionTypes:[he.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new A(e.programId),new A(e.id)],l=x.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=x.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=U(u,c,l),{publicKey:f}=U(u,c,m),{publicKey:p}=De(r.wallet,n.nftMint,oe),{publicKey:g}=Ce(u,n.nftMint),{publicKey:y}=tt(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:f,positionNftAccount:p,personalPosition:g,protocolPosition:y},instructions:[this.increasePositionFromBaseInstruction(u,r.wallet,p,g,c,y,d,f,r.tokenAccountA,r.tokenAccountB,new A(t.vault.A),new A(t.vault.B),new A(e.mintA.address),new A(e.mintB.address),o,s,a,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Ke(u,c).publicKey:void 0)],signers:[],instructionTypes:[he.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,p,g,y,b,T){let w=j([q("liquidity"),C("amountMaxA"),C("amountMaxB"),ae("optionBaseFlag"),ve("baseFlag")]),P=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[]],S=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...P],k=Buffer.alloc(w.span);w.encode({liquidity:new Ti(0),amountMaxA:g==="MintA"?y:b,amountMaxB:g==="MintA"?b:y,baseFlag:g==="MintA",optionBaseFlag:1},k);let M=Buffer.from([..._e.increaseLiquidity,...k]);return new Ie({keys:S,programId:e,data:M})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,p,g,y,b,T,w){let P=j([q("liquidity"),C("amountMinA"),C("amountMinB")]),S=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...g.map(z=>[{pubkey:z.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:z.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:z.rewardMint,isSigner:!1,isWritable:!1}]).flat()],k=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:vt,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...S],M=Buffer.alloc(P.span);P.encode({liquidity:y,amountMinA:b,amountMinB:T},M);let L=Buffer.from([..._e.decreaseLiquidity,...M]);return new Ie({keys:k,programId:e,data:L})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,l]=[new A(e.programId),new A(e.id)],m=x.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=x.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:f}=U(c,l,m),{publicKey:p}=U(c,l,d),{publicKey:g}=De(r.wallet,n.nftMint,u),{publicKey:y}=Ce(c,n.nftMint),{publicKey:b}=tt(c,l,n.tickLower,n.tickUpper),T=[];for(let S=0;S<e.rewardDefaultInfos.length;S++)T.push({poolRewardVault:new A(t.rewardInfos[S].vault),ownerRewardVault:r.rewardAccounts[S],rewardMint:new A(e.rewardDefaultInfos[S].mint.address)});let w=[],P=this.decreaseLiquidityInstruction(c,r.wallet,g,y,l,b,f,p,r.tokenAccountA,r.tokenAccountB,new A(t.vault.A),new A(t.vault.B),new A(e.mintA.address),new A(e.mintB.address),T,o,s,a,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?Ke(c,l).publicKey:void 0);return w.push(P),{address:{tickArrayLower:f,tickArrayUpper:p,positionNftAccount:g,personalPosition:y,protocolPosition:b},signers:[],instructions:w,instructionTypes:[he.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,p,g,y,b){let T=j([C("amount"),C("otherAmountThreshold"),q("sqrtPriceLimitX64"),ve("isBaseInput")]),w=[...b?[{pubkey:b,isSigner:!1,isWritable:!0}]:[],...m.map(M=>({pubkey:M,isSigner:!1,isWritable:!0}))],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:vt,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...w],S=Buffer.alloc(T.span);T.encode({amount:f,otherAmountThreshold:p,sqrtPriceLimitX64:g,isBaseInput:y},S);let k=Buffer.from([..._e.swap,...S]);return new Ie({keys:P,programId:e,data:k})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new A(e.programId),new A(e.id)],[d,f]=[new A(t.vault.A),new A(t.vault.B)],[p,g]=[new A(e.mintA.address),new A(e.mintB.address)],y=e.mintA.address===o.toString(),b=[this.swapInstruction(l,r.wallet,m,new A(e.config.id),y?r.tokenAccountA:r.tokenAccountB,y?r.tokenAccountB:r.tokenAccountA,y?d:f,y?f:d,y?p:g,y?g:p,c,n,s,a,u,!0,Ke(l,m).publicKey)];return{signers:[],instructions:b,instructionTypes:[he.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:o,amountOut:s,amountInMax:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new A(e.programId),new A(e.id)],[d,f]=[new A(t.vault.A),new A(t.vault.B)],[p,g]=[new A(e.mintA.address),new A(e.mintB.address)],y=e.mintA.address===o.toBase58(),b=[this.swapInstruction(l,r.wallet,m,new A(e.config.id),y?r.tokenAccountB:r.tokenAccountA,y?r.tokenAccountA:r.tokenAccountB,y?f:d,y?d:f,y?g:p,y?p:g,c,n,s,a,u,!1,Ke(l,m).publicKey)];return{signers:[],instructions:b,instructionTypes:[he.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,d){let f=j([C("openTime"),C("endTime"),q("emissionsPerSecondX64")]),p=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:ft.programId,isSigner:!1,isWritable:!1},{pubkey:kt,isSigner:!1,isWritable:!1}],g=Buffer.alloc(f.span);f.encode({openTime:me(l),endTime:me(m),emissionsPerSecondX64:d},g);let y=Buffer.from([..._e.initReward,...g]);return new Ie({keys:p,programId:e,data:y})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new A(e.programId),new A(e.id)],a=gi(o,s,r.mint).publicKey,u=kn(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new A(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[he.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,d){let f=j([ae("rewardIndex"),q("emissionsPerSecondX64"),C("openTime"),C("endTime")]),p=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],g=Buffer.alloc(f.span);f.encode({rewardIndex:c,emissionsPerSecondX64:d,openTime:me(l),endTime:me(m)},g);let y=Buffer.from([..._e.setRewardEmissions,...g]);return new Ie({keys:p,programId:e,data:y})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new A(e.programId),new A(e.id)],a,u,c;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===r.mint.toString()&&(a=d,u=new A(t.rewardInfos[d].vault),c=new A(t.rewardInfos[d].mint.address));(a===void 0||u===void 0)&&xi.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=kn(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new A(e.config.id),n.tokenAccount,u,c,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[he.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let u=j([ae("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:vt,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([..._e.collectReward,...l]);return new Ie({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new A(e.programId),new A(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,u=new A(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&xi.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,r,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[he.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:r,positionNft:o}){let{publicKey:s}=De(r,o,oe),{publicKey:a}=Ce(n,o),u=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:An(e,a).publicKey,isSigner:!1,isWritable:!0},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:ft.programId,isSigner:!1,isWritable:!1}];return new Ie({keys:u,programId:e,data:Buffer.from(xo)})}static harvestLockPositionInstruction(e){let[t,n]=[new A(e.poolKeys.programId),new A(e.poolKeys.id)],r=x.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),o=x.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:s}=U(t,n,r),{publicKey:a}=U(t,n,o),{publicKey:u}=De(e.owner,e.ownerPosition.nftMint,oe),{publicKey:c}=Ce(t,e.ownerPosition.nftMint),{publicKey:l}=tt(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),m=[];for(let p=0;p<e.poolKeys.rewardInfos.length;p++)m.push({poolRewardVault:new A(e.poolKeys.rewardInfos[p].vault),ownerRewardVault:e.ownerRewardAccounts[p],rewardMint:new A(e.poolKeys.rewardInfos[p].mint.address)});let d=[...m.map(p=>[{pubkey:p.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:p.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:p.rewardMint,isSigner:!1,isWritable:!1}]).flat()],f=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:An(e.programId,c).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:new A(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new A(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:Yn,isSigner:!1,isWritable:!1},{pubkey:new A(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new A(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...d];return new Ie({keys:f,programId:e.programId,data:Buffer.from(Bo)})}};export{Bi as ClmmInstrument};
//# sourceMappingURL=instrument.mjs.map