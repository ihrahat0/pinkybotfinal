var Wc=Object.defineProperty,qc=Object.defineProperties;var Uc=Object.getOwnPropertyDescriptors;var er=Object.getOwnPropertySymbols;var na=Object.prototype.hasOwnProperty,oa=Object.prototype.propertyIsEnumerable;var ta=(o,e,t)=>e in o?Wc(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,R=(o,e)=>{for(var t in e||(e={}))na.call(e,t)&&ta(o,t,e[t]);if(er)for(var t of er(e))oa.call(e,t)&&ta(o,t,e[t]);return o},E=(o,e)=>qc(o,Uc(e));var Oe=(o,e)=>{var t={};for(var n in o)na.call(o,n)&&e.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&er)for(var n of er(o))e.indexOf(n)<0&&oa.call(o,n)&&(t[n]=o[n]);return t};import Qa from"axios";import{PublicKey as sa}from"@solana/web3.js";import{get as ui,set as ra}from"lodash";var Gc=(r=>(r[r.Error=0]="Error",r[r.Warning=1]="Warning",r[r.Info=2]="Info",r[r.Debug=3]="Debug",r))(Gc||{}),ci=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},li={},ia={};function ce(o){let e=ui(li,o);if(!e){let t=ui(ia,o);e=new ci({name:o,logLevel:t}),ra(li,o,e)}return e}function _f(o,e){ra(ia,o,e);let t=ui(li,o);t&&(t.level=e)}import{MINT_SIZE as Xc,TOKEN_PROGRAM_ID as zc,getTransferFeeConfig as Qc,unpackMint as Yc}from"@solana/spl-token";var mi=ce("Raydium_accountInfo_util");async function It(o,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:i=100}=R({batchRequest:!1},t),s=di(e,i),a=new Array(s.length).fill([]);if(n){let c=s.map(m=>{let d=o._buildArgs([m.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),u=di(c,10);a=(await(await Promise.all(u.map(async m=>await o._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&mi.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:p,executable:y,lamports:f,owner:b,rentEpoch:g}=d;return p.length!==2&&p[1]!=="base64"&&mi.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:y,lamports:f,owner:new sa(b),rentEpoch:g}}return null})))}else try{a=await Promise.all(s.map(c=>o.getMultipleAccountsInfo(c,r)))}catch(c){c instanceof Error&&mi.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function Fe(o,e,t){let n=await It(o,e.map(r=>r.pubkey),t);return e.map((r,i)=>E(R({},r),{accountInfo:n[i]}))}var jc=(n=>(n[n.Uninitialized=0]="Uninitialized",n[n.Mint=1]="Mint",n[n.Account=2]="Account",n))(jc||{}),Gf=1;async function Nn({connection:o,mints:e,config:t}){var i,s,a;if(e.length===0)return{};let n=await Fe(o,e.map(c=>({pubkey:ft(c)})),t),r={};for(let c of n){if(!c.accountInfo||c.accountInfo.data.length<Xc){console.log("invalid mint account",c.pubkey.toBase58());continue}let u=Yc(c.pubkey,c.accountInfo,(i=c.accountInfo)==null?void 0:i.owner);r[c.pubkey.toString()]=E(R({},u),{programId:((s=c.accountInfo)==null?void 0:s.owner)||zc,feeConfig:(a=Qc(u))!=null?a:void 0})}return r[sa.default.toBase58()]=r[Q.toBase58()],r}import Me from"bn.js";var Mn=9e15,nn=1e9,pi="0123456789abcdef",nr="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",or="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",fi={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Mn,maxE:Mn,crypto:!1},la,Vt,re=!0,ir="[DecimalError] ",tn=ir+"Invalid argument: ",ma=ir+"Precision limit exceeded",da=ir+"crypto unavailable",pa="[object Decimal]",$e=Math.floor,Ee=Math.pow,Hc=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Zc=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,$c=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,fa=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,xt=1e7,te=7,Jc=9007199254740991,el=nr.length-1,yi=or.length-1,V={toStringTag:pa};V.absoluteValue=V.abs=function(){var o=new this.constructor(this);return o.s<0&&(o.s=1),Z(o)};V.ceil=function(){return Z(new this.constructor(this),this.e+1,2)};V.clampedTo=V.clamp=function(o,e){var t,n=this,r=n.constructor;if(o=new r(o),e=new r(e),!o.s||!e.s)return new r(NaN);if(o.gt(e))throw Error(tn+e);return t=n.cmp(o),t<0?o:n.cmp(e)>0?e:new r(n)};V.comparedTo=V.cmp=function(o){var e,t,n,r,i=this,s=i.d,a=(o=new i.constructor(o)).d,c=i.s,u=o.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(i.e!==o.e)return i.e>o.e^c<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return n===r?0:n>r^c<0?1:-1};V.cosine=V.cos=function(){var o,e,t=this,n=t.constructor;return t.d?t.d[0]?(o=n.precision,e=n.rounding,n.precision=o+Math.max(t.e,t.sd())+te,n.rounding=1,t=tl(n,wa(n,t)),n.precision=o,n.rounding=e,Z(Vt==2||Vt==3?t.neg():t,o,e,!0)):new n(1):new n(NaN)};V.cubeRoot=V.cbrt=function(){var o,e,t,n,r,i,s,a,c,u,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(re=!1,i=l.s*Ee(l.s*l,1/3),!i||Math.abs(i)==1/0?(t=Ye(l.d),o=l.e,(i=(o-t.length+1)%3)&&(t+=i==1||i==-2?"0":"00"),i=Ee(t,1/3),o=$e((o+1)/3)-(o%3==(o<0?-1:2)),i==1/0?t="5e"+o:(t=i.toExponential(),t=t.slice(0,t.indexOf("e")+1)+o),n=new m(t),n.s=l.s):n=new m(i.toString()),s=(o=m.precision)+3;;)if(a=n,c=a.times(a).times(a),u=c.plus(l),n=ke(u.plus(l).times(a),u.plus(c),s+2,1),Ye(a.d).slice(0,s)===(t=Ye(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(Z(a,o+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(Z(n,o+1,1),e=!n.times(n).times(n).eq(l));break}return re=!0,Z(n,o,m.rounding,e)};V.decimalPlaces=V.dp=function(){var o,e=this.d,t=NaN;if(e){if(o=e.length-1,t=(o-$e(this.e/te))*te,o=e[o],o)for(;o%10==0;o/=10)t--;t<0&&(t=0)}return t};V.dividedBy=V.div=function(o){return ke(this,new this.constructor(o))};V.dividedToIntegerBy=V.divToInt=function(o){var e=this,t=e.constructor;return Z(ke(e,new t(o),0,1,1),t.precision,t.rounding)};V.equals=V.eq=function(o){return this.cmp(o)===0};V.floor=function(){return Z(new this.constructor(this),this.e+1,3)};V.greaterThan=V.gt=function(o){return this.cmp(o)>0};V.greaterThanOrEqualTo=V.gte=function(o){var e=this.cmp(o);return e==1||e===0};V.hyperbolicCosine=V.cosh=function(){var o,e,t,n,r,i=this,s=i.constructor,a=new s(1);if(!i.isFinite())return new s(i.s?1/0:NaN);if(i.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(i.e,i.sd())+4,s.rounding=1,r=i.d.length,r<32?(o=Math.ceil(r/3),e=(1/ar(4,o)).toString()):(o=16,e="2.3283064365386962890625e-10"),i=_n(s,1,i.times(e),new s(1),!0);for(var c,u=o,l=new s(8);u--;)c=i.times(i),i=a.minus(c.times(l.minus(c.times(l))));return Z(i,s.precision=t,s.rounding=n,!0)};V.hyperbolicSine=V.sinh=function(){var o,e,t,n,r=this,i=r.constructor;if(!r.isFinite()||r.isZero())return new i(r);if(e=i.precision,t=i.rounding,i.precision=e+Math.max(r.e,r.sd())+4,i.rounding=1,n=r.d.length,n<3)r=_n(i,2,r,r,!0);else{o=1.4*Math.sqrt(n),o=o>16?16:o|0,r=r.times(1/ar(5,o)),r=_n(i,2,r,r,!0);for(var s,a=new i(5),c=new i(16),u=new i(20);o--;)s=r.times(r),r=r.times(a.plus(s.times(c.times(s).plus(u))))}return i.precision=e,i.rounding=t,Z(r,e,t,!0)};V.hyperbolicTangent=V.tanh=function(){var o,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(o=n.precision,e=n.rounding,n.precision=o+7,n.rounding=1,ke(t.sinh(),t.cosh(),n.precision=o,n.rounding=e)):new n(t.s)};V.inverseCosine=V.acos=function(){var o,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,i=t.rounding;return n!==-1?n===0?e.isNeg()?Bt(t,r,i):new t(0):new t(NaN):e.isZero()?Bt(t,r+4,i).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),o=Bt(t,r+4,i).times(.5),t.precision=r,t.rounding=i,o.minus(e))};V.inverseHyperbolicCosine=V.acosh=function(){var o,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(o=n.precision,e=n.rounding,n.precision=o+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,re=!1,t=t.times(t).minus(1).sqrt().plus(t),re=!0,n.precision=o,n.rounding=e,t.ln()):new n(t)};V.inverseHyperbolicSine=V.asinh=function(){var o,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(o=n.precision,e=n.rounding,n.precision=o+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,re=!1,t=t.times(t).plus(1).sqrt().plus(t),re=!0,n.precision=o,n.rounding=e,t.ln())};V.inverseHyperbolicTangent=V.atanh=function(){var o,e,t,n,r=this,i=r.constructor;return r.isFinite()?r.e>=0?new i(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(o=i.precision,e=i.rounding,n=r.sd(),Math.max(n,o)<2*-r.e-1?Z(new i(r),o,e,!0):(i.precision=t=n-r.e,r=ke(r.plus(1),new i(1).minus(r),t+o,1),i.precision=o+4,i.rounding=1,r=r.ln(),i.precision=o,i.rounding=e,r.times(.5))):new i(NaN)};V.inverseSine=V.asin=function(){var o,e,t,n,r=this,i=r.constructor;return r.isZero()?new i(r):(e=r.abs().cmp(1),t=i.precision,n=i.rounding,e!==-1?e===0?(o=Bt(i,t+4,n).times(.5),o.s=r.s,o):new i(NaN):(i.precision=t+6,i.rounding=1,r=r.div(new i(1).minus(r.times(r)).sqrt().plus(1)).atan(),i.precision=t,i.rounding=n,r.times(2)))};V.inverseTangent=V.atan=function(){var o,e,t,n,r,i,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&m+4<=yi)return s=Bt(l,m+4,d).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(m+4<=yi)return s=Bt(l,m+4,d).times(.5),s.s=u.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/te+2|0),o=t;o;--o)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(re=!1,e=Math.ceil(a/te),n=1,c=u.times(u),s=new l(u),r=u;o!==-1;)if(r=r.times(c),i=s.minus(r.div(n+=2)),r=r.times(c),s=i.plus(r.div(n+=2)),s.d[e]!==void 0)for(o=e;s.d[o]===i.d[o]&&o--;);return t&&(s=s.times(2<<t-1)),re=!0,Z(s,l.precision=m,l.rounding=d,!0)};V.isFinite=function(){return!!this.d};V.isInteger=V.isInt=function(){return!!this.d&&$e(this.e/te)>this.d.length-2};V.isNaN=function(){return!this.s};V.isNegative=V.isNeg=function(){return this.s<0};V.isPositive=V.isPos=function(){return this.s>0};V.isZero=function(){return!!this.d&&this.d[0]===0};V.lessThan=V.lt=function(o){return this.cmp(o)<0};V.lessThanOrEqualTo=V.lte=function(o){return this.cmp(o)<1};V.logarithm=V.log=function(o){var e,t,n,r,i,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding,p=5;if(o==null)o=new l(10),e=!0;else{if(o=new l(o),t=o.d,o.s<0||!t||!t[0]||o.eq(1))return new l(NaN);e=o.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new l(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)i=!0;else{for(r=t[0];r%10===0;)r/=10;i=r!==1}if(re=!1,a=m+p,s=en(u,a),n=e?rr(l,a+10):en(o,a),c=ke(s,n,a,1),eo(c.d,r=m,d))do if(a+=10,s=en(u,a),n=e?rr(l,a+10):en(o,a),c=ke(s,n,a,1),!i){+Ye(c.d).slice(r+1,r+15)+1==1e14&&(c=Z(c,m+1,0));break}while(eo(c.d,r+=10,d));return re=!0,Z(c,m,d)};V.minus=V.sub=function(o){var e,t,n,r,i,s,a,c,u,l,m,d,p=this,y=p.constructor;if(o=new y(o),!p.d||!o.d)return!p.s||!o.s?o=new y(NaN):p.d?o.s=-o.s:o=new y(o.d||p.s!==o.s?p:NaN),o;if(p.s!=o.s)return o.s=-o.s,p.plus(o);if(u=p.d,d=o.d,a=y.precision,c=y.rounding,!u[0]||!d[0]){if(d[0])o.s=-o.s;else if(u[0])o=new y(p);else return new y(c===3?-0:0);return re?Z(o,a,c):o}if(t=$e(o.e/te),l=$e(p.e/te),u=u.slice(),i=l-t,i){for(m=i<0,m?(e=u,i=-i,s=d.length):(e=d,t=l,s=u.length),n=Math.max(Math.ceil(a/te),s)+2,i>n&&(i=n,e.length=1),e.reverse(),n=i;n--;)e.push(0);e.reverse()}else{for(n=u.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(u[n]!=d[n]){m=u[n]<d[n];break}i=0}for(m&&(e=u,u=d,d=e,o.s=-o.s),s=u.length,n=d.length-s;n>0;--n)u[s++]=0;for(n=d.length;n>i;){if(u[--n]<d[n]){for(r=n;r&&u[--r]===0;)u[r]=xt-1;--u[r],u[n]+=xt}u[n]-=d[n]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(o.d=u,o.e=sr(u,t),re?Z(o,a,c):o):new y(c===3?-0:0)};V.modulo=V.mod=function(o){var e,t=this,n=t.constructor;return o=new n(o),!t.d||!o.s||o.d&&!o.d[0]?new n(NaN):!o.d||t.d&&!t.d[0]?Z(new n(t),n.precision,n.rounding):(re=!1,n.modulo==9?(e=ke(t,o.abs(),0,3,1),e.s*=o.s):e=ke(t,o,0,n.modulo,1),e=e.times(o),re=!0,t.minus(e))};V.naturalExponential=V.exp=function(){return bi(this)};V.naturalLogarithm=V.ln=function(){return en(this)};V.negated=V.neg=function(){var o=new this.constructor(this);return o.s=-o.s,Z(o)};V.plus=V.add=function(o){var e,t,n,r,i,s,a,c,u,l,m=this,d=m.constructor;if(o=new d(o),!m.d||!o.d)return!m.s||!o.s?o=new d(NaN):m.d||(o=new d(o.d||m.s===o.s?m:NaN)),o;if(m.s!=o.s)return o.s=-o.s,m.minus(o);if(u=m.d,l=o.d,a=d.precision,c=d.rounding,!u[0]||!l[0])return l[0]||(o=new d(m)),re?Z(o,a,c):o;if(i=$e(m.e/te),n=$e(o.e/te),u=u.slice(),r=i-n,r){for(r<0?(t=u,r=-r,s=l.length):(t=l,n=i,s=u.length),i=Math.ceil(a/te),s=i>s?i+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=u.length,r=l.length,s-r<0&&(r=s,t=l,l=u,u=t),e=0;r;)e=(u[--r]=u[r]+l[r]+e)/xt|0,u[r]%=xt;for(e&&(u.unshift(e),++n),s=u.length;u[--s]==0;)u.pop();return o.d=u,o.e=sr(u,n),re?Z(o,a,c):o};V.precision=V.sd=function(o){var e,t=this;if(o!==void 0&&o!==!!o&&o!==1&&o!==0)throw Error(tn+o);return t.d?(e=ya(t.d),o&&t.e+1>e&&(e=t.e+1)):e=NaN,e};V.round=function(){var o=this,e=o.constructor;return Z(new e(o),o.e+1,e.rounding)};V.sine=V.sin=function(){var o,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(o=n.precision,e=n.rounding,n.precision=o+Math.max(t.e,t.sd())+te,n.rounding=1,t=ol(n,wa(n,t)),n.precision=o,n.rounding=e,Z(Vt>2?t.neg():t,o,e,!0)):new n(NaN)};V.squareRoot=V.sqrt=function(){var o,e,t,n,r,i,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(re=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=Ye(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=$e((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),n=new l(e)):n=new l(u.toString()),t=(c=l.precision)+3;;)if(i=n,n=i.plus(ke(s,i,t+2,1)).times(.5),Ye(i.d).slice(0,t)===(e=Ye(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(Z(i,c+1,0),i.times(i).eq(s))){n=i;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(Z(n,c+1,1),o=!n.times(n).eq(s));break}return re=!0,Z(n,c,l.rounding,o)};V.tangent=V.tan=function(){var o,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(o=n.precision,e=n.rounding,n.precision=o+10,n.rounding=1,t=t.sin(),t.s=1,t=ke(t,new n(1).minus(t.times(t)).sqrt(),o+10,0),n.precision=o,n.rounding=e,Z(Vt==2||Vt==4?t.neg():t,o,e,!0)):new n(NaN)};V.times=V.mul=function(o){var e,t,n,r,i,s,a,c,u,l=this,m=l.constructor,d=l.d,p=(o=new m(o)).d;if(o.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!o.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?o.s/0:o.s*0);for(t=$e(l.e/te)+$e(o.e/te),c=d.length,u=p.length,c<u&&(i=d,d=p,p=i,s=c,c=u,u=s),i=[],s=c+u,n=s;n--;)i.push(0);for(n=u;--n>=0;){for(e=0,r=c+n;r>n;)a=i[r]+p[n]*d[r-n-1]+e,i[r--]=a%xt|0,e=a/xt|0;i[r]=(i[r]+e)%xt|0}for(;!i[--s];)i.pop();return e?++t:i.shift(),o.d=i,o.e=sr(i,t),re?Z(o,m.precision,m.rounding):o};V.toBinary=function(o,e){return Ai(this,2,o,e)};V.toDecimalPlaces=V.toDP=function(o,e){var t=this,n=t.constructor;return t=new n(t),o===void 0?t:(at(o,0,nn),e===void 0?e=n.rounding:at(e,0,8),Z(t,o+t.e+1,e))};V.toExponential=function(o,e){var t,n=this,r=n.constructor;return o===void 0?t=Nt(n,!0):(at(o,0,nn),e===void 0?e=r.rounding:at(e,0,8),n=Z(new r(n),o+1,e),t=Nt(n,!0,o+1)),n.isNeg()&&!n.isZero()?"-"+t:t};V.toFixed=function(o,e){var t,n,r=this,i=r.constructor;return o===void 0?t=Nt(r):(at(o,0,nn),e===void 0?e=i.rounding:at(e,0,8),n=Z(new i(r),o+r.e+1,e),t=Nt(n,!1,o+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};V.toFraction=function(o){var e,t,n,r,i,s,a,c,u,l,m,d,p=this,y=p.d,f=p.constructor;if(!y)return new f(p);if(u=t=new f(1),n=c=new f(0),e=new f(n),i=e.e=ya(y)-p.e-1,s=i%te,e.d[0]=Ee(10,s<0?te+s:s),o==null)o=i>0?e:u;else{if(a=new f(o),!a.isInt()||a.lt(u))throw Error(tn+a);o=a.gt(e)?i>0?e:u:a}for(re=!1,a=new f(Ye(y)),l=f.precision,f.precision=i=y.length*te*2;m=ke(a,e,0,1,1),r=t.plus(m.times(n)),r.cmp(o)!=1;)t=n,n=r,r=u,u=c.plus(m.times(r)),c=r,r=e,e=a.minus(m.times(r)),a=r;return r=ke(o.minus(t),n,0,1,1),c=c.plus(r.times(u)),t=t.plus(r.times(n)),c.s=u.s=p.s,d=ke(u,n,i,1).minus(p).abs().cmp(ke(c,t,i,1).minus(p).abs())<1?[u,n]:[c,t],f.precision=l,re=!0,d};V.toHexadecimal=V.toHex=function(o,e){return Ai(this,16,o,e)};V.toNearest=function(o,e){var t=this,n=t.constructor;if(t=new n(t),o==null){if(!t.d)return t;o=new n(1),e=n.rounding}else{if(o=new n(o),e===void 0?e=n.rounding:at(e,0,8),!t.d)return o.s?t:o;if(!o.d)return o.s&&(o.s=t.s),o}return o.d[0]?(re=!1,t=ke(t,o,0,e,1).times(o),re=!0,Z(t)):(o.s=t.s,t=o),t};V.toNumber=function(){return+this};V.toOctal=function(o,e){return Ai(this,8,o,e)};V.toPower=V.pow=function(o){var e,t,n,r,i,s,a=this,c=a.constructor,u=+(o=new c(o));if(!a.d||!o.d||!a.d[0]||!o.d[0])return new c(Ee(+a,u));if(a=new c(a),a.eq(1))return a;if(n=c.precision,i=c.rounding,o.eq(1))return Z(a,n,i);if(e=$e(o.e/te),e>=o.d.length-1&&(t=u<0?-u:u)<=Jc)return r=ba(c,a,t,n),o.s<0?new c(1).div(r):Z(r,n,i);if(s=a.s,s<0){if(e<o.d.length-1)return new c(NaN);if((o.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=Ee(+a,u),e=t==0||!isFinite(t)?$e(u*(Math.log("0."+Ye(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(re=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),r=bi(o.times(en(a,n+t)),n),r.d&&(r=Z(r,n+5,1),eo(r.d,n,i)&&(e=n+10,r=Z(bi(o.times(en(a,e+t)),e),e+5,1),+Ye(r.d).slice(n+1,n+15)+1==1e14&&(r=Z(r,n+1,0)))),r.s=s,re=!0,c.rounding=i,Z(r,n,i))};V.toPrecision=function(o,e){var t,n=this,r=n.constructor;return o===void 0?t=Nt(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(at(o,1,nn),e===void 0?e=r.rounding:at(e,0,8),n=Z(new r(n),o,e),t=Nt(n,o<=n.e||n.e<=r.toExpNeg,o)),n.isNeg()&&!n.isZero()?"-"+t:t};V.toSignificantDigits=V.toSD=function(o,e){var t=this,n=t.constructor;return o===void 0?(o=n.precision,e=n.rounding):(at(o,1,nn),e===void 0?e=n.rounding:at(e,0,8)),Z(new n(t),o,e)};V.toString=function(){var o=this,e=o.constructor,t=Nt(o,o.e<=e.toExpNeg||o.e>=e.toExpPos);return o.isNeg()&&!o.isZero()?"-"+t:t};V.truncated=V.trunc=function(){return Z(new this.constructor(this),this.e+1,1)};V.valueOf=V.toJSON=function(){var o=this,e=o.constructor,t=Nt(o,o.e<=e.toExpNeg||o.e>=e.toExpPos);return o.isNeg()?"-"+t:t};function Ye(o){var e,t,n,r=o.length-1,i="",s=o[0];if(r>0){for(i+=s,e=1;e<r;e++)n=o[e]+"",t=te-n.length,t&&(i+=Jt(t)),i+=n;s=o[e],n=s+"",t=te-n.length,t&&(i+=Jt(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return i+s}function at(o,e,t){if(o!==~~o||o<e||o>t)throw Error(tn+o)}function eo(o,e,t,n){var r,i,s,a;for(i=o[0];i>=10;i/=10)--e;return--e<0?(e+=te,r=0):(r=Math.ceil((e+1)/te),e%=te),i=Ee(10,te-e),a=o[r]%i|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==i||t>3&&a+1==i/2)&&(o[r+1]/i/100|0)==Ee(10,e-2)-1||(a==i/2||a==0)&&(o[r+1]/i/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==i||!n&&t>3&&a+1==i/2)&&(o[r+1]/i/1e3|0)==Ee(10,e-3)-1,s}function tr(o,e,t){for(var n,r=[0],i,s=0,a=o.length;s<a;){for(i=r.length;i--;)r[i]*=e;for(r[0]+=pi.indexOf(o.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function tl(o,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/ar(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),o.precision+=t,e=_n(o,1,e.times(r),new o(1));for(var i=t;i--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return o.precision-=t,e}var ke=function(){function o(n,r,i){var s,a=0,c=n.length;for(n=n.slice();c--;)s=n[c]*r+a,n[c]=s%i|0,a=s/i|0;return a&&n.unshift(a),n}function e(n,r,i,s){var a,c;if(i!=s)c=i>s?1:-1;else for(a=c=0;a<i;a++)if(n[a]!=r[a]){c=n[a]>r[a]?1:-1;break}return c}function t(n,r,i,s){for(var a=0;i--;)n[i]-=a,a=n[i]<r[i]?1:0,n[i]=a*s+n[i]-r[i];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,i,s,a,c){var u,l,m,d,p,y,f,b,g,A,w,k,I,T,S,B,C,x,L,W,v=n.constructor,$=n.s==r.s?1:-1,X=n.d,q=r.d;if(!X||!X[0]||!q||!q[0])return new v(!n.s||!r.s||(X?q&&X[0]==q[0]:!q)?NaN:X&&X[0]==0||!q?$*0:$/0);for(c?(p=1,l=n.e-r.e):(c=xt,p=te,l=$e(n.e/p)-$e(r.e/p)),L=q.length,C=X.length,g=new v($),A=g.d=[],m=0;q[m]==(X[m]||0);m++);if(q[m]>(X[m]||0)&&l--,i==null?(T=i=v.precision,s=v.rounding):a?T=i+(n.e-r.e)+1:T=i,T<0)A.push(1),y=!0;else{if(T=T/p+2|0,m=0,L==1){for(d=0,q=q[0],T++;(m<C||d)&&T--;m++)S=d*c+(X[m]||0),A[m]=S/q|0,d=S%q|0;y=d||m<C}else{for(d=c/(q[0]+1)|0,d>1&&(q=o(q,d,c),X=o(X,d,c),L=q.length,C=X.length),B=L,w=X.slice(0,L),k=w.length;k<L;)w[k++]=0;W=q.slice(),W.unshift(0),x=q[0],q[1]>=c/2&&++x;do d=0,u=e(q,w,L,k),u<0?(I=w[0],L!=k&&(I=I*c+(w[1]||0)),d=I/x|0,d>1?(d>=c&&(d=c-1),f=o(q,d,c),b=f.length,k=w.length,u=e(f,w,b,k),u==1&&(d--,t(f,L<b?W:q,b,c))):(d==0&&(u=d=1),f=q.slice()),b=f.length,b<k&&f.unshift(0),t(w,f,k,c),u==-1&&(k=w.length,u=e(q,w,L,k),u<1&&(d++,t(w,L<k?W:q,k,c))),k=w.length):u===0&&(d++,w=[0]),A[m++]=d,u&&w[0]?w[k++]=X[B]||0:(w=[X[B]],k=1);while((B++<C||w[0]!==void 0)&&T--);y=w[0]!==void 0}A[0]||A.shift()}if(p==1)g.e=l,la=y;else{for(m=1,d=A[0];d>=10;d/=10)m++;g.e=m+l*p-1,Z(g,a?i+g.e+1:i,s,y)}return g}}();function Z(o,e,t,n){var r,i,s,a,c,u,l,m,d,p=o.constructor;e:if(e!=null){if(m=o.d,!m)return o;for(r=1,a=m[0];a>=10;a/=10)r++;if(i=e-r,i<0)i+=te,s=e,l=m[d=0],c=l/Ee(10,r-s-1)%10|0;else if(d=Math.ceil((i+1)/te),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=c=0,r=1,i%=te,s=i-te+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;i%=te,s=i-te+r,c=s<0?0:l/Ee(10,r-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%Ee(10,r-s-1)),u=t<4?(c||n)&&(t==0||t==(o.s<0?3:2)):c>5||c==5&&(t==4||n||t==6&&(i>0?s>0?l/Ee(10,r-s):0:m[d-1])%10&1||t==(o.s<0?8:7)),e<1||!m[0])return m.length=0,u?(e-=o.e+1,m[0]=Ee(10,(te-e%te)%te),o.e=-e||0):m[0]=o.e=0,o;if(i==0?(m.length=d,a=1,d--):(m.length=d+1,a=Ee(10,te-i),m[d]=s>0?(l/Ee(10,r-s)%Ee(10,s)|0)*a:0),u)for(;;)if(d==0){for(i=1,s=m[0];s>=10;s/=10)i++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;i!=a&&(o.e++,m[0]==xt&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=xt)break;m[d--]=0,a=1}for(i=m.length;m[--i]===0;)m.pop()}return re&&(o.e>p.maxE?(o.d=null,o.e=NaN):o.e<p.minE&&(o.e=0,o.d=[0])),o}function Nt(o,e,t){if(!o.isFinite())return Aa(o);var n,r=o.e,i=Ye(o.d),s=i.length;return e?(t&&(n=t-s)>0?i=i.charAt(0)+"."+i.slice(1)+Jt(n):s>1&&(i=i.charAt(0)+"."+i.slice(1)),i=i+(o.e<0?"e":"e+")+o.e):r<0?(i="0."+Jt(-r-1)+i,t&&(n=t-s)>0&&(i+=Jt(n))):r>=s?(i+=Jt(r+1-s),t&&(n=t-r-1)>0&&(i=i+"."+Jt(n))):((n=r+1)<s&&(i=i.slice(0,n)+"."+i.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(i+="."),i+=Jt(n))),i}function sr(o,e){var t=o[0];for(e*=te;t>=10;t/=10)e++;return e}function rr(o,e,t){if(e>el)throw re=!0,t&&(o.precision=t),Error(ma);return Z(new o(nr),e,1,!0)}function Bt(o,e,t){if(e>yi)throw Error(ma);return Z(new o(or),e,t,!0)}function ya(o){var e=o.length-1,t=e*te+1;if(e=o[e],e){for(;e%10==0;e/=10)t--;for(e=o[0];e>=10;e/=10)t++}return t}function Jt(o){for(var e="";o--;)e+="0";return e}function ba(o,e,t,n){var r,i=new o(1),s=Math.ceil(n/te+4);for(re=!1;;){if(t%2&&(i=i.times(e),ua(i.d,s)&&(r=!0)),t=$e(t/2),t===0){t=i.d.length-1,r&&i.d[t]===0&&++i.d[t];break}e=e.times(e),ua(e.d,s)}return re=!0,i}function aa(o){return o.d[o.d.length-1]&1}function ga(o,e,t){for(var n,r=new o(e[0]),i=0;++i<e.length;)if(n=new o(e[i]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function bi(o,e){var t,n,r,i,s,a,c,u=0,l=0,m=0,d=o.constructor,p=d.rounding,y=d.precision;if(!o.d||!o.d[0]||o.e>17)return new d(o.d?o.d[0]?o.s<0?0:1/0:1:o.s?o.s<0?0:o:0/0);for(e==null?(re=!1,c=y):c=e,a=new d(.03125);o.e>-2;)o=o.times(a),m+=5;for(n=Math.log(Ee(2,m))/Math.LN10*2+5|0,c+=n,t=i=s=new d(1),d.precision=c;;){if(i=Z(i.times(o),c,1),t=t.times(++l),a=s.plus(ke(i,t,c,1)),Ye(a.d).slice(0,c)===Ye(s.d).slice(0,c)){for(r=m;r--;)s=Z(s.times(s),c,1);if(e==null)if(u<3&&eo(s.d,c-n,p,u))d.precision=c+=10,t=i=a=new d(1),l=0,u++;else return Z(s,d.precision=y,p,re=!0);else return d.precision=y,s}s=a}}function en(o,e){var t,n,r,i,s,a,c,u,l,m,d,p=1,y=10,f=o,b=f.d,g=f.constructor,A=g.rounding,w=g.precision;if(f.s<0||!b||!b[0]||!f.e&&b[0]==1&&b.length==1)return new g(b&&!b[0]?-1/0:f.s!=1?NaN:b?0:f);if(e==null?(re=!1,l=w):l=e,g.precision=l+=y,t=Ye(b),n=t.charAt(0),Math.abs(i=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(o),t=Ye(f.d),n=t.charAt(0),p++;i=f.e,n>1?(f=new g("0."+t),i++):f=new g(n+"."+t.slice(1))}else return u=rr(g,l+2,w).times(i+""),f=en(new g(n+"."+t.slice(1)),l-y).plus(u),g.precision=w,e==null?Z(f,w,A,re=!0):f;for(m=f,c=s=f=ke(f.minus(1),f.plus(1),l,1),d=Z(f.times(f),l,1),r=3;;){if(s=Z(s.times(d),l,1),u=c.plus(ke(s,new g(r),l,1)),Ye(u.d).slice(0,l)===Ye(c.d).slice(0,l))if(c=c.times(2),i!==0&&(c=c.plus(rr(g,l+2,w).times(i+""))),c=ke(c,new g(p),l,1),e==null)if(eo(c.d,l-y,A,a))g.precision=l+=y,u=s=f=ke(m.minus(1),m.plus(1),l,1),d=Z(f.times(f),l,1),r=a=1;else return Z(c,g.precision=w,A,re=!0);else return g.precision=w,c;c=u,r+=2}}function Aa(o){return String(o.s*o.s/0)}function gi(o,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,o.e=t=t-n-1,o.d=[],n=(t+1)%te,t<0&&(n+=te),n<r){for(n&&o.d.push(+e.slice(0,n)),r-=te;n<r;)o.d.push(+e.slice(n,n+=te));e=e.slice(n),n=te-e.length}else n-=r;for(;n--;)e+="0";o.d.push(+e),re&&(o.e>o.constructor.maxE?(o.d=null,o.e=NaN):o.e<o.constructor.minE&&(o.e=0,o.d=[0]))}else o.e=0,o.d=[0];return o}function nl(o,e){var t,n,r,i,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),fa.test(e))return gi(o,e)}else if(e==="Infinity"||e==="NaN")return+e||(o.s=NaN),o.e=NaN,o.d=null,o;if(Zc.test(e))t=16,e=e.toLowerCase();else if(Hc.test(e))t=2;else if($c.test(e))t=8;else throw Error(tn+e);for(i=e.search(/p/i),i>0?(c=+e.slice(i+1),e=e.substring(2,i)):e=e.slice(2),i=e.indexOf("."),s=i>=0,n=o.constructor,s&&(e=e.replace(".",""),a=e.length,i=a-i,r=ba(n,new n(t),i,i*2)),u=tr(e,t,xt),l=u.length-1,i=l;u[i]===0;--i)u.pop();return i<0?new n(o.s*0):(o.e=sr(u,l),o.d=u,re=!1,s&&(o=ke(o,r,a*4)),c&&(o=o.times(Math.abs(c)<54?Ee(2,c):to.pow(2,c))),re=!0,o)}function ol(o,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:_n(o,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/ar(5,t)),e=_n(o,2,e,e);for(var r,i=new o(5),s=new o(16),a=new o(20);t--;)r=e.times(e),e=e.times(i.plus(r.times(s.times(r).minus(a))));return e}function _n(o,e,t,n,r){var i,s,a,c,u=1,l=o.precision,m=Math.ceil(l/te);for(re=!1,c=t.times(t),a=new o(n);;){if(s=ke(a.times(c),new o(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=ke(s.times(c),new o(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(i=m;s.d[i]===a.d[i]&&i--;);if(i==-1)break}i=a,a=n,n=s,s=i,u++}return re=!0,s.d.length=m+1,s}function ar(o,e){for(var t=o;--e;)t*=o;return t}function wa(o,e){var t,n=e.s<0,r=Bt(o,o.precision,1),i=r.times(.5);if(e=e.abs(),e.lte(i))return Vt=n?4:1,e;if(t=e.divToInt(r),t.isZero())Vt=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(i))return Vt=aa(t)?n?2:3:n?4:1,e;Vt=aa(t)?n?1:4:n?3:2}return e.minus(r).abs()}function Ai(o,e,t,n){var r,i,s,a,c,u,l,m,d,p=o.constructor,y=t!==void 0;if(y?(at(t,1,nn),n===void 0?n=p.rounding:at(n,0,8)):(t=p.precision,n=p.rounding),!o.isFinite())l=Aa(o);else{for(l=Nt(o),s=l.indexOf("."),y?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=tr(Nt(d),10,r),d.e=d.d.length),m=tr(l,10,r),i=c=m.length;m[--c]==0;)m.pop();if(!m[0])l=y?"0p+0":"0";else{if(s<0?i--:(o=new p(o),o.d=m,o.e=i,o=ke(o,d,t,n,0,r),m=o.d,i=o.e,u=la),s=m[t],a=r/2,u=u||m[t+1]!==void 0,u=n<4?(s!==void 0||u)&&(n===0||n===(o.s<0?3:2)):s>a||s===a&&(n===4||u||n===6&&m[t-1]&1||n===(o.s<0?8:7)),m.length=t,u)for(;++m[--t]>r-1;)m[t]=0,t||(++i,m.unshift(1));for(c=m.length;!m[c-1];--c);for(s=0,l="";s<c;s++)l+=pi.charAt(m[s]);if(y){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(m=tr(l,r,e),c=m.length;!m[c-1];--c);for(s=1,l="1.";s<c;s++)l+=pi.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(i<0?"p":"p+")+i}else if(i<0){for(;++i;)l="0"+l;l="0."+l}else if(++i>c)for(i-=c;i--;)l+="0";else i<c&&(l=l.slice(0,i)+"."+l.slice(i))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return o.s<0?"-"+l:l}function ua(o,e){if(o.length>e)return o.length=e,!0}function rl(o){return new this(o).abs()}function il(o){return new this(o).acos()}function sl(o){return new this(o).acosh()}function al(o,e){return new this(o).plus(e)}function ul(o){return new this(o).asin()}function cl(o){return new this(o).asinh()}function ll(o){return new this(o).atan()}function ml(o){return new this(o).atanh()}function dl(o,e){o=new this(o),e=new this(e);var t,n=this.precision,r=this.rounding,i=n+4;return!o.s||!e.s?t=new this(NaN):!o.d&&!e.d?(t=Bt(this,i,1).times(e.s>0?.25:.75),t.s=o.s):!e.d||o.isZero()?(t=e.s<0?Bt(this,n,r):new this(0),t.s=o.s):!o.d||e.isZero()?(t=Bt(this,i,1).times(.5),t.s=o.s):e.s<0?(this.precision=i,this.rounding=1,t=this.atan(ke(o,e,i,1)),e=Bt(this,i,1),this.precision=n,this.rounding=r,t=o.s<0?t.minus(e):t.plus(e)):t=this.atan(ke(o,e,i,1)),t}function pl(o){return new this(o).cbrt()}function fl(o){return Z(o=new this(o),o.e+1,2)}function yl(o,e,t){return new this(o).clamp(e,t)}function bl(o){if(!o||typeof o!="object")throw Error(ir+"Object expected");var e,t,n,r=o.defaults===!0,i=["precision",1,nn,"rounding",0,8,"toExpNeg",-Mn,0,"toExpPos",0,Mn,"maxE",0,Mn,"minE",-Mn,0,"modulo",0,9];for(e=0;e<i.length;e+=3)if(t=i[e],r&&(this[t]=fi[t]),(n=o[t])!==void 0)if($e(n)===n&&n>=i[e+1]&&n<=i[e+2])this[t]=n;else throw Error(tn+t+": "+n);if(t="crypto",r&&(this[t]=fi[t]),(n=o[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(da);else this[t]=!1;else throw Error(tn+t+": "+n);return this}function gl(o){return new this(o).cos()}function Al(o){return new this(o).cosh()}function Pa(o){var e,t,n;function r(i){var s,a,c,u=this;if(!(u instanceof r))return new r(i);if(u.constructor=r,ca(i)){u.s=i.s,re?!i.d||i.e>r.maxE?(u.e=NaN,u.d=null):i.e<r.minE?(u.e=0,u.d=[0]):(u.e=i.e,u.d=i.d.slice()):(u.e=i.e,u.d=i.d?i.d.slice():i.d);return}if(c=typeof i,c==="number"){if(i===0){u.s=1/i<0?-1:1,u.e=0,u.d=[0];return}if(i<0?(i=-i,u.s=-1):u.s=1,i===~~i&&i<1e7){for(s=0,a=i;a>=10;a/=10)s++;re?s>r.maxE?(u.e=NaN,u.d=null):s<r.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[i]):(u.e=s,u.d=[i]);return}else if(i*0!==0){i||(u.s=NaN),u.e=NaN,u.d=null;return}return gi(u,i.toString())}else if(c!=="string")throw Error(tn+i);return(a=i.charCodeAt(0))===45?(i=i.slice(1),u.s=-1):(a===43&&(i=i.slice(1)),u.s=1),fa.test(i)?gi(u,i):nl(u,i)}if(r.prototype=V,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=bl,r.clone=Pa,r.isDecimal=ca,r.abs=rl,r.acos=il,r.acosh=sl,r.add=al,r.asin=ul,r.asinh=cl,r.atan=ll,r.atanh=ml,r.atan2=dl,r.cbrt=pl,r.ceil=fl,r.clamp=yl,r.cos=gl,r.cosh=Al,r.div=wl,r.exp=Pl,r.floor=hl,r.hypot=kl,r.ln=Tl,r.log=Il,r.log10=xl,r.log2=Bl,r.max=Sl,r.min=Kl,r.mod=Cl,r.mul=Rl,r.pow=Ll,r.random=Ol,r.round=Nl,r.sign=Ml,r.sin=_l,r.sinh=vl,r.sqrt=Vl,r.sub=Fl,r.sum=El,r.tan=Dl,r.tanh=Wl,r.trunc=ql,o===void 0&&(o={}),o&&o.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)o.hasOwnProperty(t=n[e++])||(o[t]=this[t]);return r.config(o),r}function wl(o,e){return new this(o).div(e)}function Pl(o){return new this(o).exp()}function hl(o){return Z(o=new this(o),o.e+1,3)}function kl(){var o,e,t=new this(0);for(re=!1,o=0;o<arguments.length;)if(e=new this(arguments[o++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return re=!0,new this(1/0);t=e}return re=!0,t.sqrt()}function ca(o){return o instanceof to||o&&o.toStringTag===pa||!1}function Tl(o){return new this(o).ln()}function Il(o,e){return new this(o).log(e)}function Bl(o){return new this(o).log(2)}function xl(o){return new this(o).log(10)}function Sl(){return ga(this,arguments,"lt")}function Kl(){return ga(this,arguments,"gt")}function Cl(o,e){return new this(o).mod(e)}function Rl(o,e){return new this(o).mul(e)}function Ll(o,e){return new this(o).pow(e)}function Ol(o){var e,t,n,r,i=0,s=new this(1),a=[];if(o===void 0?o=this.precision:at(o,1,nn),n=Math.ceil(o/te),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));i<n;)r=e[i],r>=429e7?e[i]=crypto.getRandomValues(new Uint32Array(1))[0]:a[i++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);i<n;)r=e[i]+(e[i+1]<<8)+(e[i+2]<<16)+((e[i+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,i):(a.push(r%1e7),i+=4);i=n/4}else throw Error(da);else for(;i<n;)a[i++]=Math.random()*1e7|0;for(n=a[--i],o%=te,n&&o&&(r=Ee(10,te-o),a[i]=(n/r|0)*r);a[i]===0;i--)a.pop();if(i<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=te)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<te&&(t-=te-n)}return s.e=t,s.d=a,s}function Nl(o){return Z(o=new this(o),o.e+1,this.rounding)}function Ml(o){return o=new this(o),o.d?o.d[0]?o.s:0*o.s:o.s||NaN}function _l(o){return new this(o).sin()}function vl(o){return new this(o).sinh()}function Vl(o){return new this(o).sqrt()}function Fl(o,e){return new this(o).sub(e)}function El(){var o=0,e=arguments,t=new this(e[o]);for(re=!1;t.s&&++o<e.length;)t=t.plus(e[o]);return re=!0,Z(t,this.precision,this.rounding)}function Dl(o){return new this(o).tan()}function Wl(o){return new this(o).tanh()}function ql(o){return Z(o=new this(o),o.e+1,1)}V[Symbol.for("nodejs.util.inspect.custom")]=V.toString;V[Symbol.toStringTag]="Decimal";var to=V.constructor=Pa(fi);nr=new to(nr);or=new to(or);var O=to;import jl from"big.js";import on from"bn.js";import Ul from"toformat";var Gl=Ul,no=Gl;import cr from"big.js";import Xl from"bn.js";import zl from"decimal.js-light";import oo from"bn.js";var wi=(n=>(n[n.ROUND_DOWN=0]="ROUND_DOWN",n[n.ROUND_HALF_UP=1]="ROUND_HALF_UP",n[n.ROUND_UP=2]="ROUND_UP",n))(wi||{}),ha=9007199254740991;function z(o){let e=ce("Raydium_parseBigNumberish");if(o instanceof oo)return o;if(typeof o=="string"){if(o.match(/^-?[0-9]+$/))return new oo(o);e.logWithError(`invalid BigNumberish string: ${o}`)}return typeof o=="number"?(o%1&&e.logWithError(`BigNumberish number underflow: ${o}`),(o>=ha||o<=-ha)&&e.logWithError(`BigNumberish number overflow: ${o}`),new oo(String(o))):typeof o=="bigint"?new oo(o.toString()):(e.error(`invalid BigNumberish value: ${o}`),new oo(0))}var ur=ce("module/fraction"),Pi=no(cr),ro=no(zl),Ql={[0]:ro.ROUND_DOWN,[1]:ro.ROUND_HALF_UP,[2]:ro.ROUND_UP},Yl={[0]:cr.roundDown,[1]:cr.roundHalfUp,[2]:cr.roundUp},ie=class{constructor(e,t=new Xl(1)){this.numerator=z(e),this.denominator=z(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new ie(this.denominator,this.numerator)}add(e){let t=e instanceof ie?e:new ie(z(e));return this.denominator.eq(t.denominator)?new ie(this.numerator.add(t.numerator),this.denominator):new ie(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof ie?e:new ie(z(e));return this.denominator.eq(t.denominator)?new ie(this.numerator.sub(t.numerator),this.denominator):new ie(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof ie?e:new ie(z(e));return new ie(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof ie?e:new ie(z(e));return new ie(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||ur.logWithError(`${e} is not an integer.`),e<=0&&ur.logWithError(`${e} is not positive.`),ro.set({precision:e+1,rounding:Ql[n]});let r=new ro(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||ur.logWithError(`${e} is not an integer.`),e<0&&ur.logWithError(`${e} is negative.`),Pi.DP=e,Pi.RM=Yl[n]||1,new Pi(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Hl=ce("Raydium_amount"),lr=no(jl);function ka(o,e){let t="0",n="0";if(o.includes(".")){let r=o.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):Hl.logWithError(`invalid number string, num: ${o}`)}else t=o;return[t,n.slice(0,e)||n]}var fe=class extends ie{constructor(t,n,r=!0,i){let s=new on(0),a=fn.pow(new on(t.decimals));if(r)s=z(n);else{let c=new on(0),u=new on(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=ka(n.toString(),t.decimals);c=z(l),u=z(m)}c=c.mul(a),s=c.add(u)}super(s,a);this.logger=ce(i||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new fe(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new fe(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return lr.DP=this.token.decimals,new lr(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}},pn=class extends ie{constructor(t,n,r=!0,i){let s=new on(0),a=fn.pow(new on(t.decimals));if(r)s=z(n);else{let c=new on(0),u=new on(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=ka(n.toString(),t.decimals);c=z(l),u=z(m)}c=c.mul(a),s=c.add(u)}super(s,a);this.logger=ce(i||"TokenAmount"),this.currency=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.currency.equals(t.currency)||this.logger.logWithError("gt currency not equals"),this.raw.gt(t.raw)}lt(t){return this.currency.equals(t.currency)||this.logger.logWithError("lt currency not equals"),this.raw.lt(t.raw)}add(t){return this.currency.equals(t.currency)||this.logger.logWithError("add currency not equals"),new pn(this.currency,this.raw.add(t.raw))}sub(t){return this.currency.equals(t.currency)||this.logger.logWithError("sub currency not equals"),new pn(this.currency,this.raw.sub(t.raw))}toSignificant(t=this.currency.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.currency.decimals,n,r=0){return t>this.currency.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return lr.DP=this.currency.decimals,new lr(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as Zl}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ta}from"@solana/spl-token";var Mt={chainId:101,address:Zl.default.toBase58(),programId:Ta.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},De={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Ta.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Bi}from"@solana/web3.js";import{PublicKey as xe,SystemProgram as Ia,SYSVAR_RENT_PUBKEY as $l}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Jl}from"@solana/spl-token";function h({pubkey:o,isSigner:e=!1,isWritable:t=!0}){return{pubkey:o,isWritable:t,isSigner:e}}var hi=[h({pubkey:Jl,isWritable:!1}),h({pubkey:Ia.programId,isWritable:!1}),h({pubkey:$l,isWritable:!1})];function ki({publicKey:o,transformSol:e}){let t=Ti(o.toString());if(t instanceof xe)return e&&t.equals(We)?Q:t;if(e&&t.toString()===We.toBase58())return Q;if(typeof t=="string"){if(t===xe.default.toBase58())return xe.default;try{return new xe(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Ti(o){try{return new xe(o)}catch{return o}}var mr=new xe("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),vn=new xe("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ut=new xe("SysvarRent111111111111111111111111111111111"),Ii=new xe("SysvarC1ock11111111111111111111111111111111"),Vn=new xe("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),dr=new xe("Sysvar1nstructions1111111111111111111111111"),pr=Ia.programId,Ty=new xe("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Iy=new xe("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),By=new xe("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),xy=new xe("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Sy=new xe("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ky=new xe("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Cy=new xe("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Ry=new xe("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ly=new xe("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Oy=new xe("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ny=new xe("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Q=new xe("So11111111111111111111111111111111111111112"),We=xe.default;function ft(o){return ki({publicKey:o,transformSol:!0})}var xi=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:i=!1,isToken2022:s=!1}){if(e===We.toBase58()||e instanceof Bi&&We.equals(e)){this.decimals=De.decimals,this.symbol=De.symbol,this.name=De.name,this.mint=new Bi(De.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=i?Bi.default:ki({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},be=xi;be.WSOL=new xi(E(R({},De),{mint:De.address}));var Si=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},io=Si;io.SOL=new Si(Mt);function qy(o,e){return o instanceof be&&e instanceof be?o.equals(e):o instanceof be||e instanceof be?!1:o===e}import em from"bn.js";var Ba=new ie(new em(100)),Ke=class extends ie{toSignificant(e=5,t,n){return this.mul(Ba).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Ba).toFixed(e,t,n)}};var tm=ce("Raydium_price"),Ge=class extends ie{constructor(t){let{baseToken:n,quoteToken:r,numerator:i,denominator:s}=t;super(i,s);this.baseToken=n,this.quoteToken=r,this.scalar=new ie(Ki(n.decimals),Ki(r.decimals))}get raw(){return new ie(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Ge({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&tm.logWithError("mul token not equals");let n=super.mul(t);return new Ge({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};function Ne(o){if(o instanceof Ke)return new ie(o.numerator,o.denominator);if(o instanceof Ge)return o.adjusted;if(o instanceof fe)try{return Ne(o.toExact())}catch{return new ie(qe)}if(o instanceof ie)return o;let e=String(o),t=yn(e);return new ie(t.numerator,t.denominator)}function cb(o){var n;if(o instanceof Ke)return{fr:new ie(o.numerator,o.denominator)};if(o instanceof Ge)return{fr:o.adjusted};if(o instanceof fe)return{fr:Ne(o.toExact()),decimals:o.token.decimals};if(o instanceof ie)return{fr:o};let e=String(o),t=yn(e);return{fr:new ie(t.numerator,t.denominator),decimals:(n=t.dec)==null?void 0:n.length}}function lb(o,e){if(o==null||e==null)return!1;let t=Ne(o),n=Ne(e);return t.sub(n).numerator,t.sub(n).numerator.lt(qe)}function nm(o,e){if(o==null||e==null)return!1;let t=Ne(o),n=Ne(e);return t.sub(n).numerator.gt(qe)}function mb(o,e){if(o==null||e==null)return!1;let t=Ne(o),n=Ne(e);return t.sub(n).numerator.lte(qe)}function db(o,e){if(o==null||e==null)return!1;let t=Ne(o),n=Ne(e);return t.sub(n).numerator.gte(qe)}function om(o,e){if(o==null||e==null)return!1;let t=Ne(o),n=Ne(e);return t.sub(n).numerator.eq(qe)}function pb(o,e){if(o==null||e==null)return;let t=Ne(o),n=Ne(e);try{return t.div(n)}catch{return t}}function fb(o,e){if(o==null||e==null)return;let t=Ne(o),n=Ne(e);return t.sub(n)}function yb(o){return o==null?!1:!om(o,0)}function bb(o,e){return nm(e,o)?e:o}function Ci(o,e){if(o==null||e==null)return;let t=Ne(o),n=Ne(e);return t.mul(n)}function gb(o,e){if(o==null||e==null)return;let t=Ne(o),n=Ne(e);return t.add(n)}import{PublicKey as rm}from"@solana/web3.js";import im from"bn.js";async function xa(o){new Promise(e=>setTimeout(e,o))}function Tb(){return new Date().getTime()}function Ri(o){return typeof o=="object"&&o!==null&&![be,fe,rm,ie,im,Ge,Ke].some(e=>typeof e=="object"&&o instanceof e)}function Ie(o){return typeof o=="string"?Ti(o):Array.isArray(o)?o.map(e=>Ie(e)):Ri(o)?Object.fromEntries(Object.entries(o).map(([e,t])=>[e,Ie(t)])):o}var qe=new Me(0),Ca=new Me(1),vb=new Me(2),Vb=new Me(3),Fb=new Me(5),fn=new Me(10),Eb=new Me(100),Db=new Me(1e3),Wb=new Me(1e4);function Ki(o){return fn.pow(z(o))}function yn(o){var a;if(o===void 0)return{denominator:"1",numerator:"0"};if(o instanceof Me)return{numerator:o.toString(),denominator:"1"};if(o instanceof ie)return{denominator:o.denominator.toString(),numerator:o.numerator.toString()};let e=String(o),[,t="",n="",r=""]=(a=e.replace(",","").match(/(-?)(\d*)\.?(\d*)/))!=null?a:[],i="1"+"0".repeat(r.length),s=t+(n==="0"?"":n)+r||"0";return{denominator:i,numerator:s,sign:t,int:n,dec:r}}function fr(o,e){let t=o.divmod(e);return t.mod.isZero()?t.div:t.div.isNeg()?t.div.isubn(1):t.div.iaddn(1)}function sm(o){var n;let[,e="",t=""]=(n=o.toFixed(2).match(/(-?)(\d*)\.?(\d*)/))!=null?n:[];return`${e}${t}`}function am(o,e=0){return o instanceof Me?o:new Me(sm(Ra(o).mul(fn.pow(new Me(String(e))))))}function Ra(o){if(o instanceof Ke)return new ie(o.numerator,o.denominator);if(o instanceof Ge)return o.adjusted;if(o instanceof fe)try{return Ra(o.toExact())}catch{return new ie(qe)}if(o instanceof ie)return o;let e=String(o),t=yn(e);return new ie(t.numerator,t.denominator)}function qb(o,e){let{numerator:t,denominator:n}=yn(o);return new Ke(new Me(t),new Me(n).mul(e!=null&&e.alreadyDecimaled?new Me(100):new Me(1)))}function Ub(o){let{token:e,numberPrice:t,decimalDone:n}=o,r=new be({mint:"",decimals:6,symbol:"usd",name:"usd",skipMint:!0}),{numerator:i,denominator:s}=yn(t),a=n?new Me(i).mul(fn.pow(new Me(e.decimals))):i,c=new Me(s).mul(fn.pow(new Me(r.decimals)));return new Ge({baseToken:r,denominator:c.toString(),quoteToken:new be(E(R({},e),{skipMint:!0,mint:""})),numerator:a.toString()})}function Sa(o){let e=new io({decimals:6,symbol:"usd",name:"usd"}),t=am(Ci(o,10**e.decimals));return new pn(e,t)}function Gb(o,e){return Sa(!e||!o?0:Ci(o,e))}function um(o){if(o==null)return;let{numerator:e,denominator:t}=yn(o.toString());return new ie(e,t)}function cm(o){return o instanceof O}function Ka(o){return cm(o)?um(o):Array.isArray(o)?o.map(e=>Ka(e)):Ri(o)?Object.fromEntries(Object.entries(o).map(([e,t])=>[e,Ka(t)])):o}var La=o=>typeof o=="number",Oa=o=>o?new Date(o):new Date,lm=o=>Oa(o).getTime();function Na(o,e,t){let n=La(e)?e*((t==null?void 0:t.unit)==="s"?1e3:1):e;return new Date(o).getTime()<=n}function Ma(o,e,t){let n=La(e)?e*((t==null?void 0:t.unit)==="s"?1e3:1):e;return new Date(o).getTime()>n}function zb(o,e){let n=lm(o)+(e.days?e.days*24*60*60*1e3:0)+(e.hours?e.hours*60*60*1e3:0)+(e.minutes?e.minutes*60*1e3:0)+(e.seconds?e.seconds*1e3:0)+(e.milliseconds?e.milliseconds:0);return Oa(n)}function di(o,e=1,t=[]){let n=[...o];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}function Yb(o,...e){return o.filter(t=>e.every(n=>n.includes(t)))}function jb(o,...e){return o.filter(t=>e.every(n=>!n.includes(t)))}function Hb(o){return[...new Set(o)]}var St=class{constructor(e){this._owner=e}get publicKey(){return St.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return St.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return St.isKeyPair(this._owner)}get isPublicKey(){return St.isPublicKey(this._owner)}static isKeyPair(e){return e.secretKey!==void 0}static isPublicKey(e){return!St.isKeyPair(e)}};import{PublicKey as ym}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as bm}from"@solana/spl-token";import{ComputeBudgetProgram as _a,Keypair as va,PublicKey as Va,Transaction as br,TransactionMessage as mm,VersionedTransaction as Li}from"@solana/web3.js";var bn=(t=>(t[t.V0=0]="V0",t[t.LEGACY=1]="LEGACY",t))(bn||{}),F={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"};import{TOKEN_PROGRAM_ID as dm}from"@solana/spl-token";var Ft=ce("Raydium_txUtil"),Fa=1644;function gr(o){let e=[],t=[];return o.microLamports&&(e.push(_a.setComputeUnitPrice({microLamports:o.microLamports})),t.push(F.SetComputeUnitPrice)),o.units&&(e.push(_a.setComputeUnitLimit({units:o.units})),t.push(F.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Fn(o,e){var n,r;let t=e!=null?e:"confirmed";return(r=await((n=o.getLatestBlockhash)==null?void 0:n.call(o,{commitment:t})))==null?void 0:r.blockhash}async function Ar(o,e){return o.getSignatureStatuses([e]),new Promise((t,n)=>{let r=setTimeout(n,6e4);o.onSignature(e,i=>{if(clearTimeout(r),!i.err){t("");return}n(i.err.toString())},"confirmed")})}function wr(o,e){o.length<1&&Ft.logWithError(`no instructions provided: ${o.toString()}`),e.length<1&&Ft.logWithError(`no signers provided:, ${e.toString()}`);let t=new br;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...o);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Fa}catch{return!1}}async function Ea(o,e,t,n=!0){let r=new Va("RaydiumSimuLateTransaction11111111111111111"),i=[],s=new br;s.feePayer=r;for(let u of e)wr([...s.instructions,u],[r])||(i.push(s),s=new br,s.feePayer=r),s.add(u);s.instructions.length>0&&i.push(s);let a=[];try{if(a=await pm(o,i,n),a.find(u=>u.err!==null))throw Error("rpc simulateTransaction error")}catch(u){u instanceof Error&&Ft.logWithError("failed to simulate for instructions","RPC_ERROR",{message:u.message})}let c=[];for(let u of a)if(Ft.debug("simulate result:",u),u.logs){let l=u.logs.filter(m=>m&&m.includes(t));Ft.debug("filteredLog:",c),l.length||Ft.logWithError("simulate log not match keyword","keyword",t),c.push(...l)}return c}function Da(o,e){let t=o.match(/{["\w:,]+}/g);return!t||t.length!==1?Ft.logWithError(`simulate log fail to match json, keyword: ${e}`):t[0]}function Et(o,e){let n=new RegExp(`"${e}":(\\d+)`,"g").exec(o);return!n||n.length!==2?Ft.logWithError(`simulate log fail to match key", key: ${e}`):n[1]}function ae(o,e){let[t,n]=Va.findProgramAddressSync(o,e);return{publicKey:t,nonce:n}}async function pm(o,e,t){let n=[];if(t){let r=await o.getLatestBlockhash(),i=[];for(let u of e){u.recentBlockhash=r.blockhash,u.lastValidBlockHeight=r.lastValidBlockHeight;let m=u._compile().serialize(),p=u._serialize(m).toString("base64");i.push(p)}let s=i.map(u=>{let l=o._buildArgs([u],void 0,"base64");return{methodName:"simulateTransaction",args:l}}),a=[],c=20;for(let u=0;u<Math.ceil(s.length/c);u++)a.push(s.slice(u*c,(u+1)*c));n=await(await Promise.all(a.map(async u=>(await o._rpcBatchRequest(u)).map(l=>l.result.value)))).flat()}else try{n=await Promise.all(e.map(async r=>await(await o.simulateTransaction(r)).value))}catch(r){r instanceof Error&&Ft.logWithError("failed to get info for multiple accounts","RPC_ERROR",{message:r.message})}return n}function so({instructions:o,payer:e,signers:t}){return wr(o,[e,...t])}function ao({instructions:o,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=va.generate().publicKey.toString()}){let i=new mm({payerKey:e,recentBlockhash:n,instructions:o}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Li(i).serialize()).toString("base64").length<Fa}catch{return!1}}var yr={time:0,data:void 0};async function cg(o){if(!yr.data||(Date.now()-yr.time)/1e3>30){let e=await o.getEpochInfo();return yr={time:Date.now(),data:e},e}else return yr.data}var Wa=o=>Buffer.isBuffer(o)?o:o instanceof Uint8Array?Buffer.from(o.buffer,o.byteOffset,o.byteLength):Buffer.from(o),fm=o=>{let e=o.serialize({requireAllSignatures:!1,verifySignatures:!1});o instanceof Li&&(e=Wa(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function gn(o){let e=[];return o.forEach(t=>{t instanceof br&&(t.recentBlockhash||(t.recentBlockhash=dm.toBase58()),t.feePayer||(t.feePayer=va.generate().publicKey)),e.push(fm(t))}),console.log("simulate tx string:",e),e}function lg(o){let e=o.serialize({requireAllSignatures:!1,verifySignatures:!1});return o instanceof Li&&(e=Wa(e)),e.toString("base64")}function ge(o,e,t){return ae([o.toBuffer(),(t!=null?t:bm).toBuffer(),e.toBuffer()],new ym("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as le}from"@solana/web3.js";var Oi=new le("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Ni=new le("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),En=new le("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),gm=new le("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Am=new le("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Pr=new le("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Mi=new le("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),wm=new le("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),qa=new le("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),uo=new le("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),co=new le("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),lo=new le("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Pm=new le("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),gg=new le("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),hm=new le("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),km=new le("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Tm=new le("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Im=new le("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),_i=new le("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Bm=new le("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),xm=new le("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Sm=new le("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Km=new le("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Cm=new le("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),mo={IDO_PROGRAM_ID_V1:hm,IDO_PROGRAM_ID_V2:km,IDO_PROGRAM_ID_V3:Tm,IDO_PROGRAM_ID_V4:Im},Ag={AMM_V4:Mi,AMM_STABLE:wm,CLMM_PROGRAM_ID:uo,CLMM_LOCK_PROGRAM_ID:co,CLMM_LOCK_AUTH_ID:lo,FARM_PROGRAM_ID_V3:Oi,FARM_PROGRAM_ID_V5:Ni,FARM_PROGRAM_ID_V6:En,OPEN_BOOK_PROGRAM:Am,SERUM_PROGRAM_ID_V3:Pr,UTIL1216:gm,Router:Pm,CREATE_CPMM_POOL_PROGRAM:_i,CREATE_CPMM_POOL_AUTH:Bm,CREATE_CPMM_POOL_FEE_ACC:xm},wg={SERUM_MARKET:le.default,OPENBOOK_MARKET:new le("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:le.default,FarmV3:new le("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new le("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new le("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new le("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new le("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new le("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new le("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new le("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new le("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Sm,CREATE_CPMM_POOL_AUTH:Km,CREATE_CPMM_POOL_FEE_ACC:Cm,FEE_DESTINATION_ID:new le("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR")};import Ve from"bn.js";var _t=1e4;function kg(o,e,t,n){if(e===void 0)return{amount:o,fee:void 0,expirationTime:void 0};let r=t.epoch<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,i=new Ve(r.maximumFee.toString()),s=t.epoch<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(r.transferFeeBasisPoints===_t){let a=new Ve(r.maximumFee.toString());return{amount:o.add(a),fee:a,expirationTime:s}}else{let a=Kt(o.mul(new Ve(_t)),new Ve(_t-r.transferFeeBasisPoints)),c=new Ve(r.maximumFee.toString()),u=a.sub(o).gt(c)?o.add(c):a,l=Kt(u.mul(new Ve(r.transferFeeBasisPoints)),new Ve(_t)),m=l.gt(i)?i:l;return{amount:u,fee:m,expirationTime:s}}else{let a=Kt(o.mul(new Ve(r.transferFeeBasisPoints)),new Ve(_t)),c=a.gt(i)?i:a;return{amount:o,fee:c,expirationTime:s}}}function ye(o,e,t,n){if(e===void 0)return{amount:o,fee:void 0,expirationTime:void 0};let r=E(R({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),i=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new Ve(i.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(i.transferFeeBasisPoints===_t){let c=new Ve(i.maximumFee.toString());return{amount:o.add(c),fee:c,expirationTime:a}}else{let c=Kt(o.mul(new Ve(_t)),new Ve(_t-i.transferFeeBasisPoints)),u=new Ve(i.maximumFee.toString()),l=c.sub(o).gt(u)?o.add(u):c,m=Kt(l.mul(new Ve(i.transferFeeBasisPoints)),new Ve(_t)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let c=Kt(o.mul(new Ve(i.transferFeeBasisPoints)),new Ve(_t)),u=c.gt(s)?s:c;return{amount:o,fee:u,expirationTime:a}}}function Ct(o,e){return o===void 0?e:e===void 0?o:Math.min(o,e)}function Kt(o,e){let{div:t,mod:n}=o.divmod(e);return n.gt(new Ve(0))?t.add(new Ve(1)):t}import{PublicKey as Ua,AddressLookupTableAccount as hr}from"@solana/web3.js";async function vi({connection:o,address:e}){let t=await It(o,[...new Set(e.map(r=>r.toString()))].map(r=>new Ua(r))),n={};for(let r=0;r<e.length;r++){let i=t[r],s=e[r];if(!i)continue;let a=new hr({key:s,state:hr.deserialize(i.data)});n[s.toString()]=a,kr[s.toString()]=a}return n}var kr={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new hr({key:new Ua("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:hr.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as po,sendAndConfirmTransaction as Vi,Transaction as fo,TransactionMessage as yo,VersionedTransaction as bo}from"@solana/web3.js";import Rm from"axios";var Tr=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.api=e.api}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Rm.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=gr(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:r=[],endInstructionTypes:i=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...r),this.endInstructionTypes.push(...i),this.lookupTableAddress.push(...s.filter(a=>a!==po.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(R({},t||{})):this.build(t)}build(e){var n;let t=new fo;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(r=>r.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{var u;let{recentBlockHash:i,skipPreflight:s=!0,sendAndConfirm:a}=r||{},c=i!=null?i:await Fn(this.connection,this.blockhashCommitment);if(t.recentBlockhash=c,this.signers.length&&t.sign(...this.signers),gn([t]),(u=this.owner)!=null&&u.isKeyPair)return{txId:a?await Vi(this.connection,t,this.signers.find(m=>m.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let l=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:r}=this.build(n),i=t.filter(l=>l.transaction.instructions.length>0),s=[r,...i.map(l=>l.transaction)],a=[this.signers,...i.map(l=>l.signers)],c=[...this.instructionTypes,...i.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async l=>{var b;let{sequentially:m,onTxUpdate:d,recentBlockHash:p,skipPreflight:y=!0}=l||{},f=p!=null?p:await Fn(this.connection,this.blockhashCommitment);if((b=this.owner)!=null&&b.isKeyPair){if(m){let g=[];for(let A of s){let w=await Vi(this.connection,A,this.signers.find(k=>k.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:y});g.push(w)}return{txIds:g,signedTxs:s}}return{txIds:await await Promise.all(s.map(async g=>(g.recentBlockhash=f,await this.connection.sendRawTransaction(g.serialize(),{skipPreflight:y})))),signedTxs:s}}if(this.signAllTransactions){let g=s.map((w,k)=>(w.recentBlockhash=f,a[k].length&&w.sign(...a[k]),w));gn(g);let A=await this.signAllTransactions(g);if(m){let w=0,k=[],I=async()=>{if(!A[w])return;let T=await this.connection.sendRawTransaction(A[w].serialize(),{skipPreflight:y});k.push({txId:T,status:"sent",signedTx:A[w]}),d==null||d([...k]),w++,this.connection.onSignature(T,S=>{let B=k.findIndex(C=>C.txId===T);B>-1&&(k[B].status=S.err?"error":"success"),d==null||d([...k]),S.err||I()},"processed"),this.connection.getSignatureStatus(T)};return await I(),{txIds:k.map(T=>T.txId),signedTxs:A}}else{let w=[];for(let k=0;k<A.length;k+=1){let I=await this.connection.sendRawTransaction(A[k].serialize(),{skipPreflight:y});w.push(I)}return{txIds:w,signedTxs:A}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var f;let y=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:r,recentBlockhash:i}=y,s=Oe(y,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=R(R({},this.cluster==="devnet"?{}:kr),t),c=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let b of c)a[b]===void 0&&u.push(new po(b));let l=await vi({connection:this.connection,address:u});for(let[b,g]of Object.entries(l))a[b]=g;let m=r?po.default.toBase58():i!=null?i:await Fn(this.connection,this.blockhashCommitment),d=new yo({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((f=this.owner)==null?void 0:f.signer)&&!this.signers.some(b=>b.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let p=new bo(d);return p.sign(this.signers),{builder:this,transaction:p,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async b=>{var w;let{skipPreflight:g=!0,sendAndConfirm:A}=b||{};if(gn([p]),(w=this.owner)!=null&&w.isKeyPair){let k=await this.connection.sendTransaction(p,{skipPreflight:g});return A&&await Ar(this.connection,k),{txId:k,signedTx:p}}if(this.signAllTransactions){let k=await this.signAllTransactions([p]);return{txId:await this.connection.sendTransaction(k[0],{skipPreflight:g}),signedTx:k[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:r}=await this.buildV0(n),i=t.filter(l=>l.builder.instructions.length>0),s=[r,...i.map(l=>l.transaction)],a=[this.signers,...i.map(l=>l.signers)],c=[...this.instructionTypes,...i.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,m)=>{l.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async l=>{var f;let{sequentially:m,onTxUpdate:d,recentBlockHash:p,skipPreflight:y=!0}=l||{};if(p&&s.forEach(b=>b.message.recentBlockhash=p),gn(s),(f=this.owner)!=null&&f.isKeyPair){if(m){let b=[];for(let g of s){let A=await this.connection.sendTransaction(g,{skipPreflight:y});await Ar(this.connection,A),b.push(A)}return{txIds:b,signedTxs:s}}return{txIds:await Promise.all(s.map(async b=>await this.connection.sendTransaction(b,{skipPreflight:y}))),signedTxs:s}}if(this.signAllTransactions){let b=await this.signAllTransactions(s);if(m){let g=0,A=[],w=async()=>{if(!b[g])return;let k=await this.connection.sendTransaction(b[g],{skipPreflight:y});A.push({txId:k,status:"sent",signedTx:b[g]}),d==null||d([...A]),g++,this.connection.onSignature(k,I=>{let T=A.findIndex(S=>S.txId===k);T>-1&&(A[T].status=I.err?"error":"success"),d==null||d([...A]),I.err||w()},"processed"),this.connection.getSignatureStatus(k)};return w(),{txIds:[],signedTxs:b}}else{let g=[];for(let A=0;A<b.length;A+=1){let w=await this.connection.sendTransaction(b[A],{skipPreflight:y});g.push(w)}return{txIds:g,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var l;let u=e||{},{computeBudgetConfig:t}=u,n=Oe(u,["computeBudgetConfig"]),r=t?gr(t):{instructions:[],instructionTypes:[]},i=this.signers.reduce((m,d)=>E(R({},m),{[d.publicKey.toBase58()]:d}),{}),s=[],a=[],c=[];if(this.allInstructions.forEach(m=>{let d=[...c,m],p=t?[...r.instructions,...d]:d,f=[...new Set(d.map(b=>b.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(b=>new po(b));if(c.length<12&&so({instructions:p,payer:this.feePayer,signers:f})||so({instructions:d,payer:this.feePayer,signers:f}))c.push(m);else{if(c.length===0)throw Error("item ins too big");so({instructions:t?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:f})?s.push(new fo().add(...r.instructions,...c)):s.push(new fo().add(...c)),a.push(Array.from(new Set(c.map(b=>b.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat())).map(b=>i[b]).filter(b=>b!==void 0)),c=[m]}}),c.length>0){let d=[...new Set(c.map(p=>p.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(p=>i[p]).filter(p=>p!==void 0);so({instructions:t?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:d.map(p=>p.publicKey)})?s.push(new fo().add(...r.instructions,...c)):s.push(new fo().add(...c)),a.push(d)}return s.forEach(m=>m.feePayer=this.feePayer),(l=this.owner)!=null&&l.signer&&a.forEach(m=>{m.some(d=>d.publicKey.equals(this.owner.publicKey))||m.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async m=>{var g;let{sequentially:d,onTxUpdate:p,recentBlockHash:y,skipPreflight:f=!0}=m||{},b=y!=null?y:await Fn(this.connection,this.blockhashCommitment);if(s.forEach(async(A,w)=>{A.recentBlockhash=b,a[w].length&&A.sign(...a[w])}),gn(s),(g=this.owner)!=null&&g.isKeyPair){if(d){let A=[];for(let w of s){let k=await Vi(this.connection,w,this.signers.find(I=>I.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f});A.push(k)}return{txIds:A,signedTxs:s}}return{txIds:await Promise.all(s.map(async A=>await this.connection.sendRawTransaction(A.serialize(),{skipPreflight:f}))),signedTxs:s}}if(this.signAllTransactions){let A=await this.signAllTransactions(s);if(d){let w=0,k=[],I=async()=>{if(!A[w])return;let T=await this.connection.sendRawTransaction(A[w].serialize(),{skipPreflight:f});k.push({txId:T,status:"sent",signedTx:A[w]}),p==null||p([...k]),w++,this.connection.onSignature(T,S=>{let B=k.findIndex(C=>C.txId===T);B>-1&&(k[B].status=S.err?"error":"success"),p==null||p([...k]),S.err||I()},"processed"),this.connection.getSignatureStatus(T)};return await I(),{txIds:k.map(T=>T.txId),signedTxs:A}}else{let w=[];for(let k=0;k<A.length;k+=1){let I=await this.connection.sendRawTransaction(A[k].serialize(),{skipPreflight:f});w.push(I)}return{txIds:w,signedTxs:A}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuildV0(e){var g;let b=e||{},{computeBudgetConfig:t,lookupTableCache:n={},lookupTableAddress:r=[]}=b,i=Oe(b,["computeBudgetConfig","lookupTableCache","lookupTableAddress"]),s=R(R({},this.cluster==="devnet"?{}:kr),n),a=Array.from(new Set([...this.lookupTableAddress,...r])),c=[];for(let A of a)s[A]===void 0&&c.push(new po(A));let u=await vi({connection:this.connection,address:c});for(let[A,w]of Object.entries(u))s[A]=w;let l=t?gr(t):{instructions:[],instructionTypes:[]},m=await Fn(this.connection,this.blockhashCommitment),d=this.signers.reduce((A,w)=>E(R({},A),{[w.publicKey.toBase58()]:w}),{}),p=[],y=[],f=[];if(this.allInstructions.forEach(A=>{let w=[...f,A],k=t?[...l.instructions,...w]:w;if(f.length<12&&ao({instructions:k,payer:this.feePayer,lookupTableAddressAccount:s})||ao({instructions:w,payer:this.feePayer,lookupTableAddressAccount:s}))f.push(A);else{if(f.length===0)throw Error("item ins too big");let I={};for(let T of[...new Set(a)])s[T]!==void 0&&(I[T]=s[T]);if(t&&ao({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let T=new yo({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new bo(T))}else{let T=new yo({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new bo(T))}y.push(Array.from(new Set(f.map(T=>T.keys.filter(S=>S.isSigner).map(S=>S.pubkey.toString())).flat())).map(T=>d[T]).filter(T=>T!==void 0)),f=[A]}}),f.length>0){let w=[...new Set(f.map(k=>k.keys.filter(I=>I.isSigner).map(I=>I.pubkey.toString())).flat()).values()].map(k=>d[k]).filter(k=>k!==void 0);if(t&&ao({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let k=new yo({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new bo(k))}else{let k=new yo({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new bo(k))}y.push(w)}return(g=this.owner)!=null&&g.signer&&y.forEach(A=>{A.some(w=>w.publicKey.equals(this.owner.publicKey))||A.push(this.owner.signer)}),{builder:this,transactions:p,buildProps:e,signers:y,instructionTypes:this.instructionTypes,execute:async A=>{var S;let{sequentially:w,onTxUpdate:k,recentBlockHash:I,skipPreflight:T=!0}=A||{};if(p.map(async(B,C)=>{y[C].length&&B.sign(y[C]),I&&(B.message.recentBlockhash=I)}),gn(p),(S=this.owner)!=null&&S.isKeyPair){if(w){let B=[];for(let C of p){let x=await this.connection.sendTransaction(C,{skipPreflight:T});await Ar(this.connection,x),B.push(x)}return{txIds:B,signedTxs:p}}return{txIds:await Promise.all(p.map(async B=>await this.connection.sendTransaction(B,{skipPreflight:T}))),signedTxs:p}}if(this.signAllTransactions){let B=await this.signAllTransactions(p);if(w){let C=0,x=[],L=async()=>{if(!B[C])return;let W=await this.connection.sendTransaction(B[C],{skipPreflight:T});x.push({txId:W,status:"sent",signedTx:B[C]}),k==null||k([...x]),C++,this.connection.onSignature(W,v=>{let $=x.findIndex(X=>X.txId===W);$>-1&&(x[$].status=v.err?"error":"success"),k==null||k([...x]),v.err||L()},"processed"),this.connection.getSignatureStatus(W)};return L(),{txIds:[],signedTxs:B}}else{let C=[];for(let x=0;x<B.length;x+=1){let L=await this.connection.sendTransaction(B[x],{skipPreflight:T});C.push(L)}return{txIds:C,signedTxs:B}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}};var Ga=(t=>(t.ALL="all",t.Strict="strict",t))(Ga||{}),Xa=(s=>(s.All="all",s.Standard="standard",s.Concentrated="concentrated",s.AllFarm="allFarm",s.StandardFarm="standardFarm",s.ConcentratedFarm="concentratedFarm",s))(Xa||{});var _e={BASE_HOST:"https://api-v3.raydium.io",OWNER_BASE_HOST:"https://owner-v1.raydium.io",SERVICE_BASE_HOST:"https://service.raydium.io",MONITOR_BASE_HOST:"https://monitor.raydium.io",SERVICE_1_BASE_HOST:"https://service-v1.raydium.io",SEND_TRANSACTION:"/send-transaction",FARM_ARP:"/main/farm/info",FARM_ARP_LINE:"/main/farm-apr-tv",CLMM_CONFIG:"/main/clmm-config",CPMM_CONFIG:"/main/cpmm-config",VERSION:"/main/version",CHECK_AVAILABILITY:"/v3/main/AvailabilityCheckAPI",RPCS:"/main/rpcs",INFO:"/main/info",STAKE_POOLS:"/main/stake-pools",CHAIN_TIME:"/main/chain-time",TOKEN_LIST:"/mint/list",MINT_INFO_ID:"/mint/ids",JUP_TOKEN_LIST:"https://tokens.jup.ag/tokens?tags=lst,community",POOL_LIST:"/pools/info/list",POOL_SEARCH_BY_ID:"/pools/info/ids",POOL_SEARCH_MINT:"/pools/info/mint",POOL_SEARCH_LP:"/pools/info/lps",POOL_KEY_BY_ID:"/pools/key/ids",POOL_LIQUIDITY_LINE:"/pools/line/liquidity",POOL_POSITION_LINE:"/pools/line/position",FARM_INFO:"/farms/info/ids",FARM_LP_INFO:"/farms/info/lp",FARM_KEYS:"/farms/key/ids",OWNER_CREATED_FARM:"/create-pool/{owner}",OWNER_IDO:"/main/ido/{owner}",OWNER_STAKE_FARMS:"/position/stake/{owner}",OWNER_LOCK_POSITION:"/position/clmm-lock/{owner}",IDO_KEYS:"/ido/key/ids",SWAP_HOST:"https://transaction-v1.raydium.io",SWAP_COMPUTE:"/compute/",SWAP_TX:"/transaction/",MINT_PRICE:"/mint/price",MIGRATE_CONFIG:"/main/migrate-lp",PRIORITY_FEE:"/main/auto-fee",JITO:"https://mainnet.block-engine.jito.wtf",JITO_TRANSACTION:"/api/v1/transactions",JITO_BUNDLE:"/api/v1/bundles"},rA=R({},_e);var za="ray_tab_hash",Fi="ray_req_hash",Lm=()=>{if(typeof window===void 0)return"";let o=sessionStorage.getItem(za);return o||(o=`ray-${Date.now()}`,sessionStorage.setItem(za,o)),o},Ir=async n=>{var r=n,{logCount:o=1e3,removeLastLog:e}=r,t=Oe(r,["logCount","removeLastLog"]);if(typeof window===void 0)return new Promise(s=>s());let i=JSON.parse(localStorage.getItem(Fi)||"[]").slice(0,o-1);e&&i.pop(),new Blob([JSON.stringify(t.data)]).size>1024&&(t.data=JSON.stringify(t.data).substring(0,200)+"..."),i.unshift(E(R({},t),{time:Date.now(),session:Lm()}));try{localStorage.setItem(Fi,JSON.stringify(i))}catch{if(e){let s=!1,a=JSON.stringify(t.data).substring(0,100);for(i[0].data=a+(a.length>100?"...":"");!s;){i.pop();let c=JSON.stringify(t.data).substring(0,100);i[0].data=c+(c.length>100?"...":"");try{localStorage.setItem(Fi,JSON.stringify(i)),s=!0}catch{s=!1}}return new Promise(c=>c())}return Ir(E(R({},t),{logCount:o,removeLastLog:!0}))}};var Dn=ce("Raydium_Api"),Ei=new Map;async function BA(o,e,t=1e3){let n;for(;n==null;)try{Dn.debug(`Request ${o} through endlessRetry`),n=await e()}catch(r){Dn.error(`Request ${o} failed, retry after ${t} ms`,r),await xa(t)}return n}var Br=class{constructor({cluster:e,timeout:t,logRequests:n,logCount:r,urlConfigs:i}){this.cluster=e,this.urlConfigs=i||{},this.logCount=r||1e3,this.api=Qa.create({baseURL:this.urlConfigs.BASE_HOST||_e.BASE_HOST,timeout:t}),this.api.interceptors.request.use(s=>{let{method:a,baseURL:c,url:u}=s;return Dn.debug(`${a==null?void 0:a.toUpperCase()} ${c}${u}`),s},s=>(Dn.error("Request failed"),Promise.reject(s))),this.api.interceptors.response.use(s=>{let{config:a,data:c,status:u}=s,{method:l,baseURL:m,url:d}=a;return n&&Ir({status:u,url:`${m}${d}`,params:a.params,data:c,logCount:this.logCount}),Dn.debug(`${l==null?void 0:l.toUpperCase()} ${m}${d}  ${u}`),c},s=>{let{config:a,response:c={}}=s,{status:u}=c,{method:l,baseURL:m,url:d}=a;return n&&Ir({status:u,url:`${m}${d}`,params:a.params,data:s.message,logCount:this.logCount}),Dn.error(`${l.toUpperCase()} ${m}${d} ${u||s.message}`),Promise.reject(s)})}async getClmmConfigs(){return(await this.api.get(this.urlConfigs.CLMM_CONFIG||_e.CLMM_CONFIG)).data}async getCpmmConfigs(){return(await this.api.get(this.urlConfigs.CPMM_CONFIG||_e.CPMM_CONFIG)).data}async getClmmPoolLines(e){return(await this.api.get(`${this.urlConfigs.POOL_LIQUIDITY_LINE||_e.POOL_LIQUIDITY_LINE}?pool_id=${e}`)).data}async getBlockSlotCountForSecond(e){if(!e)return 2;let n=(await Qa.post(e,{id:"getRecentPerformanceSamples",jsonrpc:"2.0",method:"getRecentPerformanceSamples",params:[4]})).result.map(r=>r.numSlots);return n.reduce((r,i)=>r+i,0)/n.length/60}async getChainTimeOffset(){return(await this.api.get(this.urlConfigs.CHAIN_TIME||_e.CHAIN_TIME)).data}async getRpcs(){return this.api.get(this.urlConfigs.RPCS||_e.RPCS)}async getTokenList(){return(await this.api.get(this.urlConfigs.TOKEN_LIST||_e.TOKEN_LIST)).data}async getJupTokenList(){return this.api.get("",{baseURL:this.urlConfigs.JUP_TOKEN_LIST||_e.JUP_TOKEN_LIST})}async getTokenInfo(e){return(await this.api.get((this.urlConfigs.MINT_INFO_ID||_e.MINT_INFO_ID)+`?mints=${e.map(n=>n.toString()).join(",")}`)).data}async getPoolList(e={}){let{type:t="all",sort:n="liquidity",order:r="desc",page:i=0,pageSize:s=100}=e;return(await this.api.get((this.urlConfigs.POOL_LIST||_e.POOL_LIST)+`?poolType=${t}&poolSortField=${n}&sortType=${r}&page=${i}&pageSize=${s}`)).data}async fetchPoolById(e){let{ids:t}=e;return(await this.api.get((this.urlConfigs.POOL_SEARCH_BY_ID||_e.POOL_SEARCH_BY_ID)+`?ids=${t}`)).data}async fetchPoolKeysById(e){let{idList:t}=e,n=[],r=t.filter(s=>Ei.has(s)?(n.push(Ei.get(s)),!1):!0),i=[];return r.length&&(i=(await this.api.get((this.urlConfigs.POOL_KEY_BY_ID||_e.POOL_KEY_BY_ID)+`?ids=${r.join(",")}`)).data.filter(Boolean),i.forEach(a=>{Ei.set(a.id,a)})),n.concat(i)}async fetchPoolByMints(e){let{mint1:t,mint2:n,type:r="all",sort:i="default",order:s="desc",page:a=1}=e,[c,u]=[t&&ft(t).toBase58(),n&&n!=="undefined"?ft(n).toBase58():""],[l,m]=u&&c>u?[u,c]:[c,u];return(await this.api.get((this.urlConfigs.POOL_SEARCH_MINT||_e.POOL_SEARCH_MINT)+`?mint1=${l}&mint2=${m}&poolType=${r}&poolSortField=${i}&sortType=${s}&pageSize=100&page=${a}`)).data}async fetchFarmInfoById(e){let{ids:t}=e;return(await this.api.get((this.urlConfigs.FARM_INFO||_e.FARM_INFO)+`?ids=${t}`)).data}async fetchFarmKeysById(e){let{ids:t}=e;return(await this.api.get((this.urlConfigs.FARM_KEYS||_e.FARM_KEYS)+`?ids=${t}`)).data}async fetchAvailabilityStatus(){return(await this.api.get(this.urlConfigs.CHECK_AVAILABILITY||_e.CHECK_AVAILABILITY)).data}async sendTxToJito(e,t){let n=t?this.urlConfigs.JITO_BUNDLE||_e.JITO_BUNDLE:this.urlConfigs.JITO_TRANSACTION||_e.JITO_TRANSACTION;return(await this.api.post(n,{jsonrpc:"2.0",id:1,method:t?"sendBundle":"sendTransaction",params:e},{baseURL:this.urlConfigs.JITO||_e.JITO})).data}};import{merge as Of}from"lodash";var xr="please provide owner in load() initialization or you can set by calling raydium.setOwner(owner)",Ya="please provide connection in load() initialization or set it by raydium.setConnection(connection)";import{PublicKey as Or,SystemProgram as Wd}from"@solana/web3.js";import{AccountLayout as Un,createAssociatedTokenAccountInstruction as Ji,TOKEN_PROGRAM_ID as un,TOKEN_2022_PROGRAM_ID as qd}from"@solana/spl-token";var Di=(...o)=>o.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Se=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=ce(t)}createTxBuilder(e){return this.scope.checkOwner(),new Tr({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Di(e))}logInfo(...e){this.logger.info(Di(e))}logAndCreateError(...e){let t=Di(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as _d,SystemProgram as vd}from"@solana/web3.js";import Vd from"bn.js";import{createCloseAccountInstruction as Fd,createInitializeAccountInstruction as Ed,createTransferInstruction as Dd,TOKEN_PROGRAM_ID as qn}from"@solana/spl-token";import{Keypair as Ld,PublicKey as lu}from"@solana/web3.js";import Od from"bn.js";import{TOKEN_PROGRAM_ID as Nd}from"@solana/spl-token";function Om(o){return o instanceof Uint8Array||o!=null&&typeof o=="object"&&o.constructor.name==="Uint8Array"}function Wi(o,...e){if(!Om(o))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(o.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${o.length}`)}function qi(o,e=!0){if(o.destroyed)throw new Error("Hash instance has been destroyed");if(e&&o.finished)throw new Error("Hash#digest() has already been called")}function ja(o,e){Wi(o);let t=e.outputLen;if(o.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var Kr=o=>new DataView(o.buffer,o.byteOffset,o.byteLength),Rt=(o,e)=>o<<32-e|o>>>e;var EA=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Nm(o){if(typeof o!="string")throw new Error(`utf8ToBytes expected string, got ${typeof o}`);return new Uint8Array(new TextEncoder().encode(o))}function Ui(o){return typeof o=="string"&&(o=Nm(o)),Wi(o),o}var Sr=class{clone(){return this._cloneInto()}},DA={}.toString;function Ha(o){let e=n=>o().update(Ui(n)).digest(),t=o();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>o(),e}function Mm(o,e,t,n){if(typeof o.setBigUint64=="function")return o.setBigUint64(e,t,n);let r=BigInt(32),i=BigInt(4294967295),s=Number(t>>r&i),a=Number(t&i),c=n?4:0,u=n?0:4;o.setUint32(e+c,s,n),o.setUint32(e+u,a,n)}var Za=(o,e,t)=>o&e^~o&t,$a=(o,e,t)=>o&e^o&t^e&t,Cr=class extends Sr{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Kr(this.buffer)}update(e){qi(this);let{view:t,buffer:n,blockLen:r}=this;e=Ui(e);let i=e.length;for(let s=0;s<i;){let a=Math.min(r-this.pos,i-s);if(a===r){let c=Kr(e);for(;r<=i-s;s+=r)this.process(c,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){qi(this),ja(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:i}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let m=s;m<r;m++)t[m]=0;Mm(n,r-8,BigInt(this.length*8),i),this.process(n,0);let a=Kr(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let m=0;m<u;m++)a.setUint32(4*m,l[m],i)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:i,destroyed:s,pos:a}=this;return e.length=r,e.pos=a,e.finished=i,e.destroyed=s,r%t&&e.buffer.set(n),e}};var _m=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),rn=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),sn=new Uint32Array(64),Gi=class extends Cr{constructor(){super(64,32,8,!1),this.A=rn[0]|0,this.B=rn[1]|0,this.C=rn[2]|0,this.D=rn[3]|0,this.E=rn[4]|0,this.F=rn[5]|0,this.G=rn[6]|0,this.H=rn[7]|0}get(){let{A:e,B:t,C:n,D:r,E:i,F:s,G:a,H:c}=this;return[e,t,n,r,i,s,a,c]}set(e,t,n,r,i,s,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=i|0,this.F=s|0,this.G=a|0,this.H=c|0}process(e,t){for(let m=0;m<16;m++,t+=4)sn[m]=e.getUint32(t,!1);for(let m=16;m<64;m++){let d=sn[m-15],p=sn[m-2],y=Rt(d,7)^Rt(d,18)^d>>>3,f=Rt(p,17)^Rt(p,19)^p>>>10;sn[m]=f+sn[m-7]+y+sn[m-16]|0}let{A:n,B:r,C:i,D:s,E:a,F:c,G:u,H:l}=this;for(let m=0;m<64;m++){let d=Rt(a,6)^Rt(a,11)^Rt(a,25),p=l+d+Za(a,c,u)+_m[m]+sn[m]|0,f=(Rt(n,2)^Rt(n,13)^Rt(n,22))+$a(n,r,i)|0;l=u,u=c,c=a,a=s+p|0,s=i,i=r,r=n,n=p+f|0}n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,s=s+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,r,i,s,a,c,u,l)}roundClean(){sn.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Ja=Ha(()=>new Gi);import{PublicKey as Sd}from"@solana/web3.js";import su,{isBN as au}from"bn.js";import{bits as vm,BitStructure as Vm,blob as Fm,Blob as Em,cstr as Dm,f32 as Wm,f32be as qm,f64 as Um,f64be as Gm,greedy as Xm,Layout as zm,ns64 as Qm,ns64be as Ym,nu64 as jm,nu64be as Hm,offset as Zm,s16 as $m,s16be as Jm,s24 as ed,s24be as td,s32 as nd,s32be as od,s40 as rd,s40be as id,s48 as sd,s48be as ad,s8 as ud,seq as cd,struct as jA,Structure as ld,u16 as md,u16be as dd,u24 as pd,u24be as fd,u32 as yd,u32be as bd,u40 as gd,u40be as Ad,u48 as wd,u48be as Pd,u8 as hd,UInt as kd,union as Td,Union as Id,unionLayoutDiscriminator as Bd,utf8 as xd}from"@solana/buffer-layout";var go=zm,eu=ld,tu=Id,HA=Vm,Xi=kd,nu=Em,ZA=Xm,Rr=hd,Dt=md,$A=pd,Ao=yd,JA=gd,ew=wd,ou=jm,tw=dd,nw=fd,ow=bd,rw=Ad,iw=Pd,sw=Hm,aw=ud,uw=$m,cw=ed,je=nd,lw=rd,mw=sd,dw=Qm,pw=Jm,fw=td,yw=od,bw=id,gw=ad,Aw=Ym,ww=Wm,Pw=qm,hw=Um,kw=Gm;var ru=cd,iu=Td,Tw=Bd,Ae=Fm,Iw=Dm,Bw=xd,zi=vm,Qi=Zm;var An=class extends go{constructor(t,n,r){super(t,r);this.blob=Ae(t),this.signed=n}decode(t,n=0){let r=new su(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new su(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}},Lr=class extends go{constructor(t){super(8,t);this._lower=zi(Ao(),!1),this._upper=zi(Ao(),!1)}addBoolean(t){this._lower.fields.length<32?this._lower.addBoolean(t):this._upper.addBoolean(t)}decode(t,n=0){let r=this._lower.decode(t,n),i=this._upper.decode(t,n+this._lower.span);return R(R({},r),i)}encode(t,n,r=0){return this._lower.encode(t,n,r)+this._upper.encode(t,n,r+this._lower.span)}};function D(o){return new Xi(1,o)}function He(o){return new Xi(4,o)}function P(o){return new An(8,!1,o)}function J(o){return new An(16,!1,o)}function uu(o){return new An(1,!0,o)}function Wn(o){return new An(8,!0,o)}function cu(o){return new An(16,!0,o)}var Wt=class extends go{constructor(t,n,r,i){super(t.span,i);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function K(o){return new Wt(Ae(32),e=>new Sd(e),e=>e.toBuffer(),o)}var Yi=class extends go{constructor(t,n){super(-1,n);this.layout=t,this.discriminator=Rr()}encode(t,n,r=0){return t==null?this.discriminator.encode(0,n,r):(this.discriminator.encode(1,n,r),this.layout.encode(t,n,r+1)+1)}decode(t,n=0){let r=this.discriminator.decode(t,n);if(r===0)return null;if(r===1)return this.layout.decode(t,n+1);throw new Error("Invalid option "+this.property)}getSpan(t,n=0){let r=this.discriminator.decode(t,n);if(r===0)return 1;if(r===1)return this.layout.getSpan(t,n+1)+1;throw new Error("Invalid option "+this.property)}};function Rw(o,e){return new Yi(o,e)}function Ze(o){return new Wt(Rr(),Kd,Cd,o)}function Kd(o){if(o===0)return!1;if(o===1)return!0;throw new Error("Invalid bool: "+o)}function Cd(o){return o?1:0}function Lw(o,e){let t=Ao("length"),n=_([t,G(o,Qi(t,-t.span),"values")]);return new Wt(n,({values:r})=>r,r=>({values:r}),e)}function Ow(o,e,t){let n=_([P("tag"),e.replicate("data")]);function r({tag:i,data:s}){if(!i.eq(o))throw new Error("Invalid tag, expected: "+o.toString("hex")+", got: "+i.toString("hex"));return s}return new Wt(n,r,i=>({tag:o,data:i}),t)}function Rd(o){let e=Ao("length"),t=_([e,Ae(Qi(e,-e.span),"data")]);return new Wt(t,({data:n})=>n,n=>({data:n}),o)}function Nw(o){return new Wt(Rd(),e=>e.toString("utf-8"),e=>Buffer.from(e,"utf-8"),o)}function Mw(o,e){let t=iu(Rr(),e);return o.forEach((n,r)=>t.addVariant(r,n,n.property)),t}function _w(o,e,t){let n=_([G(o,e,"values")]);return new Wt(n,({values:r})=>r,r=>({values:r}),t)}var ji=class extends eu{decode(e,t){return super.decode(e,t)}};function _(o,e,t){return new ji(o,e,t)}var Hi=class extends tu{encodeInstruction(e){let t=Math.max(...Object.values(this.registry).map(r=>r.span)),n=Buffer.alloc(t);return n.slice(0,this.encode(e,n))}decodeInstruction(e){return this.decode(e)}};function vw(o,e,t){return new Hi(o,e,t)}var Zi=class extends nu{decode(e,t){let n=super.decode(e,t);if(!n.every(r=>r===0))throw new Error("nonzero padding bytes");return n}};function Vw(o){return new Zi(o)}function G(o,e,t){let n,r=typeof e=="number"?e:au(e)?e.toNumber():new Proxy(e,{get(i,s){if(!n){let a=Reflect.get(i,"count");n=au(a)?a.toNumber():a,Reflect.set(i,"count",n)}return Reflect.get(i,s)},set(i,s,a){return s==="count"&&(n=a),Reflect.set(i,s,a)}});return ru(o,r,t)}var an=_([K("mint"),K("owner"),P("amount"),He("delegateOption"),K("delegate"),D("state"),He("isNativeOption"),P("isNative"),P("delegatedAmount"),He("closeAuthorityOption"),K("closeAuthority")]);var Zw=ce("Raydium_Util");function mu({owner:o,solAccountResp:e,tokenAccountResp:t}){let n=[],r=[];for(let{pubkey:i,account:s}of t.value){let a=an.decode(s.data),{mint:c,amount:u}=a;n.push({publicKey:i,mint:c,amount:u,isAssociated:ge(o,c,s.owner).publicKey.equals(i),isNative:!1,programId:s.owner}),r.push({pubkey:i,accountInfo:a,programId:s.owner})}return e&&n.push({mint:lu.default,amount:new Od(e.lamports),isNative:!0,programId:e.owner}),{tokenAccounts:n,tokenAccountRawInfos:r}}function ct({fromPublicKey:o,programId:e=Nd}){let t=Ld.generate().publicKey.toBase58().slice(0,32);return{publicKey:Md(o,t,e),seed:t}}function Md(o,e,t){let n=Buffer.concat([o.toBuffer(),Buffer.from(e),t.toBuffer()]),r=Ja(n);return new lu(r)}function $i(o){let{mint:e,tokenAccount:t,owner:n,programId:r=qn}=o;return Ed(t,e,n,r)}function qt(o){let{tokenAccount:e,payer:t,multiSigners:n=[],owner:r,programId:i=qn}=o;return Fd(e,t,r,n,i)}async function Ut(o){let{connection:e,amount:t,commitment:n,payer:r,owner:i,skipCloseAccount:s}=o,a=await e.getMinimumBalanceForRentExemption(an.span,n),c=z(t).add(new Vd(a)),u=ct({fromPublicKey:r,programId:qn});return{addresses:{newAccount:u.publicKey},signers:[],instructions:[vd.createAccountWithSeed({fromPubkey:r,basePubkey:r,seed:u.seed,newAccountPubkey:u.publicKey,lamports:c.toNumber(),space:an.span,programId:qn}),$i({mint:new _d(De.address),tokenAccount:u.publicKey,owner:i,programId:qn})],instructionTypes:[F.CreateAccount,F.InitAccount],endInstructionTypes:s?[]:[F.CloseAccount],endInstructions:s?[]:[qt({tokenAccount:u.publicKey,payer:r,owner:i})]}}function du({source:o,destination:e,owner:t,amount:n,multiSigners:r=[],tokenProgram:i=qn}){return Dd(o,e,t,BigInt(String(n)),r,i)}var wo=class extends Se{constructor(t){super(t);this._tokenAccounts=[];this._tokenAccountRawInfos=[];this._accountListener=[];this._clientOwnedToken=!1;this._accountFetchTime=0;let{tokenAccounts:n,tokenAccountRawInfos:r}=t;this._tokenAccounts=n||[],this._tokenAccountRawInfos=r||[],this._clientOwnedToken=!!(n||r)}get tokenAccounts(){return this._tokenAccounts}get tokenAccountRawInfos(){return this._tokenAccountRawInfos}updateTokenAccount({tokenAccounts:t,tokenAccountRawInfos:n}){return t&&(this._tokenAccounts=t),n&&(this._tokenAccountRawInfos=n),this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=void 0,this._clientOwnedToken=!0,this}addAccountChangeListener(t){return this._accountListener.push(t),this}removeAccountChangeListener(t){return this._accountListener=this._accountListener.filter(n=>n!==t),this}getAssociatedTokenAccount(t,n){return ge(this.scope.ownerPubKey,t,n).publicKey}resetTokenAccounts(){this._clientOwnedToken||(this._tokenAccounts=[],this._tokenAccountRawInfos=[])}async fetchWalletTokenAccounts(t){if(this._clientOwnedToken||!(t!=null&&t.forceUpdate)&&this._tokenAccounts.length&&Date.now()-this._accountFetchTime<1e3*60*3)return{tokenAccounts:this._tokenAccounts,tokenAccountRawInfos:this._tokenAccountRawInfos};this.scope.checkOwner();let r=R(R({},{}),t),[i,s,a]=await Promise.all([this.scope.connection.getAccountInfo(this.scope.ownerPubKey,r.commitment),this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:un},r.commitment),this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:qd},r.commitment)]),{tokenAccounts:c,tokenAccountRawInfos:u}=mu({owner:this.scope.ownerPubKey,solAccountResp:i,tokenAccountResp:{context:s.context,value:[...s.value,...a.value]}});return this._tokenAccounts=c,this._tokenAccountRawInfos=u,this._accountFetchTime=Date.now(),this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=this.scope.connection.onAccountChange(this.scope.ownerPubKey,()=>this.fetchWalletTokenAccounts({forceUpdate:!0}),t==null?void 0:t.commitment),{tokenAccounts:c,tokenAccountRawInfos:u}}async getCreatedTokenAccount({mint:t,programId:n=un,associatedOnly:r=!0}){await this.fetchWalletTokenAccounts();let i=this._tokenAccounts.filter(({mint:a})=>a==null?void 0:a.equals(t)).sort((a,c)=>a.amount.lt(c.amount)?1:-1),s=this.getAssociatedTokenAccount(t,n);for(let a of i){let{publicKey:c}=a;if(c&&(!r||r&&s.equals(c)))return c}}async getOrCreateTokenAccount(t){var y,f,b,g;await this.fetchWalletTokenAccounts();let{mint:n,createInfo:r,associatedOnly:i,owner:s,notUseTokenAccount:a=!1,skipCloseAccount:c=!1,checkCreateATAOwner:u=!1}=t,l=new Or(t.tokenProgram||un),m=this.getAssociatedTokenAccount(n,new Or(l)),d=(a?[]:this.tokenAccountRawInfos).filter(A=>A.accountInfo.mint.equals(n)&&(!i||A.pubkey.equals(m))).sort((A,w)=>A.accountInfo.amount.lt(w.accountInfo.amount)?1:-1);if(r===void 0||d.length>0)return d.length>0?{account:d[0].pubkey}:{};let p={instructions:[],endInstructions:[],signers:[],instructionTypes:[],endInstructionTypes:[]};if(i){let A=Ji(s,m,s,n,l);if(u){let w=await this.scope.connection.getAccountInfo(m);if(w===null)(y=p.instructions)==null||y.push(A),p.instructionTypes.push(F.CreateATA);else if(!(w.owner.equals(l)&&Un.decode(w.data).mint.equals(n)&&Un.decode(w.data).owner.equals(s)))throw Error(`create ata check error -> mint: ${n.toString()}, ata: ${m.toString()}`)}else p.instructions.push(A),p.instructionTypes.push(F.CreateATA);if(n.equals(Q)&&r.amount){let w=await Ut({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:r.payer||this.scope.ownerPubKey,amount:(f=r.amount)!=null?f:0,skipCloseAccount:c});p.instructions.push(...w.instructions||[]),p.endInstructions.push(...w.endInstructions||[]),p.instructionTypes.push(...w.instructionTypes||[]),p.endInstructionTypes.push(...w.endInstructionTypes||[]),r.amount&&(p.instructions.push(du({source:w.addresses.newAccount,destination:m,owner:this.scope.ownerPubKey,amount:r.amount,tokenProgram:un})),p.instructionTypes.push(F.TransferAmount))}return c||(p.endInstructions.push(qt({owner:s,payer:r.payer||s,tokenAccount:m,programId:l})),p.endInstructionTypes.push(F.CloseAccount)),{account:m,instructionParams:p}}else{let A=ct({fromPublicKey:s,programId:l}),w=await this.scope.connection.getMinimumBalanceForRentExemption(Un.span),k=Wd.createAccountWithSeed({fromPubkey:s,basePubkey:s,seed:A.seed,newAccountPubkey:A.publicKey,lamports:w+Number((g=(b=r.amount)==null?void 0:b.toString())!=null?g:0),space:Un.span,programId:l});return p.instructions.push(k,$i({mint:n,tokenAccount:A.publicKey,owner:this.scope.ownerPubKey,programId:l})),p.instructionTypes.push(F.CreateAccount),p.instructionTypes.push(F.InitAccount),c||(p.endInstructions.push(qt({owner:s,payer:r.payer||s,tokenAccount:A.publicKey,programId:l})),p.endInstructionTypes.push(F.CloseAccount)),{account:A.publicKey,instructionParams:p}}}async checkOrCreateAta({mint:t,programId:n=un,autoUnwrapWSOLToSOL:r}){var c;await this.fetchWalletTokenAccounts();let i=(c=this.scope.account.tokenAccounts.find(({mint:u})=>(u==null?void 0:u.toBase58())===t.toBase58()))==null?void 0:c.publicKey,s=this.scope.ownerPubKey,a={};if(!i){let u=this.getAssociatedTokenAccount(t,n),l=await Ji(s,u,s,t,n);a.instructions=[l],a.instructionTypes=[F.CreateATA],i=u}return r&&Q.toBase58()===t.toBase58()&&(a.endInstructions=[qt({owner:s,payer:s,tokenAccount:i,programId:n})],a.endInstructionTypes=[F.CloseAccount]),{pubKey:i,newInstructions:a}}async handleTokenAccount(t){let{side:n,amount:r,mint:i,programId:s=un,tokenAccount:a,payer:c=this.scope.ownerPubKey,bypassAssociatedCheck:u,skipCloseAccount:l,checkCreateATAOwner:m}=t,d=this.getAssociatedTokenAccount(i,s);if(new Or(Q).equals(i)){let p=await Ut({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:c,amount:r,skipCloseAccount:l});return R({tokenAccount:p.addresses.newAccount},p)}else if(!a||n==="out"&&!d.equals(a)&&!u){let p=[],y=Ji(this.scope.ownerPubKey,d,this.scope.ownerPubKey,i,s);if(m){let f=await this.scope.connection.getAccountInfo(d);if(f===null)p.push(y);else if(!(f.owner.equals(un)&&Un.decode(f.data).mint.equals(i)&&Un.decode(f.data).owner.equals(this.scope.ownerPubKey)))throw Error(`create ata check error -> mint: ${i.toString()}, ata: ${d.toString()}`)}else p.push(y);return{tokenAccount:d,instructions:p,instructionTypes:[F.CreateATA]}}return{tokenAccount:a}}async processTokenAccount(t){let{mint:n,programId:r=un,amount:i,useSOLBalance:s,handleTokenAccount:a}=t,c,u=this.createTxBuilder();if(n.equals(new Or(Q))&&s){let l=await this.handleTokenAccount({side:"in",amount:i||0,mint:n,bypassAssociatedCheck:!0,programId:r}),{tokenAccount:d}=l,p=Oe(l,["tokenAccount"]);c=d,u.addInstruction(p)}else if(c=await this.getCreatedTokenAccount({mint:n,associatedOnly:!1,programId:r}),!c&&a){let m=await this.scope.account.handleTokenAccount({side:"in",amount:0,mint:n,bypassAssociatedCheck:!0,programId:r}),{tokenAccount:d}=m,p=Oe(m,["tokenAccount"]);c=d,u.addInstruction(p)}return R({tokenAccount:c},u.AllTxData)}};import{PublicKey as Pe,SystemProgram as cp}from"@solana/web3.js";import{createAssociatedTokenAccountInstruction as lp}from"@solana/spl-token";import{PublicKey as wu}from"@solana/web3.js";var es=_([D("instruction")]),ts=_([D("instruction")]),Ud=_([P("rewardState"),P("rewardOpenTime"),P("rewardEndTime"),P("rewardLastUpdateTime"),P("totalReward"),P("totalRewardEmissioned"),P("rewardClaimed"),P("rewardPerSecond"),J("accRewardPerShare"),K("rewardVault"),K("rewardMint"),K("rewardSender"),P("rewardType"),G(P(),15,"padding")]),Gd=_([P("state"),P("nonce"),K("lpVault"),K("rewardVault"),K(),K(),P(),P(),P("totalReward"),J("perShareReward"),P("lastSlot"),P("perSlotReward")]),Xd=_([P("state"),P("nonce"),K("lpVault"),K("rewardVaultA"),P("totalRewardA"),J("perShareRewardA"),P("perSlotRewardA"),D("option"),K("rewardVaultB"),Ae(7),P("totalRewardB"),J("perShareRewardB"),P("perSlotRewardB"),P("lastSlot"),K()]),zd=_([P(),P("state"),P("nonce"),P("validRewardTokenNum"),J("rewardMultiplier"),P("rewardPeriodMax"),P("rewardPeriodMin"),P("rewardPeriodExtend"),K("lpMint"),K("lpVault"),G(Ud,5,"rewardInfos"),K("creator"),K(),G(P(),32,"padding")]),pu=new Proxy(Gd,{get(o,e,t){return e==="decode"?(...n)=>{let r=o.decode(...n);return E(R({},r),{version:3,rewardInfos:[{rewardVault:r.rewardVault,totalReward:r.totalReward,perSlotReward:r.perSlotReward,perShareReward:r.perShareReward}]})}:Reflect.get(o,e,t)}}),fu=new Proxy(Xd,{get(o,e,t){return e==="decode"?(...n)=>{let r=o.decode(...n);return E(R({},r),{version:5,rewardInfos:[{rewardVault:r.rewardVaultA,totalReward:r.totalRewardA,perSlotReward:r.perSlotRewardA,perShareReward:r.perShareRewardA},{rewardVault:r.rewardVaultB,totalReward:r.totalRewardB,perSlotReward:r.perSlotRewardB,perShareReward:r.perShareRewardB}]})}:Reflect.get(o,e,t)}}),Po=new Proxy(zd,{get(o,e,t){return e==="decode"?(...n)=>{let r=o.decode(...n);return E(R({},r),{version:6,rewardInfos:r.rewardInfos.map(i=>{var s;return E(R({},i),{rewardType:((s=Object.entries(cn).find(a=>String(a[1])===i.rewardType.toString()))!=null?s:["Standard SPL"])[0]})})})}:Reflect.get(o,e,t)}}),Qd=_([P("isSet"),P("rewardPerSecond"),P("rewardOpenTime"),P("rewardEndTime"),P("rewardType")]),ns=_([D("instruction"),P("nonce"),G(Qd,5,"rewardTimeInfo")]),os=_([D("instruction"),P("rewardReopenTime"),P("rewardEndTime"),P("rewardPerSecond")]),rs=_([D("instruction"),P("isSet"),P("rewardPerSecond"),P("rewardOpenTime"),P("rewardEndTime"),P("rewardType")]),CP=_([P("state"),K("id"),K("owner"),P("deposited"),G(P(),1,"rewardDebts")]),ho=_([P("state"),K("id"),K("owner"),P("deposited"),G(J(),1,"rewardDebts"),P(""),P("voteLockedBalance"),G(P(),15)]),RP=_([P("state"),K("id"),K("owner"),P("deposited"),G(P(),2,"rewardDebts")]),yu=_([P("state"),K("id"),K("owner"),P("deposited"),G(J(),2,"rewardDebts"),G(P(),17)]),bu=_([P(),P("state"),K("id"),K("owner"),P("deposited"),G(J(),5,"rewardDebts"),G(P(),16)]),rt=_([D("instruction"),P("amount")]),Yd=_([K("mint"),K("grantAuthority"),P("baselineVoteWeightScaledFactor"),P("maxExtraLockupVoteWeightScaledFactor"),P("lockupSaturationSecs"),uu("digitShift"),G(D(),7,"reserved1"),G(P(),7,"reserved2")]),gu=_([Ae(8),K("governanceProgramId"),K("realm"),K("realmGoverningTokenMint"),K("realmAuthority"),G(D(),32,"reserved1"),G(Yd,4,"votingMints"),Wn("timeOffset"),D("bump"),G(D(),7,"reserved2"),G(P(),11,"reserved3")]),jd=_([Wn("startTime"),Wn("endTime"),D("kind"),G(D(),15,"reserved")]),Hd=_([G(jd,1,"lockup"),P("amountDeposited_native"),P("amountInitiallyLockedNative"),Ze("isUsed"),Ze("allowClawback"),D("votingMintConfigIdx"),G(D(),29,"reserved")]),Au=_([Ae(8),K("voterAuthority"),K("registrar"),G(Hd,32,"deposits"),D("voterBump"),D("voterWweightRecordBump"),G(D(),94,"reserved")]);var FP=ce("Raydium_farm_config"),Pu=new wu("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),hu=new wu("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1"),ku={3:pu,5:fu,6:Po},Tu={3:ho,5:yu,6:bu},is=o=>[3,5,6].indexOf(o)!==-1,ss=o=>{var s;let{version:e,rewardInfos:t,rewardTokenAccountsPublicKeys:n}=o,r=`rewardInfo:${JSON.stringify(t)}, rewardAccount:${JSON.stringify(n)}`,i={3:()=>{if(t.length!==1||n.length!==1)return`rewardInfos or rewardTokenAccounts lengths not equal 1: ${r}`},5:()=>{if(t.length!==n.length)return`rewardInfos and rewardTokenAccounts lengths not equal: ${r}`},6:()=>{if(!n.length||t.length!==n.length)return`no rewardTokenAccounts or rewardInfos and rewardTokenAccounts lengths not equal: ${r}`}};return(s=i[e])==null?void 0:s.call(i)},cn={"Standard SPL":0,"Option tokens":1},wt={[Oi.toString()]:3,[Ni.toString()]:5,[En.toString()]:6};import{PublicKey as ue,SystemProgram as wn,SYSVAR_CLOCK_PUBKEY as Io,SYSVAR_RENT_PUBKEY as Jd,TransactionInstruction as Xe}from"@solana/web3.js";import Nr from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as ep,createAssociatedTokenAccountInstruction as tp,TOKEN_PROGRAM_ID as yt}from"@solana/spl-token";function as(o,e,t){return ae([e.toBuffer(),Buffer.from("registrar","utf8"),t.toBuffer()],o)}function us(o,e){return ae([e.toBuffer(),Buffer.from("voting_mint_seed","utf8")],o)}function cs(o,e){return ae([e.toBuffer()],o)}function ls(o,e,t){return ae([e.toBuffer(),Buffer.from("voter","utf8"),t.toBuffer()],o)}function ms(o,e,t){return ae([e.toBuffer(),Buffer.from("voter-weight-record","utf8"),t.toBuffer()],o)}function ds(o,e,t,n){return ae([Buffer.from("governance","utf8"),e.toBuffer(),t.toBuffer(),n.toBuffer()],o)}import lt from"bn.js";var ko=ce("Raydium.farm.util");function To({programId:o,poolId:e,mint:t,type:n}){let{publicKey:r}=ae([e.toBuffer(),t.toBuffer(),Buffer.from(n==="lpVault"?"lp_vault_associated_seed":n==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],o);return r}function Je({programId:o,poolId:e,owner:t,version:n}){let{publicKey:r}=ae([e.toBuffer(),t.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],o);return r}var Iu=({programId:o,poolId:e})=>ae([e.toBuffer()],o);function Bu(o){return{isSet:new lt(1),rewardPerSecond:z(o.perSecond),rewardOpenTime:z(o.openTime),rewardEndTime:z(o.endTime),rewardType:z(cn[o.rewardType])}}function ps(o){return z(o.endTime).sub(z(o.openTime)).mul(z(o.perSecond))}function Gn(o){let e=Tu[o];return e||ko.logWithError("invalid version",o),e}function Zd(o){let e=ku[o];return e||ko.logWithError("invalid version",o),e}function $d(o,e,t,n){if(o.version===3||o.version===5){if(o.lastSlot.gte(new lt(t)))return o;let r=new lt(t).sub(o.lastSlot);o.lastSlot=new lt(t);for(let i of o.rewardInfos){if(e.amount.eq(new lt(0)))continue;let s=i.perSlotReward.mul(r);i.perShareReward=i.perShareReward.add(s.mul(new lt(10).pow(new lt(o.version===3?9:15))).div(e.amount)),i.totalReward=i.totalReward.add(s)}}else if(o.version===6)for(let r of o.rewardInfos){if(r.rewardState.eq(new lt(0)))continue;let i=lt.min(new lt(n),r.rewardEndTime);if(r.rewardOpenTime.gte(i))continue;let a=i.sub(r.rewardLastUpdateTime).mul(r.rewardPerSecond),c=r.totalReward.sub(r.totalRewardEmissioned);c.lt(a)?(a=c,r.rewardLastUpdateTime=r.rewardLastUpdateTime.add(c.div(r.rewardPerSecond))):r.rewardLastUpdateTime=i,!e.amount.eq(new lt(0))&&(r.accRewardPerShare=r.accRewardPerShare.add(a.mul(o.rewardMultiplier).div(e.amount)),r.totalRewardEmissioned=r.totalRewardEmissioned.add(a))}return o}async function th({connection:o,farmPools:e,owner:t,config:n,chainTime:r}){let i=!1,s=!1,a=new lt(10),c=[];for(let d of e){let p=Ie(d);p.version===6?s=!0:i=!0,c.push({pubkey:p.id,version:p.version,key:"state",poolId:p.id},{pubkey:p.lpVault,version:p.version,key:"lpVault",poolId:p.id}),t&&c.push({pubkey:Je({programId:p.programId,poolId:p.id,owner:t,version:d.version}),version:p.version,key:"ledger",poolId:p.id})}let u={},l=await Fe(o,c,n);for(let{pubkey:d,version:p,key:y,poolId:f,accountInfo:b}of l){let g=f.toBase58();if(u[g]=R({},u[g]),y==="state"){let A=Zd(p);(!b||!b.data||b.data.length!==A.span)&&ko.logWithError(`invalid farm state account info, pools.id, ${d}`),u[g].state=A.decode(b.data)}else if(y==="lpVault")(!b||!b.data||b.data.length!==an.span)&&ko.logWithError(`invalid farm lp vault account info, pools.lpVault, ${d}`),u[g].lpVault=an.decode(b.data);else if(y==="ledger"){let A=Gn(p);b&&b.data&&(b.data.length!==A.span&&ko.logWithError(`invalid farm ledger account info, ledger, ${d}`),u[g].ledger=A.decode(b.data))}}let m=s||i?await o.getSlot():0;for(let d of Object.keys(u))u[d]!==void 0&&(u[d].state=$d(u[d].state,u[d].lpVault,m,r));for(let[d,{state:p,ledger:y}]of Object.entries(u))if(y){let f=p.version===6?p.rewardMultiplier:p.rewardInfos.length===1?a.pow(new lt(9)):a.pow(new lt(15)),b=p.rewardInfos.map((g,A)=>{let w=y.rewardDebts[A];return y.deposited.mul(p.version===6?g.accRewardPerShare:g.perShareReward).div(f).sub(w)});u[d].wrapped=E(R({},u[d].wrapped),{pendingRewards:b})}return u}function nh(o,e=Date.now()){if(o.version===6){let t=o.state.rewardInfos;if(t.every(({rewardOpenTime:n})=>Na(e,n.toNumber(),{unit:"s"})))return"upcoming pool";if(t.every(({rewardEndTime:n})=>Ma(e,n.toNumber(),{unit:"s"})))return"closed pool"}else{let t=o.state.rewardInfos.map(({perSlotReward:n})=>n);if(t.length===2){if(String(t[0])==="0"&&String(t[1])!=="0")return"normal fusion pool";if(String(t[0])!=="0"&&String(t[1])!=="0")return"dual fusion pool";if(String(t[0])==="0"&&String(t[1])==="0")return"closed pool"}else if(t.length===1&&String(t[0])==="0")return"closed pool"}}async function fs(o,e,t,n){let r=await o.getAccountInfo(e);if(r===null)throw Error("registrar info check error");let s=gu.decode(r.data).votingMints.findIndex(l=>l.mint.equals(n));if(s===-1)throw Error("find voter mint error");let a=await o.getAccountInfo(t);if(a===null)return{index:s,isInit:!1};let u=Au.decode(a.data).deposits.findIndex(l=>l.isUsed&&l.votingMintConfigIdx===s);return u===-1?{index:s,isInit:!1}:{index:u,isInit:!0}}var np=ce("Raydium_farm_instruction"),Bo={voterStakeRegistryCreateVoter:Buffer.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:Buffer.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:Buffer.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:Buffer.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:Buffer.from([45,185,3,36,109,190,115,169])};function xo(o){let{version:e,id:t,ledger:n,programId:r,owner:i}=o,s={3:9,5:10}[e];s||np.logWithError(`invalid farm pool version: ${e}`);let a=Buffer.alloc(es.span);es.encode({instruction:s},a);let c=[h({pubkey:t}),h({pubkey:n}),h({pubkey:i,isWritable:!1}),h({pubkey:wn.programId,isWritable:!1}),h({pubkey:Jd,isWritable:!1})];return{instruction:new Xe({programId:r,keys:c,data:a}),instructionType:F.FarmV3CreateLedger}}function xu(o){var n;let e=Buffer.alloc(ns.span);ns.encode({instruction:0,nonce:new Nr(o.nonce),rewardTimeInfo:o.rewardInfoConfig},e);let t=[...hi,h({pubkey:o.farmId}),h({pubkey:o.farmAuthority,isWritable:!1}),h({pubkey:o.lpVault}),h({pubkey:o.lpMint,isWritable:!1}),h({pubkey:o.lockVault}),h({pubkey:o.lockMint,isWritable:!1}),h({pubkey:(n=o.lockUserAccount)!=null?n:We}),h({pubkey:o.owner,isWritable:!1,isSigner:!0})];for(let r of o.rewardInfo)t.push(h({pubkey:r.rewardMint,isWritable:!1}),h({pubkey:r.rewardVault}),h({pubkey:r.userRewardToken}));return{instruction:new Xe({programId:o.programId,keys:t,data:e}),instructionType:F.FarmV6Create}}function Su(o){let e=Buffer.alloc(ts.span);ts.encode({instruction:5},e);let t=[h({pubkey:yt,isWritable:!1}),h({pubkey:o.id}),h({pubkey:o.authority,isWritable:!1}),h({pubkey:o.lpVault,isWritable:!1}),h({pubkey:o.rewardVault}),h({pubkey:o.userRewardToken}),h({pubkey:o.owner,isWritable:!1,isSigner:!0})];return{instruction:new Xe({programId:o.programId,keys:t,data:e}),instructionType:F.FarmV6CreatorWithdraw}}function op(o,e,t,n,r,i,s,a,c,u,l,m,d){let p=_([D("depositEntryIndex"),P("amount")]),y=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:yt,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:dr,isSigner:!1,isWritable:!1}],f=Buffer.alloc(p.span);p.encode({depositEntryIndex:m,amount:d},f);let b=Buffer.from([...Bo.voterStakeRegistryDeposit,...f]);return new Xe({keys:y,programId:o,data:b})}function rp(o,e,t,n){let r=_([]),i=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:wn.programId,isSigner:!1,isWritable:!1}],s=Buffer.alloc(r.span);r.encode({},s);let a=Buffer.from([...Bo.voterStakeRegistryUpdateVoterWeightRecord,...s]);return new Xe({keys:i,programId:o,data:a})}function ip(o,e,t,n,r,i,s,a,c,u,l,m,d,p,y){let f=_([D("depositEntryIndex"),P("amount")]),b=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:yt,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:dr,isSigner:!1,isWritable:!1}],g=Buffer.alloc(f.span);f.encode({depositEntryIndex:p,amount:y},g);let A=Buffer.from([...Bo.voterStakeRegistryWithdraw,...g]);return new Xe({keys:b,programId:o,data:A})}function sp(o,e,t,n,r,i){let s=_([D("ins")]),a=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!0},{pubkey:wn.programId,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);return s.encode({ins:23},c),new Xe({keys:a,programId:o,data:c})}function ap(o,e,t,n,r,i,s,a){let c=_([D("voterBump"),D("voterWeightRecordBump")]),u=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!0},{pubkey:wn.programId,isSigner:!1,isWritable:!1},{pubkey:ut,isSigner:!1,isWritable:!1},{pubkey:dr,isSigner:!1,isWritable:!1}],l=Buffer.alloc(c.span);c.encode({voterBump:s,voterWeightRecordBump:a},l);let m=Buffer.from([...Bo.voterStakeRegistryCreateVoter,...l]);return new Xe({keys:u,programId:o,data:m})}function up(o,e,t,n,r,i,s,a,c,u,l,m){let d=_([D("depositEntryIndex"),D("kind"),D("option"),P("startTs"),He("periods"),Ze("allowClawback")]),p=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:wn.programId,isSigner:!1,isWritable:!1},{pubkey:yt,isSigner:!1,isWritable:!1},{pubkey:ep,isSigner:!1,isWritable:!1},{pubkey:ut,isSigner:!1,isWritable:!1}],y=Buffer.alloc(d.span);d.encode({depositEntryIndex:a,kind:c,option:u===void 0?0:1,startTs:u,periods:l,allowClawback:m},y);let f=Buffer.from([...Bo.voterStakeRegistryCreateDepositEntry,...y]);return new Xe({keys:p,programId:o,data:f})}async function Ah({connection:o,programId:e,governanceProgramId:t,voteWeightAddinProgramId:n,realm:r,communityTokenMint:i,owner:s,poolId:a,tokenProgram:c}){let u=as(n,r,i).publicKey,l=Je({programId:e,poolId:a,owner:s,version:3}),m=await o.getAccountInfo(l);if(m===null)throw Error("user is not staker");let d=ho.decode(m.data),p=d.deposited.sub(d.voteLockedBalance);if(console.log("amount",p.toString()),p.eq(new Nr(0)))throw Error("user do not has new stake amount");let y=us(e,a).publicKey,f=cs(e,a).publicKey,{publicKey:b,nonce:g}=ls(n,u,s),A=ge(b,y,c).publicKey,{publicKey:w,nonce:k}=ms(n,u,s),I=ds(t,r,i,s).publicKey,T=[],S=ge(s,y,c).publicKey;if(await o.getAccountInfo(S)===null&&T.push(tp(s,S,s,y)),await o.getAccountInfo(b)===null){let W=sp(t,r,s,i,s,I);T.push(W,ap(n,u,b,w,s,s,g,k))}let{index:x,isInit:L}=await fs(o,u,b,y);return L||T.push(up(n,u,b,A,s,s,y,x,0,void 0,0,!1)),T.push(op(n,u,b,A,S,s,l,a,y,f,e,x,p),rp(n,u,b,w)),T}async function wh({connection:o,programId:e,governanceProgramId:t,voteWeightAddinProgramId:n,realm:r,communityTokenMint:i,owner:s,poolId:a,tokenProgram:c}){let u=as(n,r,i).publicKey,l=Je({programId:e,poolId:a,owner:s,version:3}),m=await o.getAccountInfo(l);if(m===null)throw Error("user is not staker");let d=ho.decode(m.data);if(d.voteLockedBalance.eq(new Nr(0)))throw Error("user has vote locked balance = 0");let p=us(e,a).publicKey,y=cs(e,a).publicKey,{publicKey:f}=ls(n,u,s),b=ge(f,p,c).publicKey,{publicKey:g}=ms(n,u,s),A=ds(t,r,i,s).publicKey,w=[],{index:k,isInit:I}=await fs(o,u,f,p);if(!I)throw Error("deposit entry index check error");return w.push(ip(n,u,f,s,A,g,b,ge(s,p,c).publicKey,l,a,p,y,e,k,d.voteLockedBalance)),w}function ys({payer:o,rewardVault:e,userRewardTokenPub:t,farmKeys:n,rewardInfo:r}){let i=Buffer.alloc(os.span);os.encode({instruction:3,rewardReopenTime:z(r.openTime),rewardEndTime:z(r.endTime),rewardPerSecond:z(r.perSecond)},i);let s=[h({pubkey:yt,isWritable:!1}),h({pubkey:n.id}),h({pubkey:n.lpVault,isWritable:!1}),h({pubkey:e}),h({pubkey:t}),h({pubkey:o,isWritable:!1,isSigner:!0})];return new Xe({programId:n.programId,keys:s,data:i})}function bs({payer:o,userRewardTokenPub:e,farmKeys:t,rewardVault:n,rewardInfo:r}){let i=Buffer.alloc(rs.span);rs.encode({instruction:4,isSet:new Nr(1),rewardPerSecond:z(r.perSecond),rewardOpenTime:z(r.openTime),rewardEndTime:z(r.endTime),rewardType:z(cn[r.rewardType])},i);let s=[...hi,h({pubkey:t.id}),h({pubkey:t.authority,isWritable:!1}),h({pubkey:r.mint,isWritable:!1}),h({pubkey:n}),h({pubkey:e}),h({pubkey:o,isWritable:!1,isSigner:!0})];return new Xe({programId:t.programId,keys:s,data:i})}function Ph(o){let{farmInfo:e,farmKeys:t,version:n,lpAccount:r,rewardAccounts:i,owner:s,instruction:a,amount:c,deposit:u}=o,[l,m]=[new ue(e.programId),new ue(e.id)],d=Je({programId:l,poolId:m,owner:s,version:n}),p=Buffer.alloc(rt.span);rt.encode({instruction:a,amount:c},p);let y=n===6?[h({pubkey:yt,isWritable:!1}),...u?[h({pubkey:wn.programId,isWritable:!1})]:[],h({pubkey:m}),h({pubkey:new ue(t.authority),isWritable:!1}),h({pubkey:new ue(t.lpVault)}),h({pubkey:d}),h({pubkey:s,isWritable:!1,isSigner:!0}),h({pubkey:r})]:[h({pubkey:m}),h({pubkey:new ue(t.authority),isWritable:!1}),h({pubkey:d}),h({pubkey:s,isWritable:!1,isSigner:!0}),h({pubkey:r}),h({pubkey:new ue(t.lpVault)}),h({pubkey:i[0]}),h({pubkey:new ue(t.rewardInfos[0].vault)}),h({pubkey:Io,isWritable:!1}),h({pubkey:yt,isWritable:!1})];if(n===5)for(let f=1;f<t.rewardInfos.length;f++)y.push(h({pubkey:i[f]})),y.push(h({pubkey:new ue(t.rewardInfos[f].vault)}));if(n===6)for(let f=0;f<t.rewardInfos.length;f++)y.push(h({pubkey:new ue(t.rewardInfos[f].vault)})),y.push(h({pubkey:i[f]}));return new Xe({programId:l,keys:y,data:p})}function So(o){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:r,owner:i,amount:s}=o,[a,c]=[new ue(e.programId),new ue(e.id)],u=Je({programId:a,poolId:c,owner:i,version:6}),l=Buffer.alloc(rt.span);rt.encode({instruction:2,amount:z(s)},l);let m=[h({pubkey:yt,isWritable:!1}),h({pubkey:c}),h({pubkey:new ue(t.authority),isWritable:!1}),h({pubkey:new ue(t.lpVault)}),h({pubkey:u}),h({pubkey:i,isWritable:!1,isSigner:!0}),h({pubkey:n})];for(let d=0;d<t.rewardInfos.length;d++)m.push(h({pubkey:new ue(t.rewardInfos[d].vault)})),m.push(h({pubkey:r[d]}));return new Xe({programId:a,keys:m,data:l})}function Ko(o){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:r,owner:i,amount:s,userAuxiliaryLedgers:a}=o,[c,u]=[new ue(e.programId),new ue(e.id)],l=Je({programId:c,poolId:u,owner:i,version:5}),m=Buffer.alloc(rt.span);rt.encode({instruction:12,amount:z(s)},m);let d=[h({pubkey:u}),h({pubkey:new ue(t.authority),isWritable:!1}),h({pubkey:l}),h({pubkey:i,isWritable:!1,isSigner:!0}),h({pubkey:n}),h({pubkey:new ue(t.lpVault)}),h({pubkey:r[0]}),h({pubkey:new ue(t.rewardInfos[0].vault)}),h({pubkey:Io,isWritable:!1}),h({pubkey:yt,isWritable:!1})];for(let p=1;p<t.rewardInfos.length;p++)d.push(h({pubkey:r[p]})),d.push(h({pubkey:new ue(t.rewardInfos[p].vault)}));if(a)for(let p of a)d.push(h({pubkey:p}));return new Xe({programId:c,keys:d,data:m})}function Co(o){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:r,owner:i,amount:s,userAuxiliaryLedgers:a}=o,[c,u]=[new ue(e.programId),new ue(e.id)],l=Je({programId:c,poolId:u,owner:i,version:3}),m=Buffer.alloc(rt.span);rt.encode({instruction:11,amount:z(s)},m);let d=[h({pubkey:u}),h({pubkey:new ue(t.authority),isWritable:!1}),h({pubkey:l}),h({pubkey:i,isWritable:!1,isSigner:!0}),h({pubkey:n}),h({pubkey:new ue(t.lpVault)}),h({pubkey:r[0]}),h({pubkey:new ue(t.rewardInfos[0].vault)}),h({pubkey:Io,isWritable:!1}),h({pubkey:yt,isWritable:!1})];if(a)for(let p of a)d.push(h({pubkey:p}));return new Xe({programId:c,keys:d,data:m})}function Ku(o){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:r,owner:i,amount:s,userAuxiliaryLedgers:a}=o,[c,u]=[new ue(e.programId),new ue(e.id)],l=Je({programId:c,poolId:u,owner:i,version:3}),m=Buffer.alloc(rt.span);rt.encode({instruction:10,amount:z(s)},m);let d=[h({pubkey:u}),h({pubkey:new ue(t.authority),isWritable:!1}),h({pubkey:l}),h({pubkey:i,isWritable:!1,isSigner:!0}),h({pubkey:n}),h({pubkey:new ue(t.lpVault)}),h({pubkey:r[0]}),h({pubkey:new ue(t.rewardInfos[0].vault)}),h({pubkey:Io,isWritable:!1}),h({pubkey:yt,isWritable:!1})];if(a)for(let p of a)d.push(h({pubkey:p}));return new Xe({programId:c,keys:d,data:m})}function Cu(o){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:r,owner:i,amount:s,userAuxiliaryLedgers:a}=o,[c,u]=[new ue(e.programId),new ue(e.id)],l=Je({programId:c,poolId:u,owner:i,version:5}),m=Buffer.alloc(rt.span);rt.encode({instruction:11,amount:z(s)},m);let d=[h({pubkey:u}),h({pubkey:new ue(t.authority),isWritable:!1}),h({pubkey:l}),h({pubkey:i,isWritable:!1,isSigner:!0}),h({pubkey:n}),h({pubkey:new ue(t.lpVault)}),h({pubkey:r[0]}),h({pubkey:new ue(t.rewardInfos[0].vault)}),h({pubkey:Io,isWritable:!1}),h({pubkey:yt,isWritable:!1})];for(let p=1;p<t.rewardInfos.length;p++)d.push(h({pubkey:r[p]})),d.push(h({pubkey:new ue(t.rewardInfos[p].vault)}));if(a)for(let p of a)d.push(h({pubkey:p}));return new Xe({programId:c,keys:d,data:m})}function Ru(o){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:r,owner:i,amount:s}=o,[a,c]=[new ue(e.programId),new ue(e.id)],u=Je({programId:a,poolId:c,owner:i,version:6}),l=Buffer.alloc(rt.span);rt.encode({instruction:1,amount:z(s)},l);let m=[h({pubkey:yt,isWritable:!1}),h({pubkey:wn.programId,isWritable:!1}),h({pubkey:c}),h({pubkey:new ue(t.authority),isWritable:!1}),h({pubkey:new ue(t.lpVault)}),h({pubkey:u}),h({pubkey:i,isWritable:!1,isSigner:!0}),h({pubkey:n})];for(let d=0;d<t.rewardInfos.length;d++)m.push(h({pubkey:new ue(t.rewardInfos[d].vault)})),m.push(h({pubkey:r[d]}));return new Xe({programId:a,keys:m,data:l})}var Ro=class extends Se{async _getUserRewardInfo({payer:e,rewardInfo:t}){if(t.mint.equals(We)){let n=await Ut({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:e,amount:ps(E(R({},t),{openTime:t.openTime.toString(),endTime:t.endTime.toString()}))});return{rewardPubKey:n.addresses.newAccount,newInstruction:n}}return{rewardPubKey:await this.scope.account.getCreatedTokenAccount({mint:t.mint,associatedOnly:!1})}}async create({poolInfo:e,rewardInfos:t,payer:n,programId:r=En,txVersion:i}){this.checkDisabled(),this.scope.checkOwner();let a={lpMint:new Pe(e.lpMint.address),lockInfo:{lockMint:Pu,lockVault:hu},version:6,rewardInfos:t,programId:r},c=this.createTxBuilder(),u=n!=null?n:this.scope.ownerPubKey,l=ct({fromPublicKey:u,programId:a.programId}),m=await this.scope.connection.getMinimumBalanceForRentExemption(Po.span);c.addInstruction({instructions:[cp.createAccountWithSeed({fromPubkey:u,basePubkey:u,seed:l.seed,newAccountPubkey:l.publicKey,lamports:m,space:Po.span,programId:a.programId})]});let{publicKey:d,nonce:p}=Iu({programId:new Pe(a.programId),poolId:l.publicKey}),y=To({programId:a.programId,poolId:l.publicKey,mint:a.lpMint,type:"lpVault"}),f=[],b=[];for(let I of a.rewardInfos){I.openTime>=I.endTime&&this.logAndCreateError("start time error","rewardInfo.rewardOpenTime",I.openTime.toString()),isNaN(cn[I.rewardType])&&this.logAndCreateError("rewardType error",I.rewardType),Number(I.perSecond)<=0&&this.logAndCreateError("rewardPerSecond error",I.perSecond),f.push(Bu(I));let{rewardPubKey:T,newInstruction:S}=await this._getUserRewardInfo({rewardInfo:I,payer:u});S&&c.addInstruction(S),T||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let B=I.mint.equals(We)?new Pe(De.address):I.mint;b.push({rewardMint:B,rewardVault:To({programId:a.programId,poolId:l.publicKey,mint:B,type:"rewardVault"}),userRewardToken:T})}let{account:g,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({mint:new Pe(a.lockInfo.lockMint),owner:this.scope.ownerPubKey,skipCloseAccount:!1,createInfo:{payer:this.scope.ownerPubKey,amount:0},associatedOnly:!1});A&&c.addInstruction(A),g||this.logAndCreateError("cannot found lock vault","tokenAccounts",this.scope.account.tokenAccounts);let{instruction:w,instructionType:k}=xu({farmId:l.publicKey,owner:this.scope.ownerPubKey,farmAuthority:d,lpVault:y,lpMint:a.lpMint,lockVault:a.lockInfo.lockVault,lockMint:a.lockInfo.lockMint,lockUserAccount:g,programId:a.programId,rewardInfo:b,rewardInfoConfig:f,nonce:p});return c.addInstruction({instructions:[w],instructionTypes:[k]}).versionBuild({txVersion:i,extInfo:{farmId:l.publicKey,farmAuthority:d,lpVault:y,lockUserAccount:g,nonce:p}})}async restartReward({farmInfo:e,payer:t,newRewardInfo:n,txVersion:r}){var b;let i=wt[e.programId];i!==6&&this.logAndCreateError("invalid farm version ",i);let s=Ie((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),a={id:s.id,rewardInfos:e.rewardInfos,lpVault:s.lpVault,programId:s.programId};n.openTime>=n.endTime&&this.logAndCreateError("start time error","newRewardInfo",n);let c=t||this.scope.ownerPubKey,u=n.mint.equals(We)?new Pe(De.address):n.mint,l=a.rewardInfos.findIndex(g=>new Pe(g.mint.address).equals(u)),m=s.rewardInfos[l];m||this.logAndCreateError("configuration does not exist","rewardMint",u);let d=(b=m.vault)!=null?b:We,p=this.createTxBuilder(),{rewardPubKey:y,newInstruction:f}=await this._getUserRewardInfo({rewardInfo:n,payer:c});return f&&p.addInstruction(f),y||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts),p.addInstruction({instructions:[ys({payer:this.scope.ownerPubKey,rewardVault:d,userRewardTokenPub:y,farmKeys:a,rewardInfo:n})],instructionTypes:[F.FarmV6Restart]}).versionBuild({txVersion:r})}async restartRewards({farmInfo:e,payer:t,newRewardInfos:n,txVersion:r}){var l;let i=wt[e.programId];i!==6&&this.logAndCreateError("invalid farm version ",i);let s=Ie((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),a={id:s.id,rewardInfos:e.rewardInfos,lpVault:s.lpVault,programId:s.programId};n.forEach(m=>{m.openTime>=m.endTime&&this.logAndCreateError("start time error","newRewardInfo",m)});let c=t||this.scope.ownerPubKey,u=this.createTxBuilder();for(let m of n){let d=m.mint.equals(We)?new Pe(De.address):m.mint,p=a.rewardInfos.findIndex(w=>new Pe(w.mint.address).equals(d)),y=s.rewardInfos[p];y||this.logAndCreateError("configuration does not exist","rewardMint",d);let f=(l=y.vault)!=null?l:We,{rewardPubKey:b,newInstruction:g}=await this._getUserRewardInfo({rewardInfo:m,payer:c});g&&u.addInstruction(g),b||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let A=ys({payer:this.scope.ownerPubKey,rewardVault:f,userRewardTokenPub:b,farmKeys:a,rewardInfo:m});u.addInstruction({instructions:[A],instructionTypes:[F.FarmV6Restart]})}return u.versionBuild({txVersion:r})}async addNewRewardToken(e){let{txVersion:t,farmInfo:n,newRewardInfo:r,payer:i}=e,s=wt[n.programId];s!==6&&this.logAndCreateError("invalid farm version ",s);let a=Ie((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),c=i!=null?i:this.scope.ownerPubKey,u=this.createTxBuilder(),l=r.mint.equals(We)?new Pe(De.address):r.mint,m=To({programId:new Pe(n.programId),poolId:new Pe(n.id),mint:l,type:"rewardVault"}),{rewardPubKey:d,newInstruction:p}=await this._getUserRewardInfo({rewardInfo:r,payer:c});return p&&u.addInstruction(p),d||this.logAndCreateError("annot found target token accounts",this.scope.account.tokenAccounts),r.mint=l,u.addInstruction({instructions:[bs({payer:this.scope.ownerPubKey,userRewardTokenPub:d,farmKeys:a,rewardVault:m,rewardInfo:r})],instructionTypes:[F.FarmV6CreatorAddReward]}).versionBuild({txVersion:t})}async addNewRewardsToken(e){let{txVersion:t,farmInfo:n,newRewardInfos:r,payer:i}=e,s=wt[n.programId];s!==6&&this.logAndCreateError("invalid farm version ",s);let a=Ie((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),c=i!=null?i:this.scope.ownerPubKey,u=this.createTxBuilder();for(let l of r){let m=l.mint.equals(We)?new Pe(De.address):l.mint,d=To({programId:new Pe(n.programId),poolId:new Pe(n.id),mint:m,type:"rewardVault"}),{rewardPubKey:p,newInstruction:y}=await this._getUserRewardInfo({rewardInfo:l,payer:c});y&&u.addInstruction(y),p||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let f=bs({payer:this.scope.ownerPubKey,userRewardTokenPub:p,farmKeys:a,rewardVault:d,rewardInfo:E(R({},l),{mint:m})});u.addInstruction({instructions:[f],instructionTypes:[F.FarmV6CreatorAddReward]})}return u.versionBuild({txVersion:t})}async deposit(e){let{txVersion:t,farmInfo:n,amount:r,feePayer:i,useSOLBalance:s,associatedOnly:a=!0,checkCreateATAOwner:c=!1,userAuxiliaryLedgers:u,computeBudgetConfig:l}=e;this.scope.availability.addFarm===!1&&this.logAndCreateError("farm deposit feature disabled in your region");let{rewardInfos:m,programId:d}=n,p=wt[d];is(p)||this.logAndCreateError("invalid farm program:",n.programId);let[y,f]=[new Pe(n.programId),new Pe(n.id)],b=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],g=Je({programId:y,poolId:f,owner:this.scope.ownerPubKey,version:p}),A=this.createTxBuilder();A.addCustomComputeBudget(l);let w={};for(let v of this.scope.account.tokenAccounts)if(a){let $=ge(this.scope.ownerPubKey,v.mint,v.programId).publicKey;v.publicKey&&$.equals(v.publicKey)&&(w[v.mint.toString()]=v.publicKey)}else w[v.mint.toString()]=v.publicKey;let k=b.lpMint,I=w[k.address];I||this.logAndCreateError("you don't have any lp","lp zero",w);let T=[];for(let v of m){let $=s&&v.mint.address===Q.toString(),X=w[v.mint.address];if(!X){let{account:q,instructionParams:ot}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:v.mint.programId,mint:new Pe(v.mint.address),notUseTokenAccount:$,createInfo:{payer:i||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!$,associatedOnly:$?!1:a,checkCreateATAOwner:c});X=q,ot&&A.addInstruction(ot)}w[v.mint.address]=X,T.push(X)}let S,B=await this.scope.connection.getAccountInfo(g);if(B&&(S=Gn(p).decode(B.data)),n.programId!==En.toString()&&!S){let{instruction:v,instructionType:$}=xo({id:f,programId:y,version:p,ledger:g,owner:this.scope.ownerPubKey});A.addInstruction({instructions:[v],instructionTypes:[$]})}let C=ss({version:p,rewardInfos:m,rewardTokenAccountsPublicKeys:T});C&&this.logAndCreateError(C);let x={amount:z(r),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:b,lpAccount:I,rewardAccounts:T,userAuxiliaryLedgers:u==null?void 0:u.map(v=>new Pe(v))},L=p===6?Ru(x):p===5?Cu(x):Ku(x),W={3:F.FarmV3Deposit,5:F.FarmV5Deposit,6:F.FarmV6Deposit};return A.addInstruction({instructions:[L],instructionTypes:[W[p]]}).versionBuild({txVersion:t})}async withdraw(e){let{txVersion:t,farmInfo:n,amount:r,deposited:i,useSOLBalance:s,feePayer:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,userAuxiliaryLedgers:l,computeBudgetConfig:m}=e,{rewardInfos:d}=n;this.scope.availability.removeFarm===!1&&this.logAndCreateError("farm withdraw feature disabled in your region");let p=wt[n.programId];is(p)||this.logAndCreateError("invalid farm program:",n.programId);let y=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],f=this.createTxBuilder();f.addCustomComputeBudget(m);let b={};for(let C of this.scope.account.tokenAccounts)if(c){let x=ge(this.scope.ownerPubKey,C.mint).publicKey;C.publicKey&&x.equals(C.publicKey)&&(b[C.mint.toString()]=C.publicKey)}else b[C.mint.toString()]=C.publicKey;if(i)i.isZero()&&this.logAndCreateError("no deposited lp",{farmId:n.id});else{let C=Je({programId:new Pe(n.programId),poolId:new Pe(n.id),owner:this.scope.ownerPubKey,version:p}),x=await this.scope.connection.getAccountInfo(C);if(x)Gn(p).decode(x.data).deposited.isZero()&&this.logAndCreateError("no deposited lp",{farmId:n.id});else if(p!==6&&(l||[]).length>0){let{instruction:L,instructionType:W}=xo({id:new Pe(y.id),programId:new Pe(y.programId),version:p,ledger:C,owner:this.scope.ownerPubKey});f.addInstruction({instructions:[L],instructionTypes:[W]})}else this.logAndCreateError("no lp data",{farmId:n.id,version:p,ledgerData:x})}let g=y.lpMint.address,A=s&&g===Q.toString(),w=b[g.toString()];if(!w){let{account:C,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:y.lpMint.programId,mint:new Pe(g),notUseTokenAccount:A,createInfo:{payer:a||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:A?!1:c,checkCreateATAOwner:u});w=C,x&&f.addInstruction(x)}b[g.toString()]=w;let k=[];for(let C of d){let x=s&&C.mint.address===Q.toString(),L=b[C.mint.address];if(!L){let{account:W,instructionParams:v}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:C.mint.programId,mint:new Pe(C.mint.address),notUseTokenAccount:x,createInfo:{payer:a||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!x,associatedOnly:x?!1:c,checkCreateATAOwner:u});L=W,v&&f.addInstruction(v)}b[C.mint.address]=L,k.push(L)}let I=ss({version:p,rewardInfos:d,rewardTokenAccountsPublicKeys:k});I&&this.logAndCreateError(I);let T={amount:z(r),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:y,lpAccount:w,rewardAccounts:k,userAuxiliaryLedgers:l==null?void 0:l.map(C=>new Pe(C))},S=p===6?So(T):p===5?Ko(T):Co(T),B={3:F.FarmV3Withdraw,5:F.FarmV5Withdraw,6:F.FarmV6Withdraw};return f.addInstruction({instructions:[S],instructionTypes:[B[p]]}).versionBuild({txVersion:t})}async withdrawFarmReward({farmInfo:e,withdrawMint:t,txVersion:n}){var p;this.scope.checkOwner();let r=Ie((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),i=wt[e.programId];i!==6&&this.logAndCreateError("invalid farm version",i);let s=e.rewardInfos.findIndex(y=>y.mint.address===We.toString()?new Pe(De.address):t),a=r.rewardInfos[s];a||this.logAndCreateError("withdraw mint error","rewardInfos",e);let c=(p=a==null?void 0:a.vault)!=null?p:We,u=this.createTxBuilder(),l;if(t.equals(We)){let y=await Ut({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:ps(E(R({},a),{openTime:a.openTime,endTime:a.endTime,perSecond:new O(a.perSecond).mul(10**a.mint.decimals).toString()}))});l=y.addresses.newAccount,u.addInstruction(y)}else{let y=await this.scope.account.getCreatedTokenAccount({mint:t});y===null?(l=await this.scope.account.getAssociatedTokenAccount(t),u.addInstruction({instructions:[lp(this.scope.ownerPubKey,l,this.scope.ownerPubKey,t)],instructionTypes:[F.CreateATA]})):l=y}let{instruction:m,instructionType:d}=Su({programId:r.programId,id:r.id,authority:r.authority,lpVault:r.lpVault,rewardVault:c,userRewardToken:l,owner:this.scope.ownerPubKey});return u.addInstruction({instructions:[m],instructionTypes:[d]}).versionBuild({txVersion:n})}async harvestAllRewards(e){let{farmInfoList:t,useSOLBalance:n,feePayer:r,associatedOnly:i=!0,checkCreateATAOwner:s=!1,userAuxiliaryLedgers:a,txVersion:c,computeBudgetConfig:u}=e,l=this.createTxBuilder(),m={};for(let y of this.scope.account.tokenAccounts)if(i){let f=ge(this.scope.ownerPubKey,y.mint).publicKey;y.publicKey&&f.equals(y.publicKey)&&(m[y.mint.toString()]=y.publicKey)}else m[y.mint.toString()]=y.publicKey;let p=(await this.scope.api.fetchFarmKeysById({ids:Object.values(t).map(y=>y.id).join(",")})).reduce((y,f)=>E(R({},y),{[f.id]:f}),{});for(let y of Object.values(t)){let{programId:f,lpMint:b,rewardInfos:g,id:A}=y,w=wt[f],k=b.address,I=n&&k===Q.toString(),T=m[k];if(!T){let{account:W,instructionParams:v}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:b.programId,mint:new Pe(k),notUseTokenAccount:I,createInfo:{payer:r||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:I?!1:i,checkCreateATAOwner:s});T=W,v&&l.addInstruction(v)}m[k.toString()]=T;let S=[];for(let W of g){let v=n&&W.mint.address===Q.toString(),$=m[W.mint.address];if(!$){let{account:X,instructionParams:q}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:W.mint.programId,mint:new Pe(W.mint.address),notUseTokenAccount:v,createInfo:{payer:r||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!v,associatedOnly:v?!1:i,checkCreateATAOwner:s});$=X,q&&l.addInstruction(q)}m[W.mint.address]=$,S.push($)}let B=p[A],C={amount:qe,owner:this.scope.ownerPubKey,farmInfo:y,farmKeys:B,lpAccount:T,rewardAccounts:S,userAuxiliaryLedgers:a==null?void 0:a.map(W=>new Pe(W))},x=w===6?So(C):w===5?Ko(C):Co(C),L={3:F.FarmV3Withdraw,5:F.FarmV5Withdraw,6:F.FarmV6Withdraw};l.addInstruction({instructions:[x],instructionTypes:[L[w]]})}return c===1?l.sizeCheckBuild({computeBudgetConfig:u}):l.sizeCheckBuildV0({computeBudgetConfig:u})}};import{PublicKey as tt}from"@solana/web3.js";import{AccountLayout as tf,NATIVE_MINT as fc,TOKEN_PROGRAM_ID as jn}from"@solana/spl-token";import{Keypair as Bs,PublicKey as U,SystemProgram as Xn,TransactionInstruction as At}from"@solana/web3.js";import Hu from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Zu,TOKEN_2022_PROGRAM_ID as zt,TOKEN_PROGRAM_ID as ve}from"@solana/spl-token";import Tp from"bn.js";import Pt from"bn.js";var pe=new Pt(0),bt=new Pt(1),Gt=new Pt(-1),gt=new Pt(1).shln(64),Mr=new Pt(1).shln(128),gs=gt.sub(bt),Lo=64,Lu=Mr.subn(1),et=-443636,it=-et,ht=new Pt("4295048016"),kt=new Pt("79226673521066979257578248091"),_r=new Pt("4295048017"),vr=new Pt("79226673521066979257578248090"),Ou=16,Nu="59543866431248",Mu="184467440737095516",_u="15793534762490258745",Vr=new Pt(10).pow(new Pt(6)),mp=(n=>(n[n.rate_500=500]="rate_500",n[n.rate_3000=3e3]="rate_3000",n[n.rate_10000=1e4]="rate_10000",n))(mp||{}),Zh={[500]:10,[3e3]:60,[1e4]:200},$h={version:6,liquidity:pe,tickCurrent:0,feeGrowthGlobalX64A:pe,feeGrowthGlobalX64B:pe,protocolFeesTokenA:pe,protocolFeesTokenB:pe,swapInAmountTokenA:pe,swapOutAmountTokenB:pe,swapInAmountTokenB:pe,swapOutAmountTokenA:pe,tickArrayBitmap:[],rewardInfos:[],day:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},week:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},month:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},tvl:0},vu={tvl:0,volumeQuote:0,mintAmountA:0,mintAmountB:0,rewardDefaultInfos:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,day:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},week:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},month:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},pooltype:[]},Jh=new Pt("18446744073700000000");import se from"bn.js";function Vu(o){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,o,!1),new Uint8Array(e)}function tk(o){let e=new ArrayBuffer(2);return new DataView(e).setInt16(0,o,!1),new Uint8Array(e)}function nk(o){let e=new ArrayBuffer(4);return new DataView(e).setUint32(0,o,!1),new Uint8Array(e)}function Fr(o){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,o,!1),new Uint8Array(e)}function As(o,e){let t=0;for(let n=o-1;n>=0&&!e.testn(n);n--)t++;return t}function ws(o,e){let t=0;for(let n=0;n<o&&!e.testn(n);n++)t++;return t}function Oo(o,e){for(let t=0;t<o;t++)if(e.testn(t))return!1;return!0}function Fu(o,e){return Oo(o,e)?null:As(o,e)}function Eu(o,e){return Oo(o,e)?null:ws(o,e)}var dp=Buffer.from("amm_config","utf8"),pp=Buffer.from("pool","utf8"),fp=Buffer.from("pool_vault","utf8"),yp=Buffer.from("pool_reward_vault","utf8"),Du=Buffer.from("position","utf8"),bp=Buffer.from("tick_array","utf8"),gp=Buffer.from("operation","utf8"),Ap=Buffer.from("pool_tick_array_bitmap_extension","utf8"),wp=Buffer.from("observation","utf8");function sk(o,e){return ae([dp,Vu(e)],o)}function Wu(o,e,t,n){return ae([pp,e.toBuffer(),t.toBuffer(),n.toBuffer()],o)}function Ps(o,e,t){return ae([fp,e.toBuffer(),t.toBuffer()],o)}function qu(o,e,t){return ae([yp,e.toBuffer(),t.toBuffer()],o)}function we(o,e,t){return ae([bp,e.toBuffer(),Fr(t)],o)}function ln(o,e,t,n){return ae([Du,e.toBuffer(),Fr(t),Fr(n)],o)}function mt(o,e){return ae([Du,e.toBuffer()],o)}function Er(o){return ae([Buffer.from("metadata","utf8"),Vn.toBuffer(),o.toBuffer()],Vn)}function No(o){return ae([gp],o)}function dt(o,e){return ae([Ap,e.toBuffer()],o)}function Uu(o,e){return ae([wp,e.toBuffer()],o)}var Pp=Buffer.from("locked_position","utf8");function hs(o,e){return ae([Pp,e.toBuffer()],o)}import{PublicKey as Lt}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Gu}from"@solana/spl-token";import Be from"bn.js";import vt from"bn.js";var Mo=class{static getfeeGrowthInside(e,t,n){let r=new vt(0),i=new vt(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,i=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),i=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new vt(0),a=new vt(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let c=ne.wrappingSubU128(ne.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),u=ne.wrappingSubU128(ne.wrappingSubU128(e.feeGrowthGlobalX64B,i),a);return{feeGrowthInsideX64A:c,feeGrowthInsideBX64:u}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:i,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=ne.mulDivFloor(ne.wrappingSubU128(i,t.feeGrowthInsideLastX64A),t.liquidity,gt),c=t.tokenFeesOwedA.add(a),u=ne.mulDivFloor(ne.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,gt),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:i,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=ne.mulDivFloor(ne.wrappingSubU128(i,t.feeGrowthInsideLastX64A),t.liquidity,gt),c=t.tokenFeesOwedA.add(a),u=ne.mulDivFloor(ne.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,gt),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let i=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=ne.wrappingSubU128(c,u.growthInsideLastX64),m=ne.mulDivFloor(l,t.liquidity,gt),d=u.rewardAmountOwed.add(m);i.push(d)}return i}static GetPositionRewards(e,t,n,r){let i=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=ne.wrappingSubU128(c,u.growthInsideLastX64),m=ne.mulDivFloor(l,t.liquidity,gt),d=u.rewardAmountOwed.add(m);i.push(d)}return i}static getRewardGrowthInside(e,t,n,r){let i=[];for(let s=0;s<r.length;s++){let a=new vt(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new vt(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),i.push(ne.wrappingSubU128(ne.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return i}static getRewardGrowthInsideV2(e,t,n,r){let i=[];for(let s=0;s<r.length;s++){let a=new vt(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new vt(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),i.push(ne.wrappingSubU128(ne.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return i}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:i,epochInfo:s}){var b,g,A,w;let a=ee.priceToSqrtPriceX64(new O(e.price),e.mintA.decimals,e.mintB.decimals),c=ee.getSqrtPriceX64FromTick(t.tickLower),u=ee.getSqrtPriceX64FromTick(t.tickUpper),l=i?1+r:1-r,m=me.getAmountsFromLiquidity(a,c,u,n,i),[d,p]=[ye(m.amountA,(b=e.mintA.extensions)==null?void 0:b.feeConfig,s,!0),ye(m.amountB,(g=e.mintB.extensions)==null?void 0:g.feeConfig,s,!0)],[y,f]=[ye(new vt(new O(m.amountA.toString()).mul(l).toFixed(0)),(A=e.mintA.extensions)==null?void 0:A.feeConfig,s,!0),ye(new vt(new O(m.amountB.toString()).mul(l).toFixed(0)),(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:p,amountSlippageA:y,amountSlippageB:f,expirationTime:Ct(d.expirationTime,p.expirationTime)}}};var hp=15,de=class{static async getTickArrays(e,t,n,r,i,s,a){let c=[],u=j.getTickArrayStartIndexByTick(r,i),l=j.getInitializedTickArrayInRange(s,a,i,u,Math.floor(hp/2));for(let p=0;p<l.length;p++){let{publicKey:y}=we(t,n,l[p]);c.push(y)}let m=(await It(e,c)).map(p=>p!==null?_o.decode(p.data):null),d={};for(let p=0;p<c.length;p++){let y=m[p];y!==null&&(d[y.startTickIndex]=E(R({},y),{address:c[p]}))}return d}static nextInitializedTick(e,t,n,r,i,s){let{initializedTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}=this.nextInitializedTickInOneArray(e,t,n,r,i,s);for(;a==null||a.liquidityGross.lten(0);){if(u=j.getNextTickArrayStartIndex(u,i,s),this.checkIsValidStartIndex(u,i))throw new Error("No enough initialized tickArray");let l=n[u];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:p}=this.firstInitializedTickInOneArray(e,t,l,s);[a,c,u]=[m,d,p]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}}static nextInitializedTickArray(e,t,n,r,i){let s=Math.floor(e/de.tickCount(t)),a=n?j.searchLowBitFromStart(r,i,s-1,1,t):j.searchHightBitFromStart(r,i,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let i;if(r){let a=Ue-1;for(;a>=0;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){i=c;break}a=a-1}}else{let a=0;for(;a<Ue;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){i=c;break}a=a+1}}let{publicKey:s}=we(e,t,n.startTickIndex);return{nextTick:i,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,i,s){let a=j.getTickArrayStartIndexByTick(r,i),c=Math.floor((r-a)/i),u=n[a];if(u==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;c>=0;){let d=u.ticks[c];if(d.liquidityGross.gtn(0)){l=d;break}c=c-1}else for(c=c+1;c<Ue;){let d=u.ticks[c];if(d.liquidityGross.gtn(0)){l=d;break}c=c+1}let{publicKey:m}=we(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:u.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(j.checkIsOutOfBoundary(e)){if(e>it)return!1;let n=j.getTickArrayStartIndexByTick(et,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return Ue*e}};var ks=14,Xt=class{static maxTickInTickarrayBitmap(e){return e*Ue*Pn}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let i=n*r;return e<0?{minValue:-i,maxValue:-i+n}:{minValue:i,maxValue:i+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!de.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let i=this.maxTickInTickarrayBitmap(n),s=r?t-de.tickCount(n):t+de.tickCount(n);if(s<-i||s>=i)return{isInit:!1,tickIndex:t};let a=n*Ue,c=s/a+512;s<0&&s%a!=0&&c--;let u=Math.abs(c);if(r){let l=e.shln(1024-u-1),m=Fu(1024,l);if(m!==null){let d=(u-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-i}}else{let l=e.shrn(u),m=Eu(1024,l);if(m!==null){let d=(u+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:i-de.tickCount(n)}}}},vo=class{static getBitmapOffset(e,t){if(!de.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=Xt.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=Xt.maxTickInTickarrayBitmap(e),n=-t;if(it<=t)throw Error(`extensionTickBoundary check error: ${it}, ${t}`);if(n<=et)throw Error(`extensionTickBoundary check error: ${n}, ${et}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),i=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:j.mergeTickArrayBitmap(r).testn(i),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let i=de.tickCount(t),s=n?e-i:e+i,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:i,maxValue:s}=Xt.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let c=j.mergeTickArrayBitmap(e).shln(Pn-1-a),u=Oo(512,c)?null:As(512,c);if(u!==null){let l=t-u*de.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:i}}else{let c=j.mergeTickArrayBitmap(e).shrn(a),u=Oo(512,c)?null:ws(512,c);if(u!==null){let l=t+u*de.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-de.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%Xt.maxTickInTickarrayBitmap(t),r=Math.floor(n/de.tickCount(t));return e<0&&n!=0&&(r=Pn-r),r}};var Ce=class{static getOutputAmountAndRemainAccounts(e,t,n,r,i,s=!1){let a=n.toBase58()===e.mintA.address,c=[],{isExist:u,startIndex:l,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,a);if(!u||l===void 0||!m)throw new Error("Invalid tick array");c.push(m);let{allTrade:d,amountCalculated:p,accounts:y,sqrtPriceX64:f,feeAmount:b}=hn.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,i,s);return c.push(...y),{allTrade:d,expectedAmountOut:p.mul(Gt),remainingAccounts:c,executionPrice:f,feeAmount:b}}static getInputAmountAndRemainAccounts(e,t,n,r,i){let s=n.toBase58()===e.mintB.address,a=[],{isExist:c,startIndex:u,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!c||u===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:b}=we(e.programId,e.id,f.nextStartIndex);a.push(b)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:y}=hn.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(Gt),u,i);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:p,feeAmount:y}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=Ce.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?vo.checkTickArrayIsInit(de.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):j.checkTickArrayIsInitialized(j.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=we(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:i,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,de.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(i){let{publicKey:a}=we(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/de.tickCount(e.tickSpacing)),r=t?j.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):j.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=de.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:i}=Xt.nextInitializedTickArrayStartIndex(j.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:i};t=i;let{isInit:s,tickIndex:a}=vo.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<et||t>it)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:i}){var a,c,u;let s=[];for(let l=0;l<i.length;l++){let m=i[l],d=(u=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?u:(c=await e.getAccountInfo(m.tokenMint))==null?void 0:c.owner;if(d===void 0)throw Error("get new reward mint info error");let p=E(R({},m),{perSecond:ne.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Lt(d)});if(p.tokenMint.equals(Lt.default))continue;if(n<=p.openTime.toNumber()||r.eq(pe)){s.push(p);continue}let y=new Be(Math.min(p.endTime.toNumber(),n)),f=y.sub(p.lastUpdateTime),b=ne.mulDivFloor(f,p.emissionsPerSecondX64,r),g=p.rewardGrowthGlobalX64.add(b),A=ne.mulDivFloor(f,p.emissionsPerSecondX64,gt),w=p.rewardTotalEmissioned.add(A);s.push(E(R({},p),{rewardGrowthGlobalX64:g,rewardTotalEmissioned:w,lastUpdateTime:y}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let i of t){let s=j.getTickArrayStartIndexByTick(i,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=Xt.maxTickInTickarrayBitmap(e),n=-t;return t>it&&(t=de.getArrayStartIndex(it,e)+de.tickCount(e)),n<et&&(n=de.getArrayStartIndex(et,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!de.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/de.tickCount(t)*Pn}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await Fe(e,t.map(s=>({pubkey:s})),{batchRequest:n}),i={};for(let s of r)s.accountInfo!==null&&(i[s.pubkey.toString()]=zu.decode(s.accountInfo.data));return i}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},i=[];for(let c of t){let u=j.getTickArrayStartIndexByTick(c.tickCurrent,c.tickSpacing),l=j.getInitializedTickArrayInRange(c.tickArrayBitmap,c.exBitmapInfo,c.tickSpacing,u,7);for(let m of l){let{publicKey:d}=we(c.programId,c.id,m);i.push({pubkey:d}),r[d.toString()]=c.id}}let s=await Fe(e,i,{batchRequest:n}),a={};for(let c of s){if(!c.accountInfo)continue;let u=r[c.pubkey.toString()];if(!u)continue;a[u.toString()]===void 0&&(a[u.toString()]={});let l=_o.decode(c.accountInfo.data);a[u.toString()][l.startTickIndex]=E(R({},l),{address:c.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:i=!0}){var a;let s=[];for(let c=0;c<e.length;c++){let u=e[c];u!==null&&(s.find(l=>l.equals(u.state.programId))||s.push(u.state.programId))}if(n){let c=n.tokenAccounts.map(d=>d.accountInfo.mint),u=[];for(let d of c)for(let p of s)u.push(mt(p,d).publicKey);let l=await It(t,u,{batchRequest:r}),m={};for(let d of l){if(d===null)continue;let p=Dr.decode(d.data),y=p.poolId.toString(),f=e.find(B=>B.state.id.toBase58()===y);if(f===void 0)continue;let b=f.state,g=j._getTickPriceLegacy({poolInfo:b,tick:p.tickLower,baseIn:!0}),A=j._getTickPriceLegacy({poolInfo:b,tick:p.tickUpper,baseIn:!0}),{amountA:w,amountB:k}=me.getAmountsFromLiquidity(b.sqrtPriceX64,g.tickSqrtPriceX64,A.tickSqrtPriceX64,p.liquidity,!1),I=1/(1-Math.sqrt(Math.sqrt(g.price.div(A.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:p.poolId,nftMint:p.nftMint,priceLower:g.price,priceUpper:A.price,amountA:w,amountB:k,tickLower:p.tickLower,tickUpper:p.tickUpper,liquidity:p.liquidity,feeGrowthInsideLastX64A:p.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:p.feeGrowthInsideLastX64B,tokenFeesOwedA:p.tokenFeesOwedA,tokenFeesOwedB:p.tokenFeesOwedB,rewardInfos:p.rewardInfos.map(B=>E(R({},B),{pendingReward:new Be(0)})),leverage:I,tokenFeeAmountA:new Be(0),tokenFeeAmountB:new Be(0)}];let T=await j.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickLower,f.state.tickSpacing),S=await j.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickUpper,f.state.tickSpacing);m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickLower}`]=T,m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickUpper}`]=S}if(i){let d=Object.values(m),p=await It(t,d,{batchRequest:r}),y={};for(let f=0;f<d.length;f++){let b=p[f];if(b===null)continue;let g=d[f].toString();y[g]=_o.decode(b.data)}for(let{state:f,positionAccount:b}of e)if(!!b)for(let g of b){let A=`${f.programId.toString()}-${f.id.toString()}-${g.tickLower}`,w=`${f.programId.toString()}-${f.id.toString()}-${g.tickUpper}`,k=y[m[A].toString()],I=y[m[w].toString()],T=k.ticks[j.getTickOffsetInArray(g.tickLower,f.tickSpacing)],S=I.ticks[j.getTickOffsetInArray(g.tickUpper,f.tickSpacing)],{tokenFeeAmountA:B,tokenFeeAmountB:C}=await Mo.GetPositionFees(f,g,T,S),x=await Mo.GetPositionRewards(f,g,T,S);g.tokenFeeAmountA=B.gte(new Be(0))?B:new Be(0),g.tokenFeeAmountB=C.gte(new Be(0))?C:new Be(0);for(let L=0;L<x.length;L++)g.rewardInfos[L].pendingReward=x[L].gte(new Be(0))?x[L]:new Be(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:i,slippage:s,priceLimit:a=new O(0),catchLiquidityInsufficient:c=!1}){var W;let u,l=n.toBase58()===e.mintA.address,[m,d]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new O(0))?u=l?ht.add(new Be(1)):kt.sub(new Be(1)):u=ee.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let p=ye(i,m,r,!1),{allTrade:y,expectedAmountOut:f,remainingAccounts:b,executionPrice:g,feeAmount:A}=Ce.getOutputAmountAndRemainAccounts(e,t,n,p.amount.sub((W=p.fee)!=null?W:pe),u,c),w=ye(f,d,r,!1),k=ee.sqrtPriceX64ToPrice(g,e.mintA.decimals,e.mintB.decimals),I=l?k:new O(1).div(k),T=f.mul(new Be(Math.floor((1-s)*1e10))).div(new Be(1e10)),S=ye(T,d,r,!1),B=l?e.currentPrice:new O(1).div(e.currentPrice),C=new O(I).sub(B).abs(),x=B,L=new Ke(new O(C).mul(10**15).toFixed(0),new O(x).mul(10**15).toFixed(0));return{allTrade:y,realAmountIn:p,amountOut:w,minAmountOut:S,expirationTime:Ct(p.expirationTime,w.expirationTime),currentPrice:e.currentPrice,executionPrice:I,priceImpact:L,fee:A,remainingAccounts:b,executionPriceX64:g}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:i,epochInfo:s,catchLiquidityInsufficient:a=!1}){let c=r.address===e.mintB.address,[u,l]=c?[e.mintA,e.mintB]:[e.mintB,e.mintA],[m,d]=[new be(E(R({},u),{mint:u.address,isToken2022:u.programId===Gu.toBase58()})),new be(E(R({},l),{mint:l.address,isToken2022:l.programId===Gu.toBase58()}))],{allTrade:p,realAmountIn:y,amountOut:f,minAmountOut:b,expirationTime:g,currentPrice:A,executionPrice:w,priceImpact:k,fee:I,remainingAccounts:T,executionPriceX64:S}=Ce.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Lt(u.address),amountIn:n,slippage:i,epochInfo:s,catchLiquidityInsufficient:a}),B=E(R({},y),{amount:new fe(m,y.amount),fee:y.fee===void 0?void 0:new fe(m,y.fee)}),C=E(R({},f),{amount:new fe(d,f.amount),fee:f.fee===void 0?void 0:new fe(d,f.fee)}),x=E(R({},b),{amount:new fe(d,b.amount),fee:b.fee===void 0?void 0:new fe(d,b.fee)}),L=new Ge({baseToken:m,denominator:new Be(10).pow(new Be(20+m.decimals)),quoteToken:d,numerator:A.mul(new O(10**(20+d.decimals))).toFixed(0)}),W=new Ge({baseToken:m,denominator:new Be(10).pow(new Be(20+m.decimals)),quoteToken:d,numerator:w.mul(new O(10**(20+d.decimals))).toFixed(0)}),v=new fe(m,I);return{allTrade:p,realAmountIn:B,amountOut:C,minAmountOut:x,expirationTime:g,currentPrice:L,executionPrice:W,priceImpact:k,fee:v,remainingAccounts:T,executionPriceX64:S}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:i,slippage:s,priceLimit:a=new O(0)}){var x;let c=n.toBase58()===e.mintA.address,u={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;a.equals(new O(0))?l=c?kt.sub(new Be(1)):ht.add(new Be(1)):l=ee.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let m=ye(i,u[n.toString()],r,!0),{expectedAmountIn:d,remainingAccounts:p,executionPrice:y,feeAmount:f}=Ce.getInputAmountAndRemainAccounts(e,t,n,m.amount.sub((x=m.fee)!=null?x:pe),l),b=c?e.mintB.address:e.mintA.address,g=ye(d,u[b],r,!1),A=ee.sqrtPriceX64ToPrice(y,e.mintA.decimals,e.mintB.decimals),w=c?A:new O(1).div(A),k=d.mul(new Be(Math.floor((1+s)*1e10))).div(new Be(1e10)),I=ye(k,u[b],r,!0),T=c?e.currentPrice:new O(1).div(e.currentPrice),S=new O(w).sub(T).abs(),B=T,C=new Ke(new O(S).mul(10**15).toFixed(0),new O(B).mul(10**15).toFixed(0));return{amountIn:g,maxAmountIn:I,realAmountOut:m,expirationTime:Ct(g.expirationTime,m.expirationTime),currentPrice:e.currentPrice,executionPrice:w,priceImpact:C,fee:f,remainingAccounts:p}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var y,f,b;let i=e[t],s=j.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=j.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),c=Math.max(s,i.priceMin),l=Math.min(a,i.priceMax)-c,m=a-s,d=i.priceMax-i.priceMin,p;return l<=0?p=0:m===l?p=d/l:d===l?p=l/m:p=l/d*(l/m),{feeApr:i.feeApr*p,rewardsApr:[((y=i.rewardApr[0])!=null?y:0)*p,((f=i.rewardApr[1])!=null?f:0)*p,((b=i.rewardApr[2])!=null?b:0)*p],apr:i.apr*p}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:i,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:c}){let u=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=r[ft(e.mintA.address).toString()],d=r[ft(e.mintB.address).toString()],p=e.mintA.decimals,y=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=ee.priceToSqrtPriceX64(new O(e.price),e.mintA.decimals,e.mintB.decimals),b=ee.getSqrtPriceX64FromTick(s),g=ee.getSqrtPriceX64FromTick(a),{amountSlippageA:A,amountSlippageB:w}=me.getAmountsFromLiquidityWithSlippage(f,b,g,t,!1,!1,0),{amountSlippageA:k,amountSlippageB:I}=me.getAmountsFromLiquidityWithSlippage(f,b,g,i,!1,!1,0),T=new O(A.toString()).div(new O(10).pow(p)).mul(m.value).add(new O(w.toString()).div(new O(10).pow(y)).mul(d.value)),S=new O(k.toString()).div(new O(10).pow(p)).mul(m.value).add(new O(I.toString()).div(new O(10).pow(y)).mul(d.value)),B=new O(1).div(T.add(S)),x=new O(l.volumeFee).mul(365).div(u).mul(B).mul(100).toNumber(),L=3600*24*365,W=e.rewardDefaultInfos.map(v=>{var q,ot;let $=v.mint.decimals,X=r[v.mint.address];return c<((q=v.startTime)!=null?q:0)||c>((ot=v.endTime)!=null?ot:0)||!v.perSecond||!X||$===void 0?0:new O(X.value).mul(new O(v.perSecond).mul(L)).div(new O(10).pow($)).mul(B).mul(100).toNumber()});return{feeApr:x,rewardsApr:W,apr:x+W.reduce((v,$)=>v+$,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:i,slippage:s,add:a,epochInfo:c,amountHasFee:u}){var g,A;let l=ee.priceToSqrtPriceX64(new O(e.price),e.mintA.decimals,e.mintB.decimals),m=ee.getSqrtPriceX64FromTick(n),d=ee.getSqrtPriceX64FromTick(r),p=a?1-s:1+s,y=ye(i,(g=e[t?"mintA":"mintB"].extensions)==null?void 0:g.feeConfig,c,!u),f=new Be(new O(y.amount.sub((A=y.fee)!=null?A:pe).toString()).mul(p).toFixed(0)),b;if(l.lte(m))b=t?me.getLiquidityFromTokenAmountA(m,d,f,!a):new Be(0);else if(l.lte(d)){let w=me.getLiquidityFromTokenAmountA(l,d,f,!a),k=me.getLiquidityFromTokenAmountB(m,l,f);b=t?w:k}else b=t?new Be(0):me.getLiquidityFromTokenAmountB(m,d,f);return Ce.getAmountsFromLiquidity({epochInfo:c,poolInfo:e,tickLower:n,tickUpper:r,liquidity:b,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:i,slippage:s,add:a}){var b,g,A,w;let c=ee.getSqrtPriceX64FromTick(n),u=ee.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,m=me.getAmountsFromLiquidity(ee.priceToSqrtPriceX64(new O(t.price),t.mintA.decimals,t.mintB.decimals),c,u,i,a),[d,p]=[ye(m.amountA,(b=t.mintA.extensions)==null?void 0:b.feeConfig,e,!0),ye(m.amountB,(g=t.mintB.extensions)==null?void 0:g.feeConfig,e,!0)],[y,f]=[ye(m.amountA.muln(l),(A=t.mintA.extensions)==null?void 0:A.feeConfig,e,!0),ye(m.amountB.muln(l),(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)];return{liquidity:i,amountA:d,amountB:p,amountSlippageA:y,amountSlippageB:f,expirationTime:Ct(d.expirationTime,p.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(c=>!n[c.id]).map(c=>new Lt(c.id));(await It(e,r)).forEach((c,u)=>{!c||(n[r[u].toBase58()]=kn.decode(c.data))});let s=t.map(c=>dt(new Lt(c.programId),new Lt(c.id)).publicKey),a=await Ce.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((c,u)=>E(R({},c),{[u.id]:E(R({},n[u.id]),{id:new Lt(u.id),version:6,programId:new Lt(u.programId),mintA:u.mintA,mintB:u.mintB,ammConfig:E(R({},u.config),{id:new Lt(u.config.id),fundOwner:""}),currentPrice:new O(u.price),exBitmapInfo:a[dt(new Lt(u.programId),new Lt(u.id)).publicKey.toBase58()],startTime:n[u.id].startTime.toNumber()})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};function Xk({poolInfo:o,tickLower:e,tickUpper:t,amountA:n,amountB:r,slippage:i,add:s,epochInfo:a,amountHasFee:c}){var w,k,I,T;let[u,l,m,d]=e<t?[e,t,n,r]:[t,e,r,n],p=ee.priceToSqrtPriceX64(new O(o.price),o.mintA.decimals,o.mintB.decimals),y=ee.getSqrtPriceX64FromTick(u),f=ee.getSqrtPriceX64FromTick(l),[b,g]=[ye(m,(w=o.mintA.extensions)==null?void 0:w.feeConfig,a,!c),ye(d,(k=o.mintB.extensions)==null?void 0:k.feeConfig,a,!c)],A=me.getLiquidityFromTokenAmounts(p,y,f,b.amount.sub((I=b.fee)!=null?I:pe),g.amount.sub((T=g.fee)!=null?T:pe));return me.getAmountsOutFromLiquidity({poolInfo:o,tickLower:e,tickUpper:t,liquidity:A,slippage:i,add:s,epochInfo:a,amountAddFee:!c})}var Ts={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]};function Xu(o){return E(R({},o),{type:"Concentrated",programId:o.programId.toString(),id:o.id.toString(),rewardDefaultInfos:[],rewardDefaultPoolInfos:"Clmm",price:o.currentPrice.toNumber(),mintAmountA:0,mintAmountB:0,feeRate:o.ammConfig.tradeFeeRate,openTime:o.startTime.toString(),tvl:0,day:Ts,week:Ts,month:Ts,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,burnPercent:0,config:E(R({},o.ammConfig),{id:o.ammConfig.id.toString(),defaultRange:0,defaultRangePoint:[]})})}var ne=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),i=r.div(n);return r.mod(n).eq(pe)||(i=i.add(bt)),i}static mulDivFloor(e,t,n){if(n.eq(pe))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(pe))throw new Error("division by 0");return e.mul(t).add(n.sub(bt)).div(n)}static x64ToDecimal(e,t){return new O(e.toString()).div(O.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new se(e.mul(O.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Mr).sub(t).mod(Mr)}};function ze(o,e){return Is(o.mul(e),64,256)}function kp(o,e,t){let n=o.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Is(o,e,t){let n=o.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var ee=class{static sqrtPriceX64ToPrice(e,t,n){return ne.x64ToDecimal(e).pow(2).mul(O.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return ne.decimalToX64(e.mul(O.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(pe))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(pe))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(pe))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(pe))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(pe))return e;let i=t.shln(Lo);if(r){let s=i,a=i.add(n.mul(e));return a.gte(s)?ne.mulDivCeil(s,e,a):ne.mulDivRoundingUp(s,bt,s.div(e).add(n))}else{let s=n.mul(e);if(!i.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=i.sub(s);return ne.mulDivCeil(i,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let i=n.shln(Lo);if(r)return e.add(i.div(t));{let s=ne.mulDivRoundingUp(i,bt,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<et||e>it)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new se("18445821805675395072"):new se("18446744073709551616");return(t&2)!=0&&(n=ze(n,new se("18444899583751176192"))),(t&4)!=0&&(n=ze(n,new se("18443055278223355904"))),(t&8)!=0&&(n=ze(n,new se("18439367220385607680"))),(t&16)!=0&&(n=ze(n,new se("18431993317065453568"))),(t&32)!=0&&(n=ze(n,new se("18417254355718170624"))),(t&64)!=0&&(n=ze(n,new se("18387811781193609216"))),(t&128)!=0&&(n=ze(n,new se("18329067761203558400"))),(t&256)!=0&&(n=ze(n,new se("18212142134806163456"))),(t&512)!=0&&(n=ze(n,new se("17980523815641700352"))),(t&1024)!=0&&(n=ze(n,new se("17526086738831433728"))),(t&2048)!=0&&(n=ze(n,new se("16651378430235570176"))),(t&4096)!=0&&(n=ze(n,new se("15030750278694412288"))),(t&8192)!=0&&(n=ze(n,new se("12247334978884435968"))),(t&16384)!=0&&(n=ze(n,new se("8131365268886854656"))),(t&32768)!=0&&(n=ze(n,new se("3584323654725218816"))),(t&65536)!=0&&(n=ze(n,new se("696457651848324352"))),(t&131072)!=0&&(n=ze(n,new se("26294789957507116"))),(t&262144)!=0&&(n=ze(n,new se("37481735321082"))),e>0&&(n=Lu.div(n)),n}static getTickFromPrice(e,t,n){return ee.getTickFromSqrtPriceX64(ee.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(kt)||e.lt(ht))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new se(t-64),r=kp(n,32,128),i=new se("8000000000000000","hex"),s=0,a=new se(0),c=t>=64?e.shrn(t-63):e.shln(63-t);for(;i.gt(new se(0))&&s<Ou;){c=c.mul(c);let y=c.shrn(127);c=c.shrn(63+y.toNumber()),a=a.add(i.mul(y)),i=i.shrn(1),s+=1}let u=a.shrn(32),m=r.add(u).mul(new se(Nu)),d=Is(m.sub(new se(Mu)),64,128).toNumber(),p=Is(m.add(new se(_u)),64,128).toNumber();return d==p?d:ee.getSqrtPriceX64FromTick(p).lte(e)?p:d}},Tn=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=ee.getTickFromSqrtPriceX64(ee.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let i=Tn.getTickWithPriceAndTickspacing(e,t,n,r),s=ee.getSqrtPriceX64FromTick(i);return ee.sqrtPriceX64ToPrice(s,n,r)}},me=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(pe))throw new Error("sqrtPriceX64A must greater than 0");let i=n.ushln(Lo),s=t.sub(e);return r?ne.mulDivRoundingUp(ne.mulDivCeil(i,s,t),bt,e):ne.mulDivFloor(i,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(pe))throw new Error("sqrtPriceX64A must greater than 0");return r?ne.mulDivCeil(n,t.sub(e),gt):ne.mulDivFloor(n,t.sub(e),gt)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let i=n.mul(e).mul(t),s=t.sub(e),a=i.div(s);return r?ne.mulDivRoundingUp(a,bt,gs):a.shrn(Lo)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),ne.mulDivFloor(n,gs,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,i){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return me.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=me.getLiquidityFromTokenAmountA(e,n,r,!1),a=me.getLiquidityFromTokenAmountB(t,e,i);return s.lt(a)?s:a}else return me.getLiquidityFromTokenAmountB(t,n,i)}static getAmountsFromLiquidity(e,t,n,r,i){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:me.getTokenAmountAFromLiquidity(t,n,r,i),amountB:new se(0)};if(e.lt(n)){let s=me.getTokenAmountAFromLiquidity(e,n,r,i),a=me.getTokenAmountBFromLiquidity(t,e,r,i);return{amountA:s,amountB:a}}else return{amountA:new se(0),amountB:me.getTokenAmountBFromLiquidity(t,n,r,i)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,i,s,a){let{amountA:c,amountB:u}=me.getAmountsFromLiquidity(e,t,n,r,s),l=i?1+a:1-a,m=new se(new O(c.toString()).mul(l).toFixed(0)),d=new se(new O(u.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:i,add:s,epochInfo:a,amountAddFee:c}){var A,w,k,I;let u=ee.priceToSqrtPriceX64(new O(e.price),e.mintA.decimals,e.mintB.decimals),l=ee.getSqrtPriceX64FromTick(t),m=ee.getSqrtPriceX64FromTick(n),d=s?1+i:1-i,p=me.getAmountsFromLiquidity(u,l,m,r,s),[y,f]=[ye(p.amountA,(A=e.mintA.extensions)==null?void 0:A.feeConfig,a,c),ye(p.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,a,c)],[b,g]=[ye(new se(new O(p.amountA.toString()).mul(d).toFixed(0)),(k=e.mintA.extensions)==null?void 0:k.feeConfig,a,c),ye(new se(new O(p.amountB.toString()).mul(d).toFixed(0)),(I=e.mintB.extensions)==null?void 0:I.feeConfig,a,c)];return{liquidity:r,amountA:y,amountB:f,amountSlippageA:b,amountSlippageB:g,expirationTime:Ct(y.expirationTime,f.expirationTime)}}},hn=class{static swapCompute(e,t,n,r,i,s,a,c,u,l,m,d,p,y,f=!1){if(d.eq(pe))throw new Error("amountSpecified must not be 0");if(y||(y=s?ht.add(bt):kt.sub(bt)),s){if(y.lt(ht))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(y.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(y.gt(kt))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(y.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let b=d.gt(pe),g={amountSpecifiedRemaining:d,amountCalculated:pe,sqrtPriceX64:m,tick:u>p?Math.min(p+de.tickCount(l)-1,u):p,accounts:[],liquidity:c,feeAmount:new se(0)},A=p,w=n[p],k=0,I=!s&&w.startTickIndex===g.tick;for(;!g.amountSpecifiedRemaining.eq(pe)&&!g.sqrtPriceX64.eq(y);){k>10;let T={};T.sqrtPriceStartX64=g.sqrtPriceX64;let S=j.nextInitTick(w,g.tick,l,s,I),B=S||null,C=null;if(!(B!=null&&B.liquidityGross.gtn(0))){let L=Ce.nextInitializedTickArrayStartIndex({tickCurrent:g.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:i},A,s);if(!L.isExist){if(f)return{allTrade:!1,amountSpecifiedRemaining:g.amountSpecifiedRemaining,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts};throw Error("swapCompute LiquidityInsufficient")}A=L.nextStartIndex;let{publicKey:W}=we(e,t,A);C=W,w=n[A];try{B=j.firstInitializedTick(w,s)}catch{throw Error("not found next tick info")}}T.tickNext=B.tick,T.initialized=B.liquidityGross.gtn(0),p!==A&&C&&(g.accounts.push(C),p=A),T.tickNext<et?T.tickNext=et:T.tickNext>it&&(T.tickNext=it),T.sqrtPriceNextX64=ee.getSqrtPriceX64FromTick(T.tickNext);let x;if(s&&T.sqrtPriceNextX64.lt(y)||!s&&T.sqrtPriceNextX64.gt(y)?x=y:x=T.sqrtPriceNextX64,[g.sqrtPriceX64,T.amountIn,T.amountOut,T.feeAmount]=hn.swapStepCompute(g.sqrtPriceX64,x,g.liquidity,g.amountSpecifiedRemaining,a),g.feeAmount=g.feeAmount.add(T.feeAmount),b?(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.sub(T.amountIn.add(T.feeAmount)),g.amountCalculated=g.amountCalculated.sub(T.amountOut)):(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.add(T.amountOut),g.amountCalculated=g.amountCalculated.add(T.amountIn.add(T.feeAmount))),g.sqrtPriceX64.eq(T.sqrtPriceNextX64)){if(T.initialized){let L=B.liquidityNet;s&&(L=L.mul(Gt)),g.liquidity=me.addDelta(g.liquidity,L)}I=T.tickNext!=g.tick&&!s&&w.startTickIndex===T.tickNext,g.tick=s?T.tickNext-1:T.tickNext}else if(g.sqrtPriceX64!=T.sqrtPriceStartX64){let L=ee.getTickFromSqrtPriceX64(g.sqrtPriceX64);I=L!=g.tick&&!s&&w.startTickIndex===L,g.tick=L}++k}try{let{nextStartIndex:T,isExist:S}=de.nextInitializedTickArray(g.tick,l,s,r,i);S&&p!==T&&(g.accounts.push(we(e,t,T).publicKey),p=T)}catch{}return{allTrade:!0,amountSpecifiedRemaining:pe,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts}}static swapStepCompute(e,t,n,r,i){let s={sqrtPriceX64Next:new se(0),amountIn:new se(0),amountOut:new se(0),feeAmount:new se(0)},a=e.gte(t),c=r.gte(pe);if(c){let l=ne.mulDivFloor(r,Vr.sub(new se(i.toString())),Vr);s.amountIn=a?me.getTokenAmountAFromLiquidity(t,e,n,!0):me.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=ee.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?me.getTokenAmountBFromLiquidity(t,e,n,!1):me.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(Gt).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=ee.getNextSqrtPriceX64FromOutput(e,n,r.mul(Gt),a);let u=t.eq(s.sqrtPriceX64Next);return a?(u&&c||(s.amountIn=me.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),u&&!c||(s.amountOut=me.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=u&&c?s.amountIn:me.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=u&&!c?s.amountOut:me.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!c&&s.amountOut.gt(r.mul(Gt))&&(s.amountOut=r.mul(Gt)),c&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=ne.mulDivCeil(s.amountIn,new se(i),Vr.sub(new se(i))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var Ue=60,Pn=512,j=class{static getTickArrayAddressByTick(e,t,n,r){let i=j.getTickArrayStartIndexByTick(n,r),{publicKey:s}=we(e,t,i);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=j.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=Ue)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=de.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*de.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*Ue,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*Ue,i=Math.floor(t/r)+512,s=Math.abs(i);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*Ue:e+t*Ue}static mergeTickArrayBitmap(e){let t=new Tp(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,i){let s=Math.floor(r/(n*Ue));return[...j.searchLowBitFromStart(e,t,s-1,i,n),...j.searchHightBitFromStart(e,t,s,i,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return j.searchHightBitFromStart(e,t,0,Pn,n)}static getAllInitializedTickArrayInfo(e,t,n,r,i){let s=[],a=j.getAllInitializedTickArrayStartIndex(n,r,i);for(let c of a){let{publicKey:u}=we(e,t,c);s.push({tickArrayStartIndex:c,tickArrayAddress:u})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,i){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>j.mergeTickArrayBitmap(u)),a=[];for(;n>=-7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n--,a.length===r)break}let c=de.tickCount(i);return a.map(u=>u*c)}static searchHightBitFromStart(e,t,n,r,i){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>j.mergeTickArrayBitmap(u)),a=[];for(;n<7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n++,a.length===r)break}let c=de.tickCount(i);return a.map(u=>u*c)}static checkIsOutOfBoundary(e){return e<et||e>it}static nextInitTick(e,t,n,r,i){if(de.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(i||(a=a+1);a<Ue;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=Ue-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<Ue;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=ee.getSqrtPriceX64FromTick(t),i=ee.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:i,tickSqrtPriceX64:r}:{tick:t,price:new O(1).div(i),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new O(1).div(t),i=Tn.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=ee.getSqrtPriceX64FromTick(i),a=ee.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:i,price:a}:{tick:i,price:new O(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=ee.getSqrtPriceX64FromTick(t),i=ee.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:i,tickSqrtPriceX64:r}:{tick:t,price:new O(1).div(i),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new O(1).div(t),i=Tn.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=ee.getSqrtPriceX64FromTick(i),a=ee.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:i,price:a}:{tick:i,price:new O(1).div(a)}}};var Qu=_([Ae(8),D("bump"),Dt("index"),K(""),He("protocolFeeRate"),He("tradeFeeRate"),Dt("tickSpacing"),G(P(),8,"")]),Ip=_([He("blockTimestamp"),Wn("tickCumulative"),G(P(),4)]),Yu=_([Ae(8),Ze("initialized"),P("recentEpoch"),Dt("observationIndex"),K("poolId"),G(Ip,100,"observations"),G(P(),4)]),Bp=_([D("rewardState"),P("openTime"),P("endTime"),P("lastUpdateTime"),J("emissionsPerSecondX64"),P("rewardTotalEmissioned"),P("rewardClaimed"),K("tokenMint"),K("tokenVault"),K("creator"),J("rewardGrowthGlobalX64")]),kn=_([Ae(8),D("bump"),K("ammConfig"),K("creator"),K("mintA"),K("mintB"),K("vaultA"),K("vaultB"),K("observationId"),D("mintDecimalsA"),D("mintDecimalsB"),Dt("tickSpacing"),J("liquidity"),J("sqrtPriceX64"),je("tickCurrent"),He(),J("feeGrowthGlobalX64A"),J("feeGrowthGlobalX64B"),P("protocolFeesTokenA"),P("protocolFeesTokenB"),J("swapInAmountTokenA"),J("swapOutAmountTokenB"),J("swapInAmountTokenB"),J("swapOutAmountTokenA"),D("status"),G(D(),7,""),G(Bp,3,"rewardInfos"),G(P(),16,"tickArrayBitmap"),P("totalFeesTokenA"),P("totalFeesClaimedTokenA"),P("totalFeesTokenB"),P("totalFeesClaimedTokenB"),P("fundFeesTokenA"),P("fundFeesTokenB"),P("startTime"),G(P(),15*4-3,"padding")]),xp=_([J("growthInsideLastX64"),P("rewardAmountOwed")]),Dr=_([Ae(8),D("bump"),K("nftMint"),K("poolId"),je("tickLower"),je("tickUpper"),J("liquidity"),J("feeGrowthInsideLastX64A"),J("feeGrowthInsideLastX64B"),P("tokenFeesOwedA"),P("tokenFeesOwedB"),G(xp,3,"rewardInfos"),G(P(),8,"")]),yT=_([Ae(8),D("bump"),K("poolId"),je("tickLowerIndex"),je("tickUpperIndex"),J("liquidity"),J("feeGrowthInsideLastX64A"),J("feeGrowthInsideLastX64B"),P("tokenFeesOwedA"),P("tokenFeesOwedB"),G(J(),3,"rewardGrowthInside"),G(P(),8,"")]),Sp=_([je("tick"),cu("liquidityNet"),J("liquidityGross"),J("feeGrowthOutsideX64A"),J("feeGrowthOutsideX64B"),G(J(),3,"rewardGrowthsOutsideX64"),G(He(),13,"")]),_o=_([Ae(8),K("poolId"),je("startTickIndex"),G(Sp,Ue,"ticks"),D("initializedTickCount"),G(D(),115,"")]),ju=_([Ae(329),G(K(),100,"whitelistMints")]),zu=_([Ae(8),K("poolId"),G(G(P(),8),ks,"positiveTickArrayBitmap"),G(G(P(),8),ks,"negativeTickArrayBitmap")]),bT=_([P(),D("bump"),K("owner"),K("poolId"),K("positionId"),K("nftAccount"),G(P(),8)]);Yu.span;var $u=ce("Raydium_Clmm"),Ot={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Kp=[188,37,179,131,82,150,84,73],Cp=[16,72,250,198,14,162,212,19],Te=class{static createPoolInstruction(e,t,n,r,i,s,a,c,u,l,m,d,p,y){let f=_([J("sqrtPriceX64"),P("startTime")]),b=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:Xn.programId,isSigner:!1,isWritable:!1},{pubkey:ut,isSigner:!1,isWritable:!1}],g=Buffer.alloc(f.span);f.encode({sqrtPriceX64:p,startTime:y},g);let A=Buffer.from([...Ot.createPool,...g]);return new At({keys:b,programId:e,data:A})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:i,ammConfigId:s,initialPriceX64:a,startTime:c}=e,[u,l]=[new U(r.address),new U(i.address)],{publicKey:m}=Wu(t,s,u,l),{publicKey:d}=Uu(t,m),{publicKey:p}=Ps(t,m,u),{publicKey:y}=Ps(t,m,l),f=[this.createPoolInstruction(t,m,n,s,d,u,p,new U(r.programId||ve),l,y,new U(i.programId||ve),dt(t,m).publicKey,a,c)];return{signers:[],instructions:f,instructionTypes:[F.CreateAccount,F.ClmmCreatePool],address:{poolId:m,observationId:d,mintAVault:p,mintBVault:y},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,i,s,a,c,u,l,m,d,p,y,f,b,g,A,w,k,I,T,S,B,C,x){let L=_([je("tickLowerIndex"),je("tickUpperIndex"),je("tickArrayLowerStartIndex"),je("tickArrayUpperStartIndex"),J("liquidity"),P("amountMaxA"),P("amountMaxB"),Ze("withMetadata"),D("optionBaseFlag"),Ze("baseFlag")]),W=[...x?[{pubkey:x,isSigner:!1,isWritable:!0}]:[]],v=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:ut,isSigner:!1,isWritable:!1},{pubkey:Xn.programId,isSigner:!1,isWritable:!1},{pubkey:ve,isSigner:!1,isWritable:!1},{pubkey:Zu,isSigner:!1,isWritable:!1},{pubkey:Vn,isSigner:!1,isWritable:!1},{pubkey:zt,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...W],$=Buffer.alloc(L.span);L.encode({tickLowerIndex:A,tickUpperIndex:w,tickArrayLowerStartIndex:k,tickArrayUpperStartIndex:I,liquidity:T,amountMaxA:S,amountMaxB:B,withMetadata:C==="create",baseFlag:!1,optionBaseFlag:0},$);let X=Buffer.from([...Ot.openPosition,...$]);return new At({keys:v,programId:e,data:X})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:i,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l}){let m=[],[d,p]=[new U(e.programId),new U(e.id)],y;if(l)y=new U((await l(1))[0]);else{let B=Bs.generate();m.push(B),y=B.publicKey}let f=j.getTickArrayStartIndexByTick(r,e.config.tickSpacing),b=j.getTickArrayStartIndexByTick(i,e.config.tickSpacing),{publicKey:g}=we(d,p,f),{publicKey:A}=we(d,p,b),{publicKey:w}=ge(n.wallet,y,ve),{publicKey:k}=Er(y),{publicKey:I}=mt(d,y),{publicKey:T}=ln(d,p,r,i),S=this.openPositionFromLiquidityInstruction(d,n.feePayer,p,n.wallet,y,w,k,T,g,A,I,n.tokenAccountA,n.tokenAccountB,new U(t.vault.A),new U(t.vault.B),new U(e.mintA.address),new U(e.mintB.address),r,i,f,b,s,a,c,u);return{signers:m,instructions:[S],instructionTypes:[F.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:y,tickArrayLower:g,tickArrayUpper:A,positionNftAccount:w,metadataAccount:k,personalPosition:I,protocolPosition:T}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:i,base:s,baseAmount:a,otherAmountMax:c,withMetadata:u,getEphemeralSigners:l}){let m=[],[d,p]=[new U(e.programId),new U(e.id)],y;if(l)y=new U((await l(1))[0]);else{let B=Bs.generate();m.push(B),y=B.publicKey}let f=j.getTickArrayStartIndexByTick(r,e.config.tickSpacing),b=j.getTickArrayStartIndexByTick(i,e.config.tickSpacing),{publicKey:g}=we(d,p,f),{publicKey:A}=we(d,p,b),{publicKey:w}=ge(n.wallet,y,ve),{publicKey:k}=Er(y),{publicKey:I}=mt(d,y),{publicKey:T}=ln(d,p,r,i),S=this.openPositionFromBaseInstruction(d,n.feePayer,p,n.wallet,y,w,k,T,g,A,I,n.tokenAccountA,n.tokenAccountB,new U(t.vault.A),new U(t.vault.B),new U(e.mintA.address),new U(e.mintB.address),r,i,f,b,u,s,a,c,Ce.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,b])?dt(d,p).publicKey:void 0);return{address:{nftMint:y,tickArrayLower:g,tickArrayUpper:A,positionNftAccount:w,metadataAccount:k,personalPosition:I,protocolPosition:T},instructions:[S],signers:m,instructionTypes:[F.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,i,s,a,c,u,l,m,d,p,y,f,b,g,A,w,k,I,T,S,B,C,x){let L=_([je("tickLowerIndex"),je("tickUpperIndex"),je("tickArrayLowerStartIndex"),je("tickArrayUpperStartIndex"),J("liquidity"),P("amountMaxA"),P("amountMaxB"),Ze("withMetadata"),D("optionBaseFlag"),Ze("baseFlag")]),W=[...x?[{pubkey:x,isSigner:!1,isWritable:!0}]:[]],v=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:ut,isSigner:!1,isWritable:!1},{pubkey:Xn.programId,isSigner:!1,isWritable:!1},{pubkey:ve,isSigner:!1,isWritable:!1},{pubkey:Zu,isSigner:!1,isWritable:!1},{pubkey:Vn,isSigner:!1,isWritable:!1},{pubkey:zt,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...W],$=Buffer.alloc(L.span);L.encode({tickLowerIndex:A,tickUpperIndex:w,tickArrayLowerStartIndex:k,tickArrayUpperStartIndex:I,liquidity:new Hu(0),amountMaxA:S==="MintA"?B:C,amountMaxB:S==="MintA"?C:B,withMetadata:T==="create",baseFlag:S==="MintA",optionBaseFlag:1},$);let X=Buffer.from([...Ot.openPosition,...$]);return new At({keys:v,programId:e,data:X})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:i,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l}){let m,d=[];if(l)m=new U((await l(1))[0]);else{let B=Bs.generate();d.push(B),m=B.publicKey}let[p,y]=[new U(e.programId),new U(e.id)],f=j.getTickArrayStartIndexByTick(r,e.config.tickSpacing),b=j.getTickArrayStartIndexByTick(i,e.config.tickSpacing),{publicKey:g}=we(p,y,f),{publicKey:A}=we(p,y,b),{publicKey:w}=ge(n.wallet,m,ve),{publicKey:k}=Er(m),{publicKey:I}=mt(p,m),{publicKey:T}=ln(p,y,r,i),S=this.openPositionFromLiquidityInstruction(p,n.wallet,y,n.wallet,m,w,k,T,g,A,I,n.tokenAccountA,n.tokenAccountB,new U(t.vault.A),new U(t.vault.B),new U(t.mintA.address),new U(t.mintB.address),r,i,f,b,s,a,c,u,Ce.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,b])?dt(p,y).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:g,tickArrayUpper:A,positionNftAccount:w,metadataAccount:k,personalPosition:I,protocolPosition:T},instructions:[S],signers:d,instructionTypes:[F.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,i){let s=_([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:Xn.programId,isSigner:!1,isWritable:!1},{pubkey:ve,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);s.encode({},c);let u=Buffer.from([...Ot.closePosition,...c]);return new At({keys:a,programId:e,data:u})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let i=new U(e.programId),{publicKey:s}=ge(n.wallet,r.nftMint,ve),{publicKey:a}=mt(i,r.nftMint),c=[];return c.push(this.closePositionInstruction(i,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:c,instructionTypes:[F.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,i,s,a,c,u,l,m,d,p,y,f,b,g,A){let w=_([J("liquidity"),P("amountMaxA"),P("amountMaxB"),D("optionBaseFlag"),Ze("baseFlag")]),k=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],I=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ve,isSigner:!1,isWritable:!1},{pubkey:zt,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...k],T=Buffer.alloc(w.span);w.encode({liquidity:f,amountMaxA:b,amountMaxB:g,optionBaseFlag:0,baseFlag:!1},T);let S=Buffer.from([...Ot.increaseLiquidity,...T]);return new At({keys:I,programId:e,data:S})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:i,amountMaxA:s,amountMaxB:a}){let[c,u]=[new U(e.programId),new U(e.id)],l=j.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=j.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=we(c,u,l),{publicKey:p}=we(c,u,m),{publicKey:y}=ge(r.wallet,n.nftMint,ve),{publicKey:f}=mt(c,n.nftMint),{publicKey:b}=ln(c,u,n.tickLower,n.tickUpper),g=this.increasePositionFromLiquidityInstruction(c,r.wallet,y,f,u,b,d,p,r.tokenAccountA,r.tokenAccountB,new U(t.vault.A),new U(t.vault.B),new U(e.mintA.address),new U(e.mintB.address),i,s,a,Ce.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?dt(c,u).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:y,personalPosition:f,protocolPosition:b},signers:[],instructions:[g],instructionTypes:[F.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:i,baseAmount:s,otherAmountMax:a}){let[c,u]=[new U(e.programId),new U(e.id)],l=j.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=j.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=we(c,u,l),{publicKey:p}=we(c,u,m),{publicKey:y}=ge(r.wallet,n.nftMint,ve),{publicKey:f}=mt(c,n.nftMint),{publicKey:b}=ln(c,u,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:y,personalPosition:f,protocolPosition:b},instructions:[this.increasePositionFromBaseInstruction(c,r.wallet,y,f,u,b,d,p,r.tokenAccountA,r.tokenAccountB,new U(t.vault.A),new U(t.vault.B),new U(e.mintA.address),new U(e.mintB.address),i,s,a,Ce.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?dt(c,u).publicKey:void 0)],signers:[],instructionTypes:[F.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,i,s,a,c,u,l,m,d,p,y,f,b,g,A){let w=_([J("liquidity"),P("amountMaxA"),P("amountMaxB"),D("optionBaseFlag"),Ze("baseFlag")]),k=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],I=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ve,isSigner:!1,isWritable:!1},{pubkey:zt,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...k],T=Buffer.alloc(w.span);w.encode({liquidity:new Hu(0),amountMaxA:f==="MintA"?b:g,amountMaxB:f==="MintA"?g:b,baseFlag:f==="MintA",optionBaseFlag:1},T);let S=Buffer.from([...Ot.increaseLiquidity,...T]);return new At({keys:I,programId:e,data:S})}static decreaseLiquidityInstruction(e,t,n,r,i,s,a,c,u,l,m,d,p,y,f,b,g,A,w){let k=_([J("liquidity"),P("amountMinA"),P("amountMinB")]),I=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...f.map(C=>[{pubkey:C.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:C.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:C.rewardMint,isSigner:!1,isWritable:!1}]).flat()],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:ve,isSigner:!1,isWritable:!1},{pubkey:zt,isSigner:!1,isWritable:!1},{pubkey:mr,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...I],S=Buffer.alloc(k.span);k.encode({liquidity:b,amountMinA:g,amountMinB:A},S);let B=Buffer.from([...Ot.decreaseLiquidity,...S]);return new At({keys:T,programId:e,data:B})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:i,amountMinA:s,amountMinB:a,programId:c}){let[u,l]=[new U(e.programId),new U(e.id)],m=j.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=j.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=we(u,l,m),{publicKey:y}=we(u,l,d),{publicKey:f}=ge(r.wallet,n.nftMint,c),{publicKey:b}=mt(u,n.nftMint),{publicKey:g}=ln(u,l,n.tickLower,n.tickUpper),A=[];for(let I=0;I<e.rewardDefaultInfos.length;I++)A.push({poolRewardVault:new U(t.rewardInfos[I].vault),ownerRewardVault:r.rewardAccounts[I],rewardMint:new U(e.rewardDefaultInfos[I].mint.address)});let w=[],k=this.decreaseLiquidityInstruction(u,r.wallet,f,b,l,g,p,y,r.tokenAccountA,r.tokenAccountB,new U(t.vault.A),new U(t.vault.B),new U(e.mintA.address),new U(e.mintB.address),A,i,s,a,Ce.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?dt(u,l).publicKey:void 0);return w.push(k),{address:{tickArrayLower:p,tickArrayUpper:y,positionNftAccount:f,personalPosition:b,protocolPosition:g},signers:[],instructions:w,instructionTypes:[F.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,i,s,a,c,u,l,m,d,p,y,f,b,g){let A=_([P("amount"),P("otherAmountThreshold"),J("sqrtPriceLimitX64"),Ze("isBaseInput")]),w=[...g?[{pubkey:g,isSigner:!1,isWritable:!0}]:[],...m.map(S=>({pubkey:S,isSigner:!1,isWritable:!0}))],k=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ve,isSigner:!1,isWritable:!1},{pubkey:zt,isSigner:!1,isWritable:!1},{pubkey:mr,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...w],I=Buffer.alloc(A.span);A.encode({amount:p,otherAmountThreshold:y,sqrtPriceLimitX64:f,isBaseInput:b},I);let T=Buffer.from([...Ot.swap,...I]);return new At({keys:k,programId:e,data:T})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:i,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[l,m]=[new U(e.programId),new U(e.id)],[d,p]=[new U(t.vault.A),new U(t.vault.B)],[y,f]=[new U(e.mintA.address),new U(e.mintB.address)],b=e.mintA.address===i.toString(),g=[this.swapInstruction(l,r.wallet,m,new U(e.config.id),b?r.tokenAccountA:r.tokenAccountB,b?r.tokenAccountB:r.tokenAccountA,b?d:p,b?p:d,b?y:f,b?f:y,u,n,s,a,c,!0,dt(l,m).publicKey)];return{signers:[],instructions:g,instructionTypes:[F.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:i,amountOut:s,amountInMax:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[l,m]=[new U(e.programId),new U(e.id)],[d,p]=[new U(t.vault.A),new U(t.vault.B)],[y,f]=[new U(e.mintA.address),new U(e.mintB.address)],b=e.mintA.address===i.toBase58(),g=[this.swapInstruction(l,r.wallet,m,new U(e.config.id),b?r.tokenAccountB:r.tokenAccountA,b?r.tokenAccountA:r.tokenAccountB,b?p:d,b?d:p,b?f:y,b?y:f,u,n,s,a,c,!1,dt(l,m).publicKey)];return{signers:[],instructions:g,instructionTypes:[F.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,i,s,a,c,u,l,m,d){let p=_([P("openTime"),P("endTime"),J("emissionsPerSecondX64")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Xn.programId,isSigner:!1,isWritable:!1},{pubkey:ut,isSigner:!1,isWritable:!1}],f=Buffer.alloc(p.span);p.encode({openTime:z(l),endTime:z(m),emissionsPerSecondX64:d},f);let b=Buffer.from([...Ot.initReward,...f]);return new At({keys:y,programId:e,data:b})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[i,s]=[new U(e.programId),new U(e.id)],a=qu(i,s,r.mint).publicKey,c=No(i).publicKey,u=[this.initRewardInstruction(i,n.wallet,s,c,new U(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:c},signers:[],instructions:u,instructionTypes:[F.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,i,s,a,c,u,l,m,d){let p=_([D("rewardIndex"),J("emissionsPerSecondX64"),P("openTime"),P("endTime")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:ve,isSigner:!1,isWritable:!1},{pubkey:zt,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0}],f=Buffer.alloc(p.span);p.encode({rewardIndex:u,emissionsPerSecondX64:d,openTime:z(l),endTime:z(m)},f);let b=Buffer.from([...Ot.setRewardEmissions,...f]);return new At({keys:y,programId:e,data:b})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[i,s]=[new U(e.programId),new U(e.id)],a,c,u;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===r.mint.toString()&&(a=d,c=new U(t.rewardInfos[d].vault),u=new U(t.rewardInfos[d].mint.address));(a===void 0||c===void 0)&&$u.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=No(i).publicKey,m=[this.setRewardInstruction(i,n.wallet,s,l,new U(e.config.id),n.tokenAccount,c,u,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:c,operationId:l},signers:[],instructions:m,instructionTypes:[F.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,i,s,a){let c=_([D("rewardIndex")]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:ve,isSigner:!1,isWritable:!1},{pubkey:zt,isSigner:!1,isWritable:!1},{pubkey:mr,isSigner:!1,isWritable:!1}],l=Buffer.alloc(c.span);c.encode({rewardIndex:a},l);let m=Buffer.from([...Ot.collectReward,...l]);return new At({keys:u,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[i,s]=[new U(e.programId),new U(e.id)],a,c;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,c=new U(t.rewardInfos[l].vault));(a===void 0||c===void 0)&&$u.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let u=[this.collectRewardInstruction(i,n.wallet,s,n.tokenAccount,c,r,a)];return{address:{rewardVault:c},signers:[],instructions:u,instructionTypes:[F.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:r,positionNft:i}){let{publicKey:s}=ge(r,i,ve),{publicKey:a}=mt(n,i),c=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:hs(e,a).publicKey,isSigner:!1,isWritable:!0},{pubkey:ve,isSigner:!1,isWritable:!1},{pubkey:Xn.programId,isSigner:!1,isWritable:!1}];return new At({keys:c,programId:e,data:Buffer.from(Kp)})}static harvestLockPositionInstruction(e){let[t,n]=[new U(e.poolKeys.programId),new U(e.poolKeys.id)],r=j.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),i=j.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:s}=we(t,n,r),{publicKey:a}=we(t,n,i),{publicKey:c}=ge(e.owner,e.ownerPosition.nftMint,ve),{publicKey:u}=mt(t,e.ownerPosition.nftMint),{publicKey:l}=ln(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),m=[];for(let y=0;y<e.poolKeys.rewardInfos.length;y++)m.push({poolRewardVault:new U(e.poolKeys.rewardInfos[y].vault),ownerRewardVault:e.ownerRewardAccounts[y],rewardMint:new U(e.poolKeys.rewardInfos[y].mint.address)});let d=[...m.map(y=>[{pubkey:y.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:y.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:y.rewardMint,isSigner:!1,isWritable:!1}]).flat()],p=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:hs(e.programId,u).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:new U(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new U(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:ve,isSigner:!1,isWritable:!1},{pubkey:zt,isSigner:!1,isWritable:!1},{pubkey:vn,isSigner:!1,isWritable:!1},{pubkey:new U(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new U(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...d];return new At({keys:p,programId:e.programId,data:Buffer.from(Cp)})}};var OT=_([He("mintAuthorityOption"),K("mintAuthority"),P("supply"),D("decimals"),D("isInitialized"),He("freezeAuthorityOption"),K("freezeAuthority")]);import{PublicKey as Rp}from"@solana/web3.js";import{MintLayout as Ju,TOKEN_PROGRAM_ID as Lp}from"@solana/spl-token";var qT=async({connection:o,mint:e})=>{let t=await o.getAccountInfo(new Rp(e));return!t||t.data.length!==Ju.span?void 0:Ju.decode(t.data)},UT=({mint:o,decimals:e,programId:t=Lp,logoURI:n="",priority:r=3})=>{let i=o.toBase58().substring(0,6);return{address:o.toBase58(),decimals:e,symbol:i,logoURI:n,extensions:{},chainId:101,programId:t.toString(),name:i,tags:[],priority:r}},Wr=o=>new be({mint:o.address,decimals:o.decimals,symbol:o.symbol,name:o.name}),Vo=r=>{var i=r,{amount:o,isRaw:e,name:t}=i,n=Oe(i,["amount","isRaw","name"]);return new fe(new be({mint:ft(n.address).toBase58(),decimals:n.decimals,symbol:n.symbol,name:t}),o,e,t)};function GT(o){return o.address===Mt.address?De:o}function XT(o){return o.address===De.address?Mt:o}var st=r=>{var i=r,{address:o,programId:e,decimals:t}=i,n=Oe(i,["address","programId","decimals"]);return R({chainId:101,address:ft(o).toBase58(),programId:e,logoURI:"",symbol:"",name:"",decimals:t,tags:[],extensions:n.extensions||{}},n)},mn=o=>o?E(R({},o),{transferFeeConfigAuthority:o.transferFeeConfigAuthority.toBase58(),withdrawWithheldAuthority:o.withdrawWithheldAuthority.toBase58(),withheldAmount:o.withheldAmount.toString(),olderTransferFee:E(R({},o.olderTransferFee),{epoch:o.olderTransferFee.epoch.toString(),maximumFee:o.olderTransferFee.maximumFee.toString()}),newerTransferFee:E(R({},o.newerTransferFee),{epoch:o.newerTransferFee.epoch.toString(),maximumFee:o.newerTransferFee.maximumFee.toString()})}):void 0;import ec from"bn.js";var xs=new ec(25),qr=new ec(1e4),Op={4:3,5:3};import{PublicKey as he,SystemProgram as uc,SYSVAR_RENT_PUBKEY as zp,TransactionInstruction as Qt}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Qp,TOKEN_PROGRAM_ID as Yn}from"@solana/spl-token";var Ss=_([D("instruction"),P("amountIn"),P("minAmountOut")]),Ks=_([D("instruction"),P("maxAmountIn"),P("amountOut")]),nI=_([D("instruction"),D("nonce")]),Cs=_([D("instruction"),D("nonce"),P("startTime")]),Fo=_([P("status"),P("nonce"),P("maxOrder"),P("depth"),P("baseDecimal"),P("quoteDecimal"),P("state"),P("resetFlag"),P("minSize"),P("volMaxCutRatio"),P("amountWaveRatio"),P("baseLotSize"),P("quoteLotSize"),P("minPriceMultiplier"),P("maxPriceMultiplier"),P("systemDecimalValue"),P("minSeparateNumerator"),P("minSeparateDenominator"),P("tradeFeeNumerator"),P("tradeFeeDenominator"),P("pnlNumerator"),P("pnlDenominator"),P("swapFeeNumerator"),P("swapFeeDenominator"),P("baseNeedTakePnl"),P("quoteNeedTakePnl"),P("quoteTotalPnl"),P("baseTotalPnl"),P("poolOpenTime"),P("punishPcAmount"),P("punishCoinAmount"),P("orderbookToInitTime"),J("swapBaseInAmount"),J("swapQuoteOutAmount"),P("swapBase2QuoteFee"),J("swapQuoteInAmount"),J("swapBaseOutAmount"),P("swapQuote2BaseFee"),K("baseVault"),K("quoteVault"),K("baseMint"),K("quoteMint"),K("lpMint"),K("openOrders"),K("marketId"),K("marketProgramId"),K("targetOrders"),K("withdrawQueue"),K("lpVault"),K("owner"),P("lpReserve"),G(P(),3,"padding")]),Np=_([P("accountType"),P("status"),P("nonce"),P("maxOrder"),P("depth"),P("baseDecimal"),P("quoteDecimal"),P("state"),P("resetFlag"),P("minSize"),P("volMaxCutRatio"),P("amountWaveRatio"),P("baseLotSize"),P("quoteLotSize"),P("minPriceMultiplier"),P("maxPriceMultiplier"),P("systemDecimalsValue"),P("abortTradeFactor"),P("priceTickMultiplier"),P("priceTick"),P("minSeparateNumerator"),P("minSeparateDenominator"),P("tradeFeeNumerator"),P("tradeFeeDenominator"),P("pnlNumerator"),P("pnlDenominator"),P("swapFeeNumerator"),P("swapFeeDenominator"),P("baseNeedTakePnl"),P("quoteNeedTakePnl"),P("quoteTotalPnl"),P("baseTotalPnl"),P("poolOpenTime"),P("punishPcAmount"),P("punishCoinAmount"),P("orderbookToInitTime"),J("swapBaseInAmount"),J("swapQuoteOutAmount"),J("swapQuoteInAmount"),J("swapBaseOutAmount"),P("swapQuote2BaseFee"),P("swapBase2QuoteFee"),K("baseVault"),K("quoteVault"),K("baseMint"),K("quoteMint"),K("lpMint"),K("modelDataAccount"),K("openOrders"),K("marketId"),K("marketProgramId"),K("targetOrders"),K("owner"),G(P(),64,"padding")]),Rs=_([D("instruction"),P("baseAmountIn"),P("quoteAmountIn"),P("fixedSide"),P("otherAmountMin")]),Ls=_([D("instruction"),P("lpAmount"),P("baseAmountMin"),P("quoteAmountMin")]),oI={4:Fo,5:Np},tc=_([P("fee")]);import{PublicKey as Mp}from"@solana/web3.js";var Qn=new Mp("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Bn=5e4,_p=_([P("x"),P("y"),P("price")]),vp=_([P("accountType"),P("status"),P("multiplier"),P("validDataCount"),G(_p,Bn,"DataElement")]);function Vp(o,e){return[0,Bn-2]}function Fp(o){return[0,Bn-2]}function Ep(o){return[0,Bn-2]}function Dp(o,e,t){let[n,r]=Vp(e,t),i=n,s=r,a=0,c=e*o.multiplier/t;for(;i<=s;){if(a=Math.floor((s+i)/2),a===0||a>=Bn-2)return[a,a,!1];let u=o.DataElement[a].x*o.multiplier/o.DataElement[a].y,l=o.DataElement[a-1].x*o.multiplier/o.DataElement[a-1].y,m=o.DataElement[a+1].x*o.multiplier/o.DataElement[a+1].y;if(c===u)return[a,a,!0];if(c===l)return[a-1,a-1,!0];if(c===m)return[a+1,a+1,!0];if(c<l)s=a-1;else{if(c>l&&c<u)return[a-1,a,!0];if(c>u&&c<m)return[a,a+1,!0];i=a+1}}return[a,a,!1]}function Os(o,e,t){let[n,r,i]=Dp(o,e,t);if(!i)return 0;if(n===r){let s=o.DataElement[n].x;return e*o.multiplier/s}else{let s=o.DataElement[n].x,a=o.DataElement[n].y,c=o.DataElement[r].x,u=o.DataElement[r].y,l=t*(c*a-s*u),m=s*l,d=(c-s)*(e*a-s*t)*u,p=m+d;return e*o.multiplier*l/p}}function In(o,e,t){return e*o.multiplier/t}function nc(o,e,t){return e*t/o.multiplier}function Wp(o,e){let[t,n]=Fp(e),r=t,i=n,s=0,a=e;for(;r<i;){if(s=Math.floor((i+r)/2),s<=0||s>Bn-2)return[s,s,!1];let c=o.DataElement[s].x,u=o.DataElement[s-1].x,l=o.DataElement[s+1].x;if(a===c)return[s,s,!0];if(a===u)return[s-1,s-1,!0];if(a===l)return[s+1,s+1,!0];if(a<u)i=s-1;else{if(a>u&&a<c)return[s-1,s,!0];if(a>c&&a<l)return[s,s+1,!0];r=s+1}}return[s,s,!1]}function qp(o,e){let[t,n]=Ep(e),r=t,i=n,s=0,a=e;for(;r<=i;){if(s=Math.floor((i+r)/2),s<=0||s>=Bn-2)return[s,s,!1];let c=o.DataElement[s].y,u=o.DataElement[s-1].y,l=o.DataElement[s+1].y;if(a===c)return[s,s,!0];if(a===u)return[s-1,s-1,!0];if(a===l)return[s+1,s+1,!0];if(a<l)r=s+1;else{if(a<u&&a>c)return[s-1,s,!0];if(a<c&&a>l)return[s,s+1,!0];i=s-1}}return[s,s,!1]}function oc(o,e,t,n){let r=n?e+t:e-t,[i,s,a]=Wp(o,r);if(!a)return[0,0,!1,a];if(i===s)return[o.DataElement[s].price,o.DataElement[s].y,!1,a];{let c=o.DataElement[i].x,u=o.DataElement[s].x,l=o.DataElement[i].price,m=o.DataElement[s].price,d=o.DataElement[i].y,p=o.DataElement[s].y;if(e>=c&&e<=u)return n?[m,p,!0,a]:[l,d,!0,a];{let y,f;return n?(y=l+(m-l)*(e-c)/(u-c),f=d-(r-c)*o.multiplier/m):(y=l+(m-l)*(e-c)/(u-c),f=p+(u-r)*o.multiplier/l),[y,f,!1,a]}}}function Up(o,e,t,n){let r=n?e-t:e+t,[i,s,a]=qp(o,r);if(!a)return[0,0,!1,a];if(i===s)return[o.DataElement[s].price,o.DataElement[s].x,!1,a];{let c=o.DataElement[i].x,u=o.DataElement[s].x,l=o.DataElement[i].price,m=o.DataElement[s].price,d=o.DataElement[i].y,p=o.DataElement[s].y;if(e>=p&&e<=d)return n?[m,u,!0,a]:[l,c,!0,a];{let y,f;return n?(y=l+(m-l)*(d-e)/(d-p),f=c+m*(d-r)/o.multiplier):(y=l+(m-l)*(d-e)/(d-p),f=u-l*(r-p)/o.multiplier),[y,f,!1,a]}}}function Gp(o,e){let t=oc(o,e,0,!1);return t[3]?t[0]:0}function rc(o,e,t,n){let r=Os(o,e,t),i=In(o,e,r),s=In(o,t,r),a=In(o,n,r),c=!0,[u,l,m,d]=oc(o,i,a,c);if(!d)return 0;if(m)return n*o.multiplier/u;{let p=s-l;return nc(o,p,r)}}function ic(o,e,t,n){let r=Os(o,e,t),i=In(o,e,r),s=In(o,t,r),a=In(o,n,r),c=!1,[u,l,m,d]=Up(o,s,a,c);if(!d)return 0;if(m)return n*u/o.multiplier;{let p=i-l;return nc(o,p,r)}}function Xp(o){let e=vp.decode(o);return{accountType:e.accountType.toNumber(),status:e.status.toNumber(),multiplier:e.multiplier.toNumber(),validDataCount:e.validDataCount.toNumber(),DataElement:e.DataElement.map(t=>({x:t.x.toNumber(),y:t.y.toNumber(),price:t.price.toNumber()}))}}function sc(o,e,t,n){let r=Gp(o,In(o,e,Os(o,e,t)))/o.multiplier;return n?r:1/r}var zn=class{constructor({connection:e}){this._layoutData={accountType:0,status:0,multiplier:0,validDataCount:0,DataElement:[]};this.connection=e}get stableModelData(){return this._layoutData}async initStableModelLayout(){if(this._layoutData.validDataCount===0&&this.connection){let e=await this.connection.getAccountInfo(Qn);e&&(this._layoutData=Xp(e==null?void 0:e.data))}}};var ac=ce("Raydium_liquidity_instruction");function cc(o){let{poolInfo:e,poolKeys:t,userKeys:n,baseAmountIn:r,quoteAmountIn:i,fixedSide:s,otherAmountMin:a}=o,c=Buffer.alloc(Rs.span);Rs.encode({instruction:3,baseAmountIn:z(r),quoteAmountIn:z(i),otherAmountMin:z(a),fixedSide:s==="base"?qe:Ca},c);let u=[h({pubkey:Yn,isWritable:!1}),h({pubkey:new he(e.id)}),h({pubkey:new he(t.authority),isWritable:!1}),h({pubkey:new he(t.openOrders),isWritable:!1}),h({pubkey:new he(t.targetOrders)}),h({pubkey:new he(e.lpMint.address)}),h({pubkey:new he(t.vault.A)}),h({pubkey:new he(t.vault.B)})];return e.pooltype.includes("StablePool")&&u.push(h({pubkey:Qn})),u.push(h({pubkey:new he(e.marketId),isWritable:!1}),h({pubkey:n.baseTokenAccount}),h({pubkey:n.quoteTokenAccount}),h({pubkey:n.lpTokenAccount}),h({pubkey:n.owner,isWritable:!1,isSigner:!0}),h({pubkey:new he(t.marketEventQueue),isWritable:!1})),new Qt({programId:new he(e.programId),keys:u,data:c})}function Ns(o){let{poolInfo:e,poolKeys:t,userKeys:n,lpAmount:r,baseAmountMin:i,quoteAmountMin:s}=o,a=Ie(t),c=4;if(e.pooltype.includes("StablePool")&&(c=5),c===4||c===5){let u=Buffer.alloc(Ls.span);Ls.encode({instruction:4,lpAmount:z(r),baseAmountMin:z(i),quoteAmountMin:z(s)},u);let l=[h({pubkey:Yn,isWritable:!1}),h({pubkey:a.id}),h({pubkey:a.authority,isWritable:!1}),h({pubkey:a.openOrders}),h({pubkey:a.targetOrders}),h({pubkey:a.mintLp.address}),h({pubkey:a.vault.A}),h({pubkey:a.vault.B})];return c===5?l.push(h({pubkey:Qn})):(l.push(h({pubkey:a.id})),l.push(h({pubkey:a.id}))),l.push(h({pubkey:a.marketProgramId,isWritable:!1}),h({pubkey:a.marketId}),h({pubkey:a.marketBaseVault}),h({pubkey:a.marketQuoteVault}),h({pubkey:a.marketAuthority,isWritable:!1}),h({pubkey:n.lpTokenAccount}),h({pubkey:n.baseTokenAccount}),h({pubkey:n.quoteTokenAccount}),h({pubkey:n.owner,isWritable:!1,isSigner:!0}),h({pubkey:a.marketEventQueue}),h({pubkey:a.marketBids}),h({pubkey:a.marketAsks})),new Qt({programId:a.programId,keys:l,data:u})}return new Qt({programId:a.programId,keys:[]})}function lc({programId:o,ammId:e,ammAuthority:t,ammOpenOrders:n,lpMint:r,coinMint:i,pcMint:s,coinVault:a,pcVault:c,withdrawQueue:u,ammTargetOrders:l,poolTempLp:m,marketProgramId:d,marketId:p,userWallet:y,userCoinVault:f,userPcVault:b,userLpVault:g,nonce:A,openTime:w,coinAmount:k,pcAmount:I,ammConfigId:T,feeDestinationId:S}){let B=_([D("instruction"),D("nonce"),P("openTime"),P("pcAmount"),P("coinAmount")]),C=[{pubkey:Yn,isSigner:!1,isWritable:!1},{pubkey:Qp,isSigner:!1,isWritable:!1},{pubkey:uc.programId,isSigner:!1,isWritable:!1},{pubkey:ut,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:T,isSigner:!1,isWritable:!1},{pubkey:S,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!0,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0}],x=Buffer.alloc(B.span);return B.encode({instruction:1,nonce:A,openTime:w,coinAmount:k,pcAmount:I},x),{instruction:new Qt({keys:C,programId:o,data:x}),instructionType:F.AmmV4CreatePool}}function wI(o){let e=_([D("instruction"),D("simulateType")]),t=Buffer.alloc(e.span);e.encode({instruction:12,simulateType:0},t);let n=[h({pubkey:new he(o.id),isWritable:!1}),h({pubkey:new he(o.authority),isWritable:!1}),h({pubkey:new he(o.openOrders),isWritable:!1}),h({pubkey:new he(o.vault.A),isWritable:!1}),h({pubkey:new he(o.vault.B),isWritable:!1}),h({pubkey:new he(o.mintLp.address),isWritable:!1}),h({pubkey:new he(o.marketId),isWritable:!1}),h({pubkey:new he(o.marketEventQueue),isWritable:!1})];return new Qt({programId:new he(o.programId),keys:n,data:t})}function Yp({poolKeys:o,userKeys:e,amountIn:t,minAmountOut:n},r){let i=Ie(o),s=Buffer.alloc(Ss.span);Ss.encode({instruction:9,amountIn:z(t),minAmountOut:z(n)},s);let a=[h({pubkey:Yn,isWritable:!1}),h({pubkey:i.id}),h({pubkey:i.authority,isWritable:!1}),h({pubkey:i.openOrders})];return r===4&&a.push(h({pubkey:i.targetOrders})),a.push(h({pubkey:i.vault.A}),h({pubkey:i.vault.B})),r===5&&a.push(h({pubkey:Qn})),a.push(h({pubkey:i.marketProgramId,isWritable:!1}),h({pubkey:i.marketId}),h({pubkey:i.marketBids}),h({pubkey:i.marketAsks}),h({pubkey:i.marketEventQueue}),h({pubkey:i.marketBaseVault}),h({pubkey:i.marketQuoteVault}),h({pubkey:i.marketAuthority,isWritable:!1}),h({pubkey:e.tokenAccountIn}),h({pubkey:e.tokenAccountOut}),h({pubkey:e.owner,isWritable:!1})),new Qt({programId:i.programId,keys:a,data:s})}function jp({poolKeys:o,userKeys:e,maxAmountIn:t,amountOut:n},r){let i=Ie(o),s=Buffer.alloc(Ks.span);Ks.encode({instruction:11,maxAmountIn:z(t),amountOut:z(n)},s);let a=[h({pubkey:Yn,isWritable:!1}),h({pubkey:i.id}),h({pubkey:i.authority,isWritable:!1}),h({pubkey:i.openOrders}),h({pubkey:i.targetOrders}),h({pubkey:i.vault.A}),h({pubkey:i.vault.B})];return r===5&&a.push(h({pubkey:Qn})),a.push(h({pubkey:i.marketProgramId,isWritable:!1}),h({pubkey:i.marketId}),h({pubkey:i.marketBids}),h({pubkey:i.marketAsks}),h({pubkey:i.marketEventQueue}),h({pubkey:i.marketBaseVault}),h({pubkey:i.marketQuoteVault}),h({pubkey:i.marketAuthority,isWritable:!1}),h({pubkey:e.tokenAccountIn}),h({pubkey:e.tokenAccountOut}),h({pubkey:e.owner,isWritable:!1,isSigner:!0})),new Qt({programId:i.programId,keys:a,data:s})}function Ur(o){let{poolKeys:e,version:t,userKeys:n,amountIn:r,amountOut:i,fixedSide:s}=o;if(t===4||t===5){let a={poolKeys:e,userKeys:n};if(s==="in")return Yp(E(R({},a),{amountIn:r,minAmountOut:i}),t);if(s==="out")return jp(E(R({},a),{maxAmountIn:r,amountOut:i}),t);ac.logWithError("invalid params","params",o)}throw ac.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}function PI({poolKeys:o,userKeys:e,startTime:t}){let n=Buffer.alloc(Cs.span);Cs.encode({instruction:0,nonce:5,startTime:z(t)},n);let r=Ie(o),i=[h({pubkey:Yn,isWritable:!1}),h({pubkey:uc.programId,isWritable:!1}),h({pubkey:zp,isWritable:!1}),h({pubkey:r.id}),h({pubkey:r.authority,isWritable:!1}),h({pubkey:r.openOrders}),h({pubkey:r.mintLp.address}),h({pubkey:r.mintA.address,isWritable:!1}),h({pubkey:r.mintB.address,isWritable:!1}),h({pubkey:r.vault.A,isWritable:!1}),h({pubkey:r.vault.B,isWritable:!1}),h({pubkey:r.id}),h({pubkey:r.targetOrders}),h({pubkey:e.lpTokenAccount}),h({pubkey:r.id,isWritable:!1}),h({pubkey:r.marketProgramId,isWritable:!1}),h({pubkey:r.marketId,isWritable:!1}),h({pubkey:e.payer,isSigner:!0})];return new Qt({programId:r.programId,keys:i,data:n})}function mc({poolKeys:o}){let e=_([D("instruction"),D("simulateType")]),t=Buffer.alloc(e.span);e.encode({instruction:12,simulateType:0},t);let n=[h({pubkey:new he(o.id),isWritable:!1}),h({pubkey:new he(o.authority),isWritable:!1}),h({pubkey:new he(o.openOrders),isWritable:!1}),h({pubkey:new he(o.vault.A),isWritable:!1}),h({pubkey:new he(o.vault.B),isWritable:!1}),h({pubkey:new he(o.mintLp.address),isWritable:!1}),h({pubkey:new he(o.marketId),isWritable:!1}),h({pubkey:new he(o.marketEventQueue),isWritable:!1})];return{instruction:new Qt({programId:new he(o.programId),keys:n,data:t})}}import{PublicKey as $p}from"@solana/web3.js";import Eo from"bn.js";import{TOKEN_PROGRAM_ID as Jp}from"@solana/spl-token";import{PublicKey as Hp}from"@solana/web3.js";var Zp=ce("Raydium_liquidity_serum");function dc({programId:o,marketId:e}){let t=[e.toBuffer()],n=0,r;for(;n<100;){try{let i=t.concat(Buffer.from([n]),Buffer.alloc(7));r=Hp.createProgramAddressSync(i,o)}catch(i){if(i instanceof TypeError)throw i;n++;continue}return{publicKey:r,nonce:n}}throw Zp.logWithError("unable to find a viable program address nonce","params",{programId:o,marketId:e}),new Error("unable to find a viable program address nonce")}function Gr({programId:o}){let{publicKey:e}=ae([Buffer.from("amm_config_account_seed","utf-8")],o);return e}function xn({name:o,programId:e,marketId:t}){let{publicKey:n}=ae([e.toBuffer(),t.toBuffer(),Buffer.from(o,"utf-8")],e);return n}function ef({programId:o,marketId:e}){let{publicKey:t}=ae([o.toBuffer(),e.toBuffer(),Buffer.from("open_order_associated_seed","utf-8")],o);return t}function vs({programId:o}){return ae([Buffer.from([97,109,109,32,97,117,116,104,111,114,105,116,121])],o)}function pc({version:o,marketVersion:e,marketId:t,baseMint:n,quoteMint:r,baseDecimals:i,quoteDecimals:s,programId:a,marketProgramId:c}){let u=xn({name:"amm_associated_seed",programId:a,marketId:t}),l=xn({name:"lp_mint_associated_seed",programId:a,marketId:t}),{publicKey:m,nonce:d}=vs({programId:a}),p=xn({name:"coin_vault_associated_seed",programId:a,marketId:t}),y=xn({name:"pc_vault_associated_seed",programId:a,marketId:t}),f=xn({name:"temp_lp_token_associated_seed",programId:a,marketId:t}),b=ef({programId:a,marketId:t}),g=xn({name:"target_associated_seed",programId:a,marketId:t}),A=xn({name:"withdraw_associated_seed",programId:a,marketId:t}),{publicKey:w}=dc({programId:c,marketId:t});return{id:u,baseMint:n,quoteMint:r,lpMint:l,baseDecimals:i,quoteDecimals:s,lpDecimals:i,version:o,programId:a,authority:m,nonce:d,baseVault:p,quoteVault:y,lpVault:f,openOrders:b,targetOrders:g,withdrawQueue:A,marketVersion:e,marketProgramId:c,marketId:t,marketAuthority:w,lookupTableAccount:$p.default,configId:Gr({programId:a})}}var Ms;async function vI({connection:o,poolKeysList:e,config:t}){Ms||(Ms=new zn({connection:o}),await Ms.initStableModelLayout());let n=e.map(s=>mc({poolKeys:s}));return(await Ea(o,n.map(s=>s.instruction),"GetPoolData")).map(s=>{let a=Da(s,"GetPoolData"),c=new Eo(Et(a,"status")),u=Number(Et(a,"coin_decimals")),l=Number(Et(a,"pc_decimals")),m=Number(Et(a,"lp_decimals")),d=new Eo(Et(a,"pool_coin_amount")),p=new Eo(Et(a,"pool_pc_amount")),y=new Eo(Et(a,"pool_lp_supply")),f="0";try{f=Et(a,"pool_open_time")}catch{}return{status:c,baseDecimals:u,quoteDecimals:l,lpDecimals:m,baseReserve:d,quoteReserve:p,lpSupply:y,startTime:new Eo(f)}})}var _s={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]},Xr=o=>{let e={},t=Jp.toBase58();return Object.keys(o).map(n=>{let r=o[n],[i,s]=[r.baseMint.toBase58(),r.quoteMint.toBase58()];e[n]={id:n,version:4,status:r.status.toNumber(),programId:r.programId.toBase58(),mintA:st({address:i,programId:t,decimals:r.baseDecimal.toNumber()}),mintB:st({address:s,programId:t,decimals:r.quoteDecimal.toNumber()}),rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:r.poolPrice.toNumber(),mintAmountA:new O(r.mintAAmount.toString()).div(10**r.baseDecimal.toNumber()).toNumber(),mintAmountB:new O(r.mintBAmount.toString()).div(10**r.quoteDecimal.toNumber()).toNumber(),baseReserve:r.baseReserve,quoteReserve:r.quoteReserve,feeRate:new O(r.tradeFeeNumerator.toString()).div(r.tradeFeeDenominator.toString()).toNumber(),openTime:r.poolOpenTime.toString(),tvl:0,day:_s,week:_s,month:_s,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,type:"Standard",marketId:r.marketId.toBase58(),configId:Gr({programId:r.programId}).toBase58(),lpPrice:0,lpAmount:0,lpMint:st({address:r.lpMint.toBase58(),programId:t,decimals:Math.min(r.baseDecimal.toNumber(),r.quoteDecimal.toNumber())}),burnPercent:0}}),e};import Qe from"bn.js";var Do=class extends Se{constructor(t){super(t);this.stableLayout=new zn({connection:this.scope.connection})}async initLayout(){await this.stableLayout.initStableModelLayout()}async load(){this.checkDisabled()}computePairAmount({poolInfo:t,amount:n,slippage:r,baseIn:i}){let s=new Qe(new O(n).mul(10**t[i?"mintA":"mintB"].decimals).toFixed(0)),a=Wr(t[i?"mintB":"mintA"]),[c,u]=[new Qe(new O(t.mintAmountA).mul(10**t.mintA.decimals).toString()),new Qe(new O(t.mintAmountB).mul(10**t.mintB.decimals).toString())],l=new Qe(new O(t.lpAmount).mul(10**t.lpMint.decimals).toFixed(0,O.ROUND_DOWN));this.logDebug("baseReserve:",c.toString(),"quoteReserve:",u.toString()),this.logDebug("tokenIn:",i?t.mintA.symbol:t.mintB.symbol,"amountIn:",s.toString(),"anotherToken:",i?t.mintB.symbol:t.mintA.symbol,"slippage:",`${r.toSignificant()}%`,"baseReserve",c.toString(),"quoteReserve",u.toString());let m=i?"base":"quote";this.logDebug("input side:",m);let d=qe;s.isZero()||(d=m==="base"?fr(s.mul(u),c):fr(s.mul(c),u)),this.logDebug("amountRaw:",d.toString(),"lpAmount:",l.toString());let p=fr(s.mul(l),m==="base"?c:u);this.logDebug("liquidity:",p.toString());let y=new Ke(new Qe(1)).add(r),f=new Ke(new Qe(1)).sub(r),b=y.mul(d).quotient,g=f.mul(d).quotient,A=new fe(a,d),w=new fe(a,b),k=new fe(a,g);return this.logDebug("anotherAmount:",A.toFixed(),"maxAnotherAmount:",w.toFixed()),{anotherAmount:A,maxAnotherAmount:w,minAnotherAmount:k,liquidity:p}}async getAmmPoolKeys(t){return(await this.scope.api.fetchPoolKeysById({idList:[t]}))[0]}async addLiquidity(t){let{poolInfo:n,poolKeys:r,amountInA:i,amountInB:s,otherAmountMin:a,fixedSide:c,config:u,txVersion:l,computeBudgetConfig:m}=t;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region"),this.logDebug("amountInA:",i,"amountInB:",s),(i.isZero()||s.isZero())&&this.logAndCreateError("amounts must greater than zero","amountInA & amountInB",{amountInA:i.toFixed(),amountInB:s.toFixed()});let{account:d}=this.scope,{bypassAssociatedCheck:p,checkCreateATAOwner:y}=R({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},u),[f,b]=[i.token,s.token],g=await d.getCreatedTokenAccount({mint:f.mint,associatedOnly:!1}),A=await d.getCreatedTokenAccount({mint:b.mint,associatedOnly:!1});!g&&!A&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",d.tokenAccounts);let w=await d.getCreatedTokenAccount({mint:new tt(n.lpMint.address)}),k=[f,b],I=[g,A],T=[i.raw,s.raw],S=i.token.mint.toBase58()===n.mintA.address?"base":"quote",B="base";["quote","base"].includes(S)||this.logAndCreateError("invalid fixedSide","fixedSide",c),S==="quote"?(k.reverse(),I.reverse(),T.reverse(),B=c==="a"?"quote":"base"):S==="base"&&(B=c==="a"?"base":"quote");let[C,x]=k,[L,W]=I,[v,$]=T,X=r!=null?r:await this.getAmmPoolKeys(n.id),q=this.createTxBuilder(),On=await d.handleTokenAccount({side:"in",amount:v,mint:C.mint,tokenAccount:L,bypassAssociatedCheck:p,checkCreateATAOwner:y}),{tokenAccount:ot}=On,Rn=Oe(On,["tokenAccount"]);q.addInstruction(Rn);let $o=await d.handleTokenAccount({side:"in",amount:$,mint:x.mint,tokenAccount:W,bypassAssociatedCheck:p,checkCreateATAOwner:y}),{tokenAccount:dn}=$o,Ht=Oe($o,["tokenAccount"]);q.addInstruction(Ht);let Jo=await d.handleTokenAccount({side:"out",amount:0,mint:new tt(n.lpMint.address),tokenAccount:w,bypassAssociatedCheck:p,checkCreateATAOwner:y}),{tokenAccount:Ln}=Jo,Zt=Oe(Jo,["tokenAccount"]);return q.addInstruction(Zt),q.addInstruction({instructions:[cc({poolInfo:n,poolKeys:X,userKeys:{baseTokenAccount:ot,quoteTokenAccount:dn,lpTokenAccount:Ln,owner:this.scope.ownerPubKey},baseAmountIn:v,quoteAmountIn:$,otherAmountMin:a.raw,fixedSide:B})],instructionTypes:[n.pooltype.includes("StablePool")?F.AmmV5AddLiquidity:F.AmmV4AddLiquidity],lookupTableAddress:X.lookupTableAccount?[X.lookupTableAccount]:[]}),q.addCustomComputeBudget(m),l===0&&await q.buildV0(),q.build()}async removeLiquidity(t){this.scope.availability.removeStandardPosition===!1&&this.logAndCreateError("remove liquidity feature disabled in your region");let{poolInfo:n,poolKeys:r,lpAmount:i,baseAmountMin:s,quoteAmountMin:a,config:c,txVersion:u,computeBudgetConfig:l}=t,m=r!=null?r:await this.getAmmPoolKeys(n.id),[d,p,y]=[new tt(n.mintA.address),new tt(n.mintB.address),new tt(n.lpMint.address)];this.logDebug("lpAmount:",i),this.logDebug("baseAmountMin:",s),this.logDebug("quoteAmountMin:",a),i.isZero()&&this.logAndCreateError("amount must greater than zero","lpAmount",i.toString());let{account:f}=this.scope,b=await f.getCreatedTokenAccount({mint:y,associatedOnly:!1});b||this.logAndCreateError("cannot found lpTokenAccount","tokenAccounts",f.tokenAccounts);let g=await f.getCreatedTokenAccount({mint:d}),A=await f.getCreatedTokenAccount({mint:p}),w=this.createTxBuilder(),{bypassAssociatedCheck:k,checkCreateATAOwner:I}=R({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},c),x=await f.handleTokenAccount({side:"out",amount:0,mint:d,tokenAccount:g,bypassAssociatedCheck:k,checkCreateATAOwner:I}),{tokenAccount:T}=x,S=Oe(x,["tokenAccount"]);w.addInstruction(S);let L=await f.handleTokenAccount({side:"out",amount:0,mint:p,tokenAccount:A,bypassAssociatedCheck:k,checkCreateATAOwner:I}),{tokenAccount:B}=L,C=Oe(L,["tokenAccount"]);return w.addInstruction(C),w.addInstruction({instructions:[Ns({poolInfo:n,poolKeys:m,userKeys:{lpTokenAccount:b,baseTokenAccount:T,quoteTokenAccount:B,owner:this.scope.ownerPubKey},lpAmount:i,baseAmountMin:s,quoteAmountMin:a})],lookupTableAddress:m.lookupTableAccount?[m.lookupTableAccount]:[],instructionTypes:[n.pooltype.includes("StablePool")?F.AmmV5RemoveLiquidity:F.AmmV4RemoveLiquidity]}),w.addCustomComputeBudget(l),u===0?await w.buildV0():w.build()}async removeAllLpAndCreateClmmPosition({poolInfo:t,clmmPoolInfo:n,removeLpAmount:r,createPositionInfo:i,farmInfo:s,userFarmLpAmount:a,base:c,computeBudgetConfig:u,payer:l,userAuxiliaryLedgers:m,tokenProgram:d=jn,checkCreateATAOwner:p=!0,getEphemeralSigners:y,txVersion:f}){if((this.scope.availability.removeStandardPosition===!1||this.scope.availability.createConcentratedPosition===!1)&&this.logAndCreateError("remove liquidity or create position feature disabled in your region"),!(t.mintA.address===n.mintA.address||t.mintA.address===n.mintB.address)||!(t.mintB.address===n.mintA.address||t.mintB.address===n.mintB.address))throw Error("mint check error");let b=this.createTxBuilder();b.addCustomComputeBudget(u);let g={};for(let q of this.scope.account.tokenAccountRawInfos)(g[q.accountInfo.mint.toString()]===void 0||ge(this.scope.ownerPubKey,q.accountInfo.mint,jn).publicKey.equals(q.pubkey))&&(g[q.accountInfo.mint.toString()]=q.pubkey);let A=g[t.lpMint.address];if(A===void 0)throw Error("find lp account error in trade accounts");let w=r.add(a!=null?a:new Qe(0)),k=t.mintA.address===be.WSOL.mint.toString(),I=t.mintB.address===be.WSOL.mint.toString(),{account:T,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:jn,mint:new tt(t.mintA.address),owner:this.scope.ownerPubKey,createInfo:k?{payer:this.scope.ownerPubKey}:void 0,skipCloseAccount:!k,notUseTokenAccount:k,associatedOnly:!0,checkCreateATAOwner:p});if(b.addInstruction(S||{}),T===void 0)throw new Error("base token account not found");let{account:B,instructionParams:C}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:jn,mint:new tt(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:I?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!I,notUseTokenAccount:I,associatedOnly:!0,checkCreateATAOwner:p});if(b.addInstruction(C||{}),B===void 0)throw new Error("quote token account not found");if(g[t.mintA.address]=T,g[t.mintB.address]=B,s!==void 0&&!(a!=null&&a.isZero())){let q=wt[s.programId],ot=Je({programId:new tt(s.programId),poolId:new tt(s.id),owner:this.scope.ownerPubKey,version:q}),Rn,dn=await this.scope.connection.getAccountInfo(ot);if(dn&&(Rn=Gn(q).decode(dn.data)),q!==6&&!Rn){let{instruction:$t,instructionType:ai}=xo({id:new tt(s.id),programId:new tt(s.programId),version:q,ledger:ot,owner:this.scope.ownerPubKey});b.addInstruction({instructions:[$t],instructionTypes:[ai]})}let Ht=[];for(let $t of s.rewardInfos){let ai=$t.mint.address===be.WSOL.mint.toString();if(g[$t.mint.address])Ht.push(g[$t.mint.address]);else{let{account:Js,instructionParams:ea}=await this.scope.account.getOrCreateTokenAccount({mint:new tt($t.mint.address),tokenProgram:d,owner:this.scope.ownerPubKey,skipCloseAccount:!ai,createInfo:{payer:l||this.scope.ownerPubKey},associatedOnly:!0,checkCreateATAOwner:p});Js||this.logAndCreateError("farm reward account not found:",$t.mint.address),ea&&b.addInstruction(ea),Ht.push(Js)}}let Ln=(await this.scope.api.fetchFarmKeysById({ids:s.id}))[0],Zt={userAuxiliaryLedgers:m,amount:a,owner:this.scope.ownerPubKey,farmInfo:s,farmKeys:Ln,lpAccount:A,rewardAccounts:Ht},On=wt[s.programId],$o=On===6?So(Zt):On===5?Ko(Zt):Co(Zt),Jo={3:F.FarmV3Withdraw,5:F.FarmV5Withdraw,6:F.FarmV6Withdraw};b.addInstruction({instructions:[$o],instructionTypes:[Jo[On]]})}let x=await this.getAmmPoolKeys(t.id),L=Ns({poolInfo:t,poolKeys:x,userKeys:{lpTokenAccount:A,baseTokenAccount:T,quoteTokenAccount:B,owner:this.scope.ownerPubKey},lpAmount:w,baseAmountMin:0,quoteAmountMin:0});b.addInstruction({instructions:[L],instructionTypes:[t.pooltype.includes("StablePool")?F.AmmV5RemoveLiquidity:F.AmmV4RemoveLiquidity],lookupTableAddress:x.lookupTableAccount?[x.lookupTableAccount]:[]});let[W,v]=t.mintA.address===n.mintA.address?[T,B]:[B,T],$=await this.scope.clmm.getClmmPoolKeys(n.id),X=await Te.openPositionFromBaseInstructions(E(R({poolInfo:n,poolKeys:$,ownerInfo:{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:W,tokenAccountB:v},withMetadata:"create"},i),{base:c,getEphemeralSigners:y}));return b.addInstruction({instructions:[...X.instructions],signers:X.signers,instructionTypes:[...X.instructionTypes],lookupTableAddress:$.lookupTableAccount?[$.lookupTableAccount]:[]}),f===0?b.sizeCheckBuildV0():b.sizeCheckBuild()}async createPoolV4({programId:t,marketInfo:n,baseMintInfo:r,quoteMintInfo:i,baseAmount:s,quoteAmount:a,startTime:c,ownerInfo:u,associatedOnly:l=!1,checkCreateATAOwner:m=!1,tokenProgram:d,txVersion:p,feeDestinationId:y,computeBudgetConfig:f}){var W;let b=u.feePayer||((W=this.scope.owner)==null?void 0:W.publicKey),g=u.useSOLBalance&&r.mint.equals(fc),A=u.useSOLBalance&&i.mint.equals(fc),w=this.createTxBuilder(),{account:k,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({mint:r.mint,owner:this.scope.ownerPubKey,createInfo:g?{payer:b,amount:s}:void 0,notUseTokenAccount:g,skipCloseAccount:!g,associatedOnly:g?!1:l,checkCreateATAOwner:m});w.addInstruction(I||{});let{account:T,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({mint:i.mint,owner:this.scope.ownerPubKey,createInfo:A?{payer:b,amount:a}:void 0,notUseTokenAccount:A,skipCloseAccount:!A,associatedOnly:A?!1:l,checkCreateATAOwner:m});if(w.addInstruction(S||{}),k===void 0||T===void 0)throw Error("you don't has some token account");let B=pc({version:4,marketVersion:3,marketId:n.marketId,baseMint:r.mint,quoteMint:i.mint,baseDecimals:r.decimals,quoteDecimals:i.decimals,programId:t,marketProgramId:n.programId}),C={programId:t,ammId:B.id,ammAuthority:B.authority,ammOpenOrders:B.openOrders,lpMint:B.lpMint,coinMint:B.baseMint,pcMint:B.quoteMint,coinVault:B.baseVault,pcVault:B.quoteVault,withdrawQueue:B.withdrawQueue,ammTargetOrders:B.targetOrders,poolTempLp:B.lpVault,marketProgramId:B.marketProgramId,marketId:B.marketId,ammConfigId:B.configId,feeDestinationId:y},{instruction:x,instructionType:L}=lc(E(R({},C),{userWallet:this.scope.ownerPubKey,userCoinVault:k,userPcVault:T,userLpVault:ge(this.scope.ownerPubKey,B.lpMint,d).publicKey,nonce:B.nonce,openTime:c,coinAmount:s,pcAmount:a}));return w.addInstruction({instructions:[x],instructionTypes:[L]}),w.addCustomComputeBudget(f),w.versionBuild({txVersion:p,extInfo:{address:C}})}async getCreatePoolFee({programId:t}){let n=Gr({programId:t}),r=await this.scope.connection.getAccountInfo(n,{dataSlice:{offset:536,length:8}});if(r===null)throw Error("get config account error");return tc.decode(r.data).fee}computeAmountOut({poolInfo:t,amountIn:n,mintIn:r,mintOut:i,slippage:s}){let[a,c]=[r.toString(),i.toString()];if(a!==t.mintA.address&&a!==t.mintB.address)throw new Error("toke not match");if(c!==t.mintA.address&&c!==t.mintB.address)throw new Error("toke not match");let{baseReserve:u,quoteReserve:l}=t,m=[u,l],d=[t.mintA.decimals,t.mintB.decimals],p=a==t.mintA.address?"base":"quote";p==="quote"&&(m.reverse(),d.reverse());let[y,f]=m,[b,g]=d,A=t.version===4,w;if(A)w=new O(f.toString()).div(10**g).div(new O(y.toString()).div(10**b));else{let v=sc(this.stableLayout.stableModelData,u.toNumber(),l.toNumber(),!1);p==="quote"?w=new O(1e6).div(v*1e6):w=new O(v*1e6).div(1e6)}let k=n,I=new Qe(0),T=new Qe(0);if(!k.isZero())if(A){T=Kt(k.mul(xs),qr);let v=k.sub(T),$=y.add(v);I=f.mul(v).div($)}else{T=k.mul(new Qe(2)).div(new Qe(1e4));let v=k.sub(T);p==="quote"?I=new Qe(rc(this.stableLayout.stableModelData,l.toNumber(),u.toNumber(),v.toNumber())):I=new Qe(ic(this.stableLayout.stableModelData,l.toNumber(),u.toNumber(),v.toNumber()))}let S=new Qe(new O(I.toString()).mul(1-s).toFixed(0)),B=I,C=S,x=new O(I.toString()).div(new O(k.sub(T).toString()).toFixed(0));!k.isZero()&&!I.isZero()&&(x=new O(I.toString()).div(10**g).div(new O(k.sub(T).toString()).div(10**b)));let L=w.sub(x).div(w).mul(100);return{amountOut:B,minAmountOut:C,currentPrice:w,executionPrice:x,priceImpact:L,fee:T}}computeAmountIn({poolInfo:t,amountOut:n,mintIn:r,mintOut:i,slippage:s}){let{baseReserve:a,quoteReserve:c}=t;r.toString()!==t.mintA.address&&r.toString()!==t.mintB.address&&this.logAndCreateError("mintIn does not match pool"),i.toString()!==t.mintA.address&&i.toString()!==t.mintB.address&&this.logAndCreateError("mintOut does not match pool"),this.logDebug("baseReserve:",a.toString()),this.logDebug("quoteReserve:",c.toString());let u=r.toString()===t.mintA.address,[l,m]=u?[t.mintA,t.mintB]:[t.mintB,t.mintA];this.logDebug("currencyOut:",m.symbol||m.address),this.logDebug("amountOut:",new O(n.toString()).div(10**m.decimals).toDecimalPlaces(m.decimals).toString(),l.symbol||l.address),this.logDebug("slippage:",`${s*100}%`);let d=[a,c],p=u?"quote":"base";p==="base"&&d.reverse(),this.logDebug("output side:",p);let[y,f]=d,b=new O(f.toString()).div(10**t[u?"mintB":"mintA"].decimals).div(new O(y.toString()).div(10**t[u?"mintA":"mintB"].decimals));this.logDebug("currentPrice:",`1 ${l.symbol||l.address} \u2248 ${b.toString()} ${m.symbol||m.address}`),this.logDebug("currentPrice invert:",`1 ${m.symbol||m.address} \u2248 ${new O(1).div(b).toString()} ${l.symbol||l.address}`);let g=new Qe(0),A=n;if(!A.isZero()){A.gt(f)&&(A=f.sub(new Qe(1)));let C=f.sub(A);g=y.mul(A).div(C).mul(qr).div(qr.sub(xs))}let w=new Qe(new O(g.toString()).mul(1+s).toFixed(0)),k=g,I=w;this.logDebug("amountIn:",new O(k.toString()).div(10**l.decimals).toDecimalPlaces(l.decimals).toString()),this.logDebug("maxAmountIn:",new O(I.toString()).div(10**l.decimals).toDecimalPlaces(l.decimals).toString());let T=null;!g.isZero()&&!A.isZero()&&(T=new O(A.toString()).div(10**m.decimals).div(new O(g.toString()).div(10**l.decimals)),this.logDebug("executionPrice:",`1 ${m.symbol||m.address} \u2248 ${T.toDecimalPlaces(Math.max(t.mintA.decimals,t.mintB.decimals)).toString()} ${l.symbol||l.address}`),this.logDebug("executionPrice invert:",`1 ${m.symbol||m.address} \u2248 ${new O(1).div(T).toDecimalPlaces(Math.max(t.mintA.decimals,t.mintB.decimals)).toString()} ${l.symbol||l.address}`));let S=b.mul(k.toString()),B=S.sub(n.toString()).abs().div(S);return this.logDebug("priceImpact:",`${B.toString()}%`),{amountIn:k,maxAmountIn:I,currentPrice:b,executionPrice:T,priceImpact:B}}async swap({poolInfo:t,poolKeys:n,amountIn:r,amountOut:i,inputMint:s,fixedSide:a,txVersion:c,config:u,computeBudgetConfig:l}){let m=this.createTxBuilder(),{associatedOnly:d=!0,inputUseSolBalance:p=!0,outputUseSolBalance:y=!0}=u||{},[f,b]=s===t.mintA.address?[t.mintA,t.mintB]:[t.mintB,t.mintA],g=p&&f.address===Q.toBase58(),A=y&&b.address===Q.toBase58(),{account:w,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:jn,mint:new tt(f.address),owner:this.scope.ownerPubKey,createInfo:g?{payer:this.scope.ownerPubKey,amount:r}:void 0,skipCloseAccount:!g,notUseTokenAccount:g,associatedOnly:d});m.addInstruction(k||{}),w||this.logAndCreateError("input token account not found",{token:f.symbol||f.address,tokenAccountIn:w,inputTokenUseSolBalance:g,associatedOnly:d});let{account:I,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:jn,mint:new tt(b.address),owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:A?!1:d});m.addInstruction(T||{}),I===void 0&&this.logAndCreateError("output token account not found",{token:b.symbol||b.address,tokenAccountOut:I,outputTokenUseSolBalance:A,associatedOnly:d});let S=n||await this.getAmmPoolKeys(t.id),B=4;return t.pooltype.includes("StablePool")&&(B=5),m.addInstruction({instructions:[Ur({version:B,poolKeys:S,userKeys:{tokenAccountIn:w,tokenAccountOut:I,owner:this.scope.ownerPubKey},amountIn:r,amountOut:i,fixedSide:a})],instructionTypes:[B===4?F.AmmV4SwapBaseIn:F.AmmV5SwapBaseIn]}),m.addCustomComputeBudget(l),m.versionBuild({txVersion:c})}async getRpcPoolInfo(t){return(await this.getRpcPoolInfos([t]))[t]}async getRpcPoolInfos(t,n){let r=await Fe(this.scope.connection,t.map(l=>({pubkey:new tt(l)})),n),i={},s=[];for(let l=0;l<t.length;l++){let m=r[l];if(m===null||!m.accountInfo)throw Error("fetch pool info error: "+String(t[l]));let d=Fo.decode(m.accountInfo.data);i[String(t[l])]=E(R({},d),{programId:m.accountInfo.owner}),s.push(d.baseVault,d.quoteVault)}let a={},c=await Fe(this.scope.connection,s.map(l=>({pubkey:new tt(l)})),n);for(let l=0;l<s.length;l++){let m=c[l].accountInfo;if(m===null)throw Error("fetch vault info error: "+s[l]);a[String(s[l])]=new Qe(tf.decode(m.data).amount.toString())}let u={};for(let[l,m]of Object.entries(i)){let d=a[m.baseVault.toString()].sub(m.baseNeedTakePnl),p=a[m.quoteVault.toString()].sub(m.quoteNeedTakePnl);u[l]=E(R({},m),{baseReserve:d,mintAAmount:a[m.baseVault.toString()],mintBAmount:a[m.quoteVault.toString()],quoteReserve:p,poolPrice:new O(p.toString()).div(new O(10).pow(m.quoteDecimal.toString())).div(new O(d.toString()).div(new O(10).pow(m.baseDecimal.toString())))})}return u}async getPoolInfoFromRpc({poolId:t}){let n=await this.getRpcPoolInfo(t),r=Xr({[t]:n}),i=r[t],s=await this.scope.tradeV2.computePoolToPoolKeys({pools:[r[t]],ammRpcData:{[t]:n}});return{poolRpcData:n,poolInfo:i,poolKeys:s[0]}}};import{PublicKey as oe}from"@solana/web3.js";import pt from"bn.js";import{AccountLayout as yc,TOKEN_PROGRAM_ID as bc}from"@solana/spl-token";var Wo=class extends Se{constructor(e){super(e)}async getClmmPoolKeys(e){return(await this.scope.api.fetchPoolKeysById({idList:[e]}))[0]}async createPool(e){var w;let{programId:t,owner:n=((w=this.scope.owner)==null?void 0:w.publicKey)||oe.default,mint1:r,mint2:i,ammConfig:s,initialPrice:a,startTime:c,computeBudgetConfig:u,forerunCreate:l,getObserveState:m,txVersion:d}=e,p=this.createTxBuilder(),[y,f,b]=new pt(new oe(r.address).toBuffer()).gt(new pt(new oe(i.address).toBuffer()))?[i,r,new O(1).div(a)]:[r,i,a],g=ee.priceToSqrtPriceX64(b,y.decimals,f.decimals),A=await Te.createPoolInstructions({connection:this.scope.connection,programId:t,owner:n,mintA:y,mintB:f,ammConfigId:s.id,initialPriceX64:g,startTime:c,forerunCreate:!m&&l});return p.addInstruction(A),p.addCustomComputeBudget(u),p.versionBuild({txVersion:d,extInfo:{address:E(R({},A.address),{programId:t.toString(),id:A.address.poolId.toString(),mintA:y,mintB:f,openTime:c.toString(),vault:{A:A.address.mintAVault.toString(),B:A.address.mintBVault.toString()},rewardInfos:[],config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}}),mockPoolInfo:R({type:"Concentrated",rewardDefaultPoolInfos:"Clmm",id:A.address.poolId.toString(),mintA:y,mintB:f,feeRate:s.tradeFeeRate,openTime:c.toString(),programId:t.toString(),price:b.toNumber(),config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]},burnPercent:0},vu),forerunCreate:l}})}async openPositionFromBase({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:i,base:s,baseAmount:a,otherAmountMax:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",getEphemeralSigners:d,computeBudgetConfig:p,txVersion:y}){this.scope.availability.addConcentratedPosition===!1&&this.logAndCreateError("add position feature disabled in your region"),this.scope.checkOwner();let f=this.createTxBuilder(),b=null,g=null,A=n.useSOLBalance&&e.mintA.address===Q.toString(),w=n.useSOLBalance&&e.mintB.address===Q.toString(),[k,I]=s==="MintA"?[a,c]:[c,a],{account:T,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new oe(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:A||k.isZero()?{payer:this.scope.ownerPubKey,amount:k}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:A?!1:u,checkCreateATAOwner:l});T&&(b=T),f.addInstruction(S||{});let{account:B,instructionParams:C}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new oe(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:w||I.isZero()?{payer:this.scope.ownerPubKey,amount:I}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:u,checkCreateATAOwner:l});B&&(g=B),f.addInstruction(C||{}),(!b||!g)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",{ownerTokenAccountA:b==null?void 0:b.toBase58(),ownerTokenAccountB:g==null?void 0:g.toBase58()});let x=t||await this.getClmmPoolKeys(e.id),L=await Te.openPositionFromBaseInstructions({poolInfo:e,poolKeys:x,ownerInfo:E(R({},n),{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:b,tokenAccountB:g}),tickLower:r,tickUpper:i,base:s,baseAmount:a,otherAmountMax:c,withMetadata:m,getEphemeralSigners:d});return f.addInstruction(L),f.addCustomComputeBudget(p),f.versionBuild({txVersion:y,extInfo:R({},L.address)})}async openPositionFromLiquidity({poolInfo:e,poolKeys:t,ownerInfo:n,amountMaxA:r,amountMaxB:i,tickLower:s,tickUpper:a,liquidity:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",txVersion:d,computeBudgetConfig:p,getEphemeralSigners:y}){this.scope.availability.createConcentratedPosition===!1&&this.logAndCreateError("open position feature disabled in your region");let f=this.createTxBuilder(),b=null,g=null,A=n.useSOLBalance&&e.mintA.address===Q.toBase58(),w=n.useSOLBalance&&e.mintB.address===Q.toBase58(),{account:k,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new oe(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:A||r.isZero()?{payer:this.scope.ownerPubKey,amount:r}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:A?!1:u,checkCreateATAOwner:l});k&&(b=k),f.addInstruction(I||{});let{account:T,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new oe(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:w||i.isZero()?{payer:this.scope.ownerPubKey,amount:i}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:u,checkCreateATAOwner:l});T&&(g=T),f.addInstruction(S||{}),(b===void 0||g===void 0)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let B=t||await this.getClmmPoolKeys(e.id),C=await Te.openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:B,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:b,tokenAccountB:g},tickLower:s,tickUpper:a,liquidity:c,amountMaxA:r,amountMaxB:i,withMetadata:m,getEphemeralSigners:y});return f.addInstruction(C),f.addCustomComputeBudget(p),f.versionBuild({txVersion:d,extInfo:{address:C.address}})}async increasePositionFromLiquidity(e){let{poolInfo:t,poolKeys:n,ownerPosition:r,amountMaxA:i,amountMaxB:s,liquidity:a,ownerInfo:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,computeBudgetConfig:m,txVersion:d}=e,p=this.createTxBuilder(),y,f,b=c.useSOLBalance&&t.mintA.address===Q.toString(),g=c.useSOLBalance&&t.mintB.address===Q.toString(),{account:A,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new oe(t.mintA.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,createInfo:b||i.isZero()?{payer:this.scope.ownerPubKey,amount:i}:void 0,skipCloseAccount:!b,associatedOnly:b?!1:u,checkCreateATAOwner:l});A&&(y=A),p.addInstruction(w||{});let{account:k,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new oe(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:g||s.isZero()?{payer:this.scope.ownerPubKey,amount:s}:void 0,notUseTokenAccount:g,skipCloseAccount:!g,associatedOnly:g?!1:u,checkCreateATAOwner:l});k&&(f=k),p.addInstruction(I||{}),!y&&!f&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let T=n!=null?n:await this.getClmmPoolKeys(t.id),S=Te.increasePositionFromLiquidityInstructions({poolInfo:t,poolKeys:T,ownerPosition:r,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:y,tokenAccountB:f},liquidity:a,amountMaxA:i,amountMaxB:s});return p.addInstruction(S),p.addCustomComputeBudget(m),p.versionBuild({txVersion:d,extInfo:{address:S.address}})}async increasePositionFromBase(e){let{poolInfo:t,ownerPosition:n,base:r,baseAmount:i,otherAmountMax:s,ownerInfo:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:l,txVersion:m}=e,d=this.createTxBuilder(),p,y,f=a.useSOLBalance&&t.mintA.address===Q.toString(),b=a.useSOLBalance&&t.mintB.address===Q.toString(),{account:g,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new oe(t.mintA.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,createInfo:f||(r==="MintA"?i:s).isZero()?{payer:this.scope.ownerPubKey,amount:r==="MintA"?i:s}:void 0,skipCloseAccount:!f,associatedOnly:f?!1:c,checkCreateATAOwner:u});g&&(p=g),d.addInstruction(A||{});let{account:w,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new oe(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:b||(r==="MintA"?s:i).isZero()?{payer:this.scope.ownerPubKey,amount:r==="MintA"?s:i}:void 0,notUseTokenAccount:b,skipCloseAccount:!b,associatedOnly:b?!1:c,checkCreateATAOwner:u});w&&(y=w),d.addInstruction(k||{}),!p&&!y&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let I=await this.getClmmPoolKeys(t.id),T=Te.increasePositionFromBaseInstructions({poolInfo:t,poolKeys:I,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:y},base:r,baseAmount:i,otherAmountMax:s});return d.addInstruction(T),d.addCustomComputeBudget(l),d.versionBuild({txVersion:m,extInfo:{address:T.address}})}async decreaseLiquidity(e){let{poolInfo:t,poolKeys:n,ownerPosition:r,ownerInfo:i,amountMinA:s,amountMinB:a,liquidity:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,computeBudgetConfig:m,txVersion:d}=e;this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let p=this.createTxBuilder(),y=i.useSOLBalance&&t.mintA.address===Q.toString(),f=i.useSOLBalance&&t.mintB.address===Q.toString(),b,g,{account:A,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new oe(t.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!y,associatedOnly:y?!1:u,checkCreateATAOwner:l});b=A,w&&p.addInstruction(w);let{account:k,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new oe(t.mintB.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!f,associatedOnly:f?!1:u,checkCreateATAOwner:l});g=k,I&&p.addInstruction(I);let T=[];for(let x of t.rewardDefaultInfos){let L=i.useSOLBalance&&x.mint.address===Q.toString(),W;if(x.mint.address===t.mintA.address)W=b;else if(x.mint.address===t.mintB.address)W=g;else{let{account:v,instructionParams:$}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new oe(x.mint.programId),mint:new oe(x.mint.address),notUseTokenAccount:L,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!L,associatedOnly:L?!1:u,checkCreateATAOwner:l});W=v,$&&p.addInstruction($)}T.push(W)}!b&&!g&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccountRawInfos);let S=n!=null?n:await this.getClmmPoolKeys(t.id),B=await Te.decreaseLiquidityInstructions({poolInfo:t,poolKeys:S,ownerPosition:r,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:b,tokenAccountB:g,rewardAccounts:T},liquidity:c,amountMinA:s,amountMinB:a});p.addInstruction({instructions:B.instructions,instructionTypes:[F.ClmmDecreasePosition]});let C=R({},B.address);if(i.closePosition){let x=await Te.closePositionInstructions({poolInfo:t,poolKeys:S,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:r});p.addInstruction({endInstructions:x.instructions,endInstructionTypes:x.instructionTypes}),C=R(R({},C),x.address)}return p.addCustomComputeBudget(m),p.versionBuild({txVersion:d,extInfo:{address:C}})}async lockPosition(e){let{programId:t=co,authProgramId:n=lo,poolProgramId:r=uo,ownerPosition:i,computeBudgetConfig:s,txVersion:a}=e,c=this.createTxBuilder(),u=await Te.lockPositionInstruction({programId:t,authProgramId:n,poolProgramId:r,owner:this.scope.ownerPubKey,positionNft:i.nftMint});return c.addInstruction({instructions:[u],instructionTypes:[F.ClmmLockPosition]}),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a})}async harvestLockPosition(e){let{programId:t=co,authProgramId:n=lo,ownerPosition:r,ownerInfo:i={useSOLBalance:!0},associatedOnly:s=!0,checkCreateATAOwner:a=!1,computeBudgetConfig:c,txVersion:u}=e,l=await this.getClmmPoolKeys(r.poolId.toString()),m=this.createTxBuilder(),d=i.useSOLBalance&&l.mintA.address===Q.toString(),p=i.useSOLBalance&&l.mintB.address===Q.toString(),y,f,{account:b,instructionParams:g}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:l.mintA.programId,mint:new oe(l.mintA.address),notUseTokenAccount:d,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!d,associatedOnly:d?!1:s,checkCreateATAOwner:a});y=b,g&&m.addInstruction(g);let{account:A,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:l.mintB.programId,mint:new oe(l.mintB.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!p,associatedOnly:p?!1:s,checkCreateATAOwner:a});f=A,w&&m.addInstruction(w);let k={},I=[];for(let S of l.rewardInfos){let B=i.useSOLBalance&&S.mint.address===Q.toString(),C=k[S.mint.address];if(!C){let{account:x,instructionParams:L}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new oe(S.mint.programId),mint:new oe(S.mint.address),notUseTokenAccount:B,owner:this.scope.ownerPubKey,skipCloseAccount:!B,createInfo:{payer:this.scope.ownerPubKey,amount:0},associatedOnly:B?!1:s});C=x,L&&m.addInstruction(L)}k[S.mint.address]=C,I.push(C)}let T=await Te.harvestLockPositionInstruction({programId:t,authProgramId:n,poolKeys:l,ownerPosition:r,owner:this.scope.ownerPubKey,ownerRewardAccounts:I,userVaultA:y,userVaultB:f});return m.addInstruction({instructions:[T],instructionTypes:[F.ClmmHarvestLockPosition]}),m.addCustomComputeBudget(c),m.versionBuild({txVersion:u})}async closePosition({poolInfo:e,poolKeys:t,ownerPosition:n,txVersion:r}){this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let i=this.createTxBuilder(),s=t!=null?t:await this.getClmmPoolKeys(e.id),a=Te.closePositionInstructions({poolInfo:e,poolKeys:s,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:n});return i.addInstruction(a).versionBuild({txVersion:r,extInfo:{address:a.address}})}async initReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:r=!0,checkCreateATAOwner:i=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let c=this.createTxBuilder(),u=t.useSOLBalance&&n.mint.address.toString()===Q.toString(),l=n.perSecond.mul(n.endTime-n.openTime),{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new oe(n.mint.address),mint:new oe(n.mint.address),notUseTokenAccount:!!u,skipCloseAccount:!u,owner:this.scope.ownerPubKey,createInfo:u?{payer:t.feePayer||this.scope.ownerPubKey,amount:new pt(new O(l.toFixed(0)).gte(l)?l.toFixed(0):l.add(1).toFixed(0))}:void 0,associatedOnly:u?!1:r,checkCreateATAOwner:i});d&&c.addInstruction(d),m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let p=await this.getClmmPoolKeys(e.id),y=Te.initRewardInstructions({poolInfo:e,poolKeys:p,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardInfo:{programId:new oe(n.mint.programId),mint:new oe(n.mint.address),openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:ne.decimalToX64(n.perSecond)}});return c.addInstruction(y),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:y.address}})}async initRewards({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfos:r,associatedOnly:i=!0,checkCreateATAOwner:s=!1,computeBudgetConfig:a,txVersion:c}){for(let m of r)m.endTime<=m.openTime&&this.logAndCreateError("reward time error","rewardInfo",m);let u=this.createTxBuilder(),l={};for(let m of r){let d=n.useSOLBalance&&m.mint.address===Q.toString(),p=m.perSecond.mul(m.endTime-m.openTime),{account:y,instructionParams:f}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new oe(m.mint.programId),mint:new oe(m.mint.address),notUseTokenAccount:!!d,skipCloseAccount:!d,owner:this.scope.ownerPubKey,createInfo:d?{payer:n.feePayer||this.scope.ownerPubKey,amount:new pt(new O(p.toFixed(0)).gte(p)?p.toFixed(0):p.add(1).toFixed(0))}:void 0,associatedOnly:d?!1:i,checkCreateATAOwner:s});f&&u.addInstruction(f),y||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let b=t!=null?t:await this.getClmmPoolKeys(e.id),g=Te.initRewardInstructions({poolInfo:e,poolKeys:b,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:y},rewardInfo:{programId:new oe(m.mint.programId),mint:new oe(m.mint.address),openTime:m.openTime,endTime:m.endTime,emissionsPerSecondX64:ne.decimalToX64(m.perSecond)}});l=R(R({},l),g.address),u.addInstruction(g)}return u.addCustomComputeBudget(a),u.versionBuild({txVersion:c,extInfo:{address:l}})}async setReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:r=!0,checkCreateATAOwner:i=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let c=this.createTxBuilder(),u=t.useSOLBalance&&n.mint.equals(Q),{account:l,instructionParams:m}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n.programId,mint:n.mint,notUseTokenAccount:u,owner:this.scope.ownerPubKey,createInfo:u?{payer:t.feePayer||this.scope.ownerPubKey,amount:new pt(new O(n.perSecond.sub(n.endTime-n.openTime).toFixed(0)).gte(n.perSecond.sub(n.endTime-n.openTime))?n.perSecond.sub(n.endTime-n.openTime).toFixed(0):n.perSecond.sub(n.endTime-n.openTime).add(1).toFixed(0))}:void 0,associatedOnly:u?!1:r,checkCreateATAOwner:i});m&&c.addInstruction(m),l||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let d=await this.getClmmPoolKeys(e.id),p=Te.setRewardInstructions({poolInfo:e,poolKeys:d,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:l},rewardInfo:{mint:n.mint,openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:ne.decimalToX64(n.perSecond)}});return c.addInstruction(p),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:p.address}})}async setRewards({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfos:r,associatedOnly:i=!0,checkCreateATAOwner:s=!1,computeBudgetConfig:a,txVersion:c}){let u=this.createTxBuilder(),l={};for(let m of r){m.endTime<=m.openTime&&this.logAndCreateError("reward time error","rewardInfo",m);let d=n.useSOLBalance&&m.mint.address===Q.toString(),{account:p,instructionParams:y}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new oe(m.mint.programId),mint:new oe(m.mint.address),notUseTokenAccount:d,owner:this.scope.ownerPubKey,createInfo:d?{payer:n.feePayer||this.scope.ownerPubKey,amount:new pt(new O(m.perSecond.sub(m.endTime-m.openTime).toFixed(0)).gte(m.perSecond.sub(m.endTime-m.openTime))?m.perSecond.sub(m.endTime-m.openTime).toFixed(0):m.perSecond.sub(m.endTime-m.openTime).add(1).toFixed(0))}:void 0,associatedOnly:d?!1:i,checkCreateATAOwner:s});y&&u.addInstruction(y),p||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let f=t!=null?t:await this.getClmmPoolKeys(e.id),b=Te.setRewardInstructions({poolInfo:e,poolKeys:f,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:p},rewardInfo:{mint:new oe(m.mint.address),openTime:m.openTime,endTime:m.endTime,emissionsPerSecondX64:ne.decimalToX64(m.perSecond)}});u.addInstruction(b),l=R(R({},l),b.address)}return u.addCustomComputeBudget(a),u.versionBuild({txVersion:c,extInfo:{address:l}})}async collectReward({poolInfo:e,ownerInfo:t,rewardMint:n,associatedOnly:r=!0,checkCreateATAOwner:i=!1}){let s=e.rewardDefaultInfos.find(p=>p.mint.address===n.toString());s||this.logAndCreateError("reward mint error","not found reward mint",n);let a=this.createTxBuilder(),c=t.useSOLBalance&&n.equals(Q),{account:u,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new oe(s.mint.programId),mint:n,notUseTokenAccount:c,owner:this.scope.ownerPubKey,skipCloseAccount:!c,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:c?!1:r,checkCreateATAOwner:i});l&&a.addInstruction(l),u||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let m=await this.getClmmPoolKeys(e.id),d=Te.collectRewardInstructions({poolInfo:e,poolKeys:m,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:u},rewardMint:n});return a.addInstruction(d),a.build({address:d.address})}async collectRewards({poolInfo:e,ownerInfo:t,rewardMints:n,associatedOnly:r=!0,checkCreateATAOwner:i=!1}){let s=this.createTxBuilder(),a={};for(let c of n){let u=e.rewardDefaultInfos.find(f=>f.mint.address===c.toString());if(!u){this.logAndCreateError("reward mint error","not found reward mint",c);continue}let l=t.useSOLBalance&&c.equals(Q),{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new oe(u.mint.programId),mint:c,notUseTokenAccount:l,owner:this.scope.ownerPubKey,skipCloseAccount:!l,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:l?!1:r,checkCreateATAOwner:i});m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos),d&&s.addInstruction(d);let p=await this.getClmmPoolKeys(e.id),y=Te.collectRewardInstructions({poolInfo:e,poolKeys:p,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardMint:c});s.addInstruction(y),a=R(R({},a),y.address)}return s.build({address:a})}async swap({poolInfo:e,poolKeys:t,inputMint:n,amountIn:r,amountOutMin:i,priceLimit:s,observationId:a,ownerInfo:c,remainingAccounts:u,associatedOnly:l=!0,checkCreateATAOwner:m=!1,txVersion:d,computeBudgetConfig:p}){let y=this.createTxBuilder(),f=n.toString()===e.mintA.address,b=c.useSOLBalance&&e.mintA.address===Q.toBase58(),g=c.useSOLBalance&&e.mintB.address===Q.toBase58(),A;!s||s.equals(new O(0))?A=f?ht.add(new pt(1)):kt.sub(new pt(1)):A=ee.priceToSqrtPriceX64(s,e.mintA.decimals,e.mintB.decimals);let w;if(!w){let{account:T,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new oe(e.mintA.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,skipCloseAccount:!b,createInfo:b||!f?{payer:c.feePayer||this.scope.ownerPubKey,amount:f?r:0}:void 0,associatedOnly:b?!1:l,checkCreateATAOwner:m});w=T,S&&y.addInstruction(S)}let k;if(!k){let{account:T,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new oe(e.mintB.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,skipCloseAccount:!g,createInfo:g||f?{payer:c.feePayer||this.scope.ownerPubKey,amount:f?0:r}:void 0,associatedOnly:g?!1:l,checkCreateATAOwner:m});k=T,S&&y.addInstruction(S)}(!w||!k)&&this.logAndCreateError("user do not have token account",{tokenA:e.mintA.symbol||e.mintA.address,tokenB:e.mintB.symbol||e.mintB.address,ownerTokenAccountA:w,ownerTokenAccountB:k,mintAUseSOLBalance:b,mintBUseSOLBalance:g,associatedOnly:l});let I=t!=null?t:await this.getClmmPoolKeys(e.id);return y.addInstruction(Te.makeSwapBaseInInstructions({poolInfo:e,poolKeys:I,observationId:a,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:w,tokenAccountB:k},inputMint:new oe(n),amountIn:r,amountOutMin:i,sqrtPriceLimitX64:A,remainingAccounts:u})),y.addCustomComputeBudget(p),y.versionBuild({txVersion:d})}async swapBaseOut({poolInfo:e,poolKeys:t,outputMint:n,amountOut:r,amountInMax:i,priceLimit:s,observationId:a,ownerInfo:c,remainingAccounts:u,associatedOnly:l=!0,checkCreateATAOwner:m=!1,txVersion:d,computeBudgetConfig:p}){let y=this.createTxBuilder(),f=n.toString()===e.mintB.address,b=c.useSOLBalance&&e.mintA.address===Q.toBase58(),g=c.useSOLBalance&&e.mintB.address===Q.toBase58(),A;!s||s.equals(new O(0))?A=n.toString()===e.mintB.address?ht.add(new pt(1)):kt.sub(new pt(1)):A=ee.priceToSqrtPriceX64(s,e.mintA.decimals,e.mintB.decimals);let w;if(!w){let{account:T,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new oe(e.mintA.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,skipCloseAccount:!b,createInfo:b||!f?{payer:c.feePayer||this.scope.ownerPubKey,amount:f?i:0}:void 0,associatedOnly:b?!1:l,checkCreateATAOwner:m});w=T,S&&y.addInstruction(S)}let k;if(!k){let{account:T,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new oe(e.mintB.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,skipCloseAccount:!g,createInfo:g||f?{payer:c.feePayer||this.scope.ownerPubKey,amount:f?0:i}:void 0,associatedOnly:g?!1:l,checkCreateATAOwner:m});k=T,S&&y.addInstruction(S)}(!w||!k)&&this.logAndCreateError("user do not have token account",{tokenA:e.mintA.symbol||e.mintA.address,tokenB:e.mintB.symbol||e.mintB.address,ownerTokenAccountA:w,ownerTokenAccountB:k,mintAUseSOLBalance:b,mintBUseSOLBalance:g,associatedOnly:l});let I=t!=null?t:await this.getClmmPoolKeys(e.id);return y.addInstruction(Te.makeSwapBaseOutInstructions({poolInfo:e,poolKeys:I,observationId:a,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:w,tokenAccountB:k},outputMint:new oe(n),amountOut:r,amountInMax:i,sqrtPriceLimitX64:A,remainingAccounts:u})),y.addCustomComputeBudget(p),y.versionBuild({txVersion:d})}async harvestAllRewards({allPoolInfo:e,allPositions:t,lockInfo:n,ownerInfo:r,associatedOnly:i=!0,checkCreateATAOwner:s=!1,programId:a,txVersion:c,computeBudgetConfig:u}){let l={};for(let d of this.scope.account.tokenAccountRawInfos)i?ge(this.scope.ownerPubKey,d.accountInfo.mint,a).publicKey.equals(d.pubkey)&&(l[d.accountInfo.mint.toString()]=d.pubkey):l[d.accountInfo.mint.toString()]=d.pubkey;let m=this.createTxBuilder();for(let d of Object.values(e)){if(t[d.id]===void 0||!t[d.id].find(k=>!k.liquidity.isZero()||k.rewardInfos.find(I=>!I.rewardAmountOwed.isZero())))continue;let p=d,y=r.useSOLBalance&&p.mintA.address===Q.toString(),f=r.useSOLBalance&&p.mintB.address===Q.toString(),b=l[p.mintA.address];if(!b){let{account:k,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:p.mintA.programId,mint:new oe(p.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,skipCloseAccount:!y,createInfo:{payer:r.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:y?!1:i,checkCreateATAOwner:s});b=k,I&&m.addInstruction(I)}let g=l[p.mintB.address];if(!g){let{account:k,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:p.mintB.programId,mint:new oe(p.mintB.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,skipCloseAccount:!f,createInfo:{payer:r.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:f?!1:i,checkCreateATAOwner:s});g=k,I&&m.addInstruction(I)}l[p.mintA.address]=b,l[p.mintB.address]=g;let A=[];for(let k of p.rewardDefaultInfos){let I=r.useSOLBalance&&k.mint.address===Q.toString(),T=l[k.mint.address];if(!T){let{account:S,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new oe(k.mint.programId),mint:new oe(k.mint.address),notUseTokenAccount:I,owner:this.scope.ownerPubKey,skipCloseAccount:!I,createInfo:{payer:r.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:I?!1:i});T=S,B&&m.addInstruction(B)}l[k.mint.address]=T,A.push(T)}let w=await this.getClmmPoolKeys(p.id);for(let k of t[d.id])if(n&&n[d.id]&&n[d.id][k.nftMint.toBase58()]){let I=Te.harvestLockPositionInstruction({poolKeys:w,owner:this.scope.ownerPubKey,ownerPosition:k,ownerRewardAccounts:A,programId:co,authProgramId:lo,userVaultA:b,userVaultB:g});m.addInstruction({instructions:[I],instructionTypes:[F.ClmmHarvestLockPosition],lookupTableAddress:w.lookupTableAccount?[w.lookupTableAccount]:[]})}else{let I=Te.decreaseLiquidityInstructions({poolInfo:p,poolKeys:w,ownerPosition:k,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:b,tokenAccountB:g,rewardAccounts:A},liquidity:new pt(0),amountMinA:new pt(0),amountMinB:new pt(0)});m.addInstruction(I)}}return c===0?m.sizeCheckBuildV0({computeBudgetConfig:u}):m.sizeCheckBuild({computeBudgetConfig:u})}async getWhiteListMint({programId:e}){let t=await this.scope.connection.getAccountInfo(No(e).publicKey);return t?ju.decode(t.data).whitelistMints.filter(r=>!r.equals(oe.default)):[]}async getOwnerPositionInfo({programId:e}){await this.scope.account.fetchWalletTokenAccounts();let n=this.scope.account.tokenAccountRawInfos.filter(s=>s.accountInfo.amount.eq(new pt(1))).map(s=>mt(new oe(e),s.accountInfo.mint).publicKey),r=await this.scope.connection.getMultipleAccountsInfo(n),i=[];return r.forEach(s=>{if(!s)return;let a=Dr.decode(s.data);i.push(a)}),i}async getRpcClmmPoolInfo({poolId:e}){return(await this.getRpcClmmPoolInfos({poolIds:[e]}))[String(e)]}async getRpcClmmPoolInfos({poolIds:e,config:t}){let n=await Fe(this.scope.connection,e.map(i=>({pubkey:new oe(i)})),t),r={};for(let i=0;i<e.length;i++){let s=n[i];if(s===null||!s.accountInfo)throw Error("fetch pool info error: "+String(e[i]));let a=kn.decode(s.accountInfo.data),c=ee.sqrtPriceX64ToPrice(a.sqrtPriceX64,a.mintDecimalsA,a.mintDecimalsB).toNumber();r[String(e[i])]=E(R({},a),{currentPrice:c,programId:s.accountInfo.owner})}return r}async getComputeClmmPoolInfos({clmmPoolsRpcInfo:e,mintInfos:t}){let n=new Set(Object.keys(e).map(c=>e[c].ammConfig.toBase58())),r=await Fe(this.scope.connection,Array.from(n).map(c=>({pubkey:new oe(c)}))),i={};r.forEach(c=>{!c.accountInfo||(i[c.pubkey.toBase58()]=Qu.decode(c.accountInfo.data))});let s=await Ce.fetchComputeMultipleClmmInfo({connection:this.scope.connection,rpcDataMap:e,poolList:Object.keys(e).map(c=>{var m,d,p,y;let[u,l]=[e[c].mintA.toBase58(),e[c].mintB.toBase58()];return{id:c,programId:e[c].programId.toBase58(),mintA:st({address:u,decimals:e[c].mintDecimalsA,programId:t[u].programId.toBase58()||bc.toBase58(),extensions:{feeConfig:(m=t[u])!=null&&m.feeConfig?mn((d=t[u])==null?void 0:d.feeConfig):void 0}}),mintB:st({address:l,decimals:e[c].mintDecimalsB,programId:t[l].programId.toBase58()||bc.toBase58(),extensions:{feeConfig:(p=t[l])!=null&&p.feeConfig?mn((y=t[l])==null?void 0:y.feeConfig):void 0}}),price:e[c].currentPrice,config:E(R({},i[e[c].ammConfig.toBase58()]),{id:e[c].ammConfig.toBase58(),fundFeeRate:0,description:"",defaultRange:0,defaultRangePoint:[]})}})}),a=await Ce.fetchMultiplePoolTickArrays({connection:this.scope.connection,poolKeys:Object.values(s)});return{computeClmmPoolInfo:s,computePoolTickData:a}}async getPoolInfoFromRpc(e){var l;let t=await this.getRpcClmmPoolInfo({poolId:e}),n=new Set([t.mintA.toBase58(),t.mintB.toBase58()]),r=await Nn({connection:this.scope.connection,mints:Array.from(n).map(m=>new oe(m))}),{computeClmmPoolInfo:i,computePoolTickData:s}=await this.scope.clmm.getComputeClmmPoolInfos({clmmPoolsRpcInfo:{[e]:t},mintInfos:r}),a=await Fe(this.scope.connection,[{pubkey:t.vaultA},{pubkey:t.vaultB}]),c=Xu(i[e]);if(!a[0].accountInfo||!a[1].accountInfo)throw new Error("pool vault data not found");c.mintAmountA=Number(yc.decode(a[0].accountInfo.data).amount.toString()),c.mintAmountB=Number(yc.decode((l=a[1].accountInfo)==null?void 0:l.data).amount.toString());let u=E(R({},i[e]),{id:e,programId:t.programId.toBase58(),openTime:t.startTime.toString(),vault:{A:t.vaultA.toBase58(),B:t.vaultB.toBase58()},rewardInfos:[],config:c.config});return{poolInfo:c,poolKeys:u,computePoolInfo:i[e],tickData:s}}};import{PublicKey as Y}from"@solana/web3.js";import{AccountLayout as yf,NATIVE_MINT as ei,TOKEN_PROGRAM_ID as Yt}from"@solana/spl-token";import Fs from"bn.js";import jr from"decimal.js-light";import qo from"bn.js";function zr(o,e){if(e.isZero())throw Error("divisor is zero");return o.mod(e)}function nf(o,e){if(e.isZero())throw Error("rhs is zero");let t=o.div(e);if(t.isZero())throw Error("quotient is zero");let n=zr(o,e);return n.gt(Hn)&&(t=t.add(new qo(1)),e=o.div(t),n=zr(o,t),n.gt(Hn)&&(e=e.add(new qo(1)))),[t,e]}var Hn=new qo(0),Qr=class{static swapWithoutFees(e,t,n){let r=t.mul(n),i=t.add(e),[s,a]=nf(r,i),c=a.sub(t),u=n.sub(s);if(u.isZero())throw Error("destinationAmountSwapped is zero");return{sourceAmountSwapped:c,destinationAmountSwapped:u}}static lpTokensToTradingTokens(e,t,n,r,i){let s=e.mul(n).div(t),a=e.mul(r).div(t);if(i===0)return{tokenAmount0:s,tokenAmount1:a};if(i===1)return zr(e.mul(n),t).gt(Hn)&&s.gt(Hn)&&(s=s.add(new qo(1))),zr(e.mul(r),t).gt(Hn)&&a.gt(Hn)&&(a=a.add(new qo(1))),{tokenAmount0:s,tokenAmount1:a};throw Error("roundDirection value error")}};import wc from"bn.js";var Vs=new wc(1e6);function of(o,e,t){return o.mul(e).add(t).sub(new wc(1)).div(t)}function Ac(o,e,t){return o.mul(e).div(t)}var Yr=class{static tradingFee(e,t){return of(e,t,Vs)}static protocolFee(e,t){return Ac(e,t,Vs)}static fundFee(e,t){return Ac(e,t,Vs)}};var gc=(t=>(t[t.Floor=0]="Floor",t[t.Ceiling=1]="Ceiling",t))(gc||{}),Hr=class{static validate_supply(e,t){if(e.isZero())throw Error("tokenAmount0 is zero");if(t.isZero())throw Error("tokenAmount1 is zero")}static swap(e,t,n,r){let i=Yr.tradingFee(e,r),s=e.sub(i),{sourceAmountSwapped:a,destinationAmountSwapped:c}=Qr.swapWithoutFees(s,t,n),u=a.add(i);return{newSwapSourceAmount:t.add(u),newSwapDestinationAmount:n.sub(c),sourceAmountSwapped:u,destinationAmountSwapped:c,tradeFee:i}}static swapBaseOut({poolMintA:e,poolMintB:t,tradeFeeRate:n,baseReserve:r,quoteReserve:i,outputMint:s,outputAmount:a}){let[c,u,l,m,d]=t.address===s.toString()?[r,i,e.decimals,t.decimals,e.address]:[i,r,t.decimals,e.decimals,t.address],p=new jr(u.toString()).div(10**m).div(new jr(c.toString()).div(10**l)),y=a.gte(u)?u.sub(new Fs(1)):a,f=u.sub(y),b=Kt(c.mul(y),f),g=Kt(b.mul(new Fs(1e6)),new Fs(1e6).sub(n)),A=g.sub(b),w=new jr(y.toString()).div(10**m).div(new jr(g.toString()).div(10**l)),k=p.isZero()?0:w.sub(p).div(p).abs().toNumber();return{amountRealOut:y,amountIn:g,amountInWithoutFee:b,tradeFee:A,priceImpact:k}}};import Re from"bn.js";import{TransactionInstruction as Uo}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as pf,TOKEN_2022_PROGRAM_ID as kc,TOKEN_PROGRAM_ID as Ds}from"@solana/spl-token";var rf=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),sf=Buffer.from("amm_config","utf8"),af=Buffer.from("pool","utf8"),uf=Buffer.from("pool_lp_mint","utf8"),cf=Buffer.from("pool_vault","utf8"),lf=Buffer.from("observation","utf8");function Zn(o){return ae([rf],o)}function ox(o,e){return ae([sf,df(e)],o)}function Es(o,e,t,n){return ae([af,e.toBuffer(),t.toBuffer(),n.toBuffer()],o)}function mf(o,e){return ae([uf,e.toBuffer()],o)}function Pc(o,e,t){return ae([cf,e.toBuffer(),t.toBuffer()],o)}function Zr(o,e){return ae([lf,e.toBuffer()],o)}function df(o){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,o,!1),new Uint8Array(e)}function hc({poolId:o,programId:e,configId:t,mintA:n,mintB:r}){let i=Zn(e).publicKey,s=o||Es(e,t,n,r).publicKey,a=mf(e,s).publicKey,c=Pc(e,s,n).publicKey,u=Pc(e,s,r).publicKey,l=Zr(e,s).publicKey;return{poolId:s,configId:t,authority:i,lpMint:a,vaultA:c,vaultB:u,observationId:l}}var ff=ce("Raydium_cpmm"),Go={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173]};function Tc(o,e,t,n,r,i,s,a,c,u,l,m,d,p,y,f,b,g,A,w){let k=_([P("amountMaxA"),P("amountMaxB"),P("openTime")]),I=Es(o,t,i,s).publicKey,T=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!r.equals(I),isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:Ds,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:pf,isSigner:!1,isWritable:!1},{pubkey:pr,isSigner:!1,isWritable:!1},{pubkey:ut,isSigner:!1,isWritable:!1}],S=Buffer.alloc(k.span);return k.encode({amountMaxA:g,amountMaxB:A,openTime:w},S),new Uo({keys:T,programId:o,data:Buffer.from([...Go.initialize,...S])})}function Ic(o,e,t,n,r,i,s,a,c,u,l,m,d,p,y){let f=_([P("lpAmount"),P("amountMaxA"),P("amountMaxB")]),b=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:Ds,isSigner:!1,isWritable:!1},{pubkey:kc,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!0}],g=Buffer.alloc(f.span);return ff.debug("cpmm deposit data",{lpAmount:d.toString(),amountMaxA:p.toString(),amountMaxB:y.toString()}),f.encode({lpAmount:d,amountMaxA:p,amountMaxB:y},g),new Uo({keys:b,programId:o,data:Buffer.from([...Go.deposit,...g])})}function Bc(o,e,t,n,r,i,s,a,c,u,l,m,d,p,y){let f=_([P("lpAmount"),P("amountMinA"),P("amountMinB")]),b=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:Ds,isSigner:!1,isWritable:!1},{pubkey:kc,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:vn,isSigner:!1,isWritable:!1}],g=Buffer.alloc(f.span);return f.encode({lpAmount:d,amountMinA:p,amountMinB:y},g),new Uo({keys:b,programId:o,data:Buffer.from([...Go.withdraw,...g])})}function $r(o,e,t,n,r,i,s,a,c,u,l,m,d,p,y,f){let b=_([P("amountIn"),P("amounOutMin")]),g=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],A=Buffer.alloc(b.span);return b.encode({amountIn:y,amounOutMin:f},A),new Uo({keys:g,programId:o,data:Buffer.from([...Go.swapBaseInput,...A])})}function xc(o,e,t,n,r,i,s,a,c,u,l,m,d,p,y,f){let b=_([P("amountInMax"),P("amountOut")]),g=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],A=Buffer.alloc(b.span);return b.encode({amountInMax:y,amountOut:f},A),new Uo({keys:g,programId:o,data:Buffer.from([...Go.swapBaseOutput,...A])})}var Sc=_([Ae(8),D("bump"),Ze("disableCreatePool"),Dt("index"),P("tradeFeeRate"),P("protocolFeeRate"),P("fundFeeRate"),P("createPoolFee"),K("protocolOwner"),K("fundOwner"),G(P(),16)]),Jr=_([Ae(8),K("configId"),K("poolCreator"),K("vaultA"),K("vaultB"),K("mintLp"),K("mintA"),K("mintB"),K("mintProgramA"),K("mintProgramB"),K("observationId"),D("bump"),D("status"),D("lpDecimals"),D("mintDecimalA"),D("mintDecimalB"),P("lpAmount"),P("protocolFeesMintA"),P("protocolFeesMintB"),P("fundFeesMintA"),P("fundFeesMintB"),P("openTime"),G(P(),32)]);var Xo=class extends Se{constructor(e){super(e)}async load(){this.checkDisabled()}async getCpmmPoolKeys(e){return(await this.scope.api.fetchPoolKeysById({idList:[e]}))[0]}async getRpcPoolInfo(e,t){return(await this.getRpcPoolInfos([e],t))[e]}async getRpcPoolInfos(e,t){let n=await Fe(this.scope.connection,e.map(m=>({pubkey:new Y(m)}))),r={},i=new Set,s=[];for(let m=0;m<e.length;m++){let d=n[m];if(d.accountInfo===null)throw Error("fetch pool info error: "+String(e[m]));let p=Jr.decode(d.accountInfo.data);r[String(e[m])]=E(R({},p),{programId:d.accountInfo.owner}),i.add(String(p.configId)),s.push(p.vaultA,p.vaultB)}let a={};if(t){let m=[...i],d=await Fe(this.scope.connection,m.map(p=>({pubkey:new Y(p)})));for(let p=0;p<m.length;p++){let y=d[p].accountInfo;if(y===null)throw Error("fetch pool config error: "+m[p]);a[m[p]]=Sc.decode(y.data)}}let c={},u=await Fe(this.scope.connection,s.map(m=>({pubkey:new Y(m)})));for(let m=0;m<s.length;m++){let d=u[m].accountInfo;if(d===null)throw Error("fetch vault info error: "+s[m]);c[String(s[m])]=new Re(yf.decode(d.data).amount.toString())}let l={};for(let[m,d]of Object.entries(r)){let p=c[d.vaultA.toString()].sub(d.protocolFeesMintA).sub(d.fundFeesMintA),y=c[d.vaultB.toString()].sub(d.protocolFeesMintB).sub(d.fundFeesMintB);l[m]=E(R({},d),{baseReserve:p,quoteReserve:y,vaultAAmount:c[d.vaultA.toString()],vaultBAmount:c[d.vaultB.toString()],configInfo:a[d.configId.toString()],poolPrice:new O(y.toString()).div(new O(10).pow(d.mintDecimalB)).div(new O(p.toString()).div(new O(10).pow(d.mintDecimalA)))})}return l}toComputePoolInfos({pools:e,mintInfos:t}){return Object.keys(e).reduce((n,r)=>{var c,u,l,m;let i=e[r],[s,a]=[i.mintA.toBase58(),i.mintB.toBase58()];return E(R({},n),{[r]:E(R({},i),{id:new Y(r),configInfo:i.configInfo,version:7,authority:Zn(i.programId).publicKey,mintA:st({address:s,decimals:i.mintDecimalA,programId:i.mintProgramA.toBase58(),extensions:{feeConfig:(c=t[s])!=null&&c.feeConfig?mn((u=t[s])==null?void 0:u.feeConfig):void 0}}),mintB:st({address:a,decimals:i.mintDecimalB,programId:i.mintProgramB.toBase58(),extensions:{feeConfig:(l=t[a])!=null&&l.feeConfig?mn((m=t[a])==null?void 0:m.feeConfig):void 0}})})})},{})}async getPoolInfoFromRpc(e){let t=await this.getRpcPoolInfo(e,!0),n=await Nn({connection:this.scope.connection,mints:[t.mintA,t.mintB]}),r=st({address:t.mintA.toBase58(),decimals:t.mintDecimalA,programId:t.mintProgramA.toBase58(),extensions:{feeConfig:n[t.mintA.toBase58()].feeConfig?mn(n[t.mintA.toBase58()].feeConfig):void 0}}),i=st({address:t.mintB.toBase58(),decimals:t.mintDecimalB,programId:t.mintProgramB.toBase58(),extensions:{feeConfig:n[t.mintB.toBase58()].feeConfig?mn(n[t.mintB.toBase58()].feeConfig):void 0}}),s=st({address:t.mintLp.toBase58(),decimals:t.lpDecimals,programId:Yt.toBase58()}),a={id:t.configId.toBase58(),index:t.configInfo.index,protocolFeeRate:t.configInfo.protocolFeeRate.toNumber(),tradeFeeRate:t.configInfo.tradeFeeRate.toNumber(),fundFeeRate:t.configInfo.fundFeeRate.toNumber(),createPoolFee:t.configInfo.createPoolFee.toString()},c={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]};return{poolInfo:{programId:t.programId.toBase58(),id:e,type:"Standard",lpMint:s,lpPrice:0,lpAmount:t.lpAmount.toNumber(),config:a,mintA:r,mintB:i,rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:t.poolPrice.toNumber(),mintAmountA:new O(t.vaultAAmount.toString()).div(10**r.decimals).toNumber(),mintAmountB:new O(t.vaultBAmount.toString()).div(10**i.decimals).toNumber(),feeRate:t.configInfo.tradeFeeRate.toNumber(),openTime:t.openTime.toString(),tvl:0,burnPercent:0,day:c,week:c,month:c,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0},poolKeys:{programId:t.programId.toBase58(),id:e,mintA:r,mintB:i,openTime:t.openTime.toString(),vault:{A:t.vaultA.toBase58(),B:t.vaultB.toBase58()},authority:Zn(t.programId).publicKey.toBase58(),mintLp:s,config:a},rpcData:t}}async createPool(d){var p=d,{poolId:e,programId:t,poolFeeAccount:n,startTime:r,ownerInfo:i,associatedOnly:s=!1,checkCreateATAOwner:a=!1,txVersion:c,feeConfig:u,computeBudgetConfig:l}=p,m=Oe(p,["poolId","programId","poolFeeAccount","startTime","ownerInfo","associatedOnly","checkCreateATAOwner","txVersion","feeConfig","computeBudgetConfig"]);var $,X,q;let y=i.feePayer||(($=this.scope.owner)==null?void 0:$.publicKey),f=new Re(new Y(m.mintA.address).toBuffer()).lte(new Re(new Y(m.mintB.address).toBuffer())),[b,g]=f?[m.mintA,m.mintB]:[m.mintB,m.mintA],[A,w]=f?[m.mintAAmount,m.mintBAmount]:[m.mintBAmount,m.mintAAmount],k=i.useSOLBalance&&b.address===ei.toBase58(),I=i.useSOLBalance&&g.address===ei.toBase58(),[T,S]=[new Y(b.address),new Y(g.address)],B=this.createTxBuilder(),{account:C,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({mint:T,tokenProgram:b.programId,owner:this.scope.ownerPubKey,createInfo:k?{payer:y,amount:A}:void 0,notUseTokenAccount:k,skipCloseAccount:!k,associatedOnly:k?!1:s,checkCreateATAOwner:a});B.addInstruction(x||{});let{account:L,instructionParams:W}=await this.scope.account.getOrCreateTokenAccount({mint:new Y(g.address),tokenProgram:g.programId,owner:this.scope.ownerPubKey,createInfo:I?{payer:y,amount:w}:void 0,notUseTokenAccount:I,skipCloseAccount:!I,associatedOnly:I?!1:s,checkCreateATAOwner:a});if(B.addInstruction(W||{}),C===void 0||L===void 0)throw Error("you don't has some token account");let v=hc({poolId:e,programId:t,configId:new Y(u.id),mintA:T,mintB:S});return B.addInstruction({instructions:[Tc(t,this.scope.ownerPubKey,new Y(u.id),v.authority,v.poolId,T,S,v.lpMint,C,L,ge(this.scope.ownerPubKey,v.lpMint).publicKey,v.vaultA,v.vaultB,n,new Y((X=b.programId)!=null?X:Yt),new Y((q=g.programId)!=null?q:Yt),v.observationId,A,w,r)],instructionTypes:[F.CpmmCreatePool]}),B.addCustomComputeBudget(l),B.versionBuild({txVersion:c,extInfo:{address:E(R({},v),{mintA:b,mintB:g,programId:t,poolFeeAccount:n,feeConfig:u})}})}async addLiquidity(e){let{poolInfo:t,poolKeys:n,inputAmount:r,baseIn:i,slippage:s,computeResult:a,computeBudgetConfig:c,config:u,txVersion:l}=e;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region"),r.isZero()&&this.logAndCreateError("amounts must greater than zero","amountInA",{amountInA:r.toString()});let{account:m}=this.scope,{bypassAssociatedCheck:d,checkCreateATAOwner:p}=R({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},u),y=a?void 0:await this.getRpcPoolInfo(t.id),{liquidity:f,inputAmountFee:b,anotherAmount:g}=a||this.computePairAmount({poolInfo:E(R({},t),{lpAmount:new O(y.lpAmount.toString()).div(10**t.lpMint.decimals).toNumber()}),baseReserve:y.baseReserve,quoteReserve:y.quoteReserve,slippage:new Ke(0),baseIn:i,epochInfo:await this.scope.fetchEpochInfo(),amount:new O(r.toString()).div(10**(i?t.mintA.decimals:t.mintB.decimals))}),A=g.amount,w=t.mintA.address===ei.toString(),k=t.mintB.address===ei.toString(),I=this.createTxBuilder(),[T,S]=[new Y(t.mintA.address),new Y(t.mintB.address)],{account:B,instructionParams:C}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new Y(t.mintA.address),owner:this.scope.ownerPubKey,createInfo:w||(i?r:A).isZero()?{payer:this.scope.ownerPubKey,amount:i?r:A}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:!1,checkCreateATAOwner:p});I.addInstruction(C||{});let{account:x,instructionParams:L}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new Y(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:k||(i?A:r).isZero()?{payer:this.scope.ownerPubKey,amount:i?A:r}:void 0,skipCloseAccount:!k,notUseTokenAccount:k,associatedOnly:!1,checkCreateATAOwner:p});I.addInstruction(L||{}),!B&&!x&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",m.tokenAccounts);let W=await m.getCreatedTokenAccount({mint:new Y(t.lpMint.address)}),ot=await m.handleTokenAccount({side:"out",amount:0,mint:new Y(t.lpMint.address),tokenAccount:W,bypassAssociatedCheck:d,checkCreateATAOwner:p}),{tokenAccount:v}=ot,$=Oe(ot,["tokenAccount"]);I.addInstruction($);let X=n!=null?n:await this.getCpmmPoolKeys(t.id),q=new Ke(new Re(1)).sub(s);return I.addInstruction({instructions:[Ic(new Y(t.programId),this.scope.ownerPubKey,new Y(X.authority),new Y(t.id),v,B,x,new Y(X.vault.A),new Y(X.vault.B),T,S,new Y(t.lpMint.address),a?a==null?void 0:a.liquidity:q.mul(f).quotient,i?b.amount:A,i?A:b.amount)],instructionTypes:[F.CpmmAddLiquidity],lookupTableAddress:X.lookupTableAccount?[X.lookupTableAccount]:[]}),I.addCustomComputeBudget(c),I.versionBuild({txVersion:l})}async withdrawLiquidity(e){var v,$;let{poolInfo:t,poolKeys:n,lpAmount:r,slippage:i,computeBudgetConfig:s,txVersion:a}=e;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region");let c=new Ke(new Re(1)).sub(i),u=await this.getRpcPoolInfo(t.id),[l,m]=[c.mul(r.mul(u.baseReserve).div(u.lpAmount)).quotient,c.mul(r.mul(u.quoteReserve).div(u.lpAmount)).quotient],d=await this.scope.fetchEpochInfo(),[p,y]=[ye(l,t.mintA.extensions.feeConfig,d,!1),ye(m,t.mintB.extensions.feeConfig,d,!1)],{account:f}=this.scope,b=this.createTxBuilder(),[g,A]=[new Y(t.mintA.address),new Y(t.mintB.address)],w=g.equals(Q),k=A.equals(Q),I,T,{account:S,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new Y(t.mintA.address),notUseTokenAccount:w,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!w,associatedOnly:!w,checkCreateATAOwner:!1});I=S,B&&b.addInstruction(B);let{account:C,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new Y(t.mintB.address),notUseTokenAccount:k,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!k,associatedOnly:!k,checkCreateATAOwner:!1});T=C,x&&b.addInstruction(x),(!I||!T)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",f.tokenAccounts);let L=await f.getCreatedTokenAccount({mint:new Y(t.lpMint.address)});L||this.logAndCreateError("cannot found lp token account","tokenAccounts",f.tokenAccounts);let W=n!=null?n:await this.getCpmmPoolKeys(t.id);return b.addInstruction({instructions:[Bc(new Y(t.programId),this.scope.ownerPubKey,new Y(W.authority),new Y(t.id),L,I,T,new Y(W.vault.A),new Y(W.vault.B),g,A,new Y(t.lpMint.address),r,l.sub((v=p.fee)!=null?v:new Re(0)),m.sub(($=y.fee)!=null?$:new Re(0)))],instructionTypes:[F.CpmmWithdrawLiquidity],lookupTableAddress:W.lookupTableAccount?[W.lookupTableAccount]:[]}),b.addCustomComputeBudget(s),b.versionBuild({txVersion:a})}async swap(e){var C,x,L,W,v,$;let{poolInfo:t,poolKeys:n,baseIn:r,fixedOut:i,inputAmount:s,swapResult:a,slippage:c=0,config:u,computeBudgetConfig:l,txVersion:m}=e,{bypassAssociatedCheck:d,checkCreateATAOwner:p,associatedOnly:y}=R({bypassAssociatedCheck:!1,checkCreateATAOwner:!1,associatedOnly:!0},u),f=this.createTxBuilder(),[b,g]=[new Y(t.mintA.address),new Y(t.mintB.address)];i?a.sourceAmountSwapped=a.sourceAmountSwapped.mul(new Re((1+c)*1e4)).div(new Re(1e4)):a.destinationAmountSwapped=a.destinationAmountSwapped.mul(new Re((1-c)*1e4)).div(new Re(1e4));let A=t.mintA.address===Q.toBase58(),w=t.mintB.address===Q.toBase58(),{account:k,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({mint:b,tokenProgram:new Y((C=t.mintA.programId)!=null?C:Yt),owner:this.scope.ownerPubKey,createInfo:A||!r?{payer:this.scope.ownerPubKey,amount:r?a.sourceAmountSwapped:0}:void 0,notUseTokenAccount:A,skipCloseAccount:!A,associatedOnly:A?!1:y,checkCreateATAOwner:p});I&&f.addInstruction(I);let{account:T,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({mint:g,tokenProgram:new Y((x=t.mintB.programId)!=null?x:Yt),owner:this.scope.ownerPubKey,createInfo:w||r?{payer:this.scope.ownerPubKey,amount:r?0:a.sourceAmountSwapped}:void 0,notUseTokenAccount:w,skipCloseAccount:!w,associatedOnly:w?!1:y,checkCreateATAOwner:p});S&&f.addInstruction(S),(!k||!T)&&this.logAndCreateError("user do not have token account",{mintA:t.mintA.symbol||t.mintA.address,mintB:t.mintB.symbol||t.mintB.address,mintATokenAcc:k,mintBTokenAcc:T,mintAUseSOLBalance:A,mintBUseSOLBalance:w,associatedOnly:y});let B=n!=null?n:await this.getCpmmPoolKeys(t.id);return f.addInstruction({instructions:[i?xc(new Y(t.programId),this.scope.ownerPubKey,new Y(B.authority),new Y(B.config.id),new Y(t.id),r?k:T,r?T:k,new Y(B.vault[r?"A":"B"]),new Y(B.vault[r?"B":"A"]),new Y((v=t[r?"mintA":"mintB"].programId)!=null?v:Yt),new Y(($=t[r?"mintB":"mintA"].programId)!=null?$:Yt),r?b:g,r?g:b,Zr(new Y(t.programId),new Y(t.id)).publicKey,a.sourceAmountSwapped,a.destinationAmountSwapped):$r(new Y(t.programId),this.scope.ownerPubKey,new Y(B.authority),new Y(B.config.id),new Y(t.id),r?k:T,r?T:k,new Y(B.vault[r?"A":"B"]),new Y(B.vault[r?"B":"A"]),new Y((L=t[r?"mintA":"mintB"].programId)!=null?L:Yt),new Y((W=t[r?"mintB":"mintA"].programId)!=null?W:Yt),r?b:g,r?g:b,Zr(new Y(t.programId),new Y(t.id)).publicKey,s,a.destinationAmountSwapped)],instructionTypes:[i?F.CpmmSwapBaseOut:F.ClmmSwapBaseIn]}),f.addCustomComputeBudget(l),f.versionBuild({txVersion:m})}computeSwapAmount({pool:e,amountIn:t,outputMint:n,slippage:r}){let i=n.toString()===e.mintB.address,s=Hr.swap(t,i?e.baseReserve:e.quoteReserve,i?e.quoteReserve:e.baseReserve,e.configInfo.tradeFeeRate),a=new O(s.destinationAmountSwapped.toString()).div(s.sourceAmountSwapped.toString()),c=s.destinationAmountSwapped.mul(new Re((1-r)*1e4)).div(new Re(1e4));return{allTrade:s.sourceAmountSwapped.eq(t),amountIn:t,amountOut:s.destinationAmountSwapped,minAmountOut:c,executionPrice:a,fee:s.tradeFee,priceImpact:e.poolPrice.sub(a).div(e.poolPrice)}}computePairAmount({poolInfo:e,baseReserve:t,quoteReserve:n,amount:r,slippage:i,epochInfo:s,baseIn:a}){var k,I,T,S,B,C,x,L,W;let c=1-Number(i.toSignificant())/100,u=new Re(new O(r).mul(10**e[a?"mintA":"mintB"].decimals).mul(c).toFixed(0)),l=ye(u,e[a?"mintA":"mintB"].extensions.feeConfig,s,!1),m=u.sub((k=l.fee)!=null?k:new Re(0)),d=new Re(new O(e.lpAmount).mul(10**e.lpMint.decimals).toFixed(0,O.ROUND_DOWN));this.logDebug("baseReserve:",t.toString(),"quoteReserve:",n.toString()),this.logDebug("tokenIn:",a?e.mintA.symbol:e.mintB.symbol,"amountIn:",u.toString(),"amountInFee:",(T=(I=l.fee)==null?void 0:I.toString())!=null?T:0,"anotherToken:",a?e.mintB.symbol:e.mintA.symbol,"slippage:",`${i.toSignificant()}%`);let p=a?"base":"quote";this.logDebug("input side:",p);let y=m.mul(d).div(p==="base"?t:n),f={amount:qe,fee:void 0,expirationTime:void 0};if(!m.isZero()){let v=bf(y,t,n,d);this.logDebug("lpAmountData:",{amountA:v.amountA.toString(),amountB:v.amountB.toString()}),f=ye(v[a?"amountB":"amountA"],e[a?"mintB":"mintA"].extensions.feeConfig,s,!0)}let b=new Ke(new Re(1)).add(i),g=new Ke(new Re(1)).sub(i),A=ye(b.mul(f.amount.sub((S=f.fee)!=null?S:new Re(0))).quotient,e[a?"mintB":"mintA"].extensions.feeConfig,s,!0),w=ye(g.mul(f.amount.sub((B=f.fee)!=null?B:new Re(0))).quotient,e[a?"mintB":"mintA"].extensions.feeConfig,s,!0);return this.logDebug("anotherAmount:",f.amount.toString(),"anotherAmountFee:",(x=(C=f.fee)==null?void 0:C.toString())!=null?x:0,"maxAnotherAmount:",A.amount.toString(),"maxAnotherAmountFee:",(W=(L=A.fee)==null?void 0:L.toString())!=null?W:0),{inputAmountFee:l,anotherAmount:f,maxAnotherAmount:A,minAnotherAmount:w,liquidity:y}}};function bf(o,e,t,n){let r=o.mul(e).div(n);!r.isZero()&&!o.mul(e).mod(n).isZero()&&(r=r.add(new Re(1)));let i=o.mul(t).div(n);return!i.isZero()&&!o.mul(t).mod(n).isZero()&&(i=i.add(new Re(1))),{amountA:r,amountB:i}}import{PublicKey as Kn}from"@solana/web3.js";import{createTransferInstruction as Nc,TOKEN_PROGRAM_ID as Le,TOKEN_2022_PROGRAM_ID as oi}from"@solana/spl-token";import ri from"bn.js";var Kc={[Pr.toBase58()]:3},Cc={3:Pr};var Ws=_([Ae(5),Ae(8),K("ownAddress"),P("vaultSignerNonce"),K("baseMint"),K("quoteMint"),K("baseVault"),P("baseDepositsTotal"),P("baseFeesAccrued"),K("quoteVault"),P("quoteDepositsTotal"),P("quoteFeesAccrued"),P("quoteDustThreshold"),K("requestQueue"),K("eventQueue"),K("bids"),K("asks"),P("baseLotSize"),P("quoteLotSize"),P("feeRateBps"),P("referrerRebatesAccrued"),Ae(7)]),Rc={3:Ws};import{PublicKey as Lc}from"@solana/web3.js";var ti=ce("Serum"),ni=class{static getProgramId(e){let t=Cc[e];return t||ti.logWithError("invalid version","version",e),t}static getVersion(e){let t=e.toBase58(),n=Kc[t];return n||ti.logWithError("invalid program id","programId",t),n}static getStateLayout(e){let t=Rc[e];return t||ti.logWithError(!!t,"invalid version","version",e),t}static getLayouts(e){return{state:this.getStateLayout(e)}}static getAssociatedAuthority({programId:e,marketId:t}){let n=[t.toBuffer()],r=0,i;for(;r<100;){try{let s=n.concat(Buffer.from([r]),Buffer.alloc(7));i=Lc.createProgramAddressSync(s,e)}catch(s){if(s instanceof TypeError)throw s;r++;continue}return{publicKey:i,nonce:r}}return ti.logWithError("unable to find a viable program address nonce","params",{programId:e,marketId:t}),{publicKey:Lc.default,nonce:r}}};import{PublicKey as H,SystemProgram as qs,TransactionInstruction as Us}from"@solana/web3.js";import Sn from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as gf,TOKEN_2022_PROGRAM_ID as Af,TOKEN_PROGRAM_ID as Gs}from"@solana/spl-token";function PS(o,e,t,n,r,i,s,a,c,u,l,m){let d=_([D("instruction"),P("amountIn"),P("amountOut")]),p=[{pubkey:qs.programId,isSigner:!1,isWritable:!1},{pubkey:Gs,isSigner:!1,isWritable:!1},{pubkey:new H(t.programId),isSigner:!1,isWritable:!1},{pubkey:new H(t.id),isSigner:!1,isWritable:!0},{pubkey:new H(n.id),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let f=Ie(t);p.push({pubkey:f.config.id,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(c)?f.vault.A:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(c)?f.vault.B:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},...m.map(b=>({pubkey:b,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let f=Ie(t);p.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:new H("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0})}else{let f=Ie(t);p.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},...f.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:f.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:f.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0}])}let y=Buffer.alloc(d.span);return d.encode({instruction:4,amountIn:u,amountOut:l},y),new Us({keys:p,programId:o,data:y})}function hS(o,e,t,n,r,i,s,a,c,u){let l=_([D("instruction")]),m=[{pubkey:qs.programId,isSigner:!1,isWritable:!1},{pubkey:Gs,isSigner:!1,isWritable:!1},{pubkey:new H(String(n.programId)),isSigner:!1,isWritable:!1},{pubkey:new H(String(n.id)),isSigner:!1,isWritable:!0},{pubkey:new H(String(t.id)),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let p=Ie(n);m.push({pubkey:p.config.id,isSigner:!1,isWritable:!1},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.mintA.address.equals(c)?p.vault.A:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.mintA.address.equals(c)?p.vault.B:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0},...u.map(y=>({pubkey:y,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let p=Ie(n);m.push({pubkey:p.authority,isSigner:!1,isWritable:!1},{pubkey:p.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:new H("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:p.openOrders,isSigner:!1,isWritable:!0},{pubkey:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.marketId,isSigner:!1,isWritable:!0},{pubkey:p.marketBids,isSigner:!1,isWritable:!0},{pubkey:p.marketAsks,isSigner:!1,isWritable:!0},{pubkey:p.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0})}else{let p=Ie(n);m.push({pubkey:p.authority,isSigner:!1,isWritable:!1},{pubkey:p.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:p.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:p.openOrders,isSigner:!1,isWritable:!0},{pubkey:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.marketId,isSigner:!1,isWritable:!0},{pubkey:p.marketBids,isSigner:!1,isWritable:!0},{pubkey:p.marketAsks,isSigner:!1,isWritable:!0},{pubkey:p.marketEventQueue,isSigner:!1,isWritable:!0},...p.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:p.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:p.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0}])}let d=Buffer.alloc(l.span);return l.encode({instruction:5},d),new Us({keys:m,programId:o,data:d})}function wf(o,e,t,n,r,i,s,a,c,u,l,m,d,p,y){var T;let f=[],b=[h({pubkey:Gs,isWritable:!1}),h({pubkey:Af,isWritable:!1}),h({pubkey:gf,isWritable:!1}),h({pubkey:qs.programId,isWritable:!1}),h({pubkey:e,isSigner:!0})];b.push(h({pubkey:t})),b.push(h({pubkey:r}));let g=[c,u],A=[l,m],w=[i,s,a];for(let S=0;S<g.length;S++){let B=g[S],C=w[S]===B.mintA.address;if(b.push(h({pubkey:new H(B.programId),isWritable:!1})),S===g.length-1?b.push(h({pubkey:r})):b.push(h({pubkey:n})),b.push(h({pubkey:new H(w[S])})),b.push(h({pubkey:new H(w[S+1])})),B.version===6){let x=A[S];b.push(h({pubkey:new H(x.config.id)})),b.push(h({pubkey:new H(x.id)})),b.push(h({pubkey:new H(C?x.vault.A:x.vault.B)})),b.push(h({pubkey:new H(C?x.vault.B:x.vault.A)})),b.push(h({pubkey:new H(B.observationId)})),b.push(h({pubkey:vn})),b.push(h({pubkey:dt(new H(B.programId),new H(B.id)).publicKey})),f.push(Pf(B.sqrtPriceX64.toString(),C));for(let L of(T=y[S])!=null?T:[])b.push(h({pubkey:new H(L)}))}else if(B.version===5){let x=A[S];b.push(h({pubkey:new H(x.id)})),b.push(h({pubkey:new H(x.authority),isWritable:!1})),b.push(h({pubkey:new H(x.marketProgramId)})),b.push(h({pubkey:new H(x.marketAuthority)})),b.push(h({pubkey:qa,isWritable:!1})),b.push(h({pubkey:new H(x.openOrders)})),b.push(h({pubkey:new H(x.vault.A)})),b.push(h({pubkey:new H(x.vault.B)})),b.push(h({pubkey:new H(x.id)})),b.push(h({pubkey:new H(x.id)})),b.push(h({pubkey:new H(x.id)})),b.push(h({pubkey:new H(x.id)})),b.push(h({pubkey:new H(x.id)})),b.push(h({pubkey:new H(x.id)})),b.push(h({pubkey:new H(x.marketId)})),b.push(h({pubkey:new H(x.marketBids)})),b.push(h({pubkey:new H(x.marketAsks)})),b.push(h({pubkey:new H(x.marketEventQueue)})),b.push(h({pubkey:new H(x.marketBaseVault)})),b.push(h({pubkey:new H(x.marketQuoteVault)}))}else if(B.version===4){let x=A[S],L=B.status!==1;b.push(h({pubkey:new H(x.id)})),b.push(h({pubkey:new H(x.authority),isWritable:!1})),b.push(h({pubkey:new H(L?x.id:x.marketProgramId)})),b.push(h({pubkey:new H(L?x.id:x.marketAuthority)})),b.push(h({pubkey:new H(L?x.id:x.openOrders)})),b.push(h({pubkey:new H(x.vault.A)})),b.push(h({pubkey:new H(x.vault.B)})),b.push(h({pubkey:new H(L?x.id:x.marketId)})),b.push(h({pubkey:new H(L?x.id:x.marketBids)})),b.push(h({pubkey:new H(L?x.id:x.marketAsks)})),b.push(h({pubkey:new H(L?x.id:x.marketEventQueue)})),b.push(h({pubkey:new H(L?x.id:x.marketBaseVault)})),b.push(h({pubkey:new H(L?x.id:x.marketQuoteVault)}))}else if(B.version===7){let x=A[S];b.push(h({pubkey:new H(x.authority)})),b.push(h({pubkey:new H(x.config.id)})),b.push(h({pubkey:new H(x.id)})),b.push(h({pubkey:new H(C?x.vault.A:x.vault.B)})),b.push(h({pubkey:new H(C?x.vault.B:x.vault.A)})),b.push(h({pubkey:new H(B.observationId)}))}else throw Error("pool type error")}let k=_([D("insId"),P("amountIn"),P("amountOut"),G(J(),f.length,"clmmPriceLimit")]),I=Buffer.alloc(k.span);return k.encode({insId:0,amountIn:d,amountOut:p,clmmPriceLimit:f},I),new Us({keys:b,programId:o,data:I})}function Pf(o,e){if(o)if(e){let t=new Sn(o).div(new Sn(25));return t.gt(_r)?t:_r}else{let t=new Sn(o).mul(new Sn(25));return t.lt(vr)?t:vr}else return e?_r:vr}function Oc({routeProgram:o,ownerInfo:e,inputMint:t,swapInfo:n}){var r,i,s,a,c,u,l;if(n.routeType==="amm")if(n.poolInfo[0].version===6){let m=n.poolKey[0],d=Ie(m),p=t.equals(d.mintA.address)?ht.add(bt):kt.sub(bt);return Te.makeSwapBaseInInstructions({poolInfo:m,poolKeys:m,observationId:n.poolInfo[0].observationId,ownerInfo:{wallet:e.wallet,tokenAccountA:d.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:d.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((i=(r=n.minAmountOut.fee)==null?void 0:r.raw)!=null?i:new Sn(0)),sqrtPriceLimitX64:p,remainingAccounts:(s=n.remainingAccounts[0])!=null?s:[]})}else if(n.poolInfo[0].version===7){let m=n.poolInfo[0],d=t.toString()===n.poolInfo[0].mintA.address;return{signers:[],instructions:[$r(m.programId,e.wallet,m.authority,m.configId,m.id,e.sourceToken,e.destinationToken,d?m.vaultA:m.vaultB,d?m.vaultB:m.vaultA,d?m.mintProgramA:m.mintProgramB,d?m.mintProgramB:m.mintProgramA,new H(m[d?"mintA":"mintB"].address),new H(m[d?"mintB":"mintA"].address),m.observationId,n.amountIn.amount.raw,n.minAmountOut.amount.raw)],lookupTableAddress:[],instructionTypes:[d?F.CpmmSwapBaseIn:F.CpmmSwapBaseOut],address:{}}}else{let m=n.poolKey[0];return{signers:[],instructions:[Ur({poolKeys:m,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((c=(a=n.minAmountOut.fee)==null?void 0:a.raw)!=null?c:new Sn(0)),fixedSide:"in"})],lookupTableAddress:m.lookupTableAccount?[m.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?F.AmmV5SwapBaseIn:F.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let m=n.poolInfo[0],d=n.poolInfo[1],p=n.poolKey[0],y=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[wf(o,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.middleToken.mint.toString(),n.outputMint.toString(),m,d,p,y,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((l=(u=n.minAmountOut.fee)==null?void 0:u.raw)!=null?l:new Sn(0)),n.remainingAccounts)],instructionTypes:[F.RouteSwap],lookupTableAddress:[p.lookupTableAccount,y.lookupTableAccount].filter(f=>f!==void 0),address:{}}}else throw Error("route type error")}var jt=new ri(0),zo=class extends Se{constructor(e){super(e)}async getWSolAccounts(){this.scope.checkOwner(),await this.scope.account.fetchWalletTokenAccounts();let e=this.scope.account.tokenAccounts.filter(t=>t.mint.equals(Q));return e.sort((t,n)=>t.isAssociated?1:n.isAssociated||t.amount.lt(n.amount)?-1:1),e}async unWrapWSol(e){let{amount:t,tokenProgram:n,txVersion:r=1}=e,i=await this.getWSolAccounts(),s=this.createTxBuilder();s.addCustomComputeBudget(e.computeBudgetConfig);let a=await Ut({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:0});s.addInstruction(a);let c=z(t);for(let u=0;u<i.length;u++)c.gte(i[u].amount)?(s.addInstruction({instructions:[qt({tokenAccount:i[u].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:n})]}),c.sub(i[u].amount)):s.addInstruction({instructions:[qt({tokenAccount:i[u].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:n})]});return s.versionBuild({txVersion:r})}async wrapWSol(e,t,n){let r=this.createTxBuilder(),i=await Ut({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:e,skipCloseAccount:!0});return r.addInstruction(i),r.versionBuild({txVersion:n!=null?n:1})}async swap({swapInfo:e,swapPoolKeys:t,ownerInfo:n,computeBudgetConfig:r,routeProgram:i,txVersion:s}){let a=this.createTxBuilder(),c=e.amountIn,u=e.amountOut,l=c.amount.token.mint.equals(Q),m=u.amount.token.mint.equals(Q),d=c.amount.token.mint,p=u.amount.token.mint,{account:y,instructionParams:f}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:c.amount.token.isToken2022?oi:Le,mint:d,notUseTokenAccount:l,owner:this.scope.ownerPubKey,skipCloseAccount:!l,createInfo:l?{payer:this.scope.ownerPubKey,amount:c.amount.raw}:void 0,associatedOnly:l?!1:n.associatedOnly,checkCreateATAOwner:n.checkCreateATAOwner});if(f&&a.addInstruction(f),y===void 0)throw Error("input account check error");let b;if(e.routeType==="route")b=this.scope.account.getAssociatedTokenAccount(p,u.amount.token.isToken2022?oi:Le);else{let{account:k,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:u.amount.token.isToken2022?oi:Le,mint:p,notUseTokenAccount:m,owner:this.scope.ownerPubKey,skipCloseAccount:!0,createInfo:{payer:this.scope.ownerPubKey,amount:0},associatedOnly:m?!1:n.associatedOnly,checkCreateATAOwner:n.checkCreateATAOwner});b=k,I&&a.addInstruction(I)}m&&a.addInstruction({endInstructions:[qt({owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,tokenAccount:b,programId:Le})],endInstructionTypes:[F.CloseAccount]});let g;if(e.routeType==="route"){let k=e.middleToken;g=this.scope.account.getAssociatedTokenAccount(k.mint,k.isToken2022?oi:Le)}let A=t||await this.computePoolToPoolKeys({pools:e.poolInfoList}),w=Oc({routeProgram:i,inputMint:d,swapInfo:E(R({},e),{poolInfo:[...e.poolInfoList],poolKey:A,outputMint:p}),ownerInfo:{wallet:this.scope.ownerPubKey,sourceToken:y,routeToken:g,destinationToken:b}});if(e.feeConfig!==void 0){let k=this.createTxBuilder();k.addInstruction({instructions:[Nc(y,e.feeConfig.feeAccount,this.scope.ownerPubKey,e.feeConfig.feeAmount.toNumber())],instructionTypes:[F.TransferAmount]}),k.addInstruction(w);let{transactions:I}=s===0?await k.sizeCheckBuildV0():await k.sizeCheckBuild();I.length<2&&a.addInstruction({instructions:[Nc(y,e.feeConfig.feeAccount,this.scope.ownerPubKey,e.feeConfig.feeAmount.toNumber())],instructionTypes:[F.TransferAmount]})}return a.addInstruction(w),s===0?a.sizeCheckBuildV0({computeBudgetConfig:r,address:w.address}):a.sizeCheckBuild({computeBudgetConfig:r,address:w.address})}async fetchRoutePoolBasicInfo(e){let{amm:t=Mi,clmm:n=uo,cpmm:r=_i}=e||{},i=await this.scope.connection.getProgramAccounts(t,{dataSlice:{offset:Fo.offsetOf("baseMint"),length:64}}),s=_([K("baseMint"),K("quoteMint")]),a=i.map(p=>({id:p.pubkey,version:4,mintA:s.decode(p.account.data).baseMint,mintB:s.decode(p.account.data).quoteMint})),c=_([K("mintA"),K("mintB")]),l=(await this.scope.connection.getProgramAccounts(n,{filters:[{dataSize:kn.span}],dataSlice:{offset:kn.offsetOf("mintA"),length:64}})).map(p=>{let y=c.decode(p.account.data);return{id:p.pubkey,version:6,mintA:y.mintA,mintB:y.mintB}}),d=(await this.scope.connection.getProgramAccounts(r,{dataSlice:{offset:Jr.offsetOf("mintA"),length:64}})).map(p=>{let y=c.decode(p.account.data);return{id:p.pubkey,version:7,mintA:y.mintA,mintB:y.mintB}});return{clmmPools:l,ammPools:a,cpmmPools:d}}getAllRoute({inputMint:e,outputMint:t,clmmPools:n,ammPools:r,cpmmPools:i}){e=e.toString()===Kn.default.toString()?Q:e,t=t.toString()===Kn.default.toString()?Q:t;let s={},a={},c={},u=[],l={};for(let d of n!=null?n:[]){if((d.mintA.equals(e)&&d.mintB.equals(t)||d.mintA.equals(t)&&d.mintB.equals(e))&&(u.push(d),a[d.id.toString()]=d),d.mintA.equals(e)){let p=d.mintB.toString();l[p]===void 0&&(l[p]={mintProgram:Le,in:[],out:[],mDecimals:0}),l[p].in.push(d)}if(d.mintB.equals(e)){let p=d.mintA.toString();l[p]===void 0&&(l[p]={mintProgram:Le,in:[],out:[],mDecimals:0}),l[p].in.push(d)}if(d.mintA.equals(t)){let p=d.mintB.toString();l[p]===void 0&&(l[p]={mintProgram:Le,in:[],out:[],mDecimals:0}),l[p].out.push(d)}if(d.mintB.equals(t)){let p=d.mintA.toString();l[p]===void 0&&(l[p]={mintProgram:Le,in:[],out:[],mDecimals:0}),l[p].out.push(d)}}let m=[];for(let d of r)(d.mintA.equals(e)&&d.mintB.equals(t)||d.mintA.equals(t)&&d.mintB.equals(e))&&(u.push(d),s[d.id.toBase58()]=d,m.push(d)),d.mintA.equals(e)&&(l[d.mintB.toBase58()]===void 0&&(l[d.mintB.toBase58()]={mintProgram:Le,in:[],out:[],mDecimals:0}),l[d.mintB.toBase58()].in.push(d)),d.mintB.equals(e)&&(l[d.mintA.toBase58()]===void 0&&(l[d.mintA.toBase58()]={mintProgram:Le,in:[],out:[],mDecimals:0}),l[d.mintA.toBase58()].in.push(d)),d.mintA.equals(t)&&(l[d.mintB.toBase58()]===void 0&&(l[d.mintB.toBase58()]={mintProgram:Le,in:[],out:[],mDecimals:0}),l[d.mintB.toBase58()].out.push(d)),d.mintB.equals(t)&&(l[d.mintA.toBase58()]===void 0&&(l[d.mintA.toBase58()]={mintProgram:Le,in:[],out:[],mDecimals:0}),l[d.mintA.toBase58()].out.push(d));for(let d of i)(d.mintA.equals(e)&&d.mintB.equals(t)||d.mintA.equals(t)&&d.mintB.equals(e))&&(u.push(d),c[d.id.toBase58()]=d),d.mintA.equals(e)&&(l[d.mintB.toBase58()]===void 0&&(l[d.mintB.toBase58()]={mintProgram:Le,in:[],out:[],mDecimals:0}),l[d.mintB.toBase58()].in.push(d)),d.mintB.equals(e)&&(l[d.mintA.toBase58()]===void 0&&(l[d.mintA.toBase58()]={mintProgram:Le,in:[],out:[],mDecimals:0}),l[d.mintA.toBase58()].in.push(d)),d.mintA.equals(t)&&(l[d.mintB.toBase58()]===void 0&&(l[d.mintB.toBase58()]={mintProgram:Le,in:[],out:[],mDecimals:0}),l[d.mintB.toBase58()].out.push(d)),d.mintB.equals(t)&&(l[d.mintA.toBase58()]===void 0&&(l[d.mintA.toBase58()]={mintProgram:Le,in:[],out:[],mDecimals:0}),l[d.mintA.toBase58()].out.push(d));for(let d of Object.keys(l)){if(l[d].in.length===1&&l[d].out.length===1&&l[d].in[0].id.equals(l[d].out[0].id)){delete l[d];continue}if(l[d].in.length===0||l[d].out.length===0){delete l[d];continue}let p=l[d];for(let y of p.in)for(let f of p.out)y.version===6&&a[y.id.toString()]===void 0?a[y.id.toString()]=y:y.version===7&&c[y.id.toString()]===void 0?c[y.id.toString()]=y:(y.version===4||y.version===5)&&s[y.id.toString()]===void 0&&(s[y.id.toString()]=y),f.version===6&&a[f.id.toString()]===void 0?a[f.id.toString()]=f:f.version===7&&c[f.id.toString()]===void 0?c[f.id.toString()]=f:(f.version===4||f.version===5)&&s[f.id.toString()]===void 0&&(s[f.id.toString()]=f)}return{directPath:u,addLiquidityPools:m,routePathDict:l,needSimulate:Object.values(s),needTickArray:Object.values(a),cpmmPoolList:Object.values(c)}}async fetchSwapRoutesData({routes:e,inputMint:t,outputMint:n}){let r=new Set([...e.needTickArray.map(f=>[f.mintA.toBase58(),f.mintB.toBase58()]).flat(),t.toString(),n.toString()]);console.log("fetching amm pools info, total: ",e.needSimulate.length);let i=await this.scope.liquidity.getRpcPoolInfos(e.needSimulate.map(f=>f.id)),s=Xr(i),a={};Object.values(s).forEach(f=>{r.delete(f.mintA.address),a[f.mintA.address]={address:new Kn(f.mintA.address),programId:Le,mintAuthority:null,supply:BigInt(0),decimals:f.mintA.decimals,isInitialized:!0,freezeAuthority:null,tlvData:Buffer.from("0","hex"),feeConfig:void 0},r.delete(f.mintB.address),a[f.mintB.address]={address:new Kn(f.mintB.address),programId:Le,mintAuthority:null,supply:BigInt(0),decimals:f.mintB.decimals,isInitialized:!0,freezeAuthority:null,tlvData:Buffer.from("0","hex"),feeConfig:void 0}}),console.log("fetching cpmm pools info, total: ",e.cpmmPoolList.length);let c=await this.scope.cpmm.getRpcPoolInfos(e.cpmmPoolList.map(f=>f.id.toBase58()),!0);Object.values(c).forEach(f=>{let[b,g]=[f.mintA.toBase58(),f.mintB.toBase58()];f.mintProgramA.equals(Le)?(r.delete(b),a[b]={address:f.mintA,programId:f.mintProgramA,mintAuthority:null,supply:BigInt(0),decimals:f.mintDecimalA,isInitialized:!0,freezeAuthority:null,tlvData:Buffer.from("0","hex"),feeConfig:void 0}):r.add(b),f.mintProgramB.equals(Le)?(r.delete(g),a[g]={address:f.mintB,programId:f.mintProgramB,mintAuthority:null,supply:BigInt(0),decimals:f.mintDecimalB,isInitialized:!0,freezeAuthority:null,tlvData:Buffer.from("0","hex"),feeConfig:void 0}):r.add(g)}),console.log("fetching mints info, total: ",r.size);let u=await Nn({connection:this.scope.connection,mints:Array.from(r).map(f=>new Kn(f))});a=R(R({},a),u);let l=this.scope.cpmm.toComputePoolInfos({pools:c,mintInfos:a});console.log("fetching clmm pools info, total:",e.needTickArray.length);let m=await this.scope.clmm.getRpcClmmPoolInfos({poolIds:e.needTickArray.map(f=>f.id)}),{computeClmmPoolInfo:d,computePoolTickData:p}=await this.scope.clmm.getComputeClmmPoolInfos({clmmPoolsRpcInfo:m,mintInfos:a}),y=Object.keys(e.routePathDict).reduce((f,b)=>E(R({},f),{[b]:E(R({},e.routePathDict[b]),{mintProgram:a[b].programId,mDecimals:a[b].decimals,in:e.routePathDict[b].in.map(g=>s[g.id.toBase58()]||d[g.id.toBase58()]||l[g.id.toBase58()]),out:e.routePathDict[b].out.map(g=>s[g.id.toBase58()]||d[g.id.toBase58()]||l[g.id.toBase58()])})}),{});return{mintInfos:a,ammPoolsRpcInfo:i,ammSimulateCache:s,clmmPoolsRpcInfo:m,computeClmmPoolInfo:d,computePoolTickData:p,computeCpmmData:l,routePathDict:y}}getAllRouteComputeAmountOut({inputTokenAmount:e,outputToken:t,directPath:n,routePathDict:r,simulateCache:i,tickCache:s,slippage:a,chainTime:c,epochInfo:u,feeConfig:l}){var g,A,w,k,I,T,S,B,C;let m=l===void 0?new ri(0):e.raw.mul(new ri(l.feeBps.toNumber())).div(new ri(1e4)),d=e.raw.sub(m),p=new fe(e.token,d),y=l===void 0?void 0:{feeAmount:m,feeAccount:l.feeAccount},f=E(R({},t),{address:ft(t.address).toString()}),b=[];for(let x of n)try{b.push(E(R({},this.computeAmountOut({itemPool:x,tickCache:s,simulateCache:i,chainTime:c,epochInfo:u,slippage:a,outputToken:f,amountIn:p})),{feeConfig:y}))}catch(L){this.logDebug("direct error",x.version,x.id.toString(),L.message)}this.logDebug("direct done");for(let[x,L]of Object.entries(r)){let W={chainId:101,address:x,programId:L.mintProgram.toBase58(),logoURI:"",symbol:"",name:"",decimals:L.mDecimals,tags:[],extensions:{}},v=L.in.map(X=>{try{return{pool:X,data:this.computeAmountOut({itemPool:X,tickCache:s,simulateCache:i,chainTime:c,epochInfo:u,slippage:a,outputToken:W,amountIn:p})}}catch(q){this.logDebug("route in error",X.version,X.id.toString(),q.message);return}}).sort((X,q)=>{var dn,Ht,Ln,Zt;let ot=X===void 0?jt:X.data.amountOut.amount.raw.sub((Ht=(dn=X.data.amountOut.fee)==null?void 0:dn.raw)!=null?Ht:jt),Rn=q===void 0?jt:q.data.amountOut.amount.raw.sub((Zt=(Ln=q.data.amountOut.fee)==null?void 0:Ln.raw)!=null?Zt:jt);return ot.lt(Rn)?1:-1})[0];if(v===void 0)continue;let $=new fe(Wr(W),v.data.amountOut.amount.raw.sub((A=(g=v.data.amountOut.fee)==null?void 0:g.raw)!=null?A:jt));for(let X of L.out)try{let q=this.computeAmountOut({itemPool:X,tickCache:s,simulateCache:i,chainTime:c,epochInfo:u,slippage:a,outputToken:f,amountIn:$});b.push(E(R({},q),{allTrade:!!(v.data.allTrade&&q.allTrade),amountIn:v.data.amountIn,amountOut:q.amountOut,minAmountOut:q.minAmountOut,currentPrice:void 0,executionPrice:new O(new Ge({baseToken:v.data.amountIn.amount.token,denominator:v.data.amountIn.amount.raw,quoteToken:q.amountOut.amount.token,numerator:q.amountOut.amount.raw.sub((k=(w=q.amountOut.fee)==null?void 0:w.raw)!=null?k:jt)}).toFixed()),priceImpact:new O(v.data.priceImpact.add(q.priceImpact).toFixed()),fee:[v.data.fee[0],q.fee[0]],routeType:"route",poolInfoList:[v.pool,X],remainingAccounts:[v.data.remainingAccounts[0],q.remainingAccounts[0]],minMiddleAmountFee:(I=q.amountOut.fee)!=null&&I.raw?new fe(v.data.amountOut.amount.token,((S=(T=v.data.amountOut.fee)==null?void 0:T.raw)!=null?S:jt).add((C=(B=q.amountOut.fee)==null?void 0:B.raw)!=null?C:jt)):void 0,middleToken:v.data.amountOut.amount.token,poolReady:v.data.poolReady&&q.poolReady,poolType:[v.data.poolType,q.poolType],feeConfig:y,expirationTime:Ct(v.data.expirationTime,q.expirationTime)}))}catch(q){this.logDebug("route out error",X.version,X.id.toString(),q.message)}}return b.filter(x=>(x.allTrade||this.logDebug(`pool ${x.poolInfoList.map(L=>L.id.toString()).join(",")} filter out since not all trade`),x.allTrade)).sort((x,L)=>x.amountOut.amount.raw.sub(L.amountOut.amount.raw).gt(jt)?-1:1)}computeAmountOut({itemPool:e,tickCache:t,simulateCache:n,chainTime:r,epochInfo:i,slippage:s,outputToken:a,amountIn:c}){if(e.version===6){let{allTrade:u,realAmountIn:l,amountOut:m,minAmountOut:d,expirationTime:p,currentPrice:y,executionPrice:f,priceImpact:b,fee:g,remainingAccounts:A,executionPriceX64:w}=Ce.computeAmountOutFormat({poolInfo:e,tickArrayCache:t[e.id.toString()],amountIn:c.raw,tokenOut:a,slippage:s,epochInfo:i,catchLiquidityInsufficient:!0});return{allTrade:u,amountIn:l,amountOut:m,minAmountOut:d,currentPrice:new O(y.toFixed()),executionPrice:new O(f.toFixed()),priceImpact:new O(b.toFixed()),fee:[g],remainingAccounts:[A],routeType:"amm",poolInfoList:[e],poolReady:e.startTime<r,poolType:"CLMM",slippage:s,clmmExPriceX64:[w],expirationTime:Ct(l.expirationTime,p)}}else if(e.version===7){let{allTrade:u,executionPrice:l,amountOut:m,minAmountOut:d,priceImpact:p,fee:y}=this.scope.cpmm.computeSwapAmount({pool:e,outputMint:a.address,amountIn:c.raw,slippage:s});return{allTrade:u,amountIn:{amount:c,fee:void 0,expirationTime:void 0},amountOut:{amount:Vo(E(R({},a),{amount:m})),fee:void 0,expirationTime:void 0},minAmountOut:{amount:Vo(E(R({},a),{amount:d})),fee:void 0,expirationTime:void 0},currentPrice:e.poolPrice,executionPrice:l,priceImpact:p,fee:[new fe(c.token,y)],remainingAccounts:[],routeType:"amm",poolInfoList:[e],poolReady:e.openTime.toNumber()<r,poolType:"CPMM",slippage:s,clmmExPriceX64:[void 0],expirationTime:void 0}}else{if(![1,6,7].includes(n[e.id.toString()].status))throw Error("swap error");let{amountOut:u,minAmountOut:l,currentPrice:m,executionPrice:d,priceImpact:p,fee:y}=this.scope.liquidity.computeAmountOut({poolInfo:n[e.id.toString()],amountIn:c.raw,mintIn:c.token.mint,mintOut:a.address,slippage:s});return{amountIn:{amount:c,fee:void 0,expirationTime:void 0},amountOut:{amount:Vo(E(R({},a),{amount:u})),fee:void 0,expirationTime:void 0},minAmountOut:{amount:Vo(E(R({},a),{amount:l})),fee:void 0,expirationTime:void 0},currentPrice:m,executionPrice:d,priceImpact:p,fee:[new fe(c.token,y)],routeType:"amm",poolInfoList:[e],remainingAccounts:[],poolReady:Number(n[e.id].openTime)<r,poolType:e.version===5?"STABLE":void 0,expirationTime:void 0,allTrade:!0,slippage:s,clmmExPriceX64:[void 0]}}}async computePoolToPoolKeys({pools:e,clmmRpcData:t={},ammRpcData:n={}}){let r=new Set(e.filter(u=>u.version===6&&!t[u.id.toString()]).map(u=>u.id.toString()));if(r.size>0){let u=await this.scope.clmm.getRpcClmmPoolInfos({poolIds:Array.from(r)});Object.keys(u).forEach(l=>{t[l]=u[l]})}if(new Set(e.filter(u=>u.version===4&&!n[u.id.toString()]).map(u=>u.id.toString())).size>0){let u=await this.scope.liquidity.getRpcPoolInfos(Array.from(r));Object.keys(u).forEach(l=>{n[l]=u[l]})}let s=new Set(e.filter(u=>u.version===4).map(u=>u.marketId)),a={};s.size>0&&(await Fe(this.scope.connection,Array.from(s).map(l=>({pubkey:new Kn(l)})))).forEach(l=>{if(!l.accountInfo)return;let m=Ws.decode(l.accountInfo.data);a[l.pubkey.toBase58()]={marketId:l.pubkey.toString(),marketProgramId:l.accountInfo.owner.toString(),marketAuthority:ni.getAssociatedAuthority({programId:l.accountInfo.owner,marketId:l.pubkey}).publicKey.toString(),marketBaseVault:m.baseVault.toString(),marketQuoteVault:m.quoteVault.toString(),marketBids:m.bids.toString(),marketAsks:m.asks.toString(),marketEventQueue:m.eventQueue.toString()}});let c=[];return e.forEach(u=>{if(u.version===6){let l=t[u.id.toString()],m={programId:u.programId.toBase58(),id:u.id.toBase58(),mintA:u.mintA,mintB:u.mintB,openTime:String(u.startTime),vault:{A:l.vaultA.toBase58(),B:l.vaultB.toBase58()},config:E(R({},u.ammConfig),{id:u.ammConfig.id.toString(),defaultRange:0,defaultRangePoint:[]}),rewardInfos:[]};c.push(m)}else if(u.version===4){let l=n[u.id.toString()],m=R({programId:u.programId,id:u.id,mintA:u.mintA,mintB:u.mintB,openTime:String(u.openTime),vault:{A:l.baseVault.toBase58(),B:l.quoteVault.toBase58()},authority:vs({programId:new Kn(u.programId)}).publicKey.toString(),openOrders:l.openOrders.toBase58(),targetOrders:l.targetOrders.toBase58(),mintLp:u.lpMint},a[u.marketId]);c.push(m)}else u.version===7&&c.push({programId:u.programId.toBase58(),id:u.id.toBase58(),mintA:u.mintA,mintB:u.mintB,openTime:String(u.openTime),authority:Zn(u.programId).publicKey.toBase58(),vault:{A:u.vaultA.toBase58(),B:u.vaultB.toBase58()},mintLp:st({address:u.mintLp.toBase58(),programId:Le.toBase58(),decimals:u.lpDecimals}),config:E(R({id:u.configId.toBase58()},u.configInfo),{protocolFeeRate:u.configInfo.protocolFeeRate.toNumber(),tradeFeeRate:u.configInfo.tradeFeeRate.toNumber(),fundFeeRate:u.configInfo.fundFeeRate.toNumber(),createPoolFee:u.configInfo.createPoolFee.toString()})})}),c}};import{PublicKey as hf,Transaction as Xs,TransactionInstruction as kf}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Tf}from"@solana/spl-token";import Mc from"bn.js";var nt=class extends Se{static getPdaPoolId(e,t){return ae([nt.SEED_CONFIG.pool.id,t.toBuffer()],e)}static getPdaOwnerId(e,t,n,r){return ae([nt.SEED_CONFIG.owner.id,t.toBuffer(),n.toBuffer(),Buffer.from(new Mc(r).toArray())],e)}static async getAllInfo({connection:e,programId:t,poolIds:n,wallet:r,chainTime:i}){if(n.length===0)return[];let s=n.map(l=>nt.getPdaPoolId(t,l).publicKey),a=[];for(let l=0;l<nt.VERSION_PROJECT.length;l++)a.push(...s.map(m=>nt.getPdaOwnerId(t,m,r,l).publicKey));let c=await It(e,[...s,...a]),u=[];for(let l=0;l<c.length;l++){let m=Math.floor(l/n.length),d=l%n.length,p=s[d],y=a[l],f=c[d],b=c[n.length+l];if(!(f&&b)||f.data.length!==nt.POOL_LAYOUT.span||b.data.length!==nt.OWNER_LAYOUT.span)continue;let g=nt.POOL_LAYOUT.decode(f.data),A=nt.OWNER_LAYOUT.decode(b.data),w=g.openTime.toNumber(),k=g.endTime.toNumber(),I=A.tokenInfo.map(B=>B.debtAmount.gt(new Mc(0))).filter(B=>!B).length!==3,T=i>w&&i<k&&g.status===1,S=I&&T;u.push({programId:t,poolId:p,ammId:g.ammId,ownerAccountId:y,snapshotLpAmount:A.lpAmount,project:nt.VERSION_PROJECT[m],openTime:w,endTime:k,canClaim:S,canClaimErrorType:I?T?void 0:"outOfOperationalTime":"alreadyClaimIt",tokenInfo:g.tokenInfo.map((B,C)=>({mintAddress:B.mintAddress,mintVault:B.mintVault,mintDecimals:B.mintDecimals,perLpLoss:B.perLpLoss,debtAmount:A.tokenInfo[C].debtAmount.add(A.tokenInfo[C].claimedAmount)}))})}return u}async makeClaimTransaction({poolInfo:e,ownerInfo:t}){t.wallet||this.scope.checkOwner();let n=this.createTxBuilder(),r=t.wallet||this.scope.ownerPubKey,i=[];for(let c of e.tokenInfo){let{account:u,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({mint:c.mintAddress,owner:this.scope.ownerPubKey,notUseTokenAccount:c.mintAddress.equals(be.WSOL.mint),createInfo:{payer:r,amount:0},skipCloseAccount:!c.mintAddress.equals(be.WSOL.mint),associatedOnly:c.mintAddress.equals(be.WSOL.mint)?!1:t.associatedOnly});l&&n.addInstruction(l),i.push(u)}n.addInstruction({instructions:[nt.makeClaimInstruction({programId:e.programId,poolInfo:e,ownerInfo:{wallet:r,ownerPda:e.ownerAccountId,claimAddress:i}})]});let{transaction:s,signers:a}=n.build();return[{transaction:s,signer:a}]}async makeClaimAllTransaction({poolInfos:e,ownerInfo:t}){let n=this.createTxBuilder(),r=t.wallet||this.scope.ownerPubKey,i={};for(let u of e){let l=[];for(let m of u.tokenInfo){let{account:d,instructionParams:p}=await this.scope.account.getOrCreateTokenAccount({mint:m.mintAddress,owner:this.scope.ownerPubKey,notUseTokenAccount:m.mintAddress.equals(be.WSOL.mint),createInfo:{payer:r,amount:0},skipCloseAccount:!m.mintAddress.equals(be.WSOL.mint),associatedOnly:m.mintAddress.equals(be.WSOL.mint)?!1:t.associatedOnly});p&&n.addInstruction(p),d&&(i[m.mintAddress.toString()]=d,l.push(d))}n.addInstruction({instructions:[nt.makeClaimInstruction({programId:u.programId,poolInfo:u,ownerInfo:{wallet:r,ownerPda:u.ownerAccountId,claimAddress:l}})]})}let{transaction:s,signers:a}=n.build(),c=n.allInstructions;return wr(c,[r,...a.map(u=>u.publicKey)])?[{transaction:s,signer:a}]:[{transaction:new Xs().add(...c.slice(0,n.AllTxData.instructions.length-1)),signer:a},{transaction:new Xs().add(...c.slice(n.AllTxData.instructions.length-1)),signer:[]},{transaction:new Xs().add(...n.AllTxData.endInstructions),signer:[]}]}static makeClaimInstruction({programId:e,poolInfo:t,ownerInfo:n}){let r=_([]),i=[{pubkey:n.wallet,isSigner:!0,isWritable:!0},{pubkey:t.poolId,isSigner:!1,isWritable:!0},{pubkey:n.ownerPda,isSigner:!1,isWritable:!0},...n.claimAddress.map(c=>({pubkey:c,isSigner:!1,isWritable:!0})),...t.tokenInfo.map(({mintVault:c})=>({pubkey:c,isSigner:!1,isWritable:!0})),{pubkey:Tf,isSigner:!1,isWritable:!1}],s=Buffer.alloc(r.span);r.encode({},s);let a=Buffer.from([10,66,208,184,161,6,191,98,...s]);return new kf({keys:i,programId:e,data:a})}},Tt=nt;Tt.CLAIMED_NUM=3,Tt.POOL_LAYOUT=_([Ae(8),D("bump"),D("status"),P("openTime"),P("endTime"),K("ammId"),G(_([D("mintDecimals"),K("mintAddress"),K("mintVault"),P("perLpLoss"),P("totalClaimedAmount")]),nt.CLAIMED_NUM,"tokenInfo"),G(P(),10,"padding")]),Tt.OWNER_LAYOUT=_([Ae(8),D("bump"),D("version"),K("poolId"),K("owner"),P("lpAmount"),G(_([K("mintAddress"),P("debtAmount"),P("claimedAmount")]),nt.CLAIMED_NUM,"tokenInfo"),G(P(),4,"padding")]),Tt.DEFAULT_POOL_ID=["58oQChx4yWmvKdwLLZzBi4ChoCc2fqCUWBkwMihLYQo2","6UmmUiYoBjSrhakAobJw8BvkmJtDVxaeBtbt7rxWo1mg","AVs9TA4nWDzfPJE9gGVNJMVhcQy3V9PGazuz33BfG2RA","DVa7Qmb5ct9RCpaU7UTpSaf3GVMYz17vNVU67XpdCRut","7XawhbbxtsRcQA8KTkHT9f9nc6d69UwqCDh6U5EEbEmX","6a1CsrpeZubDjEJE9s1CMVheB6HWM5d7m1cj2jkhyXhj","EoNrn8iUhwgJySD1pHu8Qxm5gSQqLK3za4m8xzD2RuEb","AceAyRTWt4PyB2pHqf2qhDgNZDtKVNaxgL8Ru3V4aN1P","6tmFJbMk5yVHFcFy7X2K8RwHjKLr6KVFLYXpgpBNeAxB"].map(e=>new hf(e)),Tt.SEED_CONFIG={pool:{id:Buffer.from("pool_seed","utf8")},owner:{id:Buffer.from("user_claim_seed","utf8")}},Tt.VERSION_PROJECT=[void 0,"Francium","Tulip","Larix"];import{PublicKey as Qo}from"@solana/web3.js";import Yo from"bn.js";import{TOKEN_PROGRAM_ID as Ec}from"@solana/spl-token";import{SystemProgram as Cn,SYSVAR_RENT_PUBKEY as Bf,Transaction as _c,TransactionInstruction as xf}from"@solana/web3.js";import{createInitializeAccountInstruction as vc,TOKEN_PROGRAM_ID as Vc}from"@solana/spl-token";function If(o="accountFlags"){let e=new Lr(o);return e.addBoolean("initialized"),e.addBoolean("market"),e.addBoolean("openOrders"),e.addBoolean("requestQueue"),e.addBoolean("eventQueue"),e.addBoolean("bids"),e.addBoolean("asks"),e}var zs=_([Ae(5),If("accountFlags"),K("ownAddress"),P("vaultSignerNonce"),K("baseMint"),K("quoteMint"),K("baseVault"),P("baseDepositsTotal"),P("baseFeesAccrued"),K("quoteVault"),P("quoteDepositsTotal"),P("quoteFeesAccrued"),P("quoteDustThreshold"),K("requestQueue"),K("eventQueue"),K("bids"),K("asks"),P("baseLotSize"),P("quoteLotSize"),P("feeRateBps"),P("referrerRebatesAccrued"),Ae(7)]);function Sf({programId:o,marketInfo:e}){let t=_([D("version"),He("instruction"),P("baseLotSize"),P("quoteLotSize"),Dt("feeRateBps"),P("vaultSignerNonce"),P("quoteDustThreshold")]),n=[{pubkey:e.id,isSigner:!1,isWritable:!0},{pubkey:e.requestQueue,isSigner:!1,isWritable:!0},{pubkey:e.eventQueue,isSigner:!1,isWritable:!0},{pubkey:e.bids,isSigner:!1,isWritable:!0},{pubkey:e.asks,isSigner:!1,isWritable:!0},{pubkey:e.baseVault,isSigner:!1,isWritable:!0},{pubkey:e.quoteVault,isSigner:!1,isWritable:!0},{pubkey:e.baseMint,isSigner:!1,isWritable:!1},{pubkey:e.quoteMint,isSigner:!1,isWritable:!1},{pubkey:e.authority?e.quoteMint:Bf,isSigner:!1,isWritable:!1}].concat(e.authority?{pubkey:e.authority,isSigner:!1,isWritable:!1}:[]).concat(e.authority&&e.pruneAuthority?{pubkey:e.pruneAuthority,isSigner:!1,isWritable:!1}:[]),r=Buffer.alloc(t.span);return t.encode({version:0,instruction:0,baseLotSize:e.baseLotSize,quoteLotSize:e.quoteLotSize,feeRateBps:e.feeRateBps,vaultSignerNonce:e.vaultSignerNonce,quoteDustThreshold:e.quoteDustThreshold},r),new xf({keys:n,programId:o,data:r})}async function Fc({connection:o,wallet:e,marketInfo:t}){var s,a,c,u,l,m,d,p;let n=new _c,r=await o.getMinimumBalanceForRentExemption(165);n.add(Cn.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.baseVault.seed,newAccountPubkey:t.baseVault.publicKey,lamports:r,space:165,programId:Vc}),Cn.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.quoteVault.seed,newAccountPubkey:t.quoteVault.publicKey,lamports:r,space:165,programId:Vc}),vc(t.baseVault.publicKey,t.baseMint,t.vaultOwner),vc(t.quoteVault.publicKey,t.quoteMint,t.vaultOwner));let i=new _c;return i.add(Cn.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.id.seed,newAccountPubkey:t.id.publicKey,lamports:await o.getMinimumBalanceForRentExemption(zs.span),space:zs.span,programId:t.programId}),Cn.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.requestQueue.seed,newAccountPubkey:t.requestQueue.publicKey,lamports:await o.getMinimumBalanceForRentExemption((s=t.requestQueueSpace)!=null?s:5120+12),space:(a=t.requestQueueSpace)!=null?a:5120+12,programId:t.programId}),Cn.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.eventQueue.seed,newAccountPubkey:t.eventQueue.publicKey,lamports:await o.getMinimumBalanceForRentExemption((c=t.eventQueueSpace)!=null?c:262144+12),space:(u=t.eventQueueSpace)!=null?u:262144+12,programId:t.programId}),Cn.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.bids.seed,newAccountPubkey:t.bids.publicKey,lamports:await o.getMinimumBalanceForRentExemption((l=t.orderbookQueueSpace)!=null?l:65536+12),space:(m=t.orderbookQueueSpace)!=null?m:65536+12,programId:t.programId}),Cn.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.asks.seed,newAccountPubkey:t.asks.publicKey,lamports:await o.getMinimumBalanceForRentExemption((d=t.orderbookQueueSpace)!=null?d:65536+12),space:(p=t.orderbookQueueSpace)!=null?p:65536+12,programId:t.programId}),Sf({programId:t.programId,marketInfo:{id:t.id.publicKey,requestQueue:t.requestQueue.publicKey,eventQueue:t.eventQueue.publicKey,bids:t.bids.publicKey,asks:t.asks.publicKey,baseVault:t.baseVault.publicKey,quoteVault:t.quoteVault.publicKey,baseMint:t.baseMint,quoteMint:t.quoteMint,baseLotSize:t.baseLotSize,quoteLotSize:t.quoteLotSize,feeRateBps:t.feeRateBps,vaultSignerNonce:t.vaultSignerNonce,quoteDustThreshold:t.quoteDustThreshold}})),[{transaction:n,signer:[],instructionTypes:[F.CreateAccount,F.CreateAccount,F.InitAccount,F.InitAccount]},{transaction:i,signer:[],instructionTypes:[F.CreateAccount,F.CreateAccount,F.CreateAccount,F.CreateAccount,F.CreateAccount,F.InitMarket]}]}var $n=class extends Se{async create({baseInfo:e,quoteInfo:t,lotSize:n,tickSize:r,dexProgramId:i,requestQueueSpace:s,eventQueueSpace:a,orderbookQueueSpace:c,txVersion:u,computeBudgetConfig:l}){let m=this.scope.ownerPubKey,d=ct({fromPublicKey:m,programId:i}),p=ct({fromPublicKey:m,programId:i}),y=ct({fromPublicKey:m,programId:i}),f=ct({fromPublicKey:m,programId:i}),b=ct({fromPublicKey:m,programId:i}),g=ct({fromPublicKey:m,programId:Ec}),A=ct({fromPublicKey:m,programId:Ec}),w=0,k=new Yo(100);function I(){let W=new Yo(0);for(;;)try{return{vaultOwner:Qo.createProgramAddressSync([d.publicKey.toBuffer(),W.toArrayLike(Buffer,"le",8)],i),vaultSignerNonce:W}}catch{if(W.iaddn(1),W.gt(new Yo(25555)))throw Error("find vault owner error")}}let{vaultOwner:T,vaultSignerNonce:S}=I(),B=new Yo(Math.round(10**e.decimals*n)),C=new Yo(Math.round(n*10**t.decimals*r));if(B.eq(qe))throw Error("lot size is too small");if(C.eq(qe))throw Error("tick size or lot size is too small");let x=await Fc({connection:this.scope.connection,wallet:this.scope.ownerPubKey,marketInfo:{programId:i,id:d,baseMint:e.mint,quoteMint:t.mint,baseVault:g,quoteVault:A,vaultOwner:T,requestQueue:p,eventQueue:y,bids:f,asks:b,feeRateBps:w,quoteDustThreshold:k,vaultSignerNonce:S,baseLotSize:B,quoteLotSize:C,requestQueueSpace:s,eventQueueSpace:a,orderbookQueueSpace:c}}),L=this.createTxBuilder();L.addInstruction({instructions:x[0].transaction.instructions,signers:x[0].signer});for await(let W of x.slice(1,x.length))L.addInstruction({instructions:W.transaction.instructions,signers:W.signer,instructionTypes:W.instructionTypes});return u===0?L.sizeCheckBuildV0({computeBudgetConfig:l,address:{marketId:d.publicKey,requestQueue:p.publicKey,eventQueue:y.publicKey,bids:f.publicKey,asks:b.publicKey,baseVault:g.publicKey,quoteVault:A.publicKey,baseMint:new Qo(e.mint),quoteMin:new Qo(t.mint)}}):L.sizeCheckBuild({computeBudgetConfig:l,address:{marketId:d.publicKey,requestQueue:p.publicKey,eventQueue:y.publicKey,bids:f.publicKey,asks:b.publicKey,baseVault:g.publicKey,quoteVault:A.publicKey,baseMint:new Qo(e.mint),quoteMin:new Qo(t.mint)}})}};import{PublicKey as Ho}from"@solana/web3.js";import Dc from"bn.js";import{SYSVAR_CLOCK_PUBKEY as Kf,TransactionInstruction as Ys}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as js}from"@solana/spl-token";var Qs=_([D("instruction"),ou("amount")]),jo=_([D("instruction")]);function EK({programId:o,amount:e,instructionKeys:t}){let n=[{pubkey:pr,isSigner:!1,isWritable:!1},{pubkey:js,isSigner:!1,isWritable:!1},{pubkey:ut,isSigner:!1,isWritable:!1},{pubkey:Ii,isSigner:!1,isWritable:!1},...Object.entries(t).map(([i,s])=>({pubkey:s,isSigner:i==="userOwner",isWritable:!["authority","userOwner","userIdoCheck","userStakeInfo"].includes(i)}))],r=Buffer.alloc(Qs.span);return Qs.encode({instruction:1,amount:Number(e)},r),new Ys({keys:n,programId:o,data:r})}function ii({programId:o},e){let t=[{pubkey:js,isSigner:!1,isWritable:!1},{pubkey:Ii,isSigner:!1,isWritable:!1},...Object.entries(e).map(([r,i])=>({pubkey:i,isSigner:r==="userOwner",isWritable:!["authority","userOwner"].includes(r)}))],n=Buffer.alloc(jo.span);return jo.encode({instruction:2},n),new Ys({keys:t,programId:o,data:n})}function Hs(o){let{poolConfig:e,userKeys:t,side:n}=o,r=n==="base"?t.baseTokenAccount:t.quoteTokenAccount,i=n==="base"?e.baseVault:e.quoteVault,s=Buffer.alloc(jo.span);jo.encode({instruction:2},s);let a=[{pubkey:js,isWritable:!1,isSigner:!1},{pubkey:Kf,isWritable:!1,isSigner:!1},{pubkey:e.id,isWritable:!0,isSigner:!1},{pubkey:e.authority,isWritable:!1,isSigner:!1},{pubkey:i,isWritable:!0,isSigner:!1},{pubkey:r,isWritable:!0,isSigner:!1},{pubkey:t.ledgerAccount,isWritable:!0,isSigner:!1},{pubkey:t.owner,isWritable:!1,isSigner:!0}];return new Ys({programId:e.programId,keys:a,data:s})}var Cf={[mo.IDO_PROGRAM_ID_V1.toString()]:1,[mo.IDO_PROGRAM_ID_V2.toString()]:2,[mo.IDO_PROGRAM_ID_V3.toString()]:3,[mo.IDO_PROGRAM_ID_V4.toString()]:4},Jn=class extends Se{async claim({ownerInfo:e,idoKeys:t,associatedOnly:n=!0,checkCreateATAOwner:r=!1,txVersion:i}){let s=this.createTxBuilder(),a=Cf[t.programId];a||this.logAndCreateError("invalid version",a);let c=Ie(t),[u,l]=[!new Dc(e.coin).isZero(),!new Dc(e.pc).isZero()],m=c.projectInfo.mint.address.equals(Q),{account:d,instructionParams:p}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:c.projectInfo.mint.programId,mint:c.projectInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!m,notUseTokenAccount:m,associatedOnly:m?!1:n,checkCreateATAOwner:r});!d&&u&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address),u&&p&&s.addInstruction(p);let y=c.buyInfo.mint.address.equals(Q),{account:f,instructionParams:b}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:c.buyInfo.mint.programId,mint:c.buyInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!y,notUseTokenAccount:y,associatedOnly:y?!1:n,checkCreateATAOwner:r});if(!d&&l&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address),l&&b&&s.addInstruction(b),(!d||!f)&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address,t.buyInfo.mint.address),a===3)return s.addInstruction({instructions:[...u?[ii({programId:c.programId},{idoId:c.id,authority:c.authority,poolTokenAccount:c.projectInfo.vault,userTokenAccount:d,userIdoInfo:new Ho(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[],...l?[ii({programId:new Ho(t.programId)},{idoId:c.id,authority:c.authority,poolTokenAccount:c.buyInfo.vault,userTokenAccount:f,userIdoInfo:new Ho(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[]]}).versionBuild({txVersion:i});if(a<3)return!u&&!l&&this.logAndCreateError("no claimable rewards"),s.addInstruction({instructions:[ii({programId:c.programId},{idoId:c.id,authority:c.authority,poolQuoteTokenAccount:c.buyInfo.vault,poolBaseTokenAccount:c.projectInfo.vault,userQuoteTokenAccount:f,userBaseTokenAccount:d,userIdoInfo:new Ho(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]}).versionBuild({txVersion:i});let g={poolConfig:{id:c.id,programId:c.programId,authority:c.authority,baseVault:c.projectInfo.vault,quoteVault:c.buyInfo.vault,baseToken:t.projectInfo.mint,quoteToken:t.buyInfo.mint},userKeys:{baseTokenAccount:d,quoteTokenAccount:f,ledgerAccount:new Ho(e.userIdoInfo),owner:this.scope.ownerPubKey}};return s.addInstruction({instructions:[...u?[Hs(E(R({},g),{side:"base"}))]:[],...l?[Hs(E(R({},g),{side:"quote"}))]:[]]}).versionBuild({txVersion:i})}};import{PublicKey as Rf}from"@solana/web3.js";import{MintLayout as Lf,TOKEN_2022_PROGRAM_ID as Zs,TOKEN_PROGRAM_ID as $s}from"@solana/spl-token";var Zo=class extends Se{constructor(t){super(t);this._tokenList=[];this._tokenMap=new Map;this._blackTokenMap=new Map;this._mintGroup={official:new Set,jup:new Set,extra:new Set};this._whiteMap=new Set;this._extraTokenList=[]}async load(t){this.checkDisabled();let{forceUpdate:n=!1,type:r="strict"}=t||{},{mintList:i,blacklist:s,whiteList:a}=await this.scope.fetchV3TokenList(n),c=await this.scope.fetchJupTokenList(n);this._tokenList=[],this._tokenMap=new Map,this._blackTokenMap=new Map,this._mintGroup={official:new Set,jup:new Set,extra:new Set},this._whiteMap=new Set(a),this._tokenMap.set(Mt.address,Mt),this._mintGroup.official.add(Mt.address),s.forEach(u=>{this._blackTokenMap.set(u.address,E(R({},u),{priority:-1}))}),i.forEach(u=>{var l;this._blackTokenMap.has(u.address)||(this._tokenMap.set(u.address,E(R({},u),{type:"raydium",priority:2,programId:(l=u.programId)!=null?l:u.tags.includes("token-2022")?Zs.toBase58():$s.toBase58()})),this._mintGroup.official.add(u.address))}),c.forEach(u=>{var l;this._blackTokenMap.has(u.address)||this._tokenMap.has(u.address)||(this._tokenMap.set(u.address,E(R({},u),{type:"jupiter",priority:1,programId:(l=u.programId)!=null?l:u.tags.includes("token-2022")?Zs.toBase58():$s.toBase58(),tags:u.freezeAuthority?[...u.tags||[],"hasFreeze"]:u.tags})),this._mintGroup.jup.add(u.address))}),this._extraTokenList.forEach(u=>{this._blackTokenMap.has(u.address)||this._tokenMap.has(u.address)||(this._tokenMap.set(u.address,E(R({},u),{type:"extra",priority:1,programId:u.programId||u.tags.includes("token-2022")?Zs.toBase58():$s.toBase58()})),this._mintGroup.extra.add(u.address))}),this._tokenList=Array.from(this._tokenMap).map(u=>u[1])}get tokenList(){return this._tokenList}get tokenMap(){return this._tokenMap}get blackTokenMap(){return this._blackTokenMap}get mintGroup(){return this._mintGroup}get whiteListMap(){return this._whiteMap}async getTokenInfo(t){if(!t)throw new Error("please input mint");let n=t.toString(),r=this._tokenMap.get(n);if(r)return r;if(n.toLocaleUpperCase()==="SOL")return Mt;let i=(await this.scope.api.getTokenInfo([n]))[0];if(i)return this._mintGroup.extra.add(n),this._tokenMap.set(n,E(R({},i),{priority:2})),i;let s=await this.scope.connection.getAccountInfo(new Rf(n));if(!s)throw new Error(`mint address not found: ${n}`);let a=Lf.decode(s.data),c=n.toString().substring(0,6),u={chainId:101,address:n,programId:s.owner.toBase58(),logoURI:"",symbol:c,name:c,decimals:a.decimals,tags:[],extensions:{},priority:0,type:"unknown"};return this._mintGroup.extra.add(n),this._tokenMap.set(n,u),u}};var si=class{constructor(e){this.rawBalances=new Map;let{connection:t,cluster:n,owner:r,api:i,defaultChainTime:s,defaultChainTimeOffset:a,apiCacheTime:c,blockhashCommitment:u="confirmed"}=e;this._connection=t,this.cluster=n||"mainnet",this._owner=r?new St(r):void 0,this._signAllTransactions=e.signAllTransactions,this.blockhashCommitment=u,this.api=i,this._apiCacheTime=c||5*60*1e3,this.logger=ce("Raydium"),this.farm=new Ro({scope:this,moduleName:"Raydium_Farm"}),this.account=new wo({scope:this,moduleName:"Raydium_Account",tokenAccounts:e.tokenAccounts,tokenAccountRawInfos:e.tokenAccountRawInfos}),this.liquidity=new Do({scope:this,moduleName:"Raydium_LiquidityV2"}),this.token=new Zo({scope:this,moduleName:"Raydium_tokenV2"}),this.tradeV2=new zo({scope:this,moduleName:"Raydium_tradeV2"}),this.clmm=new Wo({scope:this,moduleName:"Raydium_clmm"}),this.cpmm=new Xo({scope:this,moduleName:"Raydium_cpmm"}),this.utils1216=new Tt({scope:this,moduleName:"Raydium_utils1216"}),this.marketV2=new $n({scope:this,moduleName:"Raydium_marketV2"}),this.ido=new Jn({scope:this,moduleName:"Raydium_ido"}),this.availability={};let l=new Date().getTime();this.apiData={},a&&(this._chainTime={fetched:l,value:{chainTime:s||Date.now()-a,offset:a}})}static async load(e){var l;let t=Of({cluster:"mainnet",owner:null,apiRequestInterval:3e5,apiRequestTimeout:1e4},e),{cluster:n,apiRequestTimeout:r,logCount:i,logRequests:s,urlConfigs:a}=t,c=new Br({cluster:n,timeout:r,urlConfigs:a,logCount:i,logRequests:s}),u=new si(E(R({},t),{api:c}));return await u.fetchAvailabilityStatus((l=e.disableFeatureCheck)!=null?l:!0),e.disableLoadToken||await u.token.load({type:e.jupTokenType}),u}get owner(){return this._owner}get ownerPubKey(){if(!this._owner)throw new Error(xr);return this._owner.publicKey}setOwner(e){return this._owner=e?new St(e):void 0,this.account.resetTokenAccounts(),this}get connection(){if(!this._connection)throw new Error(Ya);return this._connection}setConnection(e){return this._connection=e,this}get signAllTransactions(){return this._signAllTransactions}setSignAllTransactions(e){return this._signAllTransactions=e,this}checkOwner(){if(!this.owner)throw this.logger.error(xr),new Error(xr)}isCacheInvalidate(e){return new Date().getTime()-e>this._apiCacheTime}async fetchChainTime(){try{let e=await this.api.getChainTimeOffset();this._chainTime={fetched:Date.now(),value:{chainTime:Date.now()+e.offset*1e3,offset:e.offset*1e3}}}catch{this._chainTime=void 0}}async fetchV3TokenList(e){if(this.apiData.tokenList&&!this.isCacheInvalidate(this.apiData.tokenList.fetched)&&!e)return this.apiData.tokenList.data;try{let t=await this.api.getTokenList(),n={fetched:Date.now(),data:t};return this.apiData.tokenList=n,n.data}catch(t){return console.error(t),{mintList:[],blacklist:[],whiteList:[]}}}async fetchJupTokenList(e){let t=this.apiData.jupTokenList;if(t&&!this.isCacheInvalidate(t.fetched)&&!e)return t.data;try{let n=await this.api.getJupTokenList();return this.apiData.jupTokenList={fetched:Date.now(),data:n.map(r=>E(R({},r),{mintAuthority:r.mint_authority||void 0,freezeAuthority:r.freeze_authority||void 0}))},this.apiData.jupTokenList.data}catch(n){return console.error(n),[]}}get chainTimeData(){var e;return(e=this._chainTime)==null?void 0:e.value}async chainTimeOffset(){var e;return this._chainTime&&Date.now()-this._chainTime.fetched<=1e3*60*5?this._chainTime.value.offset:(await this.fetchChainTime(),((e=this._chainTime)==null?void 0:e.value.offset)||0)}async currentBlockChainTime(){var e;return this._chainTime&&Date.now()-this._chainTime.fetched<=1e3*60*5?this._chainTime.value.chainTime:(await this.fetchChainTime(),((e=this._chainTime)==null?void 0:e.value.chainTime)||Date.now())}async fetchEpochInfo(){return this._epochInfo&&Date.now()-this._epochInfo.fetched<=1e3*30?this._epochInfo.value:(this._epochInfo={fetched:Date.now(),value:await this.connection.getEpochInfo()},this._epochInfo.value)}async fetchAvailabilityStatus(e){if(e)return{};try{let t=await this.api.fetchAvailabilityStatus(),n=t.all===!1;return this.availability={all:t.all,swap:n?!1:t.swap,createConcentratedPosition:n?!1:t.createConcentratedPosition,addConcentratedPosition:n?!1:t.addConcentratedPosition,addStandardPosition:n?!1:t.addStandardPosition,removeConcentratedPosition:n?!1:t.removeConcentratedPosition,removeStandardPosition:n?!1:t.removeStandardPosition,addFarm:n?!1:t.addFarm,removeFarm:n?!1:t.removeFarm},t}catch{return{}}}};var W0=o=>o;export{Gf as ACCOUNT_TYPE_SIZE,Ag as ALL_PROGRAM_ID,dp as AMM_CONFIG_SEED,wm as AMM_STABLE,Mi as AMM_V4,Oy as ANAMint,_e as API_URLS,jc as AccountType,Br as Api,Ou as BIT_PRECISION,Kt as BNDivCeil,An as BNLayout,Eb as BN_100,Db as BN_1000,Wb as BN_10000,Fb as BN_FIVE,Ca as BN_ONE,fn as BN_TEN,Vb as BN_THREE,vb as BN_TWO,qe as BN_ZERO,HA as BitStructure,nu as Blob,lo as CLMM_LOCK_AUTH_ID,co as CLMM_LOCK_PROGRAM_ID,uo as CLMM_PROGRAM_ID,Ii as CLOCK_PROGRAM_ID,Bm as CREATE_CPMM_POOL_AUTH,xm as CREATE_CPMM_POOL_FEE_ACC,_i as CREATE_CPMM_POOL_PROGRAM,Wo as Clmm,Qu as ClmmConfigLayout,Te as ClmmInstrument,Qr as ConstantProductCurve,Sc as CpmmConfigInfoLayout,Yr as CpmmFee,Jr as CpmmPoolInfoLayout,io as Currency,pn as CurrencyAmount,Hr as CurveCalculator,wg as DEVNET_PROGRAM_ID,rA as DEV_API_URLS,Km as DEV_CREATE_CPMM_POOL_AUTH,Cm as DEV_CREATE_CPMM_POOL_FEE_ACC,Sm as DEV_CREATE_CPMM_POOL_PROGRAM,_p as DataElement,Ny as ETHMint,ks as EXTENSION_TICKARRAY_BITMAP_SIZE,Pu as FARM_LOCK_MINT,hu as FARM_LOCK_VAULT,Oi as FARM_PROGRAM_ID_V3,Ni as FARM_PROGRAM_ID_V5,En as FARM_PROGRAM_ID_V6,wt as FARM_PROGRAM_TO_VERSION,Tu as FARM_VERSION_TO_LEDGER_LAYOUT,ku as FARM_VERSION_TO_STATE_LAYOUT,gg as FEE_DESTINATION_ID,Vr as FEE_RATE_DENOMINATOR,Vs as FEE_RATE_DENOMINATOR_VALUE,hp as FETCH_TICKARRAY_COUNT,mp as Fee,ie as Fraction,mo as IDO_ALL_PROGRAM,hm as IDO_PROGRAM_ID_V1,km as IDO_PROGRAM_ID_V2,Tm as IDO_PROGRAM_ID_V3,Im as IDO_PROGRAM_ID_V4,dr as INSTRUCTION_PROGRAM_ID,F as InstructionType,Ga as JupTokenType,qr as LIQUIDITY_FEES_DENOMINATOR,xs as LIQUIDITY_FEES_NUMERATOR,qa as LIQUIDITY_POOL_PROGRAM_ID_V5_MODEL,Op as LIQUIDITY_VERSION_TO_SERUM_VERSION,oI as LIQUIDITY_VERSION_TO_STATE_LAYOUT,Nu as LOG_B_2_X32,Mu as LOG_B_P_ERR_MARGIN_LOWER_X64,_u as LOG_B_P_ERR_MARGIN_UPPER_X64,kr as LOOKUP_TABLE_CACHE,go as Layout,me as LiquidityMath,bT as LockPositionLayout,Gc as LogLevel,ci as Logger,zs as MARKET_STATE_LAYOUT_V2,Ws as MARKET_STATE_LAYOUT_V3,Rc as MARKET_VERSION_TO_STATE_LAYOUT,Fa as MAX_BASE64_SIZE,kt as MAX_SQRT_PRICE_X64,vr as MAX_SQRT_PRICE_X64_SUB_ONE,it as MAX_TICK,mr as MEMO_PROGRAM_ID,vn as MEMO_PROGRAM_ID2,Vn as METADATA_PROGRAM_ID,ht as MIN_SQRT_PRICE_X64,_r as MIN_SQRT_PRICE_X64_ADD_ONE,et as MIN_TICK,Qn as MODEL_DATA_PUBKEY,ni as Market,ne as MathUtil,gs as MaxU64,Lu as MaxUint128,Gt as NEGATIVE_ONE,Ly as NRVMint,wp as OBSERVATION_SEED,bt as ONE,Am as OPEN_BOOK_PROGRAM,gp as OPERATION_SEED,Yu as ObservationInfoLayout,Ip as ObservationLayout,ju as OperationLayout,Yi as OptionLayout,St as Owner,Iy as PAIMint,Pp as POOL_LOCK_ID_SEED,yp as POOL_REWARD_VAULT_SEED,pp as POOL_SEED,Ap as POOL_TICK_ARRAY_BITMAP_SEED,fp as POOL_VAULT_SEED,Du as POSITION_SEED,Ke as Percent,Xa as PoolFetchType,kn as PoolInfoLayout,Ce as PoolUtils,Dr as PositionInfoLayout,xp as PositionRewardInfoLayout,Mo as PositionUtils,Ge as Price,yT as ProtocolPositionLayout,Mr as Q128,gt as Q64,Ty as RAYMint,ut as RENT_PROGRAM_ID,si as Raydium,Bp as RewardInfo,gc as RoundDirection,wi as Rounding,Pm as Router,Kc as SERUM_PROGRAMID_TO_VERSION,Pr as SERUM_PROGRAM_ID_V3,Cc as SERUM_VERSION_TO_PROGRAMID,za as SESSION_KEY,We as SOLMint,Mt as SOL_INFO,OT as SPL_MINT_LAYOUT,By as SRMMint,Fi as STORAGE_KEY,pr as SYSTEM_PROGRAM_ID,ee as SqrtPriceMath,zn as StableLayout,ji as Structure,hn as SwapMath,Pn as TICK_ARRAY_BITMAP_SIZE,bp as TICK_ARRAY_SEED,Ue as TICK_ARRAY_SIZE,Zh as TICK_SPACINGS,De as TOKEN_WSOL,Xt as TickArrayBitmap,zu as TickArrayBitmapExtensionLayout,vo as TickArrayBitmapExtensionUtils,_o as TickArrayLayout,Sp as TickLayout,Tn as TickMath,de as TickQuery,j as TickUtils,be as Token,fe as TokenAmount,Tr as TxBuilder,bn as TxVersion,Lo as U64Resolution,Jh as U64_IGNORE_RANGE,Xi as UInt,xy as USDCMint,Ry as USDHMint,Sy as USDTMint,gm as UTIL1216,Hi as Union,Au as Voter,Hd as VoterDepositEntry,jd as VoterLockup,gu as VoterRegistrar,Yd as VoterVotingMintConfig,Q as WSOLMint,Lr as WideBits,Wt as WrappedLayout,pe as ZERO,Ba as _100_PERCENT,h as accountMeta,gb as add,gr as addComputeBudget,Rs as addLiquidityLayout,_w as array,es as associatedLedgerAccountLayout,zi as bits,Ae as blob,Ze as bool,ps as calFarmRewardAmount,of as ceilDiv,so as checkLegacyTxSize,ao as checkV0TxSize,di as chunkArray,jo as claimLayout,Xu as clmmComputeInfoToApiInfo,qt as closeAccountInstruction,hi as commonSystemAccountMeta,Ar as confirmTransaction,xo as createAssociatedLedgerAccountInstruction,ce as createLogger,tc as createPoolFeeLayout,lc as createPoolV4InstructionV2,nI as createPoolV4Layout,Ut as createWSolAccountInstructions,Iw as cstr,qy as currencyEquals,um as decimalToFraction,Kd as decodeBool,pb as div,fr as divCeil,rt as dwLayout,Cd as encodeBool,BA as endlessRetry,om as eq,ww as f32,Pw as f32be,hw as f64,kw as f64be,rs as farmAddRewardLayout,CP as farmLedgerLayoutV3_1,ho as farmLedgerLayoutV3_2,RP as farmLedgerLayoutV5_1,yu as farmLedgerLayoutV5_2,bu as farmLedgerLayoutV6_1,Bu as farmRewardInfoToConfig,ns as farmRewardLayout,os as farmRewardRestartLayout,Qd as farmRewardTimeInfoLayout,pu as farmStateV3Layout,fu as farmStateV5Layout,Po as farmStateV6Layout,th as fetchMultipleFarmInfoAndUpdate,vI as fetchMultipleInfo,Nn as fetchMultipleMintInfos,ae as findProgramAddress,Ss as fixedSwapInLayout,Ks as fixedSwapOutLayout,Ac as floorDiv,wr as forecastTransactionSize,Xp as formatLayout,ct as generatePubKey,ge as getATAAddress,Iu as getAssociatedAuthority,Gr as getAssociatedConfigId,Je as getAssociatedLedgerAccount,To as getAssociatedLedgerPoolAccount,ef as getAssociatedOpenOrders,pc as getAssociatedPoolKeys,ox as getCpmmPdaAmmConfigId,Es as getCpmmPdaPoolId,hc as getCreatePoolKeys,Oa as getDate,fs as getDepositEntryIndex,ic as getDxByDyBaseIn,rc as getDyByDxBaseIn,cg as getEpochInfo,Gn as getFarmLedgerLayout,Zd as getFarmStateLayout,vs as getLiquidityAssociatedAuthority,xn as getLiquidityAssociatedId,Xk as getLiquidityFromAmounts,bb as getMax,It as getMultipleAccountsInfo,Fe as getMultipleAccountsInfoWithCustomFlags,vi as getMultipleLookupTableInfo,sk as getPdaAmmConfigId,dt as getPdaExBitmapAccount,hs as getPdaLockPositionId,mf as getPdaLpMint,Er as getPdaMetadataKey,Uu as getPdaObservationAccount,Zr as getPdaObservationId,No as getPdaOperationAccount,mt as getPdaPersonalPositionAddress,Zn as getPdaPoolAuthority,Wu as getPdaPoolId,qu as getPdaPoolRewardVaulId,Ps as getPdaPoolVaultId,ln as getPdaProtocolPositionAddress,we as getPdaTickArrayAddress,Pc as getPdaVault,Fn as getRecentBlockHash,as as getRegistrarAddress,Lm as getSessionKey,sc as getStablePrice,lm as getTime,Tb as getTimestamp,ds as getTokenOwnerRecordAddress,kg as getTransferAmountFee,ye as getTransferAmountFeeV2,ls as getVoterAddress,ms as getVoterWeightRecordAddress,cs as getVotingMintAuthority,us as getVotingTokenMint,sp as governanceCreateTokenOwnerRecord,ZA as greedy,nm as gt,db as gte,cu as i128,tk as i16ToBytes,Fr as i32ToBytes,Wn as i64,uu as i8,Cs as initPoolLayout,$i as initTokenAccountInstruction,Sf as initializeMarket,Yb as intersection,Ma as isDateAfter,Na as isDateBefore,cm as isDecimal,yb as isMeaningfulNumber,La as isNumber,is as isValidFarmVersion,Oo as isZero,Ie as jsonInfo2PoolKeys,nh as judgeFarmType,As as leadingZeros,Eu as leastSignificantBit,Fo as liquidityStateV4Layout,Np as liquidityStateV5Layout,lb as lt,mb as lte,Ky as mSOLMint,Ur as makeAMMSwapInstruction,cc as makeAddLiquidityInstruction,bs as makeAddNewRewardInstruction,ii as makeClaimInstruction,Hs as makeClaimInstructionV4,Tc as makeCreateCpmmPoolInInstruction,xu as makeCreateFarmInstruction,Fc as makeCreateMarketInstruction,Su as makeCreatorWithdrawFarmRewardInstruction,Ic as makeDepositCpmmInInstruction,Ku as makeDepositInstructionV3,Cu as makeDepositInstructionV5,Ru as makeDepositInstructionV6,Ah as makeDepositTokenInstruction,Ph as makeDepositWithdrawInstruction,PI as makeInitPoolInstructionV4,EK as makePurchaseInstruction,ys as makeRestartRewardInstruction,mc as makeSimulatePoolInfoInstruction,$r as makeSwapCpmmBaseInInInstruction,xc as makeSwapCpmmBaseOutInInstruction,Yp as makeSwapFixedInInstruction,jp as makeSwapFixedOutInstruction,Oc as makeSwapInstruction,du as makeTransferInstruction,Bc as makeWithdrawCpmmInInstruction,Co as makeWithdrawInstructionV3,Ko as makeWithdrawInstructionV5,So as makeWithdrawInstructionV6,wh as makeWithdrawTokenInstruction,Ct as minExpirationTime,$h as mockCreatePoolInfo,vu as mockV3CreatePoolInfo,vp as modelDataInfoLayout,Fu as mostSignificantBit,Ci as mul,Ri as notInnerObject,dw as ns64,Aw as ns64be,ou as nu64,sw as nu64be,Qi as offset,zb as offsetDateTime,Rw as option,z as parseBigNumberish,yn as parseNumberInfo,Da as parseSimulateLogToJson,Et as parseSimulateValue,mu as parseTokenAccountResp,qT as parseTokenInfo,cn as poolTypeV6,gn as printSimulate,K as publicKey,Qs as purchaseLayout,Gd as realFarmStateV3Layout,Xd as realFarmStateV5Layout,zd as realFarmV6Layout,Ka as recursivelyDecimalToFraction,Ns as removeLiquidityInstruction,Ls as removeLiquidityLayout,PS as route1Instruction,hS as route2Instruction,wf as routeInstruction,Mw as rustEnum,uw as s16,pw as s16be,cw as s24,fw as s24be,je as s32,yw as s32be,lw as s40,bw as s40be,mw as s48,gw as s48be,aw as s8,G as seq,_f as setLoggerLevel,sm as shakeFractionDecimal,Ea as simulateMultipleInstruction,wI as simulatePoolInfoInstruction,pm as simulateTransaction,xa as sleep,ft as solToWSol,GT as solToWSolToken,an as splAccountLayout,ka as splitNumber,Cy as stSOLMint,Nw as str,_ as struct,fb as sub,Ow as tagged,Ki as tenExponential,Xr as toAmmComputePoolInfo,st as toApiV3Token,am as toBN,Wa as toBuffer,mn as toFeeConfig,Ra as toFraction,cb as toFractionWithDecimals,qb as toPercent,Wr as toToken,Vo as toTokenAmount,UT as toTokenInfo,Ub as toTokenPrice,Gb as toTotalPrice,Sa as toUsdCurrency,ws as trailingZeros,lg as transformTxToBase64,Ti as tryParsePublicKey,fm as txToBase64,J as u128,Dt as u16,Vu as u16ToBytes,tw as u16be,$A as u24,nw as u24be,He as u32,nk as u32ToBytes,ow as u32be,JA as u40,rw as u40be,ew as u48,iw as u48be,P as u64,D as u8,vw as union,W0 as unionArr,Tw as unionLayoutDiscriminator,Hb as uniq,$d as updateFarmPoolInfo,Ir as updateReqHistory,Bw as utf8,ki as validateAndParsePublicKey,ss as validateFarmRewards,Lw as vec,Rd as vecU8,up as voterStakeRegistryCreateDepositEntry,ap as voterStakeRegistryCreateVoter,op as voterStakeRegistryDeposit,rp as voterStakeRegistryUpdateVoterWeightRecord,ip as voterStakeRegistryWithdraw,XT as wSolToSolToken,ts as withdrawRewardLayout,jb as xor,Vw as zeros};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=index.mjs.map